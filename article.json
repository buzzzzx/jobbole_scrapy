{"url_object_id": "686dfefb107681a80169eabfd8e284a0", "title": "给中级 Meld 用户的实用技巧", "create_time": "2017/09/03", "url": "http://blog.jobbole.com/112348/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8808-1.html\">Linux中国/geekpi</a>   </div><p>Meld 是 Linux 上功能丰富的可视化比较和合并工具。如果你是第一次接触，你可以进入我们的<a href=\"http://blog.jobbole.com/112344/\">初学者指南</a>，了解该程序的工作原理，如果你已经阅读过或正在使用 Meld 进行基本的比较/合并任务，你将很高兴了解本教程的东西，在本教程中，我们将讨论一些非常有用的技巧，这将让你使用工具的体验更好。</p>\n<p><em>但在我们跳到安装和解释部分之前，值得一提的是，本教程中介绍的所有说明和示例已在 Ubuntu 14.04 上进行了测试，而我们使用的 Meld 版本为 3.14.2</em>。</p>\n<h3 id=\"toc_1\">1、 跳转</h3>\n<p>你可能已经知道（我们也在初学者指南中也提到过这一点），标准滚动不是在使用 Meld 时在更改之间跳转的唯一方法 – 你可以使用向上和向下箭头键轻松地从一个更改跳转到另一个更改位于编辑区域上方的窗格中：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-go-next-prev-9.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ffe53b7d64bad7dac95f36ba889bc13d.png\" alt=\"Navigating in Meld\"></a></p>\n<p>但是，这需要你将鼠标指针移动到这些箭头，然后再次单击其中一个（取决于你要去哪里 – 向上或向下）。你会很高兴知道，存在另一种更简单的方式来跳转：只需使用鼠标的滚轮即可在鼠标指针位于中央更改栏上时进行滚动。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-center-area-scrolling.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/84810b35573d599d2a5a3ef2d2ee916e.png\" alt=\"The change bar\"></a></p>\n<p>这样，你就可以在视线不离开或者分心的情况下进行跳转，</p>\n<h3 id=\"toc_2\">2、 可以对更改进行的操作</h3>\n<p>看下上一节的最后一个屏幕截图。你知道那些黑箭头做什么吧？默认情况下，它们允许你执行合并/更改操作 – 当没有冲突时进行合并，并在同一行发生冲突时进行更改。</p>\n<p>但是你知道你可以根据需要删除个别的更改么？是的，这是可能的。为此，你需要做的是在处理更改时按下 Shift 键。你会观察到箭头被变成了十字架。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-delete-changes.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c867a5a2a0153b0a72912ff16ef19151.png\" alt=\"Things you can do with changes\"></a></p>\n<p>只需点击其中任何一个，相应的更改将被删除。</p>\n<p>不仅是删除，你还可以确保冲突的更改不会在合并时更改行。例如，以下是一个冲突变化的例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-conflicting-change.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/746a354faaf438fa66001862e1956e1b.png\" alt=\"Delete changes in Meld\"></a></p>\n<p>现在，如果你点击任意两个黑色箭头，箭头指向的行将被改变，并且将变得与其他文件的相应行相似。只要你想这样做，这是没问题的。但是，如果你不想要更改任何行呢？相反，目的是将更改的行在相应行的上方或下方插入到其他文件中。</p>\n<p>我想说的是，例如，在上面的截图中，需要在 “test23” 之上或之下添加 “test 2”，而不是将 “test23” 更改为 “test2”。你会很高兴知道在 Meld 中这是可能的。就像你按下 Shift 键删除注释一样，在这种情况下，你必须按下 Ctrl 键。</p>\n<p>你会观察到当前操作将被更改为插入 – 双箭头图标将确认这一点 。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-ctrl-insert.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d48a91909a13070aadaac9d3377057ba.png\" alt=\"Change actions\"></a></p>\n<p>从箭头的方向看，此操作可帮助用户将当前更改插入到其他文件中的相应更改 (如所选择的)。</p>\n<h3 id=\"toc_3\">3、 自定义文件在 Meld 的编辑器区域中显示的方式</h3>\n<p>有时候，你希望 Meld 的编辑区域中的文字大小变大（为了更好或更舒适的浏览），或者你希望文本行被包含而不是脱离视觉区域（意味着你不要想使用底部的水平滚动条）。</p>\n<p>Meld 在 <em>Editor</em> 选项卡（<em>Edit-&gt;Preferences-&gt;Editor</em>）的 <em>Preferences</em> 菜单中提供了一些显示和字体相关的自定义选项，你可以进行这些调整：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-editor-tab.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e338b0cbc7bfbabd22b4ee2d44ff46d7.png\" alt=\"Meld preferences\"></a></p>\n<p>在这里你可以看到，默认情况下，Meld 使用系统定义的字体宽度。只需取消选中 <em>Font</em> 类别下的框，你将有大量的字体类型和大小选项可供选择。</p>\n<p>然后在 <em>Display</em> 部分，你将看到我们正在讨论的所有自定义选项：你可以设置 Tab 宽度、告诉工具是否插入空格而不是 tab、启用/禁用文本换行、使Meld显示行号和空白（在某些情况下非常有用）以及使用语法突出显示。</p>\n<h3 id=\"toc_4\">4、 过滤文本</h3>\n<p>有时候，并不是所有的修改都是对你很重要的。例如，在比较两个 C 编程文件时，你可能不希望 Meld 显示注释中的更改，因为你只想专注于与代码相关的更改。因此，在这种情况下，你可以告诉 Meld 过滤（或忽略）与注释相关的更改。</p>\n<p>例如，这里是 Meld 中的一个比较，其中由工具高亮了注释相关更改：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-with-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb371296bbb42b3f6f915ac9b972510b.png\" alt=\"Filter Text in Meld\"></a></p>\n<p>而在这种情况下，Meld 忽略了相同的变化，仅关注与代码相关的变更：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-without-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/90750b2dd9bb246c780ae1b82fced95e.png\" alt=\"Ignore Changes in Meld\"></a></p>\n<p>很酷，不是吗？那么这是怎么回事？为此，我是在 “<em>Edit-&gt;Preferences-&gt;Text Filters</em>” 标签中启用了 “C comments” 文本过滤器：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-text-filters.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/411274b89687a5a801c83b74a4310ac3.png\" alt=\"C-Comments in Meld\"></a></p>\n<p>如你所见，除了 “C comments” 之外，你还可以过滤掉 C++ 注释、脚本注释、引导或所有的空格等。此外，你还可以为你处理的任何特定情况定义自定义文本过滤器。例如，如果你正在处理日志文件，并且不希望 Meld 高亮显示特定模式开头的行中的更改，则可以为该情况定义自定义文本过滤器。</p>\n<p>但是，请记住，要定义一个新的文本过滤器，你需要了解 Python 语言以及如何使用该语言创建正则表达式。</p>\n<h3 id=\"toc_5\">总结</h3>\n<p>这里讨论的所有四个技巧都不是很难理解和使用（当然，除了你想立即创建自定义文本过滤器），一旦你开始使用它们，你会认为他们是真的有好处。这里的关键是要继续练习，否则你学到的任何技巧不久后都会忘记。</p>\n<p>你还知道或者使用其他任何中级 Meld 的贴士和技巧么？如果有的话，欢迎你在下面的评论中分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112348\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112348votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112348\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"}
{"url_object_id": "382269592e7d5f328aeab89feab6e845", "title": "Linux 系统上的可视化比较与合并工具 Meld", "create_time": "2017/09/02", "url": "http://blog.jobbole.com/112344/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/dbde9a54537cff686561f4ea367befd3.png"], "praise_num": "1", "comment_num": 0, "fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/beginners-guide-to-visual-merge-tool-meld-on-linux/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8402-1.html\">Linux中国/GitFuture</a>   </div><p>我们已经<a href=\"https://www.howtoforge.com/tutorial/linux-diff-command-file-comparison/\">讲过</a> Linux 中<a href=\"https://www.howtoforge.com/tutorial/how-to-compare-three-files-in-linux-using-diff3-tool/\">一些</a>基于命令行的比较和合并工具，再来讲解该系统的一些可视化的比较与合并工具也很合理。首要的原因是，不是每个人都习惯使用命令行，而且对于某些人来说，基于命令行的比较工具可能很难学习和理解。</p>\n<p>因此，我们将会推出关于可视化工具 <strong>Meld</strong> 的系列文章。</p>\n<p>在跳到安装和介绍部分前，我需要说明这篇教程里所有的指令和用例是都是可用的，而且它们已经在 Ubuntu 14.04 中测试过了，我们使用的 Meld 版本是 3.14.2。</p>\n<h3 id=\"toc_1\">关于 Meld</h3>\n<p><a href=\"http://meldmerge.org/\">Meld</a> 主要是一个可视化的比较和合并的工具，目标人群是开发者（当然，我们将要讲到的其它部分也会考虑到最终用户）。这个工具同时支持双向和三向的比较，不仅仅是比较文件，还可以比较目录，以及版本控制的项目。</p>\n<p>“Meld 可以帮你回顾代码改动，理解补丁，”其官网如是说。“它甚至可以告知你如果你不进行合并将会发生什么事情。”该工具使用 GPL v2 协议进行授权。</p>\n<h3 id=\"toc_2\">安装 Meld</h3>\n<p>如果你用的是 Ubuntu 或者其它基于 Debian 的 Linux 分支，你可以用以下命令下载安装 Meld：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8b6270f884520737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-get install meld\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8b6270f884520737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8b6270f884520737-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8b6270f884520737-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">meld</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8b6270f884520737-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>或者你也可以用系统自带的包管理软件下载这个工具。比如在 Ubuntu 上，你可以用 Ubuntu 软件中心（Ubuntu Software Center），或者用 <a href=\"https://www.howtoforge.com/tutorial/ubuntu-16-04-lts-overview/\">Ubuntu 软件</a>，它从 Ubuntu 16.04 版本开始取代了 Ubuntu 软件中心。</p>\n<p>当然，Ubuntu 官方仓库里的 Meld 版本很有可能比较陈旧。因此如果你想要用更新的版本，你可以在<a href=\"https://git.gnome.org/browse/meld/refs/tags\">这里</a>下载软件包。如果你要用这个方法，你要做的就是解压下载好的软件包，然后运行 <code>bin</code> 目录下的 <code>meld</code> 程序。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8b62719361608114\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n~/Downloads/meld-3.14.2/bin$ ./meld \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8b62719361608114-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8b62719361608114-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8b62719361608114-1\"><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meld</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.14.2</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-sy\">$</span> <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">meld</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8b62719361608114-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>以下是 Meld 依赖的软件，仅供参考：</p>\n<ul>\n<li>Python 2.7 (Python 3.3 开发版)</li>\n<li>GTK+ 3.14</li>\n<li>GLib 2.36</li>\n<li>PyGObject 3.14</li>\n<li>GtkSourceView 3.14</li>\n<li>pycairo</li>\n</ul>\n<h3 id=\"toc_3\">使用 Meld</h3>\n<p>装好了软件，就可以看到类似这样的画面：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/dbde9a54537cff686561f4ea367befd3.png\" alt=\"Meld started\"></p>\n<p>有三个选项：比较文件（File comparison），比较目录（Directory comparison）以及版本控制视图（Version control view）。</p>\n<p>点击“比较文件”选项，就可以选择需要比较的文件：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/060bead6118e149e3a57c576d37d1376.png\" alt=\"Meld file comparison\"></p>\n<p>就像上面的截图那样明白，Meld 也可以进行三向比较，但是在这一系列文章的第一部分，我们只会讲更常用的双向比较。</p>\n<p>接着，选择你想要比较的文件，点击“比较”（Compare）按钮。软件会在两边分别打开两个文件，高亮不同的行（以及不同的部分）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/7eb08063baf7cb031a6a6f4b445926c3.png\" alt=\"Compare files in Meld\"></p>\n<p>两个文件的不同之处在第二行，差别在于 <code>file2</code> 文件的第二行多了一个 <code>3</code>。你看到的黑色箭头是用来进行合并或修改的操作的。该例中，向右的箭头将会把 <code>file2</code> 文件的第二行改成文件 <code>file1</code> 中对应行的内容。左向箭头做的事情相反。</p>\n<p>做完修改后，按下 <code>Ctrl+s</code> 来保存。</p>\n<p>这个简单的例子，让你知道 Meld 的基本用法。让我们看一看稍微复杂一点的比较：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3a1b7484b6c3766fda278db4b7d7f970.png\" alt=\"Meld advanced file comparison\"></p>\n<p>在讨论这些变化前，这里提一下， Meld 的界面中有几个区域，可以给出文件之间的差异，让概况变得直观。这里特别需要注意窗口的左右两边垂直的栏。比如下面这个截图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4ea9541f9c58840d7e096fa4bebd7813.png\" alt=\"Visual Comparison\"></p>\n<p>仔细观察，图中的这个栏包含几个不同颜色的区块。这些区块是用来让你对文件之间的差异有个大概的了解。“每一个着色的区块表示一个部分，这个部分可能是插入、删除、修改或者有差别的，取决于区块所用的颜色。”官方文档是这样说的。</p>\n<p>现在，让我们回到我们之前讨论的例子中。接下来的截图展示了用 Meld 理解文件的改动是很简单的（以及合并这些改动）：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d58833eab9d7ba00aabab813c6e0969b.png\" alt=\"File changes visualized in Meld\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6f8a5ac900f6e386e0f4982445ee0da8.png\" alt=\"Meld Example 2\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/92013c7ba1d58181b101d6d566b01afb.png\" alt=\"Meld Example 3\"></p>\n<p>接着，我们滑动文件，从一个改动跳到另一个。但是，当要比较的文件很大时，这会耗一点时间，当你想要滑动文件跳到一个改动的位置时，也会变得很困难。如果是这种情况的话，你可以用工具栏的橙色箭头，就在编辑区域的上方：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/98ecd8d98e47b079342b86dd9b0867b3.png\" alt=\"Go to next change in Meld\"></p>\n<p>这些是你使用 Meld 时做的一般性的事情：可以用标准的 <code>Ctrl+f</code> 组合键在编辑区域内进行查找，按 <code>F11</code> 键让软件进入全屏模式，再按 <code>Ctrl+r</code> 来刷新（通常在所有要比较的文件改变的时候使用）。</p>\n<p>以下是 Meld 官方网站宣传的重要特性：</p>\n<ul>\n<li>文件和目录的双向及三向比较</li>\n<li>输入即更新文件的比较</li>\n<li>自动合并模式，按块改动的动作让合并更加简单</li>\n<li>可视化让比较文件更简单</li>\n<li>支持 Git，Bazaar，Mercurial，Subversion 等等</li>\n</ul>\n<p>注意还不仅仅只有以上所列的。网站上有个专门的<a href=\"http://meldmerge.org/features.html\">特性页面</a>，里面提到了 Meld 提供的所有特性。这个页面列出的所有特性分为几个部分，以该软件是用来做文件比较、目录比较、版本控制还是处于合并模式下为基础进行划分。</p>\n<p>和其它软件相似，有些事情 Meld 做不到。官方网站上列出了其中的一部分：“当 Meld 展示文件之间的差异时，它同时显示两个文件，看起来就像在普通的文本编辑器中。它不会添加额外的行，让左右两边文件的特殊改动处于同样的行数。没有做这个事情的选项。”</p>\n<h3 id=\"toc_4\">总结</h3>\n<p>我们刚刚了解到的不过是皮毛，因为 Meld 还能做很多事情。考虑到这是教程系列的第一部分，这也挺不错的。这仅仅是让你了解 Meld 的作用，你可以配置它，忽略一些特定类型的改动，让它移动，复制或者删除文件之间的个别差异，也可以从命令行启动它。在即将推出的系列教程中，我们将会讲述所有这些重要功能。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112344\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112344votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112344\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/fe1d173df391bea51437d0e7fa21c5de4375111c.jpg"}
{"url_object_id": "16321b6a38d1ee394e7cc3ea90594078", "title": "树形结构数据存储方案（二）： 物化路径", "create_time": "2017/08/31", "url": "http://blog.jobbole.com/112312/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_num": "1", "comment_num": 1, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/path-enumeration.html\">标点符</a>   </div><p>前一篇文章介绍了比较简单的<a href=\"http://blog.jobbole.com/112309/\">邻接列表模式</a>，物化路径其实更加容易理解，其实就是在创建节点时，将节点的完整路径进行记录。以下图为例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/91ae30cffcfe91c0ebd3e6091f970295.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>按照Path Enumeration 进行存储后的结果如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d1a1da59ee04bd6479425f929f1da5d0.png\" alt=\"Path-Enumeration\" width=\"252\" height=\"221\"></p>\n<p>此种方案借助了unix文件目录的思想，主要时以空间换时间。</p>\n<p>查询某一节点下的所有子节点:（以Fruit为例）</p>\n<div id=\"crayon-59a6b897c213a519548061-1\"></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae00ee32e9a904358985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nSELECT * FROM pathTree WHERE path like CONCAT(@path,'/%');</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae00ee32e9a904358985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae00ee32e9a904358985-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae00ee32e9a904358985-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae00ee32e9a904358985-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">like </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/%'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>如何查询直属子节点？需要采用MySQL的正则表达式查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae00ee32ea5277664595\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nSELECT * FROM pathTree WHERE path REGEXP CONCAT(@path,'/','[0-9]$');</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae00ee32ea5277664595-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae00ee32ea5277664595-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae00ee32ea5277664595-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae00ee32ea5277664595-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">REGEXP </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'[0-9]$'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>查询任意节点的所有上级：（以Yellow为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae00ee32ea9170370040\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Yellow');\r\nSELECT * FROM pathTree WHERE @path LIKE CONCAT(path, '%') AND path &lt;&gt; @path;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae00ee32ea9170370040-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae00ee32ea9170370040-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae00ee32ea9170370040-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae00ee32ea9170370040-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">LIKE </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>插入新增数据：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae00ee32ead309315508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @parent_path = ( SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nINSERT INTO pathtree (path,node_name) VALUES (CONCAT(@parent_path,'/',LAST_INSERT_ID()+1),'White')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae00ee32ead309315508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae00ee32ead309315508-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae00ee32ead309315508-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae00ee32ead309315508-2\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">pathtree</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">LAST_INSERT_ID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'White'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>此方案的缺点是树的层级太深有可能会超过PATH字段的长度，所以其能支持的最大深度并非无限的。</p>\n<p>如果层级数量是确定的，可以再将所有的列都展开，如下图，比较试用于类似行政区划、生物分类法（界、门、纲、目、科、属、种）这些层级确定的内容。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/579dacd5167f484176573e5603f755c3.png\" alt=\"Multiple-lineage-columns\" width=\"609\" height=\"239\"></p>\n<p>参考文章：</p>\n<ul>\n<li>https://communities.bmc.com/docs/DOC-9902</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112312\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112312votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112312\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "131eed081b813e1db0e388ed019752d2", "title": "程序员的技术选择：发达国家和发展中国家有这些差异", "create_time": "2017/09/04", "url": "http://blog.jobbole.com/112351/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://stackoverflow.blog/2017/08/29/tale-two-industries-programming-languages-differ-wealthy-developing-countries/\">stackoverflow</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：Stack Overflow 工程师最近 David Robinson 做了一次数据分析，总结了程序员的技术选择和所在国家收入之间的关系。<b></b></p>\n<p>Stack Overflow 非常热衷于利用数据来和用户分享对全世界开发者社区的认知。比如这篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/\">关于 Android 开发者分布的文章</a>就是个很好的例子，它通过对全球开发者在 Stack Overflow 上询问 Andorid 相关问题统计，得出了结论：收入较低国家的开发者询问 Android 问题的数量要高于高收入国家的开发者。</p>\n<p>这个问题引发了我们的联想：<span style=\"color: #800000;\"><strong>高收入国家和低收入国家之间，开发人员在技术选择方面有什么不同呢？</strong></span>这种不同又会如何影响全球的软件开发产业呢？在本文中，我们就探索了上述的问题，并且发现通过收入来区分软件工业的发展，是一种很有效的办法。</p>\n<p>本文中的所有分析结论都是基于 2017 年 1 月 到 8 月的数据，并挑选在这段时间内出现频率 Top 250 标签进行统计的。为了减少数据样本过大可能造成的偏差，我们集中选取了相应时间段内来自 64 个国家的超过 500 万个问题进行分析。需要说明的是，这些数据很大程度上只反应了英语开发者们的行为模式（当然通过对西班牙语和葡萄牙语站点的分析，发现在墨西哥，西班牙这些国家，得到的分析结论和英语国家差不多）。</p>\n<h3>技术和人均 GDP 的相关性</h3>\n<p>在最近的一篇文章中，我们通过计算 Android 相关问题的比例（就是某个国家Android相关的问题的数量占该国整体Stack Overflow问题数据量的百分比），发现这个比例和这个国家的人均GPD是成反比的。所以我们也想知道，其他种类的技术和人均GDP的关系。</p>\n<p>因此我们调查了主流的编程语言和平台，包括PHP、Python、R 等等。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b0e581c125a2252f8e54bfbe6db1f064.png\"><img class=\"aligncenter size-full wp-image-65858\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg\" alt=\"tag_gdp_compare-1-2-1024x1024\" width=\"1024\" height=\"1024\"></a></p>\n<p>统计发现，来自某个国家 Android 相关问题和 PHP 相关问题的数量是和国家的收入情况成反比的，而同 Python、R 语言相关问题的数量则是正比。当然，在每一个统计案例里都会有例外的情况（例如，来自人均收入较高的韩国的 Android 问题数量要远超我们的预期，来自中国的 Python 问题的数量相对较低），但是总体来看，这种正反比关系还是很有说服力的。（多重假设检验调整后，每一种语言案例统计的决定系数都在 0.5 到 0.6 之间，P 值为 10 的负六次方）。</p>\n<p><span style=\"color: #800000;\">必须要说明一下，我们得出这些结论不是要说明什么因果性。我们并不是说，如果你选择了那些富有国家的开发者使用的编程语言，那么你所在的国家就能变成富有的国家。并且我们也不是说，国家的经济会直接影响到某种计算机技术的使用。我们只是发现，把经济和社会因素（例如教育程度，软件工业发展的年限，外包的水平等）看成一个整体，从总体上会与这个国家的财富多寡相关。</span></p>\n<h3>软件开发产业是按什么标准一分为二的？</h3>\n<p>在我们调查软件技术趋势时，通常只会把全世界的国家分成两组（即高收入国家和非高收入国家）来统计。我们不会把各国分成许多组来把相关性问题复杂化。因为在这方面已经有了很成熟的划分标准，我们就直接用<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups\">世界银行收入分级标准</a>就可以了，这种分级法是以人均国民总收入（GNI）为基准的（具体的分类方法可以看<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/378831-why-use-gni-per-capita-to-classify-economies-into\">这里</a>）</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4a90e3ee6a488ad0181fb4853f82f968.png\"><img class=\"aligncenter size-large wp-image-65861\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7uluvb7ej20sg0h243t.jpg\" alt=\"worldbank_map-1-1024x614\" width=\"1024\" height=\"614\"></a></p>\n<p>上图显示，全球一共有 78 个国家属于高收入国家，这些国家多半由美国、加拿大、西欧、部分中东和东亚国家，以及澳大利亚/新西兰构成。通过统计学的手段可以证明，这种划分方法是有足够依据的，而且这种划分方法比其他的方法更有意义，比如很多时候人们喜欢按照东西半球来划分国家，可实际上澳大利亚的技术分布情况却更接近美国和欧洲，而不是同属东半球的中国和印度尼西亚。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/bc8880913bdcd9e2cdba976f19f6e47a.png\"><img class=\"aligncenter size-large wp-image-65860\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulvf42zj20sg0izdip.jpg\" alt=\"top_countries-1-2-1024x683\" width=\"1024\" height=\"683\"></a></p>\n<p>这种分类方法同时也把 Stack Overflow 的访问量分成了两组，其中高收入国家访问量超过 2/3，剩余的国家占了访问量的不到 1/3。（得到这样的结果是和被调查国家软件开发人员的数量、互联网的基础设施的情况、以及说英语人数的情况严重相关的）。其中非高收入国家的访问量的排名分别为：印度、巴西、俄罗斯和中国。</p>\n<h3>高低收入国家使用的技术有什么不同？</h3>\n<p>我们已经把软件开发的世界分成了两个区域了。那么高收入国家和非高收入国家在使用的技术上有什么不同呢？</p>\n<p>我们从中可以看到一些有趣的结论：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b605e4100f6835b922f7fe48534c2d6f.png\"><img class=\"aligncenter size-large wp-image-65859\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fj7ulw4j26j20sg0kbjxu.jpg\" alt=\"tech_difference_graph-1-1-1024x731\" width=\"1024\" height=\"731\"></a></p>\n<p><strong>数据科学技术的不同：</strong>我们之前已经看到，Python 和 R 语言的使用情况和国家的富有程度是相关的。Python 在高收入国家使用的规模大约是其余国家的两倍之多，而 R 语言的使用规模差达到了 3 倍多。我们还注意到，通过对内容更具体的标签（tags）的统计，发现在Python和R科学计算领域，使用不同的计算包的人收入跳度很明显，例如 pandas、numpy,、matplotlib 和 ggplot2。这说明了在数据科学研究方面，不同的技术角色之间存在收入鸿沟。当然在越富有，工业化程度越高的国家，数据科学研究的占国家经济的比例越大，程序员的学历也越高，这个结论是符合逻辑的。</p>\n<p><strong>C/C++：</strong>在 Stack Overflow 上还有两个值得一提的语言就是 C 和 C++，高收入国家的程序员访问这两种语言的次数比低收入国家程序员多。对这个现象，有一种猜测是，它和教育机构有关：因为在之前的一篇<a href=\"https://stackoverflow.blog/2017/02/15/how-do-students-use-stack-overflow/\">《学生如何使用Stack Overflow》</a>的帖子里，我们发现美国的大学对 C/C++ 的访问频率是非常高的。当然这个现象也可能和电器制造商的地理分布情况有关。</p>\n<p><strong>PHP </strong><strong>和 </strong><strong>Android</strong>：我们在以前的一篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/?utm_source=so-owned&amp;utm_medium=blog&amp;utm_campaign=gen-blog&amp;utm_content=blog-link&amp;utm_term=income-countries\">《全球移动开发调查》</a>的帖子中讨论了 Android 开发的情况，除此之外，还有一种技术和低收入国家息息相关，那就是 PHP。在Stack Overflow上，来自低收入国家的对 CodeIgniter(一个PHP开源框架)的问题非常的多，而高收入国家队这个框架的提问几乎没有，这么大悬殊实在是一个很有趣的现象。经过进一步的调查，发现对 CodeIgniter 的重度访问来自于南亚，东南亚（尤其是印度、印度尼西亚、巴基斯坦和菲律宾），来自美国或者都周的访问几乎没有。所以可以推断，这个框架主要是这些外包公司用来开发门户网站用的。</p>\n<h3>结论：统计这些有什么用？</h3>\n<p>我们做这些统计当然是因为对编程语言生态系统的兴趣。而且这对我们日后要做的数据探索有很大的启发。</p>\n<p>我们在说软件开发工业方面的问题时，要意识到我们的问题都是由两个单独的问题混合起来的，这很重要，因为这种混合会给我们带来更多的信息。</p>\n<p>比如，我们想找到是哪些技术给Stack Overflow带来最大的流量，例如：《<a href=\"https://stackoverflow.blog/2017/08/01/flash-dead-technologies-might-next/\">探寻Flash技术不不断缩水的原因</a>》。如果我们把访问量最多的技术列出一张表，你会发现高收入和低收入的国家的分布是完全不一样的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/81bc32fb2d22b73b61614c4362fedb0a.png\"><img class=\"aligncenter size-full wp-image-65857\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulxy4z8j20sg0sg7ap.jpg\" width=\"1024\" height=\"1024\"></a></p>\n<p>例如，2017 年以来，Python 是来自高收入国家被访问第二多的话题，但是在非高收入国家，Python 只能排到第 8 位。而本文作者自己使用的 R 语言，在高收入国家访问数量的排名是第 15，但是在非高收入国家排名却在 50 开外。</p>\n<p>这些数据对 Stack Overflow 了解全球的开发者生态来说都是很重要的数据。而对于美国的技术招聘者来说，他们需要掌握未来的动向，所以他们需要了解更多的方面的数据，而不仅是“来自印度的学生要学习什么样的计算机语言”、“技术投资人在肯尼亚寻找合适的技术公司”这类话题。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112351\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112351votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112351\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 65</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/huangxiaofei2002\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "开发,编程语言,薪资", "front_image_path": "full/5ef5deea05baf6e946764ea6c6a4efa4c5eb9840.jpg"}
{"url_object_id": "8e71395dfec60b991d278a434c35a1da", "title": "使用 Redis 解决“树”形数据的复杂查询", "create_time": "2017/09/04", "url": "http://blog.jobbole.com/112358/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1469495/blog/1504818\">qiujiayu</a>   </div><p>最近因业务需要，研究了一下树数据结果的存储及查询解决方案。 最初的想法是使用neo4j,可是在网上看了一下开源的不支持集群，感觉用的人不多。</p>\n<p>网上也查了一些 <a href=\"http://blog.jobbole.com/112309/\">树形结构数据存储方案</a> 但每种实现方案都有它的一定局限性。</p>\n<p>想了一短时间后，想出了下面的方案：</p>\n<p>一、 因为复杂的查询都由Redis来处理，所以数据库表的设计就变得非常简单：tree 表</p>\n<p>| 字段名称 | 数据类型 | 备注说明 | | —- | —- | —- | | id | int | 主键 | | parent_id | int | 上级节点ID |</p>\n<p>二、Redis的数据存储方案：</p>\n<p>把表的数据存储到一个Hash表中，使用表中的id值做为此hash表的key, value值为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b504255618519875\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n   id: 10,\r\n   parentId: 9,\r\n   childIds: [11]\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b504255618519875-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504255618519875-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504255618519875-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504255618519875-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504255618519875-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504255618519875-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b504255618519875-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504255618519875-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504255618519875-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504255618519875-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504255618519875-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504255618519875-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>代码实现</h3>\n<p>为了简化测试，这里只演示Redis相关的操作</p>\n<ol>\n<li>Tree 类定义<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b50425f467425130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public class Tree {\r\n     private Integer id;\r\n     private String name;\r\n     private Integer parentId;\r\n     private List&lt;Integer&gt; childIds;\r\n }\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b50425f467425130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50425f467425130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50425f467425130-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50425f467425130-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50425f467425130-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50425f467425130-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50425f467425130-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b50425f467425130-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50425f467425130-2\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50425f467425130-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50425f467425130-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50425f467425130-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50425f467425130-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50425f467425130-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</li>\n<li>往Redis中添加测试数据：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b504263678584765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n [@Test](https://my.oschina.net/azibug)\r\n public void addTestData() throws Exception {\r\n     String key = \"tree-test-key\";\r\n     Tree tree = new Tree();\r\n     List&lt;Integer&gt; childIds = new ArrayList&lt;&gt;();\r\n     int max = 100000\r\n     tree.setChildIds(childIds);\r\n     for (int i = 0; i &lt; max; i++) {\r\n         tree.setId(i);\r\n         tree.setName(\"tree\" + i);\r\n         if (i &gt; 0) {\r\n             tree.setParentId(i - 1);\r\n         }\r\n         childIds.clear();\r\n         if(i &lt; (max - 1)){\r\n             childIds.add(i + 1);\r\n         }\r\n         redis.setHash(key, \"\" + i, JsonUtil.toJson(tree));\r\n     }\r\n }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504263678584765-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504263678584765-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//my.oschina.net/azibug)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTestData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tree-test-key\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-7\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setChildIds</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"tree\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-12\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setParentId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-16\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setHash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JsonUtil</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toJson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504263678584765-19\"><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504263678584765-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n\n</li>\n<li>Lua 代码的实现</li>\n</ol>\n<p>在Lua中使用递归时，需要使用“尾调用”来优化代码。关于尾调用的知识，大家可以上网去搜索。</p>\n<h4>获取所有子节点 get-tree-childs.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b504267971996889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChild(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      table.insert(res, treeNode)\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local node = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        node = cjson.decode(treeNode)\r\n        table.insert(res, treeNode)\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChild(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChild(fnodeId, \"id\", {})\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504267971996889-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504267971996889-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-33\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-36\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-38\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-41\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-42\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-43\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-45\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-46\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-48\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-49\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-50\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-51\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-52\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504267971996889-53\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504267971996889-54\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-childs-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b50426b777953675\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChildCnt(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      res = res + 1\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        local node = cjson.decode(treeNode)\r\n        res = res + 1\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChildCnt(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChildCnt(fnodeId, \"id\", 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b50426b777953675-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b50426b777953675-53\">53</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-35\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-37\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-40\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-41\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-42\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-43\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-45\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-46\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-48\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-49\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-50\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b50426b777953675-52\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b50426b777953675-53\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b504272204346314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParent(treeKey, res, nodeId)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    table.insert(res, treeNode)\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParent(treeKey, res, nextNodeId)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParent(treeKey, {}, nodeId)\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504272204346314-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504272204346314-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-20\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-24\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504272204346314-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504272204346314-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf2b504276085469613\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParentCnt(treeKey, nodeId, res)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    res = res + 1\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParentCnt(treeKey, nextNodeId, res)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParentCnt(treeKey, nodeId, 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf2b504276085469613-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf2b504276085469613-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-20\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-24\"> </div><div class=\"crayon-line\" id=\"crayon-59adf2b504276085469613-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf2b504276085469613-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>以上代码因为使用了“尾调用”，所以变得相对比较复杂</p>\n<h3>总结</h3>\n<p>此方案相对比较灵活，能支持相对比较大量的数据。</p>\n<p>缺点：过于依赖Redis。数据同步会麻烦些，好在操作不是很复杂。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Redis,数据库", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"url_object_id": "b225ce0ceb9f61bf1bed8b5e01b2f2f2", "title": "编程趋势：21 个热门和 21 个要降温的", "create_time": "2017/09/02", "url": "http://blog.jobbole.com/112238/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1fj44vfij7hj20g40c3wfr.jpg"], "praise_num": "2", "comment_num": 1, "fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx232824506\">努力学python</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.infoworld.com/article/3188464/application-development/21-hot-programming-trends-and-21-going-cold.html\">Peter Wayner</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>InfoWorld 作者总结的 21 个热门编程趋势和 21 个要变冷的趋势，包含 Web 开发，移动开发，大数据，教育等方面。</p>\n<hr>\n<p>热门还是冷门？无论 Web 开发、主板开发还是培训教育，都需要了解应用开发过程中哪些技术正在兴起，哪些技术要过时了。</p>\n<p>程序员们喜欢嘲笑时尚界的潮流说变就变，像风一样捉摸不定。裙子时而短时而长，流行色频繁更替，领带越来越窄，越来越薄。但是在技术的世界中，严谨、科学、数学和精准原则却一直流行。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj44vfij7hj20g40c3wfr.jpg\"></p>\n<p><strong>这并不是说编程没有趋势。区别在于编程的潮流由更高的效率、更多的自定义和更便于使用来驱动。具备这些特点的新技术取代旧技术，这是一种精益求精的过程，而不是朝令夕改的奇思妙想。</strong></p>\n<p>下面是现代程序世界的热门技术和冷门技术列表。可能有人会不同的意见，也可能会有遗漏，而这正是编程的迷人之处：快速变化、激烈辩论、峰回路转。</p>\n<h3>热门：预处理器</h3>\n<h3>变冷：全语言堆栈</h3>\n<p>不久之前，人们创造一门新的编程语言需要进行许多工作（从源代码到机器代码转换过程的所有工作）。 然后一些人指出他们可以推翻前面的做法。 现在程序员有了想法以后只需要编写一个预处理器，预处理器可以使用丰富的库和 API 将新代码转换成旧版本的代码。</p>\n<p>Python 、JavaScript 这类的脚本语言曾经仅限于小项目，但现在许多重要的工作都开始使用这些语言。不喜欢 JavaScript 的程序员还开发了 CoffeeScript (一种可以再次编码的预处理器)，以避免使用繁琐的标点符号。它有几十种以不同方式预处理语法的方法。</p>\n<p>那些喜欢动态类型的程序员<strong>创建了 Groovy</strong>，Groovy 是 Java 省略掉过多标点符号的简化版本。现在好像有<strong>几十种语言</strong>（如 Scala 或 Clojure）在 JVM 上运行，但只有一个 JVM 。我们可以在 .Net 虚拟机上运行多种语言，为什么还要重新发明轮子？</p>\n<h3>热门：Docker</h3>\n<h3>变冷：Hypervisors（虚拟机）</h3>\n<p>这并不完全正确，hypervisors 也有它们的用武之地，而且许多 Docker容器运行在以 hypevisors 为基础的操作系统中。然而，Docker容器与虚拟机映像相比实在太小了，这使得它们更容易使用和部署。</p>\n<p>当开发人员可以使用 Docker容器时，它们更愿意使用 Docker容器，这要归功于它可以在部署过程中轻松操作。 像 Joyent 这样的聪明公司正在开发可以占用更多资源的技术，以便容器可以在“裸机”上运行。</p>\n<p>在数字商业时代需要足够敏捷来抓住新机会，同时还要有效地维护传统的内部部署系统。</p>\n<h3>热门：JavaScript MV* 框架</h3>\n<h3>变冷：JavaScript文件</h3>\n<p>很久以前，每个人都学习如何使用 JavaScript 弹出警告窗口或如何检查表格中的电子邮件地址是否包含 @符号。 现在，HTML AJAX 应用程序已经如此成熟，以至于很少有人会再从头开始编写这些功能。 采用精心制作的框架，然后编写一些胶水代码来实现业务逻辑要简单得多。</p>\n<p>现在有许多框架可以用来处理 app、网页等的事件和内容，这些<strong>框架包括</strong> Kendo, Sencha, jQuery Mobile, AngularJS, Ember, Backbone, Meteor JS 等。</p>\n<p>这些只是网络应用程序的框架。 还有一些框架旨在为智能手机/平板电脑提供跨平台开发技术。 <strong>NativeScript，PhoneGap</strong> 和 <strong>Ext JS</strong> 都是使用 HTML5 创建 app 的技术。</p>\n<h3>热门：CSS 框架</h3>\n<h3>变冷：通用层叠样式表</h3>\n<p>曾几何时，向网页添加一点格式意味着打开 CSS文件然后写入类似 font-style:italic 这样的命令，然后保存文件，就可以在一上午的紧张忙碌之后去吃午饭了。现在网页如此复杂以至于很难使用如此简单的命令完成一个文件。调整一个颜色可能会导致一切都无法正常运行。这就像他们评价阴谋家和生态学家一样：一切都是互相联系的。</p>\n<p>这就是 SASS 和 Compass 等 CSS框架的用武之地。 它们通过提供编程结构（如实变量，嵌套块和混合）来鼓励规范，可靠的编码。 这在编程层面中可能听起来并没有多新颖，但对于设计层来说这是一个巨大的飞跃。</p>\n<h3>热门：视频标签</h3>\n<h3>变冷：静态标签</h3>\n<p>曾经有段时间， 视频是指 YouTube 或 Vimeo 上观看的视频。它是一种存在于专有页面上的单独内容。然而随着越来越多的网站使用音频来构建区块，其过程与使用 静态 GIFs 或者 JPGs 进行构建区块一样，这种情况正在发生改变。突然之间，屏幕变得生动起来。</p>\n<p>设计师发现，现代视频标签只是另一个矩形，尽管矩形通常需要程序员使用更多的 JavaScript 代码来控制。 我们只是开始明白，在客厅沙发前面的盒子可以不再是我们获取视频的主要来源，而可以仅仅是一个装饰。</p>\n<h3>热门：类大数据(不使用 Hadoop 分析)</h3>\n<h3>变冷：大数据（使用 Hadoop）</h3>\n<p>每个人都希望自己看起来像是圈子里的大人物，如果他们在圈子里有没影响力，那么他们会寻找一个适合他们脱颖而出的圈子。 所以，当“大数据”开始在高管之间开始流行时，这些高管要求最大，最强大的<strong>大数据系统</strong>，就像购买游艇或摩天大楼一样。</p>\n<p>有趣的是，许多问题没有大到要用高级大数据解决方案来解决。当然，像谷歌或雅虎这种跟踪我们浏览的所有网页的公司是需要大数据解决方案的，他们的数据文件很大需要用 petabytes 或 yottabytes 来计量。但大多数公司的数据都可以轻松地用一个 PC机内存进行处理。我是用一台在 16GB 内存的 PC 机来写这篇文章的，这台 PC 足够处理十亿件几个字节的事件。在大多数算法中，数据不需要读入内存，因为直接从 SSD 获取就可以了。</p>\n<p>可能存在需要 Hadoop云几十台机器并行运算来实现快速响应的需求，但是许多需求在单台机器上处理即可，这样还可以避免产生麻烦的协调或通信问题。</p>\n<h3>热门：Spark</h3>\n<h3>变冷：Hadoop</h3>\n<p>可能并不是 Hadoop 不流行了，而是 Spark 太热门了，这使得 Hadoop 模型看起来有些老。Spark 借鉴了Hadoop 从大量数据中提取语义的做法的最佳思路，并通过一些改进使代码运行的更快。Spark 最大的优势在于它将数据保存在快速内存中而不是需要所有内容都写入分布式文件系统。</p>\n<p>当然，许多人正在通过使用 Spark 的处理速度对存储在 Hadoop 分布式文件系统的数据进行处理，因此，Spark 和 Hadoop 更像是合作伙伴而不是竞争对手。</p>\n<h3>热门：人工智能/机器学习</h3>\n<h3>变冷：大数据</h3>\n<p>没有人知道 “人工智能”的真正含义，它们对营销人员很有利，特别是在“大数据”广泛应用的今天。他们从人工智能中提取术语并且升级数字处理算法的复杂度来处理我们的 log 文件和点击流。通过从具有 50年历史的 AI研究中借鉴更复杂算法，我们比以往任何时候都更有可能从噪音中发现信号。从机器学习框架到认知计算的工具，再到 IBM 的沃森，总能解决你的问题。它们每个都提供自己机器的智能水平，我们可以使用它们进行更多的数据分析和取证。</p>\n<h3>热门：机器人</h3>\n<h3>变冷：虚拟现实</h3>\n<p>就在几分钟之前，我们还都将梦想寄托在虚拟现实中，虚拟现实可以通过一些视频卡在我们视网膜上绘制图形。这种情况仍然可能发生，但与此同时，机器人的世界也将迅速发展。每个学校都有一个机器人团队，家庭的每个角落充斥着机器人，机器人吸尘器已经是旧新闻了，无人机正在自由翱翔。</p>\n<p>这意味着程序要开始考虑如何写代码来控制新机器。目前，这意味着为 Raspberry Pi 这样的轻量级控制器写脚本，但是随着库文件发展的越来越复杂，必然会发生变化。比如，许多机器人专家喜欢研究 C语言实现的机器视觉平台OpenCV 中的代码。这意味着需要考虑新的规则，新的类库，新的协议，和许多其他新的主题。</p>\n<h3>热门：单页Web应用</h3>\n<h3>变冷：网站</h3>\n<p>还记得 URLs 指向满是静态文本和图片的网页的时代吗？把所有信息都放在被称为网站的单独网页中是多么地简单和古雅。设计团队在网站地图上花费几个小时的时间来使网站更易于导航。</p>\n<p>新的 web 应用通过数据库填充内容。当 web应用需要信息时，它从数据库获取信息并将其放入本地模板中。我们不需要使用构建 web页面的所有 web附加组件来标记数据。数据层与展示和格式化层完全分离。移动计算的兴起是另一个原因在于：单个响应式页面工作机制与app类似，可以减少从鱼龙混杂的应用商店中寻找想要的内容所浪费的时间。</p>\n<h3>热门：移动Web app</h3>\n<h3>变冷：原生移动 App</h3>\n<p>假如你有一个移动内容的好主意，那么需要为 IOS、Android、Windows 8甚至黑莓OS 或者其他的系统开发不同的版本。每个版本都需要一个独立的团队使用不同的编程语言实现。然后每个平台应用商店都需要使用自己的版本，才能把 app 分发给用户。</p>\n<p>或者，我们可以创建一个 HTML 应用，然后把它放到各个平台都可以运行的网站上。如果有变化，也不需要到应用商店去请求快速审核错误修复。 现在 HTML层速度越来越快，并且运行在速度越来越快的芯片上，以便于它可以在更复杂和互动性更高的应用程序上更好地与本地应用程序竞争。</p>\n<h3>热门：Android</h3>\n<h3>变冷：iOS</h3>\n<p>是不是几年前苹果专卖店门前还要排蜿蜒的长队？ 现在时代变了。 虽然 iPhone 和 iPad 还拥有大量热爱它们丰富而复杂的界面的铁杆粉丝，但从原始销售数量来看，Android更具优势 。 有报道甚至说 80％ 以上的手机都是 Android系统。</p>\n<p>原因可能就在于成本。 即使 iOS设备只需要花费很少的前，Android世界充斥的大量竞争也可以将产品的价格压缩到 iOS设备的五分之一。 省钱总是很有诱惑力的。</p>\n<p>但另一方面，也可能与开源有关。每个人都可以在市场上竞争，他们也是这样做的。我们有大大小小的安卓平板，安卓相机甚至安卓冰箱。没有人需要在创新之前先请示“妈妈，我可以吗?”。如果他们有一个好点子，做就可以了。</p>\n<p>不过，Apple 也在向安卓学习。iPhone 6 有了不同尺寸的屏幕，或许机会就在眼前。</p>\n<h3>热门：GPU</h3>\n<h3>变冷：CPU</h3>\n<p>当软件非常简单，可以很好的安排一系列指令时，CPU 是计算机的王者，因为它承担了所有的工作。 现在，视频游戏充满了可以并行运行的大量图形程序，显卡可以运行这些图形。 我们很容易花费 500美元、600美元甚至更多来购买各种显卡，一些重度的游戏玩家可能拥有不止一两个显卡。 这些显卡的价格是许多基本台式机显卡价格的两倍。 游戏玩家并不是唯一吹嘘他们的 GPU 的人。 计算机科学家现在将许多并行应用程序转换到 GPU 上运行，这样速度可以提高数百倍。</p>\n<h3>热门：GitHub主页</h3>\n<h3>变冷：个人简历</h3>\n<p>当然，我们可以通过阅读包括初中棋牌俱乐部副总裁的成就清单来了解候选人。 但阅读某人的实际代码则更加丰富和具有启发性。 他们注释写的清楚吗？ 他们把很多时间浪费在把内容写到作用寥寥的类里吗？他的架构真的有扩展空间吗？ 所有这些问题都可以从他们的代码的发现答案。</p>\n<p>这就是为什么参与开源项目对找工作越来越重要。 从专有项目共享代码是很难的，但开源代码可以随处可见。</p>\n<h3>热门：租用</h3>\n<h3>变冷：购买</h3>\n<p>当亚马逊在黑色星期五卖力推销电脑和其他电子产品时，却忘记了推销他们的云服务。在不久的将来，它很可能会这么做。以前，公司设立自己的数据中心并且聘请员工来维护购买的电脑。 现在，他们租赁电脑、数据中心、工作人员、甚至按小时租用软件。 任何人都不想处理购买带来的麻烦。这一切都是好主意，至少在网站发生病毒事件（你的点击将为所有物品支付费用）之前是这样的。尽管现在只有亚马逊发现了自动提供云的方法，趋势将会趋同。</p>\n<h3>热门：复杂云</h3>\n<h3>变冷：简约云</h3>\n<p>云计算早期阶段，供应商强调一键获得正在运行的机器是多么地容易。那时，简约是王道。</p>\n<p>现在选择正确的机器并找出合适的折扣方案可能比编写代码要花费更多的时间。 我们可以获得几十种机器配置文件，大多数云提供商都提供一些老型号的电脑。 所有供应商都提供不同性能水平的机器，因此我们需要对它们进行基准测试，以确定哪种性价比最高。 少用一些 RAM 来每小时节省 12美分有意义吗？ 如果需要几个月连续运行 100台机器，那么这很重要。</p>\n<p>更复杂的情况在于，云公司还会为提前付款或批量购买提供不同的折扣方案， 我们也必须把它们考虑在内。 购买一个云成本工程的在线课程就可以了解这些内容了。</p>\n<h3>热门：数据移动专家</h3>\n<h3>变冷：备份磁带</h3>\n<p>当数据很少时，我们不需要考虑如何移动它。 我们可以将其备份到磁带或者安装 RAID硬盘。 但是现在数据如此之大，以至于我们不得不考虑我们在哪里使用它们。这变得越来越重要，因为更多的服务发生在云端的某个地方，而不是 RAID阵列所在的机架。</p>\n<p>让我们来看看亚马逊的新款 Snowmobile ，这是一个可爱的内部名称，它是用于装载可容纳 100PB 数据硬盘的移动容器。 他们还制作了一个叫做 Snowball 的小盒子，可以容纳 80TB 。 两者都将像运送货物一样运送数据，而不是采用光纤信号。 一项估计表明，通过 1Gbps 的光纤线路下载 100PB 的数据需要 28 年，而货运卡车可能会在几天内将集装箱运送到全国各地。</p>\n<p>所有这一切说明，开发人员需要开始考虑从哪里采集数据、在哪里使用数据。我们采集了比以前更多的数据，把它们移动到正确的地方也比以前也更加重要。正如 Wayne Gretzky 所说，他的成功在于提前计划并且通过分析对趋势进行预测，而不是仅仅把注意力放在正在发生的事情上。</p>\n<h3>热门：语音</h3>\n<h3>变冷：网站</h3>\n<p>网站并没有真正死亡，只是新的音频接口方兴未艾。亚马逊、谷歌和苹果都在主推用语音来解决问题来替代通过敲打电脑键盘输入内容来解决。</p>\n<p>这对于程序员来说意味着更多的工作，因为所有这些机制都有新的 API ，比如 Alexa 控制灯光的新开关。 如果您的公司想要连接这些音频接口，您最好现在就开始了解。毕竟，键盘和 URL 已经是上个世纪的发明了。</p>\n<h3>热门：Node.js</h3>\n<h3>变冷：JavaEE，Ruby on Rails</h3>\n<p>服务器领域一直在线程模式上蓬勃发展，这使得操作系统允许开发人员各种任性、低效、放纵的行为。 无论采用愚蠢的循环还是更多的程序编码，操作系统将通过线程之间的切换平衡性能。</p>\n<p>然后Node.js 与 JavaScript 回调模型出现，这些代码运行速度非常快–比任何人期望JavaScript达到的速度都要快。突然间，创建新线程的开销变得明显，Node.js 繁荣起来。 使用 node.js 时，如果程序员的表现不好会出现问题，但这在很大程度上是对他们是很有好处的。约束程序员的可用资源会促使程序员开发出更快的代码。</p>\n<p>Node.js 还得益于它可以使前后台保持一致。两者运行相同的代码，这使得开发人员更容易迁移和重用函数。 因此，Node.js 已经成为互联网上最热门的堆栈。</p>\n<h3>热门：PHP7</h3>\n<h3>变冷：旧版PHP</h3>\n<p>过去，PHP 是实现动态网页的简单方法。 我们可以通过在HTML 标签之间嵌入简单的代码来实现一些变化。为了便于 Web 开发人员使用，它是如此的基础，但速度也慢得足以让硬件程序员嘲笑。</p>\n<p>这已成为过去，WordPress 和 Facebook 这样的 PHP 爱好者通过引入即时编译器技术(该技术使 Java 成为高性能解决方案)使得PHP代码比以往任何时候都快。 现在，像 HipHop虚拟机和 PHP 7.0 这样的工具的传输速度可能达到旧版本的两倍。Node.js 和 Java，准备接招吧。</p>\n<h3>热门：即时教育</h3>\n<h3>变冷：四年全日制</h3>\n<p>计算机辅助课程不再新鲜，每个人都可以观看视频讲座，并且可以加快或者放慢视频播放速度或者要求教授重复最后一点。在线论坛也改变了以前一个人主导讨论的旧形式。</p>\n<p>在线课程的本质和技术不仅颠覆了教育产业结构，还实现了随时随地学习的灵活性。这正在改变人们的观念，人们不再需要为与他们有关或无关的大量课程而投入四年高昂的学费。在你不知道自己是否需要在编译器上工作时，为什么要学习编译器课程？如果老板想从关系数据库切换到NoSQL引擎，那么我们可以将时间用于现代数据存储的课程上。只有在需要的时候才获得新信息，不要用快要腐烂的方法来扰乱思维。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/11eefac5bf4ae36c73b7b40eb087be7b.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/02a9f7817f8dd0012ff1327fde5bdc94.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112238\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112238votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112238\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">努力学python</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            应用软件开发，主要用python、sql        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx232824506\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx232824506/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,编程,职业", "front_image_path": "full/0341d03d14d3de38ff2983a92d11b39e71e6c1aa.jpg"}
{"url_object_id": "02055325a5e02932f7792960f1ebb630", "title": "树形结构数据存储方案（四）：左右值编码", "create_time": "2017/09/02", "url": "http://blog.jobbole.com/112323/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/the-nested-set-model.html\">标点符</a>   </div><p>在基于数据库的一般应用中，查询的需求总要大于删除和修改。为了避免对于树形结构查询时的“<a href=\"http://blog.jobbole.com/112309/\">递归</a>”过程，基于Tree的前序遍历设计一种全新的无递归查询、无限分组的左右值编码方案，来保存该树的数据。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1e2e2b27dafbace20975589812804590.jpg\" alt=\"Nested-Set\" width=\"383\" height=\"216\"></p>\n<p>第一次看见这种表结构，相信大部分人都不清楚左值（Lft）和右值（Rgt）是如何计算出来的，而且这种表设计似乎并没有保存父子节点的继承关系。但当你用手指指着表中的数字从1数到18，你应该会发现点什么吧。对，你手指移动的顺序就是对这棵树进行前序遍历的顺序，如下图所示。当我们从根节点Food左侧开始，标记为1，并沿前序遍历的方向，依次在遍历的路径上标注数字，最后我们回到了根节点Food，并在右边写上了18。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a3d57449cc2b5c29854f79f0be69725c.jpg\" alt=\"lft-rgt\" width=\"411\" height=\"166\"></p>\n<p>依据此设计，我们可以推断出所有左值大于2，并且右值小于11的节点都是Fruit的后续节点，整棵树的结构通过左值和右值存储了下来。然而，这还不够，我们的目的是能够对树进行CRUD操作，即需要构造出与之配套的相关算法。按照深度优先，由左到右的原则遍历整个树，从1开始给每个节点标注上left值和right值，并将这两个值存入对应的name之中。</p>\n<p><strong>如何查询？</strong></p>\n<p>1、获取某个节点下的所有子孙节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac091854134385\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Lft &gt; 2 AND Lft &lt; 11 ORDER BY Lft ASC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac091854134385-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac091854134385-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-v\">ASC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>2、获取子孙节点总数</p>\n<p>子孙总数 = (右值–左值–1)/2，以Fruit为例，其子孙总数为：(11–2–1)/2 = 4</p>\n<p>3、 获取节点在树中所处的层数，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac09c338732032\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT COUNT(*) FROM Tree WHERE Lft &lt;= 2 AND Rgt &gt;=11</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac09c338732032-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac09c338732032-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>4、 获取当前节点所在路径，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0a0027743364\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Lft &lt;= 2 AND Rgt &gt;=11 ORDER BY Lft ASC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a0027743364-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0a0027743364-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-v\">ASC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在日常的处理中我们经常还会遇到的需要获取某一个节点的直属上级、同级、直属下级。为了更好的描述层级关系，我们可以为Tree建立一个视图，添加一个层次列，该列数值可以编写一个自定义函数来计算：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0a3641281867\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE FUNCTION `CountLayer`(`_node_id` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE _result INT;\r\n\tDECLARE _lft INT;\r\n\tDECLARE _rgt INT;\r\n\tIF EXISTS(SELECT Node_id FROM Tree WHERE Node_id = _node_id)\r\n\tTHEN\r\n\t\tSELECT Lft,Rgt FROM Tree WHERE Node_id = _node_id INTO _lft,_rgt;\r\n\t\tSET _result = (SELECT COUNT(1) FROM Tree WHERE Lft &lt;= _lft AND Rgt &gt;= _rgt);\t\r\n\t\tRETURN _result;\r\n\tELSE\r\n\t\tRETURN 0;\r\n\tEND IF;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a3641281867-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a3641281867-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">CountLayer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_result </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_lft </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_rgt </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">Node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">Rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_node_id </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-v\">_lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_rgt</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_lft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">ELSE</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a3641281867-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0a3641281867-15\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>在添加完函数以后，我们创建一个a视图，添加新的层次列：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0a7205723853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE VIEW `NewView`AS \r\nSELECT Node_id, Name, Lft, Rgt, CountLayer(Node_id) AS Layer FROM Tree ORDER BY Lft ;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0a7205723853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0a7205723853-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0a7205723853-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">VIEW</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">NewView</span><span class=\"crayon-sy\">`</span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0a7205723853-2\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CountLayer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Layer </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-i\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>5、 获取当前节点父节点,以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0aa417569414\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Lft &lt;= 2 AND Rgt &gt;=11 AND Layer=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0aa417569414-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0aa417569414-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>6、 获取所有直属子节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0ad935697508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Lft BETWEEN 2 AND 11 AND Layer=3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0ad935697508-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0ad935697508-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-i\">BETWEEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>7、 获取所有兄弟节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0b0725714384\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Rgt &gt; 11 AND Rgt &lt; (SELECT Rgt FROM treeview WHERE Lft &lt;= 2 AND Rgt &gt;=11 AND Layer=1) AND Layer=2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b0725714384-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0b0725714384-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">Rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>8、 返回所有叶子节点</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0b3055949575\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Rgt = Lft + 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b3055949575-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0b3055949575-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><strong>如何创建树？如何新增数据？</strong></p>\n<p>上面已经介绍了如何检索结果，那么如何才能增加新的节点呢？Nested set 最重要是一定要有一个根节点作为所有节点的起点，而且通常这个节点是不被使用的。为了便于控制查询级别，在建表的时候建议添加parent_id配合之联结列表方式一起使用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0b7920706576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE IF NOT EXISTS `Tree` (\r\n  `node_id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `parent_id` int(10) UNSIGNED NOT NULL DEFAULT '0',\r\n  `name` varchar(255) NOT NULL,\r\n  `lft` int(11) NOT NULL DEFAULT '0',\r\n  `rgt` int(11) NOT NULL DEFAULT '0',\r\n  PRIMARY KEY (`node_id`),\r\n  KEY `idx_left_right` (`lft`,`rgt`)\r\n) DEFAULT CHARSET=utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b7920706576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0b7920706576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b7920706576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0b7920706576-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b7920706576-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0b7920706576-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b7920706576-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0b7920706576-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0b7920706576-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0b7920706576-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">EXISTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">Tree</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0b7920706576-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0b7920706576-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">UNSIGNED</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0b7920706576-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0b7920706576-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0b7920706576-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0b7920706576-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0b7920706576-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">idx_left_right</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0b7920706576-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0ba885946661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nINSERT INTO `Tree` (parent_id,name,lft,rgt) VALUES ( 0,'Food',1,2)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0ba885946661-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0ba885946661-1\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">Tree</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Food'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>添加子节点（子节点起始处），以在Food下添加子节点Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0bd073774174\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := node_id, @myLeft := lft FROM Tree WHERE name = 'Food';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt; @myLeft;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myLeft;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Fruit', @myLeft + 1, @myLeft + 2);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0bd073774174-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0bd073774174-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0bd073774174-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0bd073774174-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0bd073774174-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0bd073774174-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0bd073774174-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0bd073774174-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lft </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Food'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0bd073774174-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0bd073774174-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0bd073774174-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0bd073774174-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>如需在末尾追加就需要以下方式进行（以在Red下添加Apple为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0c0545685478\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := node_id , @myRight := rgt FROM Tree WHERE name = 'Red';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt;= @myRight;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myRight;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Apple', @myRight, @myRight + 1);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c0545685478-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c0545685478-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c0545685478-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c0545685478-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c0545685478-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c0545685478-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0c0545685478-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c0545685478-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Red'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c0545685478-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c0545685478-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c0545685478-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c0545685478-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>在节点A后面添加同级节点（以在Yellow后面添加Green为例）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0c3863573034\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := parent_id , @myRight := rgt FROM Tree WHERE name = 'Yellow';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt; @myRight;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myRight;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Green', @myRight+1, @myRight+2);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c3863573034-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c3863573034-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c3863573034-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c3863573034-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c3863573034-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c3863573034-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0c3863573034-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c3863573034-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parent</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c3863573034-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c3863573034-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c3863573034-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c3863573034-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>以上讨论的添加节点指的都是添加末端节点，即插入的这个节点不是当前已存在节点的父节点。如果需要插入非末端节点要怎么办呢？</p>\n<p>这个过程可以将流程分为2步，首先新增节点，接下里再将需要的节点移到新增的节点下级。节点移动方法(以将Apple移到Yellow中为例)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0c6176022481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @nodeId := node_id , @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Apple';\r\nUPDATE Tree SET lft = lft - (@myRight - @myLeft) - 1 WHERE lft &gt; @myRight;\r\nUPDATE Tree SET rgt = rgt - (@myRight - @myLeft) - 1 WHERE rgt &gt; @myRight;\r\nSELECT @parent_id := node_id , &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; := lft , &lt;a href=\"http://www.jobbole.com/members/wx3757768826\"&gt;@Right&lt;/a&gt; := rgt FROM Tree WHERE name = 'Yellow';\r\nUPDATE Tree SET lft = lft + (@myRight - @myLeft) + 1 WHERE lft &gt; @Left;\r\nUPDATE Tree SET rgt = rgt + (@myRight - @myLeft) + 1 WHERE lft &gt; @Left;\r\nUPDATE Tree SET parent_id = @parent_id WHERE name = node_id = @nodeId;\r\nUPDATE Tree SET lft = &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; + lft - @myLeft + 1, rgt = &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; + lft - @myLeft + 1  + (@myRight - @myLeft) WHERE lft &gt;= @myLeft AND rgt &lt;= @myRight;\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c6176022481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c6176022481-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c6176022481-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c6176022481-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c6176022481-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c6176022481-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c6176022481-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c6176022481-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0c6176022481-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0c6176022481-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0c6176022481-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c6176022481-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c6176022481-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c6176022481-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c6176022481-5\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx3757768826\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Right</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c6176022481-6\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c6176022481-7\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c6176022481-8\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">parent_id </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0c6176022481-9\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0c6176022481-10\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0072 seconds] -->\r\n<p><strong>删除节点（包含子节点）</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0ca733063009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Apple';\r\nDELETE Tree WHERE lft &gt;= @myLeft AND rgt &lt;= @myRight;\r\nUPDATE Tree SET lft = lft - (@myRight - @myLeft) - 1 WHERE lft &gt; @myRight;\r\nUPDATE Tree SET rgt = rgt - (@myRight - @myLeft) - 1 WHERE rgt &gt; @myRight;\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0ca733063009-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0ca733063009-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0ca733063009-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0ca733063009-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0ca733063009-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0ca733063009-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0ca733063009-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0ca733063009-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0ca733063009-3\"><span class=\"crayon-e\">DELETE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0ca733063009-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0ca733063009-5\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0ca733063009-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>如果需要只删除该节点，子节点自动上移一级如何处理？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add745ac0cd008669479\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := parent_id , @node_id :=node_id , @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Red';\r\nUPDATE Tree SET parent_id = @parent_id WHERE  parent_id = @node_id\r\nDELETE Tree WHERE lft = @myLeft;\r\nUPDATE Tree SET lft = lft - 1,rgt = rgt-1 Where lft &gt; @myLeft AND @rgt &lt; @myRight\r\nUPDATE Tree SET lft = lft - 2,rgt = rgt-2 Where lft &gt; @rgt &gt; @myRight\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add745ac0cd008669479-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0cd008669479-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0cd008669479-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0cd008669479-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0cd008669479-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add745ac0cd008669479-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add745ac0cd008669479-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add745ac0cd008669479-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0cd008669479-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parent</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Red'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0cd008669479-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">parent_id </span><span class=\"crayon-e\">WHERE  </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0cd008669479-4\"><span class=\"crayon-e\">DELETE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0cd008669479-5\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Where </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myRight</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add745ac0cd008669479-6\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Where </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myRight</span></div><div class=\"crayon-line\" id=\"crayon-59add745ac0cd008669479-7\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>以上为Nested Set的CURD操作，具体在使用时建议结合事务和存储过程一起使用。本方案的优点时查询非常的方便，缺点就是每次插入删除数据涉及到的更新内容太多，如果树非常大，插入一条数据可能花很长的时间。</p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.sitepoint.com/hierarchical-data-database/\">https://www.sitepoint.com/hierarchical-data-database/</a></li>\n<li><a href=\"https://packagist.org/search/?q=Nested+Set\">https://packagist.org/search/?q=Nested+Set</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112323\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112323votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112323\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "6066e9414921b467dc9895b140263fb2", "title": "树形结构数据存储方案（三）：闭包表", "create_time": "2017/09/01", "url": "http://blog.jobbole.com/112315/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/closure-table.html\">标点符</a>   </div><p>将Closure Table翻译成闭包表不知道是否合适，闭包表的思路和<a href=\"http://blog.jobbole.com/112312/\">物化路径</a>差不多，都是空间换时间，Closure Table，一种更为彻底的全路径结构，分别记录路径上相关结点的全展开形式。能明晰任意两结点关系而无须多余查询，级联删除和结点移动也很方便。但是它的存储开销会大一些，除了表示结点的Meta信息，还需要一张专用的关系表。</p>\n<p>以下图举例数据举例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/72dbc716e80c6f5d62a90ddf0cf49901.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>创建主表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0bec156319761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeInfo (\r\n\tnode_id INT NOT NULL AUTO_INCREMENT,\r\n\tnode_name VARCHAR (255),\r\n\tPRIMARY KEY (`node_id`)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bec156319761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bec156319761-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bec156319761-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bec156319761-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bec156319761-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bec156319761-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bec156319761-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bec156319761-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bec156319761-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bec156319761-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>创建关系表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0bf5590970438\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeRelationship (\r\n\tancestor INT NOT NULL,\r\n\tdescendant INT NOT NULL,\r\n\tdistance INT NOT NULL,\r\n\tPRIMARY KEY (ancestor, descendant)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf5590970438-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf5590970438-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf5590970438-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf5590970438-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf5590970438-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf5590970438-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf5590970438-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeRelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf5590970438-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf5590970438-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf5590970438-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">distance </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf5590970438-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf5590970438-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>其中</p>\n<ul>\n<li>Ancestor代表祖先节点</li>\n<li>Descendant代表后代节点</li>\n<li>Distance 祖先距离后代的距离</li>\n</ul>\n<p>添加数据（创建存储过程）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0bf9445015849\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` PROCEDURE `AddNode`(`_parent_name` varchar(255),`_node_name` varchar(255))\r\nBEGIN\r\n\tDECLARE _ancestor INT;\r\n\tDECLARE _descendant INT;\r\n\tDECLARE _parent INT;\r\n\tIF NOT EXISTS(SELECT node_id From nodeinfo WHERE node_name = _node_name)\r\n\tTHEN\r\n\t\tINSERT INTO nodeinfo (node_name) VALUES(_node_name);\r\n\t\tSET _descendant = (SELECT node_id FROM nodeinfo WHERE node_name = _node_name);\r\n\t\tINSERT INTO noderelationship (ancestor,descendant,distance) VALUES(_descendant,_descendant,0);\r\n\t\tIF EXISTS (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name)\r\n\t\tTHEN\r\n\t\t\tSET _parent = (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name);\r\n\t\t\tINSERT INTO noderelationship (ancestor,descendant,distance) SELECT ancestor,_descendant,distance+1 from noderelationship where descendant = _parent;\r\n\t\tEND IF;\r\n\tEND IF;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bf9445015849-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bf9445015849-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PROCEDURE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">AddNode</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-2\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-3\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_parent </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">From </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">nodeinfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-14\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bf9445015849-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bf9445015849-17\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p>完成后2张表的数据大致是这样的：（注意：每个节点都有一条到其本身的记录。）</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/97f89f232ea959cd8c01536308049baf.png\" alt=\"Closure-Table-1\" width=\"178\" height=\"224\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5842ea4fa2e0b6f0bdc31ed02131df05.png\" alt=\"Closure-Table-2\" width=\"261\" height=\"451\"></p>\n<p>查询Fruit下所有的子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0bfd731229810\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance != 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bfd731229810-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bfd731229810-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bfd731229810-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bfd731229810-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bfd731229810-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bfd731229810-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bfd731229810-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0bfd731229810-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0bfd731229810-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bfd731229810-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bfd731229810-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bfd731229810-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bfd731229810-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bfd731229810-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bfd731229810-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bfd731229810-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0bfd731229810-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0bfd731229810-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>查询Fruit下直属子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0c00409686121\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance = 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c00409686121-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c00409686121-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c00409686121-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c00409686121-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c00409686121-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c00409686121-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c00409686121-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c00409686121-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c00409686121-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c00409686121-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c00409686121-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c00409686121-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c00409686121-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c00409686121-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c00409686121-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c00409686121-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c00409686121-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c00409686121-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>查询Fruit所处的层级：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adbf8bf0c04865532445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn2.*, n3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.descendant\r\nINNER JOIN nodeinfo n3 ON n2.ancestor = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nORDER BY\r\n\tn2.distance DESC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c04865532445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c04865532445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c04865532445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c04865532445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c04865532445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c04865532445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c04865532445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c04865532445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adbf8bf0c04865532445-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adbf8bf0c04865532445-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c04865532445-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c04865532445-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c04865532445-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c04865532445-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c04865532445-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">descendant</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c04865532445-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c04865532445-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c04865532445-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59adbf8bf0c04865532445-9\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adbf8bf0c04865532445-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">distance </span><span class=\"crayon-v\">DESC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>另外要删除节点也非常的简单，这里就不再做过多的阐述。</p>\n<p>参考链接：</p>\n<ul>\n<li>https://coderwall.com/p/lixing/closure-tables-for-browsing-trees-in-sql</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "132543f366021bfbe319524538ba0b5d", "title": "树形结构数据存储方案（五）：区间嵌套", "create_time": "2017/09/03", "url": "http://blog.jobbole.com/112339/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/nested-intervals.html\">标点符</a>   </div><p>前面的一篇文章介绍了<a href=\"http://blog.jobbole.com/112323/\">左右值编码</a>，不知道大家注意到了没有，如果数据庞大，每次更新都需要更新差不多全表，效率较低没有更好的方式？今天我们就来研究下区间嵌套法。</p>\n<p><strong>区间嵌套法原理</strong></p>\n<p>如果节点区间[clft, crgt]与[plft, prgt]存在如下关系：plft &lt;= clft and crgt &gt;= prgt，则[clft, crgt]区间里的点是[plft, prgt]的子节点。基于此假设我们就可以通过对区间的不断的向下划来获取新的区间。举例：如果在区间[plft, prgt]中存在一个空白区间[lft1, rgt1]，如果要加入一个[plft,lft1]、[rgt1,prgt]同级的区间，只需插入节点：[(2*lft1+rgt1)/3,  (rgt1+2*lft)/3]。在添加完节点后我们还留下[lft1,(2*lft1+rgt1)/3]和 [(rgt1+2*lft)/3,rgt1]两个空余的空间用来添加更多的子节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/94d451042cd71b68d4b44369f8ecff49.png\" alt=\"nested-intervals\" width=\"575\" height=\"100\">如果我们把区间放在二位平面上，把rgt当成是x轴，lft当做是y轴，纳闷嵌套的区间数差不多是这样的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6e99479d95abda03131d9100ec75ec0f.png\" alt=\"nested-intervals-2\" width=\"500\" height=\"500\"></p>\n<p>每个节点[lft, rgt]拥有的子节点都被包含在y &gt;= lft &amp; x &lt;= rgt中。同时y &gt;= clft &amp; x &lt;= crgt所在的空间也是y &gt;= plft  &amp; x &lt;= prgt的子集。另外由于新增的右区间都小于已有的左区间，所以新增的节点均在y=x这条直线以下。</p>\n<p><strong>区间嵌套法实现</strong></p>\n<p>了解了区间嵌套法的原理后，接下来我们就要考虑如何实现他，原则上初始的区间使用任何区间都是可以的，这里我们使用的是[0,1]作为根区间。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/81fa2963538889e727c4b2e0ba0e9df5.png\" alt=\"nested-intervals-3\" width=\"594\" height=\"594\"></p>\n<p>首先，我们在XY平面上定义2个点。深度优先集合点和广度有限集合点，针对点&lt;x=1,y=1/2&gt;的深度优先集合点为&lt;x=1,y=1&gt;，广度优先集合点为&lt;x=1/2,y=1/2&gt;。接下来我们定义第一个子节点的位置为父节点和深度优先集合点的中间点。兄弟节点则为前一个子节点到广度优先集合点的中间点，如上图所示，节点1.2的位置为&lt;x=3/4, y=5/8&gt;。</p>\n<p>另外仔细看我们可以看到点与点之间的关系。另外如果我们知道x和y的和，我们就能反推出x,y的值（具体的逻辑是什么，我现在也还没有搞懂，有知道的朋友可以帮忙解释下）。</p>\n<p>我们以节点&lt;x=3/4, y=5/8&gt;为例，我们可以得到他的和为11/8。</p>\n<p>我们定义11为分子（numerator），8为分母（denominator），则x点的分子为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22d4701105728\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22d4701105728-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22d4701105728-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">x_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22d4701105728-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22d4701105728-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>x点的分母为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22df261585534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_ denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22df261585534-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22df261585534-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">x_ </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22df261585534-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22df261585534-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>Y点的分子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22e3406063916\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e3406063916-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e3406063916-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e3406063916-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e3406063916-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>Y 的分母：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22e7036545971\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22e7036545971-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22e7036545971-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22e7036545971-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22e7036545971-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>接下来我们来测试下，X与Y是否能解码出来：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22eb215770124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tCONCAT(x_numer (11, 8),'/',x_denom (11, 8)) AS X,\r\n\tCONCAT(y_numer (11, 8),'/',y_denom (11, 8)) AS Y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22eb215770124-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22eb215770124-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22eb215770124-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22eb215770124-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22eb215770124-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22eb215770124-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">y_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">y_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bbeb82483ee93ccefe1247f25950d91a.png\" alt=\"result\" width=\"232\" height=\"83\"></p>\n<p>结果与节点1.2的位置为&lt;x=3/4, y=5/8&gt;完全一致。现在我们知道只需要一个分数即可表示平面上的一个点。</p>\n<p>如有已经有分数11/8如何获取该节点的父节点？(如果分子为3，则代表其为根节点)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22ee241917370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN denom/2;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ee241917370-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ee241917370-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ee241917370-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ee241917370-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22f1697824345\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT CONCAT(parent_numer(11,8),'/',parent_denom(11,8)) AS parent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f1697824345-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f1697824345-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>计算当前节点在同级所在的位置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22f5653820964\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN NULL;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f5653820964-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f5653820964-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f5653820964-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f5653820964-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>有了查询父节点的方法及当前节点所在同级中的位置的方法，即可通过这两个的组合，将节点的路径给计算出来。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22f8685770230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tIF numer is NULL THEN\r\n\t\tRETURN '';\r\n\tEND IF;\r\n\tRETURN path(parent_numer(numer, denom),parent_denom(numer, denom))|| ‘.’ || sibling_number(numer, denom);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f8685770230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f8685770230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f8685770230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f8685770230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f8685770230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f8685770230-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22f8685770230-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22f8685770230-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f8685770230-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f8685770230-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f8685770230-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f8685770230-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f8685770230-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f8685770230-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22f8685770230-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-sy\">.</span>’<span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22f8685770230-8\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>按照以上方法添加后进行测试，返回[Err] 1424 – Recursive stored functions and triggers are not allowed. 即MySQL的自定义函数不支持递归查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22fb200471635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tDECLARE numer_temp INT;\r\n\tDECLARE denom_temp INT;\r\n\tDECLARE path_result VARCHAR(255);\r\n\tDECLARE path_temp VARCHAR(255);\r\n\tDECLARE sn VARCHAR(255);\r\n\tSET path_temp := '';\r\n\tWHILE numer IS NOT NULL DO\r\n\t\tIF path_temp = ''\r\n\t\tTHEN\r\n\t\t\tSET path_result := sibling_number(numer, denom);\r\n\t\tELSE\r\n\t\t\tSET path_result := CONCAT(sibling_number(numer, denom),'.',path_temp);\r\n\t\tEND IF;\r\n\t\tSET path_temp := path_result;\r\n\t\tSET numer_temp := parent_numer(numer, denom);\r\n\t\tSET denom_temp := parent_denom(numer, denom);\r\n\t\tSET numer := numer_temp;\r\n\t\tSET denom := denom_temp;\r\n\tEND WHILE;\r\n\tRETURN path_result;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22fb200471635-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22fb200471635-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_result </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_temp </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sn </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">IS</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">ELSE</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-15\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-19\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-20\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22fb200471635-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22fb200471635-24\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>SELECT path (11, 8) 的结果为 1.2</p>\n<p>计算节点层级的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb22ff862759393\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `node_level`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tDECLARE ret INT;\r\n\tSET ret =1;\r\n\tIF numer=3 THEN\r\n\t\treturn 1;\r\n\tEND IF;\r\n\tWHILE numer!=3 DO\r\n\t\tSET ret_num := parent_numer(numer, denom);\r\n\t\tSET ret_den := parent_denom(numer, denom);\r\n\t\tSET numer := ret_num;\r\n\t\tSET denom := ret_den;\r\n\t\tSET ret := ret + 1;\r\n\tEND WHILE;\r\n\tRETURN ret;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb22ff862759393-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb22ff862759393-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_level</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">!=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb22ff862759393-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb22ff862759393-19\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>我们知道了如何将编码过的节点转成目录形式，如何逆转呢？以下是方法：</p>\n<p>先添加2个辅助函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb2302069737576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_numer`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN num * power(2, child) + 3 - power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2302069737576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2302069737576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2302069737576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2302069737576-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2302069737576-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb2302069737576-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2302069737576-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2302069737576-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2302069737576-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2302069737576-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb2306647133622\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_denom`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN den*power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2306647133622-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2306647133622-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2306647133622-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2306647133622-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2306647133622-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb2306647133622-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2306647133622-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2306647133622-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2306647133622-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2306647133622-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>再来编写逆转函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb2309421692639\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_numer`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb2309421692639-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb2309421692639-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb2309421692639-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb2309421692639-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0fedb230c826829281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_denom`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0fedb230c826829281-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0fedb230c826829281-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0fedb230c826829281-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0fedb230c826829281-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>select CONCAT(path_numer(‘2.1.3′),’/’,path_denom(‘2.1.3’)) 结果为51/64</p>\n<p>参考资料：</p>\n<ul>\n<li>http://www.rampant-books.com/art_vadim_nested_sets_sql_trees.htm</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112339\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112339votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112339\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "cc5aad5c95d92007fc92bd84a7332c25", "title": "11 个超酷的编程新工具", "create_time": "2017/08/29", "url": "http://blog.jobbole.com/112288/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg"], "praise_num": "2", "comment_num": 0, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/11-cool-new-coding-tools-to-know?utm_medium=feed&amp;utm_source=feedpress.me&amp;utm_campaign=Feed:%20dzone\">Damian Wolf</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/11-cool-new-coding-tools-to-know?print\">开源中国</a>   </div><p>工具对开发人员来说至关重要。工具可以让一个开发人员的日常工作更高效，并且只需要关注最重要的事情。对于开发人员来讲，寻找更好的替代工具往往比坚持使用熟悉单身过时的工具更困难。</p>\n<p>在这篇文章中，我们将列出你在日常工作中能够使用的新的开发工具。很多对在线流媒体感兴趣的开发人员已经开始在他们的开发环境中使用这些新工具，因为相比他们的旧的设施来讲这些工具提供了更多的优势。</p>\n<p>你可能会想，如果旧的工具可以完成工作，还有必要去寻找新的工具吗？技术总是在变化，而且与我们的工作方式息息相关，它需要保持更新。此外，新工具可以在某些方面对工作进行自动化，让你更好的控制工作流程，从而带来更大的价值。因此，如果你现在确信并准备考虑使用市场上新的编程工具，请继续阅读本文，了解其中最好的一些。</p>\n<h1>LiveEdu</h1>\n<p><a href=\"https://www.liveedu.tv/\" target=\"_blank\" rel=\"nofollow\">LiveEdu</a> 是开发者和工程师入驻的好地方。它是一个基于项目的学习平台，服务于游戏开发、设计、数据科学、编程、增强现实、人工智能和虚拟现实等方面的技能提升。学习的关键在于项目的真实性，以及 <a href=\"https://www.liveedu.tv/projects/premium/\" target=\"_blank\" rel=\"nofollow\">LiveEdu 平台额外提供的项目教程</a>，这些教程涵盖大量不同的主题，适用于任何人，包括初学者。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg\"><img class=\"aligncenter size-full wp-image-112289\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Standup</h1>\n<p><a href=\"https://getstandup.com/\" target=\"_blank\" rel=\"nofollow\">Standup</a> 是一个监控团队开发进度的好工具。它很好地集成了你已经在用的所有工具，比如Trello， BitBucket， GitHub，以及其他工具。它是怎么工作的呢？它会完全按照开发团队成员的提交历史来自动生成工作报告。这项应用使团队之间共享信息变得更容易，也让团队成员之间形成了积极的竞争关系。该主意是Mesh Studio在完成一个客户的严格的汇报需求的合同工作的时候想出来的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a127c8395466be2c10e9248164371cd.jpg\"><img class=\"aligncenter size-full wp-image-112294\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a127c8395466be2c10e9248164371cd.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Cell</h1>\n<p><a href=\"http://www.celljs.org/\" target=\"_blank\" rel=\"nofollow\">Cell</a> 自称为“自驱动的网页应用开发框架”。框架这个词让人立刻想到它应该包含APIs，方法，或其他框架具备的功能。然而，Cell 提供的是一种写 HTML 代码的全新的方式。它基于三个简单的规则，而且不运行任何函数就自助建立 DOM。Cell 提供了一种类似写小说的方式来开发网页应用。</p>\n<p>请看示例代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0d1781a29702730667\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;html&gt;\r\n&lt;script src=\"https://www.celljs.org/cell.js\"&gt;&lt;/script&gt;\r\n&lt;script&gt;\r\nvar el = {\r\n  $cell: true,\r\n  style: \"font-family: Helvetica; font-size: 14px;\",\r\n  $components: [\r\n    {\r\n      $type: \"input\",\r\n      type: \"text\",\r\n      placeholder: \"Type something and press enter\",\r\n      style: \"width: 100%; outline:none; padding: 5px;\",\r\n      $init: function(e) { this.focus() },\r\n      onkeyup: function(e) {\r\n        if (e.keyCode === 13) {\r\n          document.querySelector(\"#list\")._add(this.value);\r\n          this.value = \"\";\r\n        }\r\n      }\r\n    },\r\n    {\r\n      $type: \"ol\",\r\n      id: \"list\",\r\n      _items: [],\r\n      $components: [],\r\n      _add: function(val) { this._items.push(val) },\r\n      $update: function() {\r\n        this.$components = this._items.map(function(item) {\r\n          return { $type: \"li\", $text: item }\r\n        })\r\n      }\r\n    }\r\n  ]\r\n}\r\n&lt;/script&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a29702730667-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a29702730667-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-2\"><span class=\"crayon-ta\">&lt;script </span><span class=\"crayon-e \">src</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://www.celljs.org/cell.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-3\"><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">el</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">cell</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"font-family: Helvetica; font-size: 14px;\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">placeholder</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Type something and press enter\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"width: 100%; outline:none; padding: 5px;\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">init</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">focus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">onkeyup</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">keyCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">querySelector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#list\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ol\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"list\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">_items</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">_add</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">update</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-29\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"li\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-31\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-33\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a29702730667-35\"><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a29702730667-36\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0086 seconds] -->\r\n<p>上面这段代码可以生成如下HTML：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e8ba56d831e236baa499c6d2aeb80a2c.png\"><img class=\"aligncenter size-full wp-image-112295\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e8ba56d831e236baa499c6d2aeb80a2c.png\" alt=\"autnonomous_dom\"></a></p>\n<h1>Osquery</h1>\n<p><a href=\"https://osquery.io/\" target=\"_blank\" rel=\"nofollow\">Osquery</a> 是 Facebook 通过 Query 语言揭示操作系统的方法。尽管初看并不吸引人，但其实有着很多实际的用途。例如，你可以通过它来获取通过USB连接的硬件设备列表。</p>\n<p>如果开发者想要保护他们的 APP 不受安全漏洞的影响，或是能在不同的系统上监视他们的应用，那么其中一个有效方法是不使用底层函数或API交互的能力。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/030b4cdf07d5b1fff4501c159be7740b.jpg\"><img class=\"aligncenter size-full wp-image-112296\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/030b4cdf07d5b1fff4501c159be7740b.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>React Native Firebase</h1>\n<p><a href=\"https://github.com/invertase/react-native-firebase?ref=stackshare\" rel=\"nofollow\">React Native Firebase</a> 旨在帮助开发者更好地使用 React Native 和Firebase。 RN Firebase 可以让你使用 JavaScript bridge 在 Android 和 iOS 上轻松访问本地 eFirebase SDK</p>\n<h1>Warp</h1>\n<p><a href=\"https://github.com/spolu/warp?ref=stackshare\" rel=\"nofollow\">Warp </a>是一个简单的工具，它可以让任何人分享他们的终端。分享终端就像输入一个 warp open 命令那么简单。这可以帮助开发者或主机供应商彼此分享终端。该工具的主要特点是安全和易于传输。让分享从未如此容易！你很快就会忘记SSH 的必要性，并使用它跟同远程团队和刚入坑的小伙伴进行互动。</p>\n<h1>Draft</h1>\n<p><a href=\"https://github.com/Azure/draft\" target=\"_blank\" rel=\"nofollow\">Draft</a> 是一个可以帮助开发者轻松在 Kubernet 构建应用程序的新工具。直到现在，把应用移动版本库之前的测试仍是一件费时费力的工作。有了 Draft，开发者可以在Kubernetes的开发沙箱中把“内循环”和测试应用作为测试对象。沙箱可以通过公共URL获得，并可以使用本地编辑器修改。</p>\n<h1>Docsify</h1>\n<p><a href=\"https://docsify.js.org/\" rel=\"nofollow\">Docsify</a> 是一个文档站点生成器工具。但它完全不同于其他静态的HTML文件生成器。有了 Docsify，你可以使用 Markdown 文件生成你的站点。这样你就可以在 Markdown 上修改代码并及时看到更新。这一特点使得它媲美GitBook等其他流行工具。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/624701b202ab86af496a8f4830a5a6bf.jpg\"><img class=\"aligncenter size-full wp-image-112297\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/624701b202ab86af496a8f4830a5a6bf.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Prismic IO</h1>\n<p><a href=\"https://prismic.io/\" rel=\"nofollow\">Prismic IO</a> 是一个无头CMS系统的后台应用。感谢 API 让它可以和任何站点和App一起使用，并很容易和已有的系统进行整合。CMS 也为营销人员提供了一些现代化的发布和创作工具。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/599f353f6d045c4e0809c4a27437185f.jpg\"><img class=\"aligncenter size-full wp-image-112298\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/599f353f6d045c4e0809c4a27437185f.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Javalin</h1>\n<p><a href=\"https://javalin.io/?ref=stackshare\" rel=\"nofollow\">Javalin</a> 为Kotlin和Java提供了简单的REST API。 这个REST API易于使用，API也非常的流畅。它不是框架，因此不会被混淆。它的目的是提供一个易用的轻量级 REST API库。</p>\n<p>下面是用Kotlin实现的 “Hello World”API的例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ae0d1781a36758632710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport io.javalin.Javalin\r\nfunmain(args: Array&lt;String&gt;) {\r\n    val app = Javalin.create().port(7000)\r\n    app.get(\"/\") { ctx -&gt; ctx.result(\"Hello World\") }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a36758632710-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a36758632710-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a36758632710-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ae0d1781a36758632710-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ae0d1781a36758632710-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ae0d1781a36758632710-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">javalin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Javalin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a36758632710-2\"><span class=\"crayon-e\">funmain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a36758632710-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">val </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Javalin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">port</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">7000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ae0d1781a36758632710-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ctx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ctx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello World\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ae0d1781a36758632710-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h1>Bootsnap</h1>\n<p>我们都知道速度对某些应用程序而言有多重要。Ruby的性能臭名昭著。然而，<a href=\"https://stackshare.io/bootsnap?utm_source=sitepoint&amp;utm_medium=guest_post&amp;utm_campaign=top_new_tools_june_2017&amp;utm_term=dev_tools&amp;utm_content=post\" target=\"_blank\" rel=\"nofollow\">Bootsnap</a>尝试通过缓存很多Ruby方法并提高其整体性能来加快其速度。它可以以gem的形式轻松插入你的应用程序中，目前可用于 MacOS 和 Linux 系统。</p>\n<h1>最后的思考<del></del></h1>\n<p>编码工具是开发人员工具的一部分。 就像其他职位一样，其对提高效率是很有帮助的。最终这些新的编码工具肯定会以某种方式帮助你。但是，上述提及的工具是非常专业的，你可能根本不会使用到它们。在这种情况下，我们期盼你对最近使用的任何新编码工具（与你的工作相关）进行评论。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112288\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112288votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112288\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,工具", "front_image_path": "full/506b10e07df0fcf17177c7768541dfb59fecd817.jpg"}
{"url_object_id": "57b1c7a9c251956122375617d79e5750", "title": "树形结构数据存储方案（一）：邻接列表模式", "create_time": "2017/08/30", "url": "http://blog.jobbole.com/112309/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/adjacency-list.html\">标点符</a>   </div><p>在程序开发中，我们常遇到用树型结构来表示某些数据间的关系，如企业的组织架构、商品的分类、操作栏目等，目前的关系型数据库都是以二维表的形式记录存储数据，而树型结构的数据如需存入二维表就必须进行Schema设计。最近对此方面比较感兴趣，专门做下梳理，如下为常见的树型结构的数据：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/22f7d85dbaeaaf50d465db3628ed7427.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>其中最简单的方法是：Adjacency List（邻接列表模式）。简单的说是根据节点之间的继承关系，显现的描述某一节点的父节点，从而建立二位的关系表。表结构通常设计为{Node_id,Parent_id}，如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/55b08386eecd7d15cebf167c700aab46.jpg\" alt=\"adjacency-list\" width=\"312\" height=\"215\"></p>\n<p>使用连接表的大致代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add2d629f40530631900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n// $parent is the parent of the children we want to see\r\n// $level is increased when we go deeper into the tree,\r\n//        used to display a nice indented tree\r\n \r\nfunction display_children($parent, $level) \r\n{\r\n   // 获得一个 父节点 $parent 的所有子节点\r\n   $result = mysql_query('SELECT name FROM tree WHERE parent=\"'.$parent.'\";');\r\n \r\n   // 显示每个子节点\r\n   while ($row = mysql_fetch_array($result)) \r\n   {\r\n       // 缩进显示节点名称\r\n       echo str_repeat('  ',$level).$row['name'].\"\\n\";\r\n \r\n       //再次调用这个函数显示子节点的子节点\r\n      \r\n       display_children($row['name'], $level+1);\r\n   }\r\n}\r\n?&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f40530631900-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f40530631900-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-1\"><span class=\"crayon-ta\">&lt;?php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-2\"><span class=\"crayon-c\">// $parent is the parent of the children we want to see</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-3\"><span class=\"crayon-c\">// $level is increased when we go deeper into the tree,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-4\"><span class=\"crayon-c\">//        used to display a nice indented tree</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-6\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">display_children</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$parent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 获得一个 父节点 $parent 的所有子节点</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'SELECT name FROM tree WHERE parent=\"'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'\";'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-10\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 显示每个子节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_fetch_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-14\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// 缩进显示节点名称</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-15\"><span class=\"crayon-h\">       </span><span class=\"crayon-k \">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str_repeat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'  '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">$level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//再次调用这个函数显示子节点的子节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-18\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-e\">display_children</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$level</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-20\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f40530631900-21\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f40530631900-22\"><span class=\"crayon-ta\">?&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>对整个结构的根节点（Food）使用这个函数就可以打印出整个多级树结构，由于Food是根节点它的父节点是空的，所以这样调用: display_children(”,0)。将显示整个树的内容。如果你只想显示整个结构中的一部分，比如说水果部分，就可以这样调用：display_children(‘Fruit’,0);</p>\n<p>几乎使用同样的方法我们可以知道从根节点到任意节点的路径。比如 Cherry 的路径是　”Food &gt;; Fruit &gt;; Red”。 为了得到这样的一个路径我们需要从最深的一级”Cherry”开始， 查询得到它的父节点”Red”把它添加到路径中， 然后我们再查询Red的父节点并把它也添加到路径中，以此类推直到最高层的”Food”</p>\n<p>以下是代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add2d629f4e072086291\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n// $node 是那个最深的节点\r\nfunction get_path($node) \r\n{\r\n   // 查询这个节点的父节点\r\n   $result = mysql_query('SELECT parent FROM tree '.\r\n                          'WHERE name=\"'.$node.'\";');\r\n   $row = mysql_fetch_array($result);\r\n \r\n   // 用一个数组保存路径\r\n   $path = array();\r\n \r\n   // 如果不是根节点则继续向上查询\r\n   // (根节点没有父节点)\r\n   if ($row['parent']!='') \r\n   {\r\n       // the last part of the path to $node, is the name\r\n       // of the parent of $node\r\n       $path[] = $row['parent'];\r\n \r\n       // we should add the path to the parent of this node\r\n       // to the path\r\n       $path = array_merge(get_path($row['parent']), $path);\r\n   }\r\n \r\n   // return the path\r\n   return $path;\r\n}\r\n?&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f4e072086291-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f4e072086291-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-1\"><span class=\"crayon-ta\">&lt;?php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-2\"><span class=\"crayon-c\">// $node 是那个最深的节点</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-3\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 查询这个节点的父节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'SELECT parent FROM tree '</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-7\"><span class=\"crayon-h\">                          </span><span class=\"crayon-s\">'WHERE name=\"'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'\";'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_fetch_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-9\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 用一个数组保存路径</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-12\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 如果不是根节点则继续向上查询</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// (根节点没有父节点)</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">!=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// the last part of the path to $node, is the name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// of the parent of $node</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-21\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// we should add the path to the parent of this node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-22\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// to the path</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-23\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">$path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">get_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-24\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-25\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-26\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// return the path</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-27\"><span class=\"crayon-h\">   </span><span class=\"crayon-k \">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f4e072086291-28\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f4e072086291-29\"><span class=\"crayon-ta\">?&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>如果对”Cherry”使用这个函数：print_r(get_path(‘Cherry’))，就会得到这样的一个数组了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add2d629f53330028845\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nArray  \r\n(  \r\n  [0] =&gt;; Food  \r\n  [1] =&gt;; Fruit  \r\n  [2] =&gt;; Red  \r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add2d629f53330028845-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f53330028845-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f53330028845-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f53330028845-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add2d629f53330028845-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add2d629f53330028845-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add2d629f53330028845-1\"><span class=\"crayon-t\">Array</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f53330028845-2\"><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f53330028845-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Food</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f53330028845-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Fruit</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59add2d629f53330028845-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Red</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add2d629f53330028845-6\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这种方案的优点很明显：结构简单易懂，由于互相之间的关系只由一个parent_id维护，所以增删改都是非常容易，只需要改动和他直接相关的记录就可以。缺点当然也是非常的突出：由于直接地记录了节点之间的继承关系，因此对Tree的任何CRUD操作都将是低效的，这主要归根于频繁的“递归”操作，递归过程不断地访问数据库，每次数据库IO都会有时间开销。举个例子，如果想要返回所有水果，也就是水果的所有子孙节点，看似很简单的操作，就需要用到一堆递归。当然，这种方案并非没有用武之地，在树的层级比较少的时候就非常实用，在邻接列表模式的基础上还可以拓展的是平面表，区别是将节点的level和当前节点的顺序也放入表中，比较适合类似评论等场景，具体的表结构类似这样，这里就不再深入阐述。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/39555f44c984f39dcebeef0feeb23dce.png\" alt=\"flat-table\" width=\"800\" height=\"183\"></p>\n<p>参考链接：</p>\n<ul>\n<li>http://salman-w.blogspot.com/2012/08/php-adjacency-list-hierarchy-tree-traversal.html</li>\n<li>https://packagist.org/search/?tags=adjacency%20list</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112309\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112309votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112309\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "c2031fdb29548112c91025f9bbba3f1f", "title": "一个时代的结束：Solaris 系统的那些年，那些事", "create_time": "2017/08/25", "url": "http://blog.jobbole.com/112268/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.phoronix.com/scan.php?page=news_item&amp;px=Solaris-2017-Look-Back\">Michael Larabel</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8803-1.html\">Linux中国/MonkeyDEcho</a>   </div><p>现在看来，Oracle 公司正在通过取消 Solaris 12 而终止 Solaris 的功能开发，这里我们要回顾下多年来在 Phoronix 上最受欢迎的 Solaris 重大事件和新闻。</p>\n<p>这里有许多关于 Solaris 的有趣／重要的回忆。<img src=\"../../upload/2017_08/170823192136556.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112270\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/93e6343916d6c39535b8e3d60d32842b.jpg\" alt=\"170823192136556\"></p>\n<p>在 Sun Microsystems 时期，我真的对 Solaris 很感兴趣。在 Phoronix 上我们一直重点关注 Linux 的同时，经常也有 Solaris 的文章出现。 Solaris 玩起来很有趣，OpenSolaris／SXCE 是伟大的产物，我将 Phoronix 测试套件移植到 Solaris 上，我们与 Sun Microsystems 人员有密切的联系，也出现在 Sun 的许多活动中。</p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112271\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1cd3d84a19148210405ea50c5cb700d6.jpg\" alt=\"170823192136551\"></p>\n<p style=\"text-align: center\"><em>在那些日子里 Sun 有一些相当独特的活动…</em></p>\n<p>不幸的是，自从 Oracle 公司收购了 Sun 公司， Solaris 就如坠入深渊一样。最大的打击大概是 Oracle 结束了 OpenSolaris ，并将所有 Solaris 的工作转移到专有模式…<img src=\"../../upload/2017_08/170823192136552.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112272\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8f35c72754a3ff32e7d0a0bbc13f3000.jpg\" alt=\"170823192136552\"></p>\n<p>在 Sun 时代的 Solaris 有很多美好的回忆，所以 Oracle 在其计划中抹去了 Solaris 12 之后，我经常在 Phoronix 上翻回去看一些之前 Solaris 的经典文章，期待着能从 Oracle 听到 “Solaris 11” 下一代的消息，重启 Solaris 项目的开发。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136553.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112273\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/afbcf1ab8db3a502f127d7208a1ffd08.jpg\" alt=\"170823192136553\"></p>\n<p>虽然在后 Solaris 的世界中，看到 Oracle 对 ZFS 所做的事情以及他们在基于 RHEL 的 Oracle Enterprise Linux 上下的重注将会很有趣，但时间将会告诉我们一切。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136554.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112274\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8fef927af40aa7f7db5a27dc2d0be68c.jpg\" alt=\"170823192136554\"></p>\n<p>无论如何，这是回顾自 2004 年以来我们最受欢迎的 Solaris 文章：</p>\n<h4 id=\"toc_1\">2016/12/1 Oracle 或许会罐藏 Solaris</h4>\n<p>Oracle 可能正在拔掉 Solaris 的电源插头，据一些新的传闻说。</p>\n<h4 id=\"toc_2\">2013/6/9 OpenSXCE 2013.05 拯救 Solaris 社区</h4>\n<p>作为 Solaris 社区版的社区复兴，OpenSXCE 2013.05 出现在网上。</p>\n<h4 id=\"toc_3\">2013/2/2 Solaris 12 可能最终带来 Radeon KMS 驱动程序</h4>\n<p>看起来，Oracle 可能正在准备发布自己的 AMD Radeon 内核模式设置（KMS）驱动程序，并引入到 Oracle Solaris 12 中。</p>\n<h4 id=\"toc_4\">2012/10/4 Oracle Solaris 11.1 提供 300 个以上增强功能</h4>\n<p>Oracle昨天在旧金山的 Oracle OpenWorld 会议上发布了 Solaris 11.1 。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136555.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112275\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg\" alt=\"170823192136555\"></p>\n<h4 id=\"toc_5\">2012/1/9 Oracle 尚未澄清 Solaris 11 内核来源</h4>\n<p>一个月前，Phoronix 是第一个注意到 Solaris 11 内核源代码通过 Torrent 站点泄漏到网上的信息。一个月后，甲骨文还没有正式评论这个情况。</p>\n<h4 id=\"toc_6\">2011/12/19 Oracle Solaris 11 内核源代码泄漏</h4>\n<p>似乎 Solaris 11的内核源代码在过去的一个周末被泄露到了网上。</p>\n<h4 id=\"toc_7\">2011/8/25 对于 BSD，Solaris 的 GPU 驱动程序的悲惨状态</h4>\n<p>昨天在邮件列表上出现了关于干掉所有旧式 Mesa 驱动程序的讨论。这些旧驱动程序没有被积极维护，支持复古的图形处理器，并且没有更新支持新的 Mesa 功能。英特尔和其他开发人员正在努力清理 Mesa 核心，以将来增强这一开源图形库。这种清理 Mesa，对 BSD 和 Solaris 用户也有一些影响。</p>\n<h4 id=\"toc_8\">2010/8/13 告别 OpenSolaris，Oracle 刚刚把它干掉</h4>\n<p>Oracle 终于宣布了他们对 Solaris 操作系统和 OpenSolaris 平台的计划，而且不是好消息。OpenSolaris 将实际死亡，未来将不会有更多的 Solaris 版本出现 – 包括长期延期的 2010 年版本。Solaris 仍然会继续存在，现在 Oracle 正在忙于明年发布的 Solaris 11，但仅在 Oracle 的企业版之后才会发布 “Solaris 11 Express” 作为 OpenSolaris 的类似产品。</p>\n<h4 id=\"toc_9\">2010/2/22 Oracle 仍然要对 OpenSolaris 进行更改</h4>\n<p>自从 Oracle 完成对 Sun Microsystems 的收购以来，已经有了许多变化，这个 Sun 最初支持的开源项目现在已经不再被 Oracle 支持，并且对其余的开源产品进行了重大改变。 Oracle 表现出并不太开放的意图的开源项目之一是 OpenSolaris 。 Solaris Express 社区版（SXCE）上个月已经关闭，并且也没有预计 3 月份发布的下一个 OpenSolaris 版本（OpenSolaris 2010.03）的信息流出。</p>\n<h4 id=\"toc_10\">2007/9/10 Solaris Express 社区版 Build 72</h4>\n<p>对于那些想要在 “印第安纳项目” 发布之前尝试 OpenSolaris 软件中最新最好的软件的人来说，现在可以使用 Solaris Express 社区版 Build 72。Solaris Express 社区版（SXCE）Build 72 可以从 OpenSolaris.org 下载。同时，预计将在下个月推出 Sun 的 “印第安纳项目” 项目的预览版。</p>\n<h4 id=\"toc_11\">2007/9/6 ATI R500/600 驱动要支持 Solaris 了?</h4>\n<p>虽然没有可用于 Solaris/OpenSolaris 或 * BSD 的 ATI fglrx 驱动程序，现在 AMD 将向 X.Org 开发人员和开源驱动程序交付规范，但对于任何使用 ATI 的 Radeon X1000 “R500” 或者 HD 2000“R600” 系列的 Solaris 用户来说，这肯定是有希望的。将于下周发布的开源 X.Org 驱动程序距离成熟尚远，但应该能够相对容易地移植到使用 X.Org 的 Solaris 和其他操作系统上。 AMD 今天宣布的针对的是 Linux 社区，但它也可以帮助使用 ATI 硬件的 Solaris/OpenSolaris 用户。特别是随着印第安纳项目的即将推出，开源 R500/600 驱动程序移植就只是时间问题了。</p>\n<h4 id=\"toc_12\">2007/9/5 Solaris Express 社区版 Build 71</h4>\n<p>Solaris Express 社区版（SXCE）现已推出 Build 71。您可以在 OpenSolaris.org 中找到有关 Solaris Express 社区版 Build 71 的更多信息。另外，在 Linux 内核峰会上，AMD 将提供 GPU 规格的消息，由此产生的 X.Org 驱动程序将来可能会导致 ATI 硬件上 Solaris/OpenSolaris 有所改善。</p>\n<h4 id=\"toc_13\">2007/8/27 Linux 的 Solaris 容器</h4>\n<p>Sun Microsystems 已经宣布，他们将很快支持适用于 Linux 应用程序的 Solaris 容器。这样可以在 Solaris 下运行 Linux 应用程序，而无需对二进制包进行任何修改。适用于 Linux 的 Solaris 容器将允许从 Linux 到 Solaris 的平滑迁移，协助跨平台开发以及其他优势。当该支持到来时，这个时代就“快到了”。</p>\n<h4 id=\"toc_14\">2007/8/23 OpenSolaris 开发者峰会</h4>\n<p>今天早些时候在 OpenSolaris 论坛上发布了第一次 OpenSolaris 开发人员峰会的消息。这次峰会将在十月份在加州大学圣克鲁斯分校举行。 Sara Dornsife 将这次峰会描述为“不是与演示文稿或参展商举行会议，而是一个亲自参与的协作工作会议，以计划下一期的印第安纳项目。” 伊恩·默多克（Ian Murdock） 将在这个“印第安纳项目”中进行主题演讲，但除此之外，该计划仍在计划之中。 Phoronix 可能会继续跟踪此事件，您可以在 Solaris 论坛上讨论此次峰会。</p>\n<h4 id=\"toc_15\">2007/8/18 Solaris Express 社区版 Build 70</h4>\n<p>名叫 “Nevada” 的 Solaris Express 社区版 Build 70 (SXCE snv_70) 现在已经发布。有关下载链接的通知可以在 OpenSolaris 论坛中找到。还有公布了其网络存储的 Build 71 版本，包括来自 Qlogic 的光纤通道 HBA 驱动程序的源代码。</p>\n<h4 id=\"toc_16\">2007/8/16 IBM 使用 Sun Solaris 的系统</h4>\n<p>Sun Microsystems 和 IBM正在举行电话会议，他们刚刚宣布，IBM 将开始在服务器上使用 Sun 的 Solaris 操作系统。这些 IBM 服务器包括基于 x86 的服务器系统以及 Blade Center 服务器。官方新闻稿刚刚发布，可以在 sun 新闻室阅读。</p>\n<h4 id=\"toc_17\">2007/8/9 OpenSolaris 不会与 Linux 合并</h4>\n<p>在旧金山的 LinuxWorld 2007 上，Andrew Morton 在主题演讲中表示， OpenSolaris 的关键组件不会出现在 Linux 内核中。事实上，莫顿甚至表示 “非常遗憾 OpenSolaris 活着”。OpenSolaris 的一些关键组件包�� Zones、ZFS 和 DTrace 。虽然印第安纳州项目有可能将这些项目转变为 GPLv3 项目… 更多信息参见 ZDNET。</p>\n<h4 id=\"toc_18\">2007/7/27 Solaris Xen 已经更新</h4>\n<p>已经有一段时间了，Solaris Xen 终于更新了。约翰·莱文（John Levon）表示，这一最新版本基于 Xen 3.0.4 和 Solaris “Nevada” Build 66。这一最新版本的改进包括 PAE 支持、HVM 支持、新的 virt-manager 工具、改进的调试支持以及管理域支持。可以在 Sun 的网站上找到 2007 年 7 月 Solaris Xen 更新的下载。</p>\n<h4 id=\"toc_19\">2007/7/25 Solaris 10 7/07 HW 版本</h4>\n<p>Solaris 10 7/07 HW 版本的文档已经上线。如 Solaris 发行注记中所述，Solaris 10 7/07 仅适用于 SPARC Enterprise M4000-M9000 服务器，并且没有 x86/x64 版本可用。所有平台的最新 Solaris 更新是 Solaris 10 11/06 。您可以在 Phoronix 论坛中讨论 Solaris 7/07。</p>\n<h4 id=\"toc_20\">2007/7/16 来自英特尔的 Solaris 电信服务器</h4>\n<p>今天宣布推出符合 NEBS、ETSI 和 ATCA 合规性的英特尔体系的 Sun Solaris 电信机架服务器和刀片服务器。在这些新的运营商级平台中，英特尔运营商级机架式服务器 TIGW1U 支持 Linux 和 Solaris 10，而 Intel NetStructure MPCBL0050 SBC 也将支持这两种操作系统。今天的新闻稿可以在这里阅读。</p>\n<p>然后是 Solaris 分类中最受欢迎的特色文章：</p>\n<h4 id=\"toc_21\">Ubuntu vs. OpenSolaris vs. FreeBSD 基准测试</h4>\n<p>在过去的几个星期里，我们提供了几篇关于 Ubuntu Linux 性能的深入文章。我们已经开始提供 Ubuntu 7.04 到 8.10 的基准测试，并且发现这款受欢迎的 Linux 发行版的性能随着时间的推移而变慢，随之而来的是 Mac OS X 10.5 对比 Ubuntu 8.10 的基准测试和其他文章。在本文中，我们正在比较 Ubuntu 8.10 的 64 位性能与 OpenSolaris 2008.11 和 FreeBSD 7.1 的最新测试版本。</p>\n<h4 id=\"toc_22\">NVIDIA 的性能：Windows vs. Linux vs. Solaris</h4>\n<p>本周早些时候，我们预览了 Quadro FX1700，它是 NVIDIA 的中端工作站显卡之一，基于 G84GL 内核，而 G84GL 内核又源于消费级 GeForce 8600 系列。该 PCI Express 显卡提供 512MB 的视频内存，具有两个双链路 DVI 连接，并支持 OpenGL 2.1 ，同时保持最大功耗仅为 42 瓦。正如我们在预览文章中提到的，我们将不仅在 Linux 下查看此显卡的性能，还要在 Microsoft Windows 和 Sun 的 Solaris 中测试此工作站解决方案。在今天的这篇文章中，我们正在这样做，因为我们测试了 NVIDIA Quadro FX1700 512MB 与这些操作系统及其各自的二进制显示驱动程序。</p>\n<h4 id=\"toc_23\">FreeBSD 8.0 对比 Linux、OpenSolaris</h4>\n<p>在 FreeBSD 8.0 的稳定版本发布的上周，我们终于可以把它放在测试台上，并用 Phoronix 测试套件进行了全面的了解。我们将 FreeBSD 8.0 的性能与早期的 FreeBSD 7.2 版本以及 Fedora 12 和 Ubuntu 9.10 还有 Sun OS 端的 OpenSolaris 2010.02 b127 快照进行了比较。</p>\n<h4 id=\"toc_24\">Fedora、Debian、FreeBSD、OpenBSD、OpenSolaris 基准测试</h4>\n<p>上周我们发布了第一个 Debian GNU/kFreeBSD 基准测试，将 FreeBSD 内核捆绑在 Debian GNU 用户的 Debian GNU/Linux 上，比较了这款 Debian 系统的 32 位和 64 位性能。 我们现在扩展了这个比较，使许多其他操作系统与 Debian GNU/Linux 和 Debian GNU/kFreeBSD 的 6.0 Squeeze 快照直接进行比较，如 Fedora 12，FreeBSD 7.2，FreeBSD 8.0，OpenBSD 4.6 和 OpenSolaris 2009.06 。</p>\n<h4 id=\"toc_25\">AMD 上海皓龙：Linux vs. OpenSolaris 基准测试</h4>\n<p>1月份，当我们研究了四款皓龙 2384 型号时，我们在 Linux 上发布了关于 AMD 上海皓龙 CPU 的综述。与早期的 AMD 巴塞罗那处理器 Ubuntu Linux 相比，这些 45nm 四核工作站服务器处理器的性能非常好，但是在运行 Sun OpenSolaris 操作系统时，性能如何？今天浏览的是 AMD 双核的基准测试，运行 OpenSolaris 2008.11、Ubuntu 8.10 和即将推出的 Ubuntu 9.04 版本。</p>\n<h4 id=\"toc_26\">OpenSolaris vs. Linux 内核基准</h4>\n<p>本周早些时候，我们提供了 Ubuntu 9.04 与 Mac OS X 10.5.6 的基准测试，发现 Leopard 操作系统（Mac）在大多数测试中的表现要优于 Jaunty Jackalope （Ubuntu），至少在 Ubuntu 32 位是这样的。我们今天又回过来进行更多的操作系统基准测试，但这次我们正在比较 Linux 和 Sun OpenSolaris 内核的性能。我们使用的 Nexenta Core 2 操作系统将 OpenSolaris 内核与 GNU/Ubuntu 用户界面组合在同一个 Ubuntu 软件包中，但使用了 Linux 内核的 32 位和 64 位 Ubuntu 服务器安装进行测试。</p>\n<h4 id=\"toc_27\">Netbook 性能：Ubuntu vs. OpenSolaris</h4>\n<p>过去，我们已经发布了 OpenSolaris vs. Linux Kernel 基准测试以及类似的文章，关注 Sun 的 OpenSolaris 与流行的 Linux 发行版的性能。我们已经看过高端 AMD 工作站的性能，但是我们从来没有比较上网本上的 OpenSolaris 和 Linux 性能。直到今天，在本文中，我们将比较戴尔 Inspiron Mini 9 上网本上的 OpenSolaris 2009.06 和 Ubuntu 9.04 的结果。</p>\n<h4 id=\"toc_28\">NVIDIA 图形：Linux vs. Solaris</h4>\n<p>在 Phoronix，我们不断探索 Linux 下的不同显示驱动程序，在我们评估了 Sun 的检查工具并测试了 Solaris 主板以及覆盖其他几个领域之后，我们还没有执行图形驱动程序 Linux 和 Solaris 之间的比较。直到今天。由于印第安纳州项目，我们对 Solaris 更感兴趣，我们决定终于通过 NVIDIA 专有驱动程序提供我们在 Linux 和 Solaris 之间的第一次定量图形比较。</p>\n<h4 id=\"toc_29\">OpenSolaris 2008.05 向 Solaris 提供了一个新面孔</h4>\n<p>2月初，Sun Microsystems 发布了印第安纳项目的第二个预览版本。对于那些人来说，印第安纳州项目是 Sun 的 Ian Murdock 领导的项目的代号，旨在通过解决 Solaris 的长期可用性问题，将 OpenSolaris 推向更多的台式机和笔记本电脑。我们没有对预览 2 留下什么深刻印象，因为它没有比普通用户感兴趣的 GNU/Linux 桌面更有优势。然而，随着 5 月份推出的 OpenSolaris 2008.05 印第安纳项目发布，Sun Microsystems 今天发布了该操作系统的最终测试副本。当最后看到项目印第安纳时， 我们对这个新的 OpenSolaris 版本的最初体验是远远优于我们不到三月前的体验的。</p>\n<h4 id=\"toc_30\">快速概览 Oracle Solaris 11</h4>\n<p>Solaris 11 在周三发布，是七年来这个前 Sun 操作系统的第一个主要更新。在过去七年中，Solaris 家族发生了很大变化，OpenSolaris 在那个时候已经到来，但在本文中，简要介绍了全新的 Oracle Solaris 11 版本。</p>\n<h4 id=\"toc_31\">OpenSolaris、BSD &amp; Linux 的新基准测试</h4>\n<p>今天早些时候，我们对以原生的内核模块支持的 Linux 上的 ZFS 进行了基准测试，该原生模块将被公开提供，以将这个 Sun/Oracle 文件系统覆盖到更多的 Linux 用户。现在，尽管作为一个附加奖励，我们碰巧有了基于 OpenSolaris 的最新发行版的新基准，包括 OpenSolaris、OpenIndiana 和 Augustiner-Schweinshaxe，与 PC-BSD、Fedora 和 Ubuntu相比。</p>\n<h4 id=\"toc_32\">FreeBSD/PC-BSD 9.1 针对 Linux、Solaris、BSD 的基准</h4>\n<p>虽然 FreeBSD 9.1 尚未正式发布，但是基于 FreeBSD 的 PC-BSD 9.1 “Isotope”版本本月已经可用。本文中的性能指标是 64 位版本的 PC-BSD 9.1 与 DragonFlyBSD 3.0.3、Oracle Solaris Express 11.1、CentOS 6.3、Ubuntu 12.10 以及 Ubuntu 13.04 开发快照的比较。</p>\n<hr>\n<p>作者简介：</p>\n<p>Michael Larabel 是 Phoronix.com 的作者，并于 2004 年创立了该网站，该网站重点是丰富多样的 Linux 硬件体验。 Michael 撰写了超过10,000 篇文章，涵盖了 Linux 硬件支持，Linux 性能，图形驱动程序等主题。 Michael 也是 Phoronix 测试套件、 Phoromatic 和 OpenBenchmarking.org 自动化基准测试软件的主要开发人员。可以通过 Twitter 关注他或通过 MichaelLarabel.com 联系他。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112268\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112268votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112268\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/25c01fba3f23ba887baf904514a2ccb08fc515e4.jpg"}
{"url_object_id": "ffadf132787e6e34490e266051346177", "title": "最实用的 Linux 命令行使用技巧", "create_time": "2017/08/24", "url": "http://blog.jobbole.com/112265/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_num": "1", "comment_num": 0, "fav_num": 9, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/most-useful-linux-command-line-tricks\">Seco Max</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/most-useful-linux-command-line-tricks\">开源中国 - leoxu</a>   </div><p>我们可能每天都会要使用到很多的 <a href=\"https://likegeeks.com/main-linux-commands-easy-guide/\" target=\"_blank\" rel=\"nofollow\">Linux 命令行</a>。 我们也会网络上知晓一些使用它们的小技巧，但是如果我们没有时常来进行练习，就有可能会忘掉怎么去使用它们。 所以我就决定把那些你可能会忘记的小提示和小技巧，或者对你而言可能是全新的东西都列表来。</p>\n<h3>将输出内容以表格的形式显示出来</h3>\n<p>有时，在你看到命令行执行的输出时，因为字符串过度拥挤（比如说 mount 命令的输出）导致输出内容难以识别。如果我们看到的内容是一张表格会如何呢？其实这是很容易做到的！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade77829941020400350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmount | column –t:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade77829941020400350-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade77829941020400350-1\"><span class=\"crayon-i\">mount</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> –<span class=\"crayon-v\">t</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8105f229bd5aab1933e69a673b050b77.png\"></p>\n<p>在此例中，由于内容中留了空格，所以输出的形式就美观了起来。 那如果想要的分隔符是别的什么符号，比如说冒号，又该怎么去做呢？ （例如，在 cat/etc/passwd 的输出内容中使用）</p>\n<p>这时候只需要使用 -s 参数指定分隔符就行了，像下面这样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade7782994a767827566\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat /etc/passwd | column -t -s:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade7782994a767827566-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade7782994a767827566-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">passwd</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span> <span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ef22e95df16fb93a17c96954e6950305.png\"></p>\n<h3>重复执行一个命令，直到它运行成功</h3>\n<p>如果在 Google 上搜索这个功能，你会发现很多人都问到了如何重复执行命令，直到这个命令成功返回并且运行正常。 Google上的建议里就包括 ping 服务器，直到它变得空闲为止，还有就是检查是否有向特定的目录上传了具有特定扩展名的文件，还有就是检查特定的URL是否已经存在，诸如此类的办法。</p>\n<p>其实你还可以使用 while true 的循环来实现来实现这个功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/aa7339a9cd7cf1369192fd1007cb76cc.png\"></p>\n<p>在上面这个示例中，&gt;/dev/null 2&gt;＆1 会让程序的输出重定向到 /dev/ null。标准错误和标准输出都会被包含进去。</p>\n<p>这是我认为最酷的Linux命令行技巧之一。</p>\n<h3>按内存资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade7782994f389316439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -rnk 4:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade7782994f389316439-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade7782994f389316439-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">rnk</span> <span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/02ff6a80a4e1632d459fbe1ff580d8fb.png\"></p>\n<h3>按 CPU 资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade77829952666222902\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -nk 3:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade77829952666222902-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade77829952666222902-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">nk</span> <span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a71a5974b1fbae9a9614f2f65d66bfdd.png\"></p>\n<p>如果想要检查你的机器架构，那就执行 getconf LONG_BIT。</p>\n<h3>可以同时查看多个日志文件</h3>\n<p>毫无疑问，你可能已经会使用 tail  命令来查看日志文件了，但可能有时候你还想着能同时查看多个日志文件。 使用 multi-tail 命令就支持支持文本的高亮显示，内容过滤以及更多你可能需要的功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ba6ceb511883799d251d17f9b4e28f0e.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d81c3712dd9b9986860c3e89467852fb.png\"></p>\n<p>如果系统里还没有这个命令，运行 apt-get install multitail 命令就可以把它给装上。</p>\n<h3>回到你操作过的上一个目录去</h3>\n<p>只需敲入 cd – 就会返回到你操作过的上一个目录中去。</p>\n<h3>让非交互式 Shell 会话可进行交互</h3>\n<p>想要这样做，那就把设置从 ~/.bashrc 改成 ~/.bash_profile 吧。</p>\n<h3>定时的监视性命令输出</h3>\n<p>使用 watch 命令（watch df -h），你就可以查看到任何命令的任何输出。例如，你可以查看可用空间以及它的使用量增长情况。</p>\n<p>通过利用 watch 命令来操作会变化的数据，你可以尽情想象自己能拿这个来做些什么哦。</p>\n<h3>在会话关掉以后继续运行程序</h3>\n<p>如果你在后台运行了什么程序，然后你关掉了的 shell 会话，那么这个后台运行的程序就会被你的 shell 杀掉。关闭 shell 以后怎么让程序继续运行下去呢？</p>\n<p>这个可以用 nohup 命令做到 – 该指令表示不做挂断操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade77829957994682917\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnohup wget site.com/file.zip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade77829957994682917-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade77829957994682917-1\"><span class=\"crayon-i\">nohup</span> <span class=\"crayon-i\">wget</span> <span class=\"crayon-v\">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>此命令是最容易被遗忘的 Linux 命令行技巧之一，因为我们许多人都会使用另外一个类命令的 screen 环境：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8e6ac97ad36188d5a566a851d1e2c8c5.png\"></p>\n<p>这样会在同一个目录下生成一个名称为 nohup.out 的文件，其中包含了正在运行的程序的输出内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/73f4a9d25594c685db6714ee46d96810.png\"></p>\n<p>命令很酷，对吧？</p>\n<h3>自动对任何命令回答 Yes 或者 No</h3>\n<p>如果你想自动化需要向用户说的 Yes 的过程，可以使用 yes 命令来实现：yes | apt-get update。</p>\n<p>也许你想做的是自动地说“No”。这个可以使用 yes no | 命令来实现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9d3ada6e55c6b9738b0dc40667db4c50.png\"></p>\n<h3>创建具有指定大小的文件</h3>\n<p>可以使用 dd 命令来创建出具有指定大小的文件：dd if=/dev/zero of=out.txt bs=1M count=10。</p>\n<p>这样就会创建出一个 10 MB 的文件，填充零作为内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/caf1d4163993de8e51e0eb04e45c59d6.png\"></p>\n<h3>以根目录用户来运行最后一个命令</h3>\n<p>有时，你会忘记在需要 root 权限的命令之前敲入 sudo。这时候你没必要去重写命令; 只要输入 sudo 就行了！</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1f79f8f42fcd5f08552b17cc3398d258.png\"></p>\n<h3>对命令行会话进行记录</h3>\n<p>如果想要把自己在 shell 屏幕上敲的内容记录下来，可以使用 script 命令将所有敲写的内容保存到一个名为 typescriptscript 的文件中去。</p>\n<p>等你敲入 exit 命令以后，所有命令就都会被写入该文件，以便你事后再回过头去查看。</p>\n<h3>用标签符号替换空格符</h3>\n<p>可以使用 tr 命令替换任何字符，这个用起来非常方便：cat geeks.txt | tr ‘:[space]:’ ‘\\t’ &gt; out.txt.</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7dcc5cc23045ed18fd3ed993c3065028.png\"></p>\n<h3>将文件内容转换为大写或者小写</h3>\n<p>可以这样实现：cat myfile | tr a-z A-Z&gt; output.txt。</p>\n<h3>强大的 Xargs 命令</h3>\n<p>xargs 命令是最重要的 Linux 命令行技巧之一。你可以使用这个命令将命令的输出作为参数传递给另一个命令。例如，搜索 png 文件然后对其进行压缩或者其它操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade7782995b559203789\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind. -name *.png -type f -print | xargs tar -cvzf images.tar.gz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade7782995b559203789-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade7782995b559203789-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">.</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span> <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">png</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span> <span class=\"crayon-i\">f</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">print</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-i\">tar</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">cvzf</span> <span class=\"crayon-v\">images</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>又或者你的文件中有一个 URL 的列表，而你想要做的是以不同的方式下载或者处理这些 URL，可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade7782995f022400805\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat urls.txt | xargs wget</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade7782995f022400805-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade7782995f022400805-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-v\">wget</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/219b583b1bb3cac2c59130e9bb7e62bf.png\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fc0b4e63f0d1e1009371efcca207fb23.png\" alt=\"xargs command\" width=\"881\" height=\"119\"></p>\n<p>请你要记得，第一个命令的输出会在 xargs 命令结尾处传递。</p>\n<p>那如果命令需要中间过程的输出，该怎么办呢？这个简单！</p>\n<p>只需要使用 {} 并结合 -i 参数就行了。如下所示，替换在第一个命令的输出应该去的地方的参数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade77829962158612979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls /etc/*.conf | xargs -i cp {} /home/likegeeks/Desktop/out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade77829962158612979-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade77829962158612979-1\"><span class=\"crayon-i\">ls</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">conf</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">xargs</span> <span class=\"crayon-o\">-</span><span class=\"crayon-e\">i</span> <span class=\"crayon-e\">cp</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">likegeeks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这只是 Linux 命令行技巧其中的几个而已。你可以使用其他命令来做一些更 HAPPY 的事情，比如 awk 命令和 sed 命令！</p>\n<p>如果你知道一些我在这里没有提到的任何其它的极客命令，欢迎评论。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112265\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112265votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112265\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "af10c79270ccf4bcd277e6f2be193417", "title": "在 Linux 中分割和重组文件", "create_time": "2017/08/30", "url": "http://blog.jobbole.com/112303/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2017/8/splitting-and-re-assembling-files-linux\">Carla Schroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8818-1.html\">Linux中国/firmianay</a>   </div><blockquote><p>非常有用的 <code>csplit</code> 命令可以将单个文件分割成多个文件。Carla Schroder 解释说。</p></blockquote>\n<p>Linux 有几个用于分割文件的工具程序。那么你为什么要分割文件呢？一个用例是将大文件分割成更小的尺寸，以便它适用于比较小的存储介质，比如 U 盘。当您遇到 FAT32（最大文件大小为 4GB），且您的文件大于此时，通过 U 盘传输文件也是一个很好的技巧。另一个用例是加速网络文件传输，因为小文件的并行传输通常更快。</p>\n<p>我们将学习如何使用 <code>csplit</code>，<code>split</code> 和 <code>cat</code> 来重新整理文件，然后再将文件合并在一起。这些操作在任何文件类型下都有用：文本、图片、音频文件、ISO 镜像文件等。</p>\n<h3 id=\"toc_1\">使用 csplit 分割文件</h3>\n<p><code>csplit</code> 是这些有趣的小命令中的一个，它永远伴你左右，一旦开始用它就离不开了。<code>csplit</code> 将单个文件分割成多个文件。这个示例演示了最简单的使用方法，它将文件 foo.txt 分为三个文件，以行号 17 和 33 作为分割点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d752c877078171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 17 33\r\n2591\r\n3889\r\n2359\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d752c877078171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d752c877078171-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d752c877078171-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d752c877078171-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d752c877078171-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d752c877078171-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d752c877078171-2\"><span class=\"crayon-cn\">2591</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d752c877078171-3\"><span class=\"crayon-cn\">3889</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d752c877078171-4\"><span class=\"crayon-cn\">2359</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d752c877078171-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>csplit</code> 在当前目录下创建了三个新文件，并以字节为单位打印出新文件的大小。默认情况下，每个新文件名为 <code>xx_nn</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7535902581234\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\nxx00\r\nxx01\r\nxx02\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7535902581234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7535902581234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7535902581234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7535902581234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7535902581234-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7535902581234-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7535902581234-2\"><span class=\"crayon-e\">xx00</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7535902581234-3\"><span class=\"crayon-e\">xx01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7535902581234-4\"><span class=\"crayon-i\">xx02</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7535902581234-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>您可以使用 <code>head</code> 命令查看每个新文件的前十行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7539543428471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ head xx*\r\n==&gt; xx00 &lt;==\r\nFoo File\r\nby Carla Schroder\r\nFoo text\r\nFoo subheading\r\nMore foo text\r\n==&gt; xx01 &lt;==\r\nFoo text\r\nFoo subheading\r\nMore foo text\r\n==&gt; xx02 &lt;==\r\nFoo text\r\nFoo subheading\r\nMore foo text </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7539543428471-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7539543428471-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">head </span><span class=\"crayon-e \">xx*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-2\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx00</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-3\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">File</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-4\"><span class=\"crayon-e\">by </span><span class=\"crayon-e\">Carla </span><span class=\"crayon-e\">Schroder</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-5\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-6\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-7\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-v\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-8\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx01</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-9\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-10\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-11\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-v\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-12\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx02</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-13\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7539543428471-14\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7539543428471-15\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-i\">text</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>如果要将文件分割成包含相同行数的多个文件怎么办？可以指定行数，然后将重复次数放在在花括号中。此示例重复分割 4 次，并将剩下的转储到最后一个文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d753d244622830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 5 {4}\r\n57\r\n1488\r\n249\r\n1866\r\n3798\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d753d244622830-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d753d244622830-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d753d244622830-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d753d244622830-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d753d244622830-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d753d244622830-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d753d244622830-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d753d244622830-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d753d244622830-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d753d244622830-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d753d244622830-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d753d244622830-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d753d244622830-6\"><span class=\"crayon-cn\">3798</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d753d244622830-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>您可以使用星号通配符来告诉 <code>csplit</code> 尽可能多地重复分割。这听起来很酷，但是如果文件不能等分，则可能会失败（LCTT 译注：低版本的 <code>csplit</code> 不支持此参数）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7540333316563\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 10 {*}\r\n1545\r\n2115\r\n1848\r\n1901\r\ncsplit: '10': line number out of range on repetition 4\r\n1430\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7540333316563-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7540333316563-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7540333316563-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7540333316563-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7540333316563-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7540333316563-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7540333316563-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7540333316563-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7540333316563-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7540333316563-2\"><span class=\"crayon-cn\">1545</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7540333316563-3\"><span class=\"crayon-cn\">2115</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7540333316563-4\"><span class=\"crayon-cn\">1848</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7540333316563-5\"><span class=\"crayon-cn\">1901</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7540333316563-6\"><span class=\"crayon-v\">csplit</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'10'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">range </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">repetition</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7540333316563-7\"><span class=\"crayon-cn\">1430</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7540333316563-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>默认的行为是删除发生错误时的输出文件。你可以用 <code>-k</code> 选项来解决这个问题，当有错误时，它就不会删除输出文件。另一个行为是每次运行 <code>csplit</code> 时，它将覆盖之前创建的文件，所以你需要使用新的文件名来分别保存它们。使用 <code>--prefix= _prefix_</code> 来设置一个不同的文件前缀：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7544319734527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit -k --prefix=mine foo.txt 5 {*}  \r\n57\r\n1488\r\n249\r\n1866\r\n993\r\ncsplit: '5': line number out of range on repetition 9\r\n437\r\n\r\n$ ls\r\nmine00\r\nmine01\r\nmine02\r\nmine03 \r\nmine04\r\nmine05\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7544319734527-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7544319734527-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">csplit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-6\"><span class=\"crayon-cn\">993</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-7\"><span class=\"crayon-v\">csplit</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'5'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">range </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">repetition</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-8\"><span class=\"crayon-cn\">437</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-11\"><span class=\"crayon-e\">mine00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-12\"><span class=\"crayon-e\">mine01</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-13\"><span class=\"crayon-e\">mine02</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-14\"><span class=\"crayon-e\">mine03 </span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-15\"><span class=\"crayon-e\">mine04</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7544319734527-16\"><span class=\"crayon-i\">mine05</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7544319734527-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>选项 <code>-n</code> 可用于改变对文件进行编号的数字位数（默认是 2 位）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7547874358500\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit -n 3 --prefix=mine foo.txt 5 {4}\r\n57\r\n1488\r\n249\r\n1866\r\n1381\r\n3798\r\n\r\n$ ls\r\nmine000\r\nmine001\r\nmine002\r\nmine003\r\nmine004\r\nmine005\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7547874358500-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7547874358500-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">csplit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-6\"><span class=\"crayon-cn\">1381</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-7\"><span class=\"crayon-cn\">3798</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-10\"><span class=\"crayon-e\">mine000</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-11\"><span class=\"crayon-e\">mine001</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-12\"><span class=\"crayon-e\">mine002</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-13\"><span class=\"crayon-e\">mine003</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-14\"><span class=\"crayon-e\">mine004</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7547874358500-15\"><span class=\"crayon-i\">mine005</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7547874358500-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><code>csplit</code> 中的 “c” 是上下文（context）的意思。这意味着你可以根据任意匹配的方式或者巧妙的正则表达式来分割文件。下面的例子将文件分为两部分。第一个文件在包含第一次出现 “fie” 的前一行处结束，第二个文件则以包含 “fie” 的行开头。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d754a866647500\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d754a866647500-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d754a866647500-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d754a866647500-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d754a866647500-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在每次出现 “fie” 时分割文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7554149340724\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ {*}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7554149340724-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7554149340724-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7554149340724-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7554149340724-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 “fie” 前五次出现的地方分割文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7557224613699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ {5}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7557224613699-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7557224613699-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7557224613699-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7557224613699-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>仅当内容以包含 “fie” 的行开始时才复制，并且省略前面的所有内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d755a930311037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit myfile %fie% \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d755a930311037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d755a930311037-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d755a930311037-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">myfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">fie</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d755a930311037-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">将文件分割成不同大小</h3>\n<p><code>split</code> 与 <code>csplit</code> 类似。它将文件分割成特定的大小，当您将大文件分割成小的多媒体文件或者使用网络传送时，这就非常棒了。默认的大小为 1000 行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d755d501563998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split foo.mv\r\n$ ls -hl\r\n266K Aug 21 16:58 xaa\r\n267K Aug 21 16:58 xab\r\n315K Aug 21 16:58 xac\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d755d501563998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d755d501563998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d755d501563998-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d755d501563998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d755d501563998-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d755d501563998-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d755d501563998-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d755d501563998-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">split </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d755d501563998-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">hl</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d755d501563998-3\"><span class=\"crayon-cn\">266K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xaa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d755d501563998-4\"><span class=\"crayon-cn\">267K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xab</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d755d501563998-5\"><span class=\"crayon-cn\">315K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d755d501563998-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d755d501563998-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>它们分割出来的大小相似，但你可以指定任何你想要的大小。这个例子中是 20M 字节：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7560177282209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split -b 20M foo.mv\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7560177282209-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7560177282209-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7560177282209-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20M</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7560177282209-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>尺寸单位缩写为 K，M，G，T，P，E，Z，Y（1024 的幂）或者 KB，MB，GB 等等（1000 的幂）。</p>\n<p>为文件名选择你自己的前缀和后缀：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7564819055282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split -a 3 --numeric-suffixes=9 --additional-suffix=mine foo.mv SB\r\n240K Aug 21 17:44 SB009mine\r\n214K Aug 21 17:44 SB010mine\r\n220K Aug 21 17:44 SB011mine\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7564819055282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7564819055282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7564819055282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7564819055282-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7564819055282-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7564819055282-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">numeric</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">suffixes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">additional</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">suffix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mv </span><span class=\"crayon-i\">SB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7564819055282-2\"><span class=\"crayon-cn\">240K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB009mine</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7564819055282-3\"><span class=\"crayon-cn\">214K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB010mine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7564819055282-4\"><span class=\"crayon-cn\">220K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB011mine</span></div><div class=\"crayon-line\" id=\"crayon-59adcf20d7564819055282-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p><code>-a</code> 选项控制编号的数字位置。<code>--numeric-suffixes</code> 设置编号的开始值。默认前缀为 <code>x</code>，你也可以通过在文件名后输入它来设置一个不同的前缀。</p>\n<h3 id=\"toc_3\">将分割后的文件合并</h3>\n<p>你可能想在某个时候重组你的文件。常用的 <code>cat</code> 命令就用在这里：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d7567693048057\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat SB0* &gt; foo2.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d7567693048057-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d7567693048057-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d7567693048057-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-e \">SB0*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d7567693048057-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>示例中的星号通配符将匹配到所有以 SB0 开头的文件，这可能不会得到您想要的结果。您可以使用问号通配符进行更精确的匹配，每个字符使用一个问号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcf20d756a512631131\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat SB0?????? &gt; foo2.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcf20d756a512631131-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcf20d756a512631131-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcf20d756a512631131-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">SB0</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcf20d756a512631131-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>和往常一样，请查阅相关的手册和信息页面以获取完整的命令选项。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112303\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112303votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112303\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "fc306e48d67be0a615adc28402f72695", "title": "颜值即正义，超好用的 Linux 桌面个性化工具推荐", "create_time": "2017/09/01", "url": "http://blog.jobbole.com/112327/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1527138\">开源中国编辑部</a>   </div><p>对于系统桌面，有人追求美观，有人追求简洁，有人追求实用，也有人就是喜欢默认的设置效果。接下来，推荐几款适用于 Linux 的开源桌面个性化工具，代码敲累了的时候，换换主题，说不定也能让你更放松。</p>\n<h3><a href=\"https://github.com/horst3180/arc-theme\" target=\"_blank\" rel=\"nofollow\">1、Arc</a></h3>\n<p>一款主打透明元素的扁平化主题，支持基于 GTK 3 和 GTK 2 的桌面环境，如 GNOME、Unity、Budgie、Pantheon、Xfce、MATE 等，内含 3 种不同的风格可供选择。</p>\n<p>Arc</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e41e73992d65b40d4d856f068e9d8d62.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Darker</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fbc7c1532ebf62c705c2e98744257133.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Dark</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5abc27be17959c64e32449fcaa25b5c6.png\" width=\"728\" height=\"155\"></p>\n<h3><a href=\"http://github.com/anmoljagetia/Flatabulous\" target=\"_blank\" rel=\"nofollow\">2、<strong>Flatabulous</strong></a></h3>\n<p>一款扁平化主题，适用于 Ubuntu 以及其它基于 Gnome 的 Linux 系统。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6522206a9c1be1c6ef3506fbe28c85cc.png\" width=\"1366\" height=\"768\"></p>\n<h3><a href=\"https://github.com/adapta-project/adapta-gtk-theme\" target=\"_blank\" rel=\"nofollow\">3、Adapta</a></h3>\n<p>一款自适应的 Gtk+ 主题，遵循当前比较流行的 Material Design 设计风格。支持 GNOME、Budgie、Cinnamon、Unity、XFce4、Mate、LXDE 等桌面环境。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1874fddce2d1634263d80adbfa498f14.png\" width=\"800\" height=\"800\"></p>\n<h3><a href=\"https://github.com/numixproject/numix-gtk-theme\" target=\"_blank\" rel=\"nofollow\">4、Numix</a></h3>\n<p>一款结合了明暗元素的现代化平面主题，支持 Gnome、Unity、XFCE 和 Openbox 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ec4cee40a68985bdd7163f64eefcfe7.png\" width=\"1406\" height=\"1600\"></p>\n<h3><a href=\"https://krourke.org/projects/art/la-capitaine-icon-theme\" target=\"_blank\" rel=\"nofollow\">5、La Capitaine</a></h3>\n<p>这是一个图标主题，目标是适配大部分桌面环境。里面的图标受 macOS 和 Material Design 启发，主要是使用视觉上容易吸引眼球的渐变、阴影和简单的几何形式元素。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4700d547b2265628ab762d53a2d5a658.png\" width=\"1500\" height=\"2000\"></p>\n<h3><a href=\"https://github.com/PapirusDevelopmentTeam/papirus-icon-theme\" target=\"_blank\" rel=\"nofollow\">6、Papirus</a></h3>\n<p>基于非开源的 <a href=\"https://snwh.org/paper\" target=\"_blank\" rel=\"nofollow\">Paper</a> 主题，并有一些额外的特性（如硬编码托盘支持，kde 颜色方案支持，libreoffice 图标主题，filezilla 主题，smplayer 主题…）以及其它的修改的 SVG 图标主题。有 Papirus 、Papirus Dark、Papirus Light、ePapirus 四种风格可供选择。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6bd12b2013111e5a71af592a691fba2c.png\" width=\"370\" height=\"364\"></p>\n<h3><a href=\"https://github.com/bil-elmoussaoui/Hardcode-Tray\" target=\"_blank\" rel=\"nofollow\">7、Hardcode Tray</a></h3>\n<p>这是一个托盘脚本，通过在 Linux 中自动探测你的默认主题，正确的图标尺寸，硬编码内嵌图标应用，以及正确的状态图标，来修正硬编码的托盘图标。它还支持上面提到的 Numix 和 Papirus 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c5ddb413c4c4f2777d2a8a12475a112a.png\" width=\"727\" height=\"87\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e1c69452a123294ca53f1fa4f690b46e.png\" width=\"718\" height=\"195\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112327\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112327votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112327\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "dab40ec7ecc758d03176270c9e8c36d4", "title": "Linux 开机引导和启动过程详解", "create_time": "2017/08/26", "url": "http://blog.jobbole.com/112277/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/2/linux-boot-and-startup\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8807-1.html\">Linux中国/penghuster</a>   </div><blockquote><p>你是否曾经对操作系统为何能够执行应用程序而感到疑惑？那么本文将为你揭开操作系统引导与启动的面纱。</p></blockquote>\n<p>理解操作系统开机引导和启动过程对于配置操作系统和解决相关启动问题是至关重要的。该文章陈述了 <a href=\"https://en.wikipedia.org/wiki/GNU_GRUB\">GRUB2 引导装载程序</a>开机引导装载内核的过程和 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd 初始化系统</a>执行开机启动操作系统的过程。</p>\n<p>事实上，操作系统的启动分为两个阶段：引导boot和启动startup。引导阶段开始于打开电源开关，结束于内核初始化完成和 systemd 进程成功运行。启动阶段接管了剩余工作，直到操作系统进入可操作状态。</p>\n<p>总体来说，Linux 的开机引导和启动过程是相当容易理解，下文将分节对于不同步骤进行详细说明。</p>\n<ul>\n<li>BIOS 上电自检（POST）</li>\n<li>引导装载程序 (GRUB2)</li>\n<li>内核初始化</li>\n<li>启动 systemd，其是所有进程之父。</li>\n</ul>\n<p>注意，本文以 GRUB2 和 systemd 为载体讲述操作系统的开机引导和启动过程，是因为这二者是目前主流的 linux 发行版本所使用的引导装载程序和初始化软件。当然另外一些过去使用的相关软件仍然在一些 Linux 发行版本中使用。</p>\n<h3 id=\"toc_1\">引导过程</h3>\n<p>引导过程能以两种方式之一初始化。其一，如果系统处于关机状态，那么打开电源按钮将开启系统引导过程。其二，如果操作系统已经运行在一个本地用户（该用户可以是 root 或其他非特权用户），那么用户可以借助图形界面或命令行界面通过编程方式发起一个重启操作，从而触发系统引导过程。重启包括了一个关机和重新开始的操作。</p>\n<h4 id=\"toc_2\">BIOS 上电自检（POST）</h4>\n<p>上电自检过程中其实 Linux 没有什么也没做，上电自检主要由硬件的部分来完成，这对于所有操作系统都一样。当电脑接通电源，电脑开始执行 BIOS（基本输入输出系统Basic I/O System）的 POST（上电自检Power On Self Test）过程。</p>\n<p>在 1981 年，IBM 设计的第一台个人电脑中，BIOS 被设计为用来初始化硬件组件。POST 作为 BIOS 的组成部分，用于检验电脑硬件基本功能是否正常。如果 POST 失败，那么这个电脑就不能使用，引导过程也将就此中断。</p>\n<p>BIOS 上电自检确认硬件的基本功能正常，然后产生一个 BIOS <a href=\"https://en.wikipedia.org/wiki/BIOS_interrupt_call\">中断</a> INT 13H，该中断指向某个接入的可引导设备的引导扇区。它所找到的包含有效的引导记录的第一个引导扇区将被装载到内存中，并且控制权也将从引导扇区转移到此段代码。</p>\n<p>引导扇区是引导加载器真正的第一阶段。大多数 Linux 发行版本使用的引导加载器有三种：GRUB、GRUB2 和 LILO。GRUB2 是最新的，也是相对于其他老的同类程序使用最广泛的。</p>\n<h4 id=\"toc_3\">GRUB2</h4>\n<p>GRUB2 全称是 GRand Unified BootLoader，Version 2（第二版大一统引导装载程序）。它是目前流行的大部分 Linux 发行版本的主要引导加载程序。GRUB2 是一个用于计算机寻找操作系统内核并加载其到内存的智能程序。由于 GRUB 这个单词比 GRUB2 更易于书写和阅读，在下文中，除特殊指明以外，GRUB 将代指 GRUB2。</p>\n<p>GRUB 被设计为兼容操作系统<a href=\"https://en.wikipedia.org/wiki/Multiboot_Specification\">多重引导规范</a>，它能够用来引导不同版本的 Linux 和其他的开源操作系统；它还能链式加载专有操作系统的引导记录。</p>\n<p>GRUB 允许用户从任何给定的 Linux 发行版本的几个不同内核中选择一个进行引导。这个特性使得操作系统，在因为关键软件不兼容或其它某些原因升级失败时，具备引导到先前版本的内核的能力。GRUB 能够通过文件 <code>/boot/grub/grub.conf</code> 进行配置。（LCTT 译注：此处指 GRUB1）</p>\n<p>GRUB1 现在已经逐步被弃用，在大多数现代发行版上它已经被 GRUB2 所替换，GRUB2 是在 GRUB1 的基础上重写完成。基于 Red Hat 的发行版大约是在 Fedora 15 和 CentOS/RHEL 7 时升级到 GRUB2 的。GRUB2 提供了与 GRUB1 同样的引导功能，但是 GRUB2 也是一个类似主框架（mainframe）系统上的基于命令行的前置操作系统（Pre-OS）环境，使得在预引导阶段配置更为方便和易操作。GRUB2 通过 <code>/boot/grub2/grub.cfg</code> 进行配置。</p>\n<p>两个 GRUB 的最主要作用都是将内核加载到内存并运行。两个版本的 GRUB 的基本工作方式一致，其主要阶段也保持相同，都可分为 3 个阶段。在本文将以 GRUB2 为例进行讨论其工作过程。GRUB 或 GRUB2 的配置，以及 GRUB2 的命令使用均超过本文范围，不会在文中进行介绍。</p>\n<p>虽然 GRUB2 并未在其三个引导阶段中正式使用这些阶段stage名词，但是为了讨论方便，我们在本文中使用它们。</p>\n<h5 id=\"toc_4\">阶段 1</h5>\n<p>如上文 POST（上电自检）阶段提到的，在 POST 阶段结束时，BIOS 将查找在接入的磁盘中查找引导记录，其通常位于 MBR（主引导记录Master Boot Record），它加载它找到的第一个引导记录中到内存中，并开始执行此代码。引导代码（及阶段 1 代码）必须非常小，因为它必须连同分区表放到硬盘的第一个 512 字节的扇区中。 在<a href=\"https://en.wikipedia.org/wiki/Master_boot_record\">传统的常规 MBR</a> 中，引导代码实际所占用的空间大小为 446 字节。这个阶段 1 的 446 字节的文件通常被叫做引导镜像（boot.img），其中不包含设备的分区信息，分区是一般单独添加到引导记录中。</p>\n<p>由于引导记录必须非常的小，它不可能非常智能，且不能理解文件系统结构。因此阶段 1 的唯一功能就是定位并加载阶段 1.5 的代码。为了完成此任务，阶段 1.5 的代码必须位于引导记录与设备第一个分区之间的位置。在加载阶段 1.5 代码进入内存后，控制权将由阶段 1 转移到阶段 1.5。</p>\n<h5 id=\"toc_5\">阶段 1.5</h5>\n<p>如上所述，阶段 1.5 的代码必须位于引导记录与设备第一个分区之间的位置。该空间由于历史上的技术原因而空闲。第一个分区的开始位置在扇区 63 和 MBR（扇区 0）之间遗留下 62 个 512 字节的扇区（共 31744 字节），该区域用于存储阶段 1.5 的代码镜像 core.img 文件。该文件大小为 25389 字节，故此区域有足够大小的空间用来存储 core.img。</p>\n<p>因为有更大的存储空间用于阶段 1.5，且该空间足够容纳一些通用的文件系统驱动程序，如标准的 EXT 和其它的 Linux 文件系统，如 FAT 和 NTFS 等。GRUB2 的 core.img 远比更老的 GRUB1 阶段 1.5 更复杂且更强大。这意味着 GRUB2 的阶段 2 能够放在标准的 EXT 文件系统内，但是不能放在逻辑卷内。故阶段 2 的文件可以存放于 <code>/boot</code> 文件系统中，一般在 <code>/boot/grub2</code> 目录下。</p>\n<p>注意 <code>/boot</code> 目录必须放在一个 GRUB 所支持的文件系统（并不是所有的文件系统均可）。阶段 1.5 的功能是开始执行存放阶段 2 文件的 <code>/boot</code> 文件系统的驱动程序，并加载相关的驱动程序。</p>\n<h5 id=\"toc_6\">阶段 2</h5>\n<p>GRUB 阶段 2 所有的文件都已存放于 <code>/boot/grub2</code> 目录及其几个子目录之下。该阶段没有一个类似于阶段 1 与阶段 1.5 的镜像文件。相应地，该阶段主要需要从 <code>/boot/grub2/i386-pc</code> 目录下加载一些内核运行时模块。</p>\n<p>GRUB 阶段 2 的主要功能是定位和加载 Linux 内核到内存中，并转移控制权到内核。内核的相关文件位于 <code>/boot</code> 目录下，这些内核文件可以通过其文件名进行识别，其文件名均带有前缀 vmlinuz。你可以列出 <code>/boot</code> 目录中的内容来查看操作系统中当前已经安装的内核。</p>\n<p>GRUB2 跟 GRUB1 类似，支持从 Linux 内核选择之一引导启动。Red Hat 包管理器（DNF）支持保留多个内核版本，以防最新版本内核发生问题而无法启动时，可以恢复老版本的内核。默认情况下，GRUB 提供了一个已安装内核的预引导菜单，其中包括问题诊断菜单（recuse）以及恢复菜单（如果配置已经设置恢复镜像）。</p>\n<p>阶段 2 加载选定的内核到内存中，并转移控制权到内核代码。</p>\n<h4 id=\"toc_7\">内核</h4>\n<p>内核文件都是以一种自解压的压缩格式存储以节省空间，它与一个初始化的内存映像和存储设备映射表都存储于 <code>/boot</code> 目录之下。</p>\n<p>在选定的内核加载到内存中并开始执行后，在其进行任何工作之前，内核文件首先必须从压缩格式解压自身。一旦内核自解压完成，则加载 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> 进程（其是老式 System V 系统的 <a href=\"https://en.wikipedia.org/wiki/Init#SysV-style\">init</a> 程序的替代品)，并转移控制权到 systemd。</p>\n<p>这就是引导过程的结束。此刻，Linux 内核和 systemd 处于运行状态，但是由于没有其他任何程序在执行，故其不能执行任何有关用户的功能性任务。</p>\n<h3 id=\"toc_8\">启动过程</h3>\n<p>启动过程紧随引导过程之后，启动过程使 Linux 系统进入可操作状态，并能够执行用户功能性任务。</p>\n<h4 id=\"toc_9\">systemd</h4>\n<p>systemd 是所有进程的父进程。它负责将 Linux 主机带到一个用户可操作状态（可以执行功能任务）。systemd 的一些功能远较旧式 init 程序更丰富，可以管理运行中的 Linux 主机的许多方面，包括挂载文件系统，以及开启和管理 Linux 主机的系统服务等。但是 systemd 的任何与系统启动过程无关的功能均不在此文的讨论范围。</p>\n<p>首先，systemd 挂载在 <code>/etc/fstab</code> 中配置的文件系统，包括内存交换文件或分区。据此，systemd 必须能够访问位于 <code>/etc</code> 目录下的配置文件，包括它自己的。systemd 借助其配置文件 <code>/etc/systemd/system/default.target</code> 决定 Linux 系统应该启动达到哪个状态（或目标态target）。<code>default.target</code> 是一个真实的 target 文件的符号链接。对于桌面系统，其链接到 <code>graphical.target</code>，该文件相当于旧式 systemV init 方式的 <strong>runlevel 5</strong>。对于一个服务器操作系统来说，<code>default.target</code> 更多是默认链接到 <code>multi-user.target</code>， 相当于 systemV 系统的 <strong>runlevel 3</strong>。 <code>emergency.target</code> 相当于单用户模式。</p>\n<p>（LCTT 译注：“target” 是 systemd 新引入的概念，目前尚未发现有官方的准确译名，考虑到其作用和使用的上下文环境，我们认为翻译为“目标态”比较贴切。以及，“unit” 是指 systemd 中服务和目标态等各个对象/文件，在此依照语境译作“单元”。）</p>\n<p>注意，所有的目标态target和服务service均是 systemd 的单元unit。</p>\n<p>如下表 1 是 systemd 启动的目标态target和老版 systemV init 启动运行级别runlevel的对比。这个 <strong>systemd 目标态别名</strong> 是为了 systemd 向前兼容 systemV 而提供。这个目标态别名允许系统管理员（包括我自己）用 systemV 命令（例如 <code>init 3</code>）改变运行级别。当然，该 systemV 命令是被转发到 systemd 进行解释和执行的。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>SystemV 运行级别</th>\n<th>systemd 目标态</th>\n<th>systemd 目标态别名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td><code>halt.target</code></td>\n<td></td>\n<td>停止系统运行但不切断电源。</td>\n</tr>\n<tr>\n<td>0</td>\n<td><code>poweroff.target</code></td>\n<td><code>runlevel0.target</code></td>\n<td>停止系统运行并切断电源.</td>\n</tr>\n<tr>\n<td>S</td>\n<td><code>emergency.target</code></td>\n<td></td>\n<td>单用户模式，没有服务进程运行，文件系统也没挂载。这是一个最基本的运行级别，仅在主控制台上提供一个 shell 用于用户与系统进行交互。</td>\n</tr>\n<tr>\n<td>1</td>\n<td><code>rescue.target</code></td>\n<td><code>runlevel1.target</code></td>\n<td>挂载了文件系统，仅运行了最基本的服务进程的基本系统，并在主控制台启动了一个 shell 访问入口用于诊断。</td>\n</tr>\n<tr>\n<td>2</td>\n<td></td>\n<td><code>runlevel2.target</code></td>\n<td>多用户，没有挂载 NFS 文件系统，但是所有的非图形界面的服务进程已经运行。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><code>multi-user.target</code></td>\n<td><code>runlevel3.target</code></td>\n<td>所有服务都已运行，但只支持命令行接口访问。</td>\n</tr>\n<tr>\n<td>4</td>\n<td></td>\n<td><code>runlevel4.target</code></td>\n<td>未使用。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><code>graphical.target</code></td>\n<td><code>runlevel5.target</code></td>\n<td>多用户，且支持图形界面接口。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><code>reboot.target</code></td>\n<td><code>runlevel6.target</code></td>\n<td>重启。</td>\n</tr>\n<tr>\n<td></td>\n<td><code>default.target</code></td>\n<td></td>\n<td>这个目标态target是总是 <code>multi-user.target</code> 或 <code>graphical.target</code> 的一个符号链接的别名。systemd 总是通过 <code>default.target</code> 启动系统。<code>default.target</code> 绝不应该指向 <code>halt.target</code>、 <code>poweroff.target</code> 或 <code>reboot.target</code>。</td>\n</tr>\n</tbody>\n</table>\n<p><em>表 1 老版本 systemV 的 运行级别与 systemd 与目标态target或目标态别名的比较</em></p>\n<p>每个目标态target有一个在其配置文件中描述的依赖集，systemd 需要首先启动其所需依赖，这些依赖服务是 Linux 主机运行在特定的功能级别所要求的服务。当配置文件中所有的依赖服务都加载并运行后，即说明系统运行于该目标级别。</p>\n<p>systemd 也会查看老式的 systemV init 目录中是否存在相关启动文件，若存在，则 systemd 根据这些配置文件的内容启动对应的服务。在 Fedora 系统中，过时的网络服务就是通过该方式启动的一个实例。</p>\n<p>如下图 1 是直接从 bootup 的 man 页面拷贝而来。它展示了在 systemd 启动过程中一般的事件序列和确保成功的启动的基本的顺序要求。</p>\n<p><code>sysinit.target</code> 和 <code>basic.target</code> 目标态可以被视作启动过程中的状态检查点。尽管 systemd 的设计初衷是并行启动系统服务，但是部分服务或功能目标态是其它服务或目标态的启动的前提。系统将暂停于检查点直到其所要求的服务和目标态都满足为止。</p>\n<p><code>sysinit.target</code> 状态的到达是以其所依赖的所有资源模块都正常启动为前提的，所有其它的单元，如文件系统挂载、交换文件设置、设备管理器的启动、随机数生成器种子设置、低级别系统服务初始化、加解密服务启动（如果一个或者多个文件系统加密的话）等都必须完成，但是在 <strong>sysinit.target</strong> 中这些服务与模块是可以并行启动的。</p>\n<p><code>sysinit.target</code> 启动所有的低级别服务和系统初具功能所需的单元，这些都是进入下一阶段 basic.target 的必要前提。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/944467b0a5e4a593baaedea046cb4522.jpg\"></p>\n<p style=\"text-align: center\"><em>图 1：systemd 的启动流程</em></p>\n<p>在 <code>sysinit.target</code> 的条件满足以后，systemd 接下来启动 <code>basic.target</code>，启动其所要求的所有单元。 <code>basic.target</code> 通过启动下一目标态所需的单元而提供了更多的功能，这包括各种可执行文件的目录路径、通信 sockets，以及定时器等。</p>\n<p>最后，用户级目标态（<code>multi-user.target</code> 或 <code>graphical.target</code>） 可以初始化了，应该注意的是 <code>multi-user.target</code> 必须在满足图形化目标态 <code>graphical.target</code> 的依赖项之前先达成。</p>\n<p>图 1 中，以 <code>*</code> 开头的目标态是通用的启动状态。当到达其中的某一目标态，则说明系统已经启动完成了。如果 <code>multi-user.target</code> 是默认的目标态，则成功启动的系统将以命令行登录界面呈现于用户。如果 <code>graphical.target</code> 是默认的目标态，则成功启动的系统将以图形登录界面呈现于用户，界面的具体样式将根据系统所配置的<a href=\"https://opensource.com/article/16/12/yearbook-best-couple-2016-display-manager-and-window-manager\">显示管理器</a>而定。</p>\n<h3 id=\"toc_10\">故障讨论</h3>\n<p>最近我需要改变一台使用 GRUB2 的 Linux 电脑的默认引导内核。我发现一些 GRUB2 的命令在我的系统上不能用，也可能是我使用方法不正确。至今，我仍然不知道是何原因导致，此问题需要进一步探究。</p>\n<p><code>grub2-set-default</code> 命令没能在配置文件 <code>/etc/default/grub</code> 中成功地设置默认内核索引，以至于期望的替代内核并没有被引导启动。故在该配置文件中我手动更改 <code>GRUB_DEFAULT=saved</code> 为 <code>GRUB_DEFAULT=2</code>，2 是我需要引导的安装好的内核文件的索引。然后我执行命令 <code>grub2-mkconfig &gt; /boot/grub2/grub.cfg</code> 创建了新的 GRUB 配置文件，该方法如预期的规避了问题，并成功引导了替代的内核。</p>\n<h3 id=\"toc_11\">结论</h3>\n<p>GRUB2、systemd 初始化系统是大多数现代 Linux 发行版引导和启动的关键组件。尽管在实际中，systemd 的使用还存在一些争议，但是 GRUB2 与 systemd 可以密切地配合先加载内核，然后启动一个业务系统所需要的系统服务。</p>\n<p>尽管 GRUB2 和 systemd 都比其前任要更加复杂，但是它们更加容易学习和管理。在 man 页面有大量关于 systemd 的帮助说明，freedesktop.org 也在线收录了完整的此<a href=\"https://www.freedesktop.org/software/systemd/man/index.html\">帮助说明</a>。下面有更多相关信息链接。</p>\n<h3 id=\"toc_12\">附加资源</h3>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/GNU_GRUB\">GNU GRUB</a> (Wikipedia)</li>\n<li><a href=\"https://www.gnu.org/software/grub/manual/grub.html\">GNU GRUB Manual</a> (GNU.org)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Master_boot_record\">Master Boot Record</a> (Wikipedia)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Multiboot_Specification\">Multiboot specification</a> (Wikipedia)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> (Wikipedia)</li>\n<li><a href=\"https://www.freedesktop.org/software/systemd/man/bootup.html\">systemd bootup process</a> (Freedesktop.org)</li>\n<li><a href=\"https://www.freedesktop.org/software/systemd/man/index.html\">systemd index of man pages</a> (Freedesktop.org)</li>\n</ul>\n<hr>\n<p>作者简介：</p>\n<p>David Both 居住在美国北卡罗纳州的首府罗利，是一个 Linux 开源贡献者。他已经从事 IT 行业 40 余年，在 IBM 教授 OS/2 20余年。1981 年，他在 IBM 开发了第一个关于最初的 IBM 个人电脑的培训课程。他也曾在 Red Hat 教授 RHCE 课程，也曾供职于 MCI worldcom，Cico 以及北卡罗纳州等。他已经为 Linux 开源社区工作近 20 年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112277\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112277votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112277\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "b2d388974611689881f58c518d10da26", "title": "全文搜索引擎 Elasticsearch 入门教程", "create_time": "2017/08/29", "url": "http://blog.jobbole.com/112285/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\">阮一峰</a>   </div><p><a href=\"https://baike.baidu.com/item/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E\">全文搜索</a>属于最常见的需求，开源的 <a href=\"https://www.elastic.co/\">Elasticsearch</a> （以下简称 Elastic）是目前全文搜索引擎的首选。</p>\n<p>它可以快速地储存、搜索和分析海量数据。维基百科、Stack Overflow、Github 都采用它。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg\"><img class=\"aligncenter size-full wp-image-112291\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg\" alt=\"bg2017081701\"></a></p>\n<p>Elastic 的底层是开源库 <a href=\"https://lucene.apache.org/\">Lucene</a>。但是，你没法直接用 Lucene，必须自己写代码去调用它的接口。Elastic 是 Lucene 的封装，提供了 REST API 的操作接口，开箱即用。</p>\n<p>本文从零开始，讲解如何使用 Elastic 搭建自己的全文搜索引擎。每一步都有详细的说明，大家跟着做就能学会。</p>\n<h1>一、安装</h1>\n<p>Elastic 需要 Java 8 环境。如果你的机器还没安装 Java，可以参考<a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-debian-8\">这篇文章</a>，注意要保证环境变量<strong>JAVA_HOME</strong>正确设置。</p>\n<p>安装完 Java，就可以跟着<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/zip-targz.html\">官方文档</a>安装 Elastic。直接下载压缩包比较简单。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047c6987151812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.1.zip\r\n$ unzip elasticsearch-5.5.1.zip\r\n$ cd elasticsearch-5.5.1/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047c6987151812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047c6987151812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047c6987151812-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047c6987151812-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.1.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047c6987151812-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unzip </span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5.5.1.zip</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047c6987151812-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5.5.1</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>接着，进入解压后的目录，运行下面的命令，启动 Elastic。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047dc109461075\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./bin/elasticsearch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047dc109461075-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047dc109461075-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">elasticsearch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>如果这时<a href=\"https://github.com/spujadas/elk-docker/issues/92\">报错</a>“max virtual memory areas vm.max<em>map</em>count [65530] is too low”，要运行下面的命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047e0694687939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo sysctl -w vm.max_map_count=262144</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e0694687939-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047e0694687939-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sysctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max_map_count</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">262144</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>如果一切正常，Elastic 就会在默认的9200端口运行。这时，打开另一个命令行窗口，请求该端口，会得到说明信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047e4799312646\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl localhost:9200\r\n\r\n{\r\n  \"name\" : \"atntrTf\",\r\n  \"cluster_name\" : \"elasticsearch\",\r\n  \"cluster_uuid\" : \"tf9250XhQ6ee4h7YI11anA\",\r\n  \"version\" : {\r\n    \"number\" : \"5.5.1\",\r\n    \"build_hash\" : \"19c13d0\",\r\n    \"build_date\" : \"2017-07-18T20:44:24.823Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"6.6.0\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047e4799312646-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e4799312646-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">9200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"atntrTf\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"cluster_name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"elasticsearch\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"cluster_uuid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tf9250XhQ6ee4h7YI11anA\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5.5.1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_hash\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"19c13d0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_date\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2017-07-18T20:44:24.823Z\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_snapshot\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"lucene_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6.6.0\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047e4799312646-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"tagline\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You Know, for Search\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047e4799312646-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>上面代码中，请求9200端口，Elastic 返回一个 JSON 对象，包含当前节点、集群、版本等信息。</p>\n<p>按下 Ctrl + C，Elastic 就会停止运行。</p>\n<p>默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的<strong>config/elasticsearch.yml</strong>文件，去掉<strong>network.host</strong>的注释，将它的值改成<strong>0.0.0.0</strong>，然后重新启动 Elastic。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047e7612011348\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnetwork.host: 0.0.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047e7612011348-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047e7612011348-1\"><span class=\"crayon-v\">network</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>上面代码中，设成<strong>0.0.0.0</strong>让任何人都可以访问。线上服务不要这样设置，要设成具体的 IP。</p>\n<h1>二、基本概念</h1>\n<h2>2.1 Node 与 Cluster</h2>\n<p>Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。</p>\n<p>单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。</p>\n<h2>2.2 Index</h2>\n<p>Elastic 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。</p>\n<p>所以，Elastic 数据管理的顶层单位就叫做 Index（索引）。它是单个数据库的同义词。每个 Index （即数据库）的名字必须是小写。</p>\n<p>下面的命令可以查看当前节点的所有 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047ec403505150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X GET 'http://localhost:9200/_cat/indices?v'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047ec403505150-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047ec403505150-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://localhost:9200/_cat/indices?v'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h2>2.3 Document</h2>\n<p>Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。</p>\n<p>Document 使用 JSON 格式表示，下面是一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047ef492508360\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"user\": \"张三\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"数据库管理\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047ef492508360-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047ef492508360-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047ef492508360-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047ef492508360-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047ef492508360-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047ef492508360-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047ef492508360-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047ef492508360-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047ef492508360-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047ef492508360-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。</p>\n<h2>2.4 Type</h2>\n<p>Document 可以分组，比如<strong>weather</strong>这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document。</p>\n<p>不同的 Type 应该有相似的结构（schema），举例来说，<strong>id</strong>字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的<a href=\"https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html\">一个区别</a>。性质完全不同的数据（比如<strong>products</strong>和<strong>logs</strong>）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。</p>\n<p>下面的命令可以列出每个 Index 所包含的 Type。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047f3753079665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/_mapping?pretty=true'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047f3753079665-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047f3753079665-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/_mapping?pretty=true'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>根据<a href=\"https://www.elastic.co/blog/index-type-parent-child-join-now-future-in-elasticsearch\">规划</a>，Elastic 6.x 版只允许每个 Index 包含一个 Type，7.x 版将会彻底移除 Type。</p>\n<h1>三、新建和删除 Index</h1>\n<p>新建 Index，可以直接向 Elastic 服务器发出 PUT 请求。下面的例子是新建一个名叫<strong>weather</strong>的 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047f8399055510\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/weather'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047f8399055510-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047f8399055510-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>服务器返回一个 JSON 对象，里面的<strong>acknowledged</strong>字段表示操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047fb385167285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"acknowledged\":true,\r\n  \"shards_acknowledged\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047fb385167285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047fb385167285-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047fb385167285-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f2047fb385167285-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047fb385167285-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047fb385167285-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"acknowledged\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f2047fb385167285-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"shards_acknowledged\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f2047fb385167285-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>然后，我们发出 DELETE 请求，删除这个 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f2047fe250262793\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X DELETE 'localhost:9200/weather'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f2047fe250262793-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f2047fe250262793-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DELETE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h1>四、中文分词设置</h1>\n<p>首先，安装中文分词插件。这里使用的是 <a href=\"https://github.com/medcl/elasticsearch-analysis-ik/\">ik</a>，也可以考虑其他插件（比如 <a href=\"https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html\">smartcn</a>）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204801135118038\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.5.1/elasticsearch-analysis-ik-5.5.1.zip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204801135118038-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204801135118038-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">plugin </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.5.1/elasticsearch-analysis-ik-5.5.1.zip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>上面代码安装的是5.5.1版的插件，与 Elastic 5.5.1 配合使用。</p>\n<p>接着，重新启动 Elastic，就会自动加载这个新安装的插件。</p>\n<p>然后，新建一个 Index，指定需要分词的字段。这一步根据数据结构而异，下面的命令只针对本文。基本上，凡是需要搜索的中文字段，都要单独设置一下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204804030280930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts' -d '\r\n{\r\n  \"mappings\": {\r\n    \"person\": {\r\n      \"properties\": {\r\n        \"user\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        },\r\n        \"title\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        },\r\n        \"desc\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204804030280930-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204804030280930-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-3\"><span class=\"crayon-s\">  \"mappings\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-4\"><span class=\"crayon-s\">    \"person\": {</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-5\"><span class=\"crayon-s\">      \"properties\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-6\"><span class=\"crayon-s\">        \"user\": {</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-7\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-8\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-9\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-10\"><span class=\"crayon-s\">        },</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-11\"><span class=\"crayon-s\">        \"title\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-12\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-13\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-14\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-15\"><span class=\"crayon-s\">        },</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-16\"><span class=\"crayon-s\">        \"desc\": {</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-17\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-18\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-19\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-20\"><span class=\"crayon-s\">        }</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-21\"><span class=\"crayon-s\">      }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-22\"><span class=\"crayon-s\">    }</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204804030280930-23\"><span class=\"crayon-s\">  }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204804030280930-24\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>上面代码中，首先新建一个名称为<strong>accounts</strong>的 Index，里面有一个名称为<strong>person</strong>的 Type。<strong>person</strong>有三个字段。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204808280431343\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser\r\ntitle\r\ndesc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204808280431343-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204808280431343-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204808280431343-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204808280431343-1\"><span class=\"crayon-e\">user</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204808280431343-2\"><span class=\"crayon-e\">title</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204808280431343-3\"><span class=\"crayon-v\">desc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这三个字段都是中文，而且类型都是文本（text），所以需要指定中文分词器，不能使用默认的英文分词器。</p>\n<p>Elastic 的分词器称为 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html\">analyzer</a>。我们对每个字段指定分词器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20480b577106090\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"user\": {\r\n  \"type\": \"text\",\r\n  \"analyzer\": \"ik_max_word\",\r\n  \"search_analyzer\": \"ik_max_word\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480b577106090-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20480b577106090-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480b577106090-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20480b577106090-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480b577106090-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20480b577106090-1\"><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20480b577106090-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20480b577106090-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"analyzer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ik_max_word\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20480b577106090-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"search_analyzer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ik_max_word\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20480b577106090-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>上面代码中，<strong>analyzer</strong>是字段文本的分词器，<strong>search_analyzer</strong>是搜索词的分词器。<strong>ik_max_word</strong>分词器是插件<strong>ik</strong>提供的，可以对文本进行最大数量的分词。</p>\n<h1>五、数据操作</h1>\n<h2>5.1 新增记录</h2>\n<p>向指定的 /Index/Type 发送 PUT 请求，就可以在 Index 里面新增一条记录。比如，向<strong>/accounts/person</strong>发送请求，就可以新增一条人员记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20480f600888115\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts/person/1' -d '\r\n{\r\n  \"user\": \"张三\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"数据库管理\"\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480f600888115-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20480f600888115-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480f600888115-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20480f600888115-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20480f600888115-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20480f600888115-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20480f600888115-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20480f600888115-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20480f600888115-3\"><span class=\"crayon-s\">  \"user\": \"张三\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20480f600888115-4\"><span class=\"crayon-s\">  \"title\": \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20480f600888115-5\"><span class=\"crayon-s\">  \"desc\": \"数据库管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20480f600888115-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>服务器返回的 JSON 对象，会给出 Index、Type、Id、Version 等信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204813111756445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"1\",\r\n  \"_version\":1,\r\n  \"result\":\"created\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204813111756445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204813111756445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204813111756445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204813111756445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204813111756445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204813111756445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204813111756445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204813111756445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204813111756445-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204813111756445-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204813111756445-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204813111756445-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204813111756445-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204813111756445-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204813111756445-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204813111756445-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204813111756445-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204813111756445-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>如果你仔细看，会发现请求路径是<strong>/accounts/person/1</strong>，最后的<strong>1</strong>是该条记录的 Id。它不一定是数字，任意字符串（比如<strong>abc</strong>）都可以。</p>\n<p>新增记录的时候，也可以不指定 Id，这时要改成 POST 请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204817850697479\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X POST 'localhost:9200/accounts/person' -d '\r\n{\r\n  \"user\": \"李四\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"系统管理\"\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204817850697479-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204817850697479-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204817850697479-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204817850697479-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204817850697479-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204817850697479-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204817850697479-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">POST</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204817850697479-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204817850697479-3\"><span class=\"crayon-s\">  \"user\": \"李四\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204817850697479-4\"><span class=\"crayon-s\">  \"title\": \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204817850697479-5\"><span class=\"crayon-s\">  \"desc\": \"系统管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204817850697479-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>上面代码中，向<strong>/accounts/person</strong>发出一个 POST 请求，添加一个记录。这时，服务器返回的 JSON 对象里面，<strong>_id</strong>字段就是一个随机字符串。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20481a894501753\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"AV3qGfrC6jMbsbXb6k1p\",\r\n  \"_version\":1,\r\n  \"result\":\"created\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481a894501753-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20481a894501753-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481a894501753-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20481a894501753-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481a894501753-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20481a894501753-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481a894501753-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20481a894501753-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481a894501753-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20481a894501753-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20481a894501753-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20481a894501753-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20481a894501753-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"AV3qGfrC6jMbsbXb6k1p\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20481a894501753-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20481a894501753-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20481a894501753-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20481a894501753-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20481a894501753-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>注意，如果没有先创建 Index（这个例子是<strong>accounts</strong>），直接执行上面的命令，Elastic 也不会报错，而是直接生成指定的 Index。所以，打字的时候要小心，不要写错 Index 的名称。</p>\n<h2>5.2 查看记录</h2>\n<p>向<strong>/Index/Type/Id</strong>发出 GET 请求，就可以查看这条记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20481e102381101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/1?pretty=true'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20481e102381101-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20481e102381101-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1?pretty=true'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>上面代码请求查看<strong>/accounts/person/1</strong>这条记录，URL 的参数<strong>pretty=true</strong>表示以易读的格式返回。</p>\n<p>返回的数据中，<strong>found</strong>字段表示查询成功，<strong>_source</strong>字段返回原始记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204821395129587\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\" : \"accounts\",\r\n  \"_type\" : \"person\",\r\n  \"_id\" : \"1\",\r\n  \"_version\" : 1,\r\n  \"found\" : true,\r\n  \"_source\" : {\r\n    \"user\" : \"张三\",\r\n    \"title\" : \"工程师\",\r\n    \"desc\" : \"数据库管理\"\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204821395129587-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204821395129587-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"found\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204821395129587-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204821395129587-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>如果 Id 不正确，就查不到数据，<strong>found</strong>字段就是<strong>false</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204824447233295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/weather/beijing/abc?pretty=true'\r\n\r\n{\r\n  \"_index\" : \"accounts\",\r\n  \"_type\" : \"person\",\r\n  \"_id\" : \"abc\",\r\n  \"found\" : false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204824447233295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204824447233295-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204824447233295-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204824447233295-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204824447233295-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204824447233295-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204824447233295-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204824447233295-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204824447233295-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather/beijing/abc?pretty=true'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204824447233295-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adc4f204824447233295-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204824447233295-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204824447233295-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204824447233295-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abc\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204824447233295-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"found\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204824447233295-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h2>5.3 删除记录</h2>\n<p>删除记录就是发出 DELETE 请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204827923768572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X DELETE 'localhost:9200/accounts/person/1'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204827923768572-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204827923768572-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DELETE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>这里先不要删除这条记录，后面还要用到。</p>\n<h2>5.4 更新记录</h2>\n<p>更新记录就是使用 PUT 请求，重新发送一次数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20482a357048832\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts/person/1' -d '\r\n{\r\n    \"user\" : \"张三\",\r\n    \"title\" : \"工程师\",\r\n    \"desc\" : \"数据库管理，软件开发\"\r\n}' \r\n\r\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"1\",\r\n  \"_version\":2,\r\n  \"result\":\"updated\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482a357048832-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482a357048832-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-3\"><span class=\"crayon-s\">    \"user\" : \"张三\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-4\"><span class=\"crayon-s\">    \"title\" : \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-5\"><span class=\"crayon-s\">    \"desc\" : \"数据库管理，软件开发\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-6\"><span class=\"crayon-s\">}'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"updated\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482a357048832-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482a357048832-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>上面代码中，我们将原始数据从”数据库管理”改成”数据库管理，软件开发”。 返回结果里面，有几个字段发生了变化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20482d199368460\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"_version\" : 2,\r\n\"result\" : \"updated\",\r\n\"created\" : false</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482d199368460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20482d199368460-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20482d199368460-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20482d199368460-1\"><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20482d199368460-2\"><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"updated\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20482d199368460-3\"><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>可以看到，记录的 Id 没变，但是版本（version）从<strong>1</strong>变成<strong>2</strong>，操作类型（result）从<strong>created</strong>变成<strong>updated</strong>，<strong>created</strong>字段变成<strong>false</strong>，因为这次不是新建记录。</p>\n<h1>六、数据查询</h1>\n<h2>6.1 返回所有记录</h2>\n<p>使用 GET 方法，直接请求<strong>/Index/Type/_search</strong>，就会返回所有记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204831995995452\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'\r\n\r\n{\r\n  \"took\":2,\r\n  \"timed_out\":false,\r\n  \"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\r\n  \"hits\":{\r\n    \"total\":2,\r\n    \"max_score\":1.0,\r\n    \"hits\":[\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"AV3qGfrC6jMbsbXb6k1p\",\r\n        \"_score\":1.0,\r\n        \"_source\": {\r\n          \"user\": \"李四\",\r\n          \"title\": \"工程师\",\r\n          \"desc\": \"系统管理\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"1\",\r\n        \"_score\":1.0,\r\n        \"_source\": {\r\n          \"user\" : \"张三\",\r\n          \"title\" : \"工程师\",\r\n          \"desc\" : \"数据库管理，软件开发\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204831995995452-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204831995995452-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"took\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timed_out\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"max_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"AV3qGfrC6jMbsbXb6k1p\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"李四\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"系统管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-29\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-30\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理，软件开发\"</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-32\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204831995995452-34\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204831995995452-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>上面代码中，返回结果的 <strong>took</strong>字段表示该操作的耗时（单位为毫秒），<strong>timed_out</strong>字段表示是否超时，<strong>hits</strong>字段表示命中的记录，里面子字段的含义如下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204835397401983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntotal：返回记录数，本例是2条。\r\nmax_score：最高的匹配程度，本例是1.0。\r\nhits：返回的记录组成的数组。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204835397401983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204835397401983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204835397401983-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204835397401983-1\"><span class=\"crayon-i\">total</span>：返回记录数，本例是<span class=\"crayon-cn\">2</span>条。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204835397401983-2\"><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>score：最高的匹配程度，本例是<span class=\"crayon-cn\">1.0</span>。</div><div class=\"crayon-line\" id=\"crayon-59adc4f204835397401983-3\"><span class=\"crayon-i\">hits</span>：返回的记录组成的数组。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>返回的记录中，每条记录都有一个<strong>_score</strong>字段，表示匹配的程序，默认是按照这个字段降序排列。</p>\n<h2>6.2 全文搜索</h2>\n<p>Elastic 的查询非常特别，使用自己的<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html\">查询语法</a>，要求 GET 请求带有数据体。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204838714965917\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"软件\" }}\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204838714965917-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204838714965917-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204838714965917-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204838714965917-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204838714965917-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204838714965917-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204838714965917-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"软件\" }}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204838714965917-4\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面代码使用 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html\">Match 查询</a>，指定的匹配条件是<strong>desc</strong>字段里面包含”软件”这个词。返回结果如下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20483c334629430\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"took\":3,\r\n  \"timed_out\":false,\r\n  \"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\r\n  \"hits\":{\r\n    \"total\":1,\r\n    \"max_score\":0.28582606,\r\n    \"hits\":[\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"1\",\r\n        \"_score\":0.28582606,\r\n        \"_source\": {\r\n          \"user\" : \"张三\",\r\n          \"title\" : \"工程师\",\r\n          \"desc\" : \"数据库管理，软件开发\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20483c334629430-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20483c334629430-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"took\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timed_out\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"max_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.28582606</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.28582606</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-15\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理，软件开发\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20483c334629430-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20483c334629430-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>Elastic 默认一次返回10条结果，可以通过<strong>size</strong>字段改变这个设置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204840849201123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},\r\n  \"size\": 1\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204840849201123-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204840849201123-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204840849201123-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204840849201123-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204840849201123-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204840849201123-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204840849201123-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204840849201123-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204840849201123-4\"><span class=\"crayon-s\">  \"size\": 1</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204840849201123-5\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>上面代码指定，每次只返回一条结果。</p>\n<p>还可以通过<strong>from</strong>字段，指定位移。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204843893408362\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},\r\n  \"from\": 1,\r\n  \"size\": 1\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204843893408362-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204843893408362-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204843893408362-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204843893408362-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204843893408362-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204843893408362-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204843893408362-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204843893408362-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204843893408362-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204843893408362-4\"><span class=\"crayon-s\">  \"from\": 1,</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204843893408362-5\"><span class=\"crayon-s\">  \"size\": 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204843893408362-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>上面代码指定，从位置1开始（默认是从位置0开始），只返回一条结果。</p>\n<h2>6.3 逻辑运算</h2>\n<p>如果有多个搜索关键字， Elastic 认为它们是<strong>or</strong>关系。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f204846043909737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"软件 系统\" }}\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f204846043909737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204846043909737-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f204846043909737-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f204846043909737-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f204846043909737-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204846043909737-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f204846043909737-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"软件 系统\" }}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f204846043909737-4\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>上面代码搜索的是<strong>软件 or 系统</strong>。</p>\n<p>如果要执行多个关键词的<strong>and</strong>搜索，必须使用<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html\">布尔查询</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc4f20484a676887319\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        { \"match\": { \"desc\": \"软件\" } },\r\n        { \"match\": { \"desc\": \"系统\" } }\r\n      ]\r\n    }\r\n  }\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20484a676887319-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20484a676887319-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20484a676887319-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20484a676887319-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc4f20484a676887319-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adc4f20484a676887319-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20484a676887319-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-3\"><span class=\"crayon-s\">  \"query\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20484a676887319-4\"><span class=\"crayon-s\">    \"bool\": {</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-5\"><span class=\"crayon-s\">      \"must\": [</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20484a676887319-6\"><span class=\"crayon-s\">        { \"match\": { \"desc\": \"软件\" } },</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-7\"><span class=\"crayon-s\">        { \"match\": { \"desc\": \"系统\" } }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20484a676887319-8\"><span class=\"crayon-s\">      ]</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-9\"><span class=\"crayon-s\">    }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc4f20484a676887319-10\"><span class=\"crayon-s\">  }</span></div><div class=\"crayon-line\" id=\"crayon-59adc4f20484a676887319-11\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h1>七、参考链接</h1>\n<ul>\n<li><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html\">ElasticSearch 官方手册</a></li>\n<li><a href=\"https://www.elastic.co/blog/a-practical-introduction-to-elasticsearch\">A Practical Introduction to Elasticsearch</a></li>\n</ul>\n<p>（完）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112285\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112285votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112285\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,ElasticSearch", "front_image_path": "full/4339f4ef6accd92b11112bee83043315c7e470f3.jpg"}
{"url_object_id": "f92a3bde740456fa4413c08852ffb416", "title": "30 多年的编码经验浓缩成的 10 条最佳实践", "create_time": "2017/08/30", "url": "http://blog.jobbole.com/112300/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/ae1f71aa35785945dbe6af4a8ee36970.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://cdiggins.github.io/blog/programming-tips.html\">Christopher Diggins</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1525762\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ae1f71aa35785945dbe6af4a8ee36970.jpg\" alt=\"\" width=\"650\" height=\"423\"></p>\n<p>所以，如何写出一手好代码？</p>\n<p>良好的代码更易于阅读、理解、调试和修改，最重要的是它的缺陷也更少。显然，编写良好的代码需要更多的时间，但是从长远来看，它也具有更多的价值，因为这降低了维护的成本，而且具有更好的可重用性。</p>\n<p>事实上，我们可以将好的代码等同为可重用的代码，这也是本篇文章罗列的许多技巧背后的驱动原则。作为一个要实现特定功能的开发者，代码可以实现你的短期目标，但如果没有其他人希望重用它（包括未来的自己），这些代码一定会缺失某些东西。无论它是太复杂，还是太具体，在不同情况下都有很大可能会出错，或者不被其他开发者信任。</p>\n<p>我发现，只要尝试坚持将下面的最佳实践应用于你编写的所有代码（包括你的实验和原型），无论你现在的经验水平如何，都会编写出更好的代码。</p>\n<h2><strong>1. 遵循单一职责原则</strong></h2>\n<p>函数是程序员的工具中最重要的抽象形式。它们能更多地被重复使用，你需要编写的代码就越少，代码也因此变得更可靠。较小的函数遵循<a href=\"https://en.wikipedia.org/wiki/Single_responsibility_principle\" target=\"_blank\" rel=\"nofollow\">单一职责原则</a>更有可能被重复使用。</p>\n<h2><strong>2. 尽量减少共享状态</strong></h2>\n<p>你应该尽量减少函数之间的隐式共享状态，无论它是文件作用域的变量还是对象的成员字段，这有利于明确要求把值作为参数。当能明确地显示函数需要什么才可以产生所需的结果时，代码会变得更容易理解和重用。</p>\n<p>对此的一个推论是，在一个对象中，相对于成员变量，你更应该优先选择静态的无状态变量 (static stateless variables)。</p>\n<h2><strong>3. 将“副作用”局部化</strong></h2>\n<p>理想的副作用（例如：打印到控制台、日志记录、更改全局状态、文件系统操作等）应该被放置到单独的模块中，而不是散布在整个代码里面。函数中的一些“副作用”功能往往违反了单一职责原则。</p>\n<h2><strong>4. 优先使用不变的对象</strong></h2>\n<p>如果一个对象的状态在其构造函数中仅被设置一次，并且从不再次更改，则调试会变得更加容易，因为只要构造正确就能保持有效。这也是降低软件项目复杂性的最简单方法之一。</p>\n<h2><strong>5. 多用接口少用类</strong></h2>\n<p>接收接口的函数（或 C++ 中的模板参数和概念）比在类上运行的函数更具可重用性。</p>\n<h2><strong>6. 对模块应用良好的原则</strong></h2>\n<p>寻找机会将软件项目分解成更小的模块（例如库和应用程序），以促进模块级别的重用。对于模块，应该遵循的一些关键原则是：</p>\n<ol>\n<li>尽可能减少依赖</li>\n<li>每个项目应该有一个明确的职责</li>\n<li>不要重复自身</li>\n</ol>\n<p>你应该努力使你的项目保持小巧和明确。</p>\n<h2><strong>7. 避免继承</strong></h2>\n<p>在面向对象编程中，继承 —— 特别是和虚拟函数结合使用时，在可重用性方面往往是一条死胡同。我很少有成功的使用或编写重载类的库的经历。</p>\n<h2><strong>8. 将测试作为设计和开发的一部分</strong></h2>\n<p>我不是测试驱动开发的坚定分子，但开始编码时先编写测试代码会使得代码十分自然地遵循许多指导原则。这也有助于尽早发现错误。不过要注意避免编写无用的测试，良好的编码实践意味着更高级别的测试（例如单元测试中的集成测试或特征测试）在揭示缺陷方面更有效。</p>\n<h2><strong>9. 优先使用标准库而不是手写的</strong></h2>\n<p>我经常看到<em>更好</em>版本的 <code>std::vector</code> 或 <code>std::string</code>，但这几乎总是浪费时间和精力。一个明显的事实是 —— 你正在为一个新的地方引入 bug，其他开发者也不太可能重用你的代码，因为没有被广泛理解、支持和测试。</p>\n<h2><strong>10. 避免编写新的代码</strong></h2>\n<p>这是每个程序员都应遵循的最重要的教诲：最好的代码就是还没写的代码。你写的代码越多，你将遇到的问题就越多，查找和修复错误就越困难。</p>\n<p>在写一行代码之前先问一问自己，有没有一个工具、函数或者库已经实现了你所需要的功能？你真的需要自己实现这个功能，而不是调用一个已经存在的功能吗？</p>\n<h2><strong>写在最后的话</strong></h2>\n<p>我发现编程是一门与学习艺术或运动非常相似的技能，你通过刻意的练习和从别人的经验中学习会得到更好的结果。不断提升你产出的代码质量有助于你成为更优秀的程序员。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112300\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112300votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112300\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,最佳实践", "front_image_path": "full/a4a64072434bbc0b2f1faeb985528ab740691ca1.jpg"}
{"url_object_id": "f9b2e348640d6f457d71b1531fbb9152", "title": "六个优雅的 Linux 命令行技巧", "create_time": "2017/08/30", "url": "http://blog.jobbole.com/112306/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_num": "2", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3219684/linux/half-a-dozen-clever-linux-command-line-tricks.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8820-1.html\">Linux中国/firmianay</a>   </div><blockquote><p>一些非常有用的命令能让命令行的生活更满足</p></blockquote>\n<p>使用 Linux 命令工作可以获得许多乐趣，但是如果您使用一些命令，它们可以减少您的工作或以有趣的方式显示信息时，您将获得更多的乐趣。在今天的文章中，我们将介绍六个命令，它们可能会使你用在命令行上的时间更加值当。</p>\n<h3 id=\"toc_1\">watch</h3>\n<p><code>watch</code> 命令会重复运行您给出的任何命令，并显示输出。默认情况下，它每两秒运行一次命令。命令的每次运行都将覆盖上一次运行时显示的内容，因此您始终可以看到最新的数据。</p>\n<p>您可能会在等待某人登录时使用它。在这种情况下，您可以使用 <code>watch who</code> 命令或者 <code>watch -n 15 who</code> 命令使每 15 秒运行一次，而不是两秒一次。另外终端窗口的右上角会显示日期和时间。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f32053732681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ watch -n 5 who\r\nEvery 5.0s: who                               stinkbug: Wed Aug 23 14:52:15 2017\r\n\r\nshs      pts/0        2017-08-23 14:45 (192.168.0.11)\r\nzoe      pts/1        2017-08-23 08:15 (192.168.0.19)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f32053732681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f32053732681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f32053732681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f32053732681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f32053732681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f32053732681-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f32053732681-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">watch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">who</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f32053732681-2\"><span class=\"crayon-i\">Every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">who                               </span><span class=\"crayon-v\">stinkbug</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Wed </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f32053732681-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f32053732681-4\"><span class=\"crayon-e\">shs      </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">192.168.0.11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f32053732681-5\"><span class=\"crayon-e\">zoe      </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">192.168.0.19</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f32053732681-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>您也可以使用它来查看日志文件。如果您显示的数据没有任何变化，则只有窗口角落里的日期和时间会发生变化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f3b966001100\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ watch tail /var/log/syslog\r\nEvery 2.0s: tail /var/log/syslog              stinkbug: Wed Aug 23 15:16:37 2017\r\n\r\nAug 23 14:45:01 stinkbug CRON[7214]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 14:45:17 stinkbug systemd[1]: Started Session 179 of user shs.\r\nAug 23 14:55:01 stinkbug CRON[7577]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 15:05:01 stinkbug CRON[7582]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 15:08:48 stinkbug systemd[1]: Starting Cleanup of Temporary Directories...\r\nAug 23 15:08:48 stinkbug systemd-tmpfiles[7584]: [/usr/lib/tmpfiles.d/var.conf:1\r\n4] Duplicate line for path \"/var/log\", ignoring.\r\nAug 23 15:08:48 stinkbug systemd[1]: Started Cleanup of Temporary Directories.\r\nAug 23 15:13:41 stinkbug systemd[1]: Started Session 182 of user shs.\r\nAug 23 15:14:29 stinkbug systemd[1]: Started Session 183 of user shs.\r\nAug 23 15:15:01 stinkbug CRON[7828]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f3b966001100-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f3b966001100-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">watch </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">syslog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-2\"><span class=\"crayon-i\">Every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.0s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">syslog              </span><span class=\"crayon-v\">stinkbug</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Wed </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-4\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7214</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-5\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-6\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">179</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-7\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7577</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-8\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-9\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7582</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-10\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-11\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-e\">Cleanup </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">Temporary </span><span class=\"crayon-v\">Directories</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-12\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tmpfiles</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7584</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmpfiles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-13\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/var/log\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ignoring</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-14\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">Cleanup </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">Temporary </span><span class=\"crayon-v\">Directories</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-15\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">182</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-16\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">183</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-17\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7828</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f3b966001100-18\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f3b966001100-19\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p>这里的输出和使用命令 <code>tail -f /var/log/syslog</code> 的输出相似。</p>\n<h3 id=\"toc_2\">look</h3>\n<p>这个命令的名字 <code>look</code> 可能会让我们以为它和 <code>watch</code> 做类似的事情，但其实是不同的。<code>look</code> 命令用于搜索以某个特定字符串开头的单词。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f41167847360\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ look ecl\r\neclectic\r\neclectic's\r\neclectically\r\neclecticism\r\neclecticism's\r\neclectics\r\neclipse\r\neclipse's\r\neclipsed\r\neclipses\r\neclipsing\r\necliptic\r\necliptic's\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f41167847360-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f41167847360-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">look </span><span class=\"crayon-e\">ecl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-2\"><span class=\"crayon-e\">eclectic</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-3\"><span class=\"crayon-i\">eclectic</span><span class=\"crayon-s\">'s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-4\"><span class=\"crayon-s\">eclectically</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-5\"><span class=\"crayon-s\">eclecticism</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-6\"><span class=\"crayon-s\">eclecticism'</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-7\"><span class=\"crayon-e\">eclectics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-8\"><span class=\"crayon-e\">eclipse</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-9\"><span class=\"crayon-i\">eclipse</span><span class=\"crayon-s\">'s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-10\"><span class=\"crayon-s\">eclipsed</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-11\"><span class=\"crayon-s\">eclipses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-12\"><span class=\"crayon-s\">eclipsing</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-13\"><span class=\"crayon-s\">ecliptic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f41167847360-14\"><span class=\"crayon-s\">ecliptic'</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f41167847360-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>look</code> 命令通常有助于单词的拼写，它使用 <code>/usr/share/dict/words</code> 文件，除非你使用如下的命令指定了文件名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f44060916208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ look esac .bashrc\r\nesac\r\nesac\r\nesac\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f44060916208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f44060916208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f44060916208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f44060916208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f44060916208-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f44060916208-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">look </span><span class=\"crayon-i\">esac</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f44060916208-2\"><span class=\"crayon-e\">esac</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f44060916208-3\"><span class=\"crayon-e\">esac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f44060916208-4\"><span class=\"crayon-i\">esac</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f44060916208-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在这种情况下，它的作用就像跟在一个 <code>awk</code> 命令后面的 <code>grep</code> ，只打印匹配行上的第一个单词。</p>\n<h3 id=\"toc_3\">man -k</h3>\n<p><code>man -k</code> 命令列出包含指定单词的手册页。它的工作基本上和 <code>apropos</code> 命令一样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f48116558538\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ man -k logrotate\r\ndh_installlogrotate (1) - install logrotate config files\r\nlogrotate (8)        - rotates, compresses, and mails system logs\r\nlogrotate.conf (5)   - rotates, compresses, and mails system logs\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f48116558538-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f48116558538-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f48116558538-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f48116558538-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f48116558538-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f48116558538-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">logrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f48116558538-2\"><span class=\"crayon-e\">dh_installlogrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">logrotate </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">files</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f48116558538-3\"><span class=\"crayon-e\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rotates</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">compresses</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mails </span><span class=\"crayon-e\">system </span><span class=\"crayon-e\">logs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f48116558538-4\"><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rotates</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">compresses</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mails </span><span class=\"crayon-e\">system </span><span class=\"crayon-i\">logs</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f48116558538-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">help</h3>\n<p>当你完全绝望的时候，您可能会试图使用此命令，<code>help</code> 命令实际上是显示一个 shell 内置命令的列表。最令人惊讶的是它有相当多的参数变量。你可能会看到这样的东西，然后开始想知道这些内置功能可以为你做些什么：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f4b245688814\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ help\r\nGNU bash, version 4.4.7(1)-release (i686-pc-linux-gnu)\r\nThese shell commands are defined internally.  Type `help' to see this list.\r\nType `help name' to find out more about the function `name'.\r\nUse `info bash' to find out more about the shell in general.\r\nUse `man -k' or `info' to find out more about commands not in this list.\r\n\r\nA star (*) next to a name means that the command is disabled.\r\n\r\n job_spec [&amp;]                            history [-c] [-d offset] [n] or hist&gt;\r\n (( expression ))                        if COMMANDS; then COMMANDS; [ elif C&gt;\r\n . filename [arguments]                  jobs [-lnprs] [jobspec ...] or jobs &gt;\r\n :                                       kill [-s sigspec | -n signum | -sigs&gt;\r\n [ arg... ]                              let arg [arg ...]\r\n [[ expression ]]                        local [option] name[=value] ...\r\n alias [-p] [name[=value] ... ]          logout [n]\r\n bg [job_spec ...]                       mapfile [-d delim] [-n count] [-O or&gt;\r\n bind [-lpsvPSVX] [-m keymap] [-f file&gt;  popd [-n] [+N | -N]\r\n break [n]                               printf [-v var] format [arguments]\r\n builtin [shell-builtin [arg ...]]       pushd [-n] [+N | -N | dir]\r\n caller [expr]                           pwd [-LP]\r\n case WORD in [PATTERN [| PATTERN]...)&gt;  read [-ers] [-a array] [-d delim] [-&gt;\r\n cd [-L|[-P [-e]] [-@]] [dir]            readarray [-n count] [-O origin] [-s&gt;\r\n command [-pVv] command [arg ...]        readonly [-aAf] [name[=value] ...] o&gt;\r\n compgen [-abcdefgjksuv] [-o option] [&gt;  return [n]\r\n complete [-abcdefgjksuv] [-pr] [-DE] &gt;  select NAME [in WORDS ... ;] do COMM&gt;\r\n compopt [-o|+o option] [-DE] [name ..&gt;  set [-abefhkmnptuvxBCHP] [-o option-&gt;\r\n continue [n]                            shift [n]\r\n coproc [NAME] command [redirections]    shopt [-pqsu] [-o] [optname ...]\r\n declare [-aAfFgilnrtux] [-p] [name[=v&gt;  source filename [arguments]\r\n dirs [-clpv] [+N] [-N]                  suspend [-f]\r\n disown [-h] [-ar] [jobspec ... | pid &gt;  test [expr]\r\n echo [-neE] [arg ...]                   time [-p] pipeline\r\n enable [-a] [-dnps] [-f filename] [na&gt;  times\r\n eval [arg ...]                          trap [-lp] [[arg] signal_spec ...]\r\n exec [-cl] [-a name] [command [argume&gt;  true\r\n exit [n]                                type [-afptP] name [name ...]\r\n export [-fn] [name[=value] ...] or ex&gt;  typeset [-aAfFgilnrtux] [-p] name[=v&gt;\r\n false                                   ulimit [-SHabcdefiklmnpqrstuvxPT] [l&gt;\r\n fc [-e ename] [-lnr] [first] [last] o&gt;  umask [-p] [-S] [mode]\r\n fg [job_spec]                           unalias [-a] name [name ...]\r\n for NAME [in WORDS ... ] ; do COMMAND&gt;  unset [-f] [-v] [-n] [name ...]\r\n for (( exp1; exp2; exp3 )); do COMMAN&gt;  until COMMANDS; do COMMANDS; done\r\n function name { COMMANDS ; } or name &gt;  variables - Names and meanings of so&gt;\r\n getopts optstring name [arg]            wait [-n] [id ...]\r\n hash [-lr] [-p pathname] [-dt] [name &gt;  while COMMANDS; do COMMANDS; done\r\n help [-dms] [pattern ...]               { COMMANDS ; }\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f4b245688814-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f4b245688814-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">help</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-2\"><span class=\"crayon-e\">GNU </span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.4.7</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">release</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i686</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">gnu</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-3\"><span class=\"crayon-e\">These </span><span class=\"crayon-e\">shell </span><span class=\"crayon-e\">commands </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">defined </span><span class=\"crayon-v\">internally</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">help</span><span class=\"crayon-s\">' to see this list.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-4\"><span class=\"crayon-s\">Type `help name'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">the </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">name</span><span class=\"crayon-s\">'.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-5\"><span class=\"crayon-s\">Use `info bash'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">shell </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-6\"><span class=\"crayon-st\">Use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">man</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-s\">' or `info'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">commands </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-8\"><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">star</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-e\">means </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                            </span><span class=\"crayon-i\">history</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expression</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                  </span><span class=\"crayon-i\">jobs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lnprs</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">jobspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jobs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                                       </span><span class=\"crayon-i\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sigspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">signum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sigs</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                              </span><span class=\"crayon-e\">let </span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expression</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                        </span><span class=\"crayon-i\">local</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alias</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">          </span><span class=\"crayon-i\">logout</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                       </span><span class=\"crayon-i\">mapfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delim</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-18\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bind</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lpsvPSVX</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keymap</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">popd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                               </span><span class=\"crayon-i\">printf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">var</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">builtin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">builtin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-i\">pushd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">caller</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                           </span><span class=\"crayon-i\">pwd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">LP</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">WORD</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">PATTERN</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PATTERN</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">read</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ers</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delim</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-23\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">L</span><span class=\"crayon-o\">|</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span><span class=\"crayon-i\">readarray</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pVv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">        </span><span class=\"crayon-i\">readonly</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAf</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-25\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">compgen</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abcdefgjksuv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-26\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">complete</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abcdefgjksuv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">select </span><span class=\"crayon-i\">NAME</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WORDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMM</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-27\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">compopt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abefhkmnptuvxBCHP</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-o\">-&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-28\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                            </span><span class=\"crayon-i\">shift</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-29\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">coproc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">NAME</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">redirections</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">shopt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pqsu</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">optname</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-30\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAfFgilnrtux</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">source </span><span class=\"crayon-i\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-31\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dirs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clpv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                  </span><span class=\"crayon-i\">suspend</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-32\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">disown</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ar</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">jobspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expr</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-33\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">neE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                   </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pipeline</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-34\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">enable</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dnps</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">na</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">times</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-35\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">eval</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                          </span><span class=\"crayon-i\">trap</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lp</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">signal</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-36\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cl</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">argume</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-37\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                                </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">afptP</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-38\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ex</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">typeset</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAfFgilnrtux</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-39\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\">                                   </span><span class=\"crayon-i\">ulimit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">SHabcdefiklmnpqrstuvxPT</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-40\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ename</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lnr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">first</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">umask</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-41\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">job_spec</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                           </span><span class=\"crayon-i\">unalias</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-42\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">NAME</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WORDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMAND</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">unset</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-43\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exp3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMAN</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">until </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-44\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMANDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">variables</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Names </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">meanings </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">so</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-45\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getopts </span><span class=\"crayon-e\">optstring </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span><span class=\"crayon-i\">wait</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-46\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathname</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dt</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">done</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f4b245688814-47\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">help</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dms</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMANDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f4b245688814-48\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0228 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">stat -c</h3>\n<p><code>stat</code> 命令用于显示文件的大小、所有者、用户组、索引节点号、权限、修改和访问时间等重要的统计信息。这是一个非常有用的命令，可以显示比 <code>ls -l</code> 更多的细节。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f5a945522566\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat .bashrc\r\n  File: .bashrc\r\n  Size: 4048            Blocks: 8          IO Block: 4096   regular file\r\nDevice: 806h/2054d      Inode: 421481      Links: 1\r\nAccess: (0644/-rw-r--r--)  Uid: ( 1000/     shs)   Gid: ( 1000/     shs)\r\nAccess: 2017-08-23 15:13:41.781809933 -0400\r\nModify: 2017-06-21 17:37:11.875157790 -0400\r\nChange: 2017-06-21 17:37:11.899157791 -0400\r\n Birth: -\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5a945522566-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5a945522566-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5a945522566-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5a945522566-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5a945522566-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5a945522566-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5a945522566-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5a945522566-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5a945522566-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5a945522566-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f5a945522566-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5a945522566-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">File</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f5a945522566-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4048</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">IO </span><span class=\"crayon-v\">Block</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">regular </span><span class=\"crayon-e\">file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5a945522566-4\"><span class=\"crayon-v\">Device</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">806h</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2054d</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">421481</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Links</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f5a945522566-5\"><span class=\"crayon-v\">Access</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0644</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Uid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Gid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5a945522566-6\"><span class=\"crayon-v\">Access</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41.781809933</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f5a945522566-7\"><span class=\"crayon-v\">Modify</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.875157790</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5a945522566-8\"><span class=\"crayon-v\">Change</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.899157791</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f5a945522566-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Birth</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5a945522566-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>使用 <code>-c</code> 选项，您可以指定要查看的字段。例如，如果您只想查看一个文件或一系列文件的文件名和访问权限，则可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f5e135323917\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat -c '%n %a' .bashrc\r\n.bashrc 644\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5e135323917-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f5e135323917-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f5e135323917-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f5e135323917-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f5e135323917-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">644</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f5e135323917-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在此命令中， <code>%n</code> 表示每个文件的名称，而 <code>%a</code> 表示访问权限。<code>%u</code> 表示数字类型的 UID，而 <code>%U</code> 表示用户名。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add69f11f61921996416\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat -c '%n %a' bin/*\r\nbin/loop 700\r\nbin/move2nohup 700\r\nbin/nohup.out 600\r\nbin/show_release 700\r\n\r\n$ stat -c '%n %a %U' bin/*\r\nbin/loop 700 shs\r\nbin/move2nohup 700 shs\r\nbin/nohup.out 600 root\r\nbin/show_release 700 shs\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add69f11f61921996416-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add69f11f61921996416-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-2\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-3\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">move2nohup</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-4\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nohup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-5\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">show</span><span class=\"crayon-sy\">_</span>release<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-6\"> </div><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a %U'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-8\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shs</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-9\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">move2nohup</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-10\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nohup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-59add69f11f61921996416-11\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">show</span><span class=\"crayon-sy\">_</span>release<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add69f11f61921996416-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">TAB</h3>\n<p>如果你没有使用过 tab 键来补全文件名，你真的错过了一个非常有用的命令行技巧。tab 键提供文件名补全功能（包括使用 <code>cd</code> 时的目录）。它在出现歧义之前尽可能多的填充文件名（多个文件以相同的字母开头。如果您有一个名为 <code>bigplans</code> 的文件，另一个名为 <code>bigplans2017</code> 的文件会发生歧义，你将听到一个声音，然后需要决定是按下回车键还是输入 <code>2</code> 之后再按下 tab 键选择第二个文件。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112306\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112306votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112306\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "7a050b13630b4c2a96626bde9331cd01", "title": "提升 C++ 技能的 7 种方法", "create_time": "2017/08/24", "url": "http://blog.jobbole.com/112246/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/09/64a7802a3a60295a4726c49e90604108.png"], "praise_num": "2", "comment_num": 3, "fav_num": 9, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.fluentcpp.com/2017/06/23/7-ways-better-cpp-summer/\">Jonathan Boccara</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>夏天时常会谈到大海、太阳、沙滩、大山或者你的家庭住宅。<strong>更充裕的时间</strong>也是夏天带来的好处之一。可能是因为你在休假，也可能是因为这段时间工作没有那么忙。无论是哪种情况，与一年中的其他季节相比，夏天的时间似乎更加宽裕。</p>\n<p>你有两个选择：1）把所有夏季空闲时间都用来休整，适当放松一下没什么不可以。2）或者你可以投入一部分空闲时间来提升你的技能，尤其是 C++，用 C++ 水平的提高（boost C++）来开始新的一年。</p>\n<p>如果你觉得选择1）更适合你，那么关掉手机和笔记本吧，真正地放松一下！但是如果你倾向于选择2），那么这篇文章就是为你准备的。</p>\n<p>有 7 种方法帮助你利用夏天真正提高 C++。之后我会给你一些小技巧来帮助你<strong>真正实现</strong>所选的目标。</p>\n<h3>1）开始一个项目</h3>\n<p>用 C++ 来建一个你自己的小项目是一个很好的试验方法，而且能通过这个项目真正理解程序的运行。另一个优点在于你可以完全自由地决定使用什么组件。这样你能够提升这一年没有权限/时间使用的语言特性和库组件。</p>\n<p>在我去年的夏季项目中，我实现了一些区间适配器，这让我学到了超多东西。所以我会把这个项目的细节告诉你，这样你能够得到一些灵感来构建你自己的项目：</p>\n<ul>\n<li>如果你不熟悉 C++ 中的区间（Ranges），请参考<a href=\"http://www.fluentcpp.com/2017/01/12/ranges-stl-to-the-next-level/\">《Ranges: the STL to the Next Level》</a></li>\n<li>实现 transform_iterator，</li>\n<li>实现变换区间适配器（transform range adaptor），</li>\n<li>实现 filter_iterator，</li>\n<li>实现筛选区间适配器（filter range adaptor），</li>\n<li>实现 zip 适配器（zip adaptor），然后结合变换区间适配器使用。Zip 适配器需要两个区间，并且返回到来自这两个区间的成对对象的视图</li>\n<li>为 zip 适配器一般化，要令 zip 适配器能够使用任意数量的区间，</li>\n<li>实现<a href=\"http://www.fluentcpp.com/2017/04/14/understand-ranges-better-with-the-new-cartesian-product-adaptor/\">笛卡尔积区间适配器（Cartesian product range adaptor）</a>，</li>\n<li>实现你自己的新区间适配器！</li>\n</ul>\n<p>是否完美，是否完整或者是否遵从上述指示都不重要，重要的是你要去<strong>试验</strong>。但是上面这些任务能给你带来的是：</p>\n<ul>\n<li>明确理解区间，而区间是当下一个非常流行的 C++ 特性，</li>\n<li>练习变参模板（variadic templates）的使用，</li>\n<li>初步接触模板元编程（template metaprogramming），</li>\n</ul>\n<p>并且这些都是逐渐才能体会到的。</p>\n<p>如果你在这种项目上有任何需要帮助的地方，我都愿意效劳。另外我在这个项目上的所有尝试都写在 <a href=\"https://github.com/joboccara/ranges\">GitHub 的代码仓库</a>中了，希望对你们有用。</p>\n<h3>2）读一本好书</h3>\n<p>我会发布一个 C++ 的书单，但是我现在要给你一个选择。我认为作为一个程序员要读的第一本书就是 Steve McConnell 的《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全</a>》。尽管这本书不是专注于 C++ 的，但是它把写好代码要注意的几乎所有方面都教给你了。从写一个 if 语句（没错，有好多方法把 if 语句搞砸）到分配类责任，再到代码审查，《代码大全》涵盖了软件架构的所有方面。在读完这本书以后你永远不会还用一样的方法来编程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\"><img class=\"aligncenter wp-image-112252 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\" alt=\"Code-complete-246x300\" width=\"246\" height=\"300\"></a></p>\n<p>如果你还没有读过《代码大全》，你应该去看看 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B004G72P24/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B004G72P24&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective C++</a>》。我建议《Effective C++》要读<strong>两遍</strong>。我已经读过三遍了，但是我想两遍的效果应该一样好。尽管这本书是在 C++11 之前写的，但是大部分内容在今天也仍然是有用的。而且《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》涵盖了C++11 和 C++14 中的特性，可以作为这本书的补充材料。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\"><img class=\"aligncenter wp-image-112253 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\" alt=\"Code-complete-246x300\" width=\"243\" height=\"300\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\"><img class=\"aligncenter wp-image-112255 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\" alt=\"Effective-modern-C-249x300\" width=\"249\" height=\"300\"></a></p>\n<p>今年夏天我要看的是 Eric Evans 的著名书籍——《<a href=\"https://www.amazon.cn/gp/product/B01GZ6T12K/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B01GZ6T12K&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">领域驱动设计</a>》（Domain Driven Design）。《领域驱动设计》涵盖了领域专家和开发人员之间的密集交流，建立领域模型以及在讨论模型与代码时使用<strong>同一种语言</strong>。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\"><img class=\"aligncenter wp-image-112256 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\" alt=\"Code-complete-246x300\" width=\"227\" height=\"300\"></a></p>\n<p>尽管这本书的内容很有价值，但是读起来并不容易。我发现一个有用的小技巧：对每一小节<strong>先读第一段，再读最后一段，最后读其余部分</strong>。这样你能更好地理解作者的写作方向，节省时间。</p>\n<p>我希望通过显示代码中的域，来找到使代码具有表达性的灵感。当然啦，我会在博客上分享这些灵感的。</p>\n<p>这只是一个选择，我还会做一个更全面的书单。</p>\n<h3>3）学习一个新的语言</h3>\n<p>虽然听起来很稀奇，但是学习一种新的语言可以让你对你所的专注语言获得更深层次的理解，而且是最有效的方法之一。并且新的语言和你自己使用的语言差别越大，效果越好。</p>\n<p>新的观点认为，其他编程语言会让你对编程有更一般的理解。由于你太熟悉自己所用的语言，往往会忽略它的特性，而用不同的方法解决问题能够使这些特性凸显出来。即使你不会使用新语言来写产品代码，所接触到的新概念也能为你提供可以应用到主语言中的思路。</p>\n<p>如果你用的是 C++，那么我推荐你去学习一下 Haskell 语言。Haskell 是一种<strong>函数型编程</strong>语言。如果你还没有试用过函数型编程，那么你能从它的概念中获得启发，并从新的角度看待 C++，尤其是 STL。</p>\n<p>我已经花了很长时间比较网络上各种学习 Haskell 的资源。2013 年（单指那一年）<a href=\"http://www.seas.upenn.edu/~cis194/spring13/lectures.html\">宾夕法尼亚大学的课程</a>是我找到的最好的资源。它解释得很清楚，没有太多理论，课程练习也很良心而且有指导性，并且它还是免费的。</p>\n<p>一旦你学完这门课程，你可以在<a href=\"https://github.com/tonymorris/fp-course\"> data61 课程</a>中获得很多 Haskell 的练习，包括填空补充代码。你能够通过这些练习来整理不寻常的函数型编程的相关知识。</p>\n<p>如果你想了解更多函数型编程语言以及它们在 C++中的应用，我推荐 Quentin Duval 的博客：<a href=\"https://deque.blog/\">deque.blog</a>。</p>\n<p>今年夏天我要学习的语言是 <strong>Lisp</strong> 。我明白它是一种非常强大的语言，能够全面提升对编程的理解。一些语言是从它衍生出来的。它不会消失一定是有原因的！</p>\n<p>我还没有完成对网上资源的调查，但是我计划使用《<a href=\"https://www.amazon.cn/gp/product/B0011AP7RY/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0011AP7RY&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">计算机程序的构造和解释</a>》（Structure and Interpretation of Computer Programs）。如果你有任何关于学习 Lisp 的想法，请告诉我！</p>\n<h3>4）提升使用 STL 的能力</h3>\n<p>STL 是 C++ 中处理容器和算法的部分。它很强大而且并不难用，却没有它应有的名气。要想掌握 STL 需要有相当的知识积累，但是这是值得的。它是一个神奇的方法，能使你的 C++ 代码更具有表达性也更健壮。</p>\n<p>我正在整理帮你掌握 STL 的资料，叫做 <a href=\"http://www.fluentcpp.com/stl/\">STL 学习资源</a>。还没有完成，但是有很大一部分已经做完了，我想足够让你在这个夏天的大部分时间都很充实了。</p>\n<h3>5）紧跟现代C++的特性</h3>\n<p>C++11，C++14 和C++17给C++ 和标准库带来了很多新的特性。即使你现在，比如今年夏天，没有在产品代码中使用它们，它们也都来了。并且你可以立即把它们应用在你的项目中（看上面的第1条）。</p>\n<p>有些特性很好掌握，比如 <strong>lambdas</strong>。尽管精通 lambda 表达式需要掌握很多细节上的东西，但是学会它们的基础用法不需要花太多精力。</p>\n<p>所以部分特性很好理解，只需要一些好资源和时间来熟悉它们。比如 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》（见上面的第2点）涵盖了 C++11和 C++14 的大部分特性。</p>\n<p>我特别喜欢Bartek博客上的一份 <a href=\"http://www.bfilipek.com/2017/01/cpp17features.html\">C++17 特性列表</a>，它可以帮你快速上手 C++17 新特性。内容详实，而且你可以通过给一个特定的特性添加信息来贡献自己的一份力量。Bartolomiej 提供了所有的资源和 Github 权限，所以你能够非常轻松地添加信息。这样即使你还不了解 C++17 也能够贡献自己的力量，并且<strong>在这个过程中学到很多东西</strong>。</p>\n<p>如果你不练习的话，是无法理解很多特性的。尤其是<strong>变参模板</strong>，它是现代标准 C++ 的一个重要特性。上面第一点中的项目和其他任何包含变参模板的项目都可以作为练习。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\"><img class=\"aligncenter wp-image-112257 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\" alt=\"Code-complete-246x300\" width=\"640\" height=\"360\"></a></p>\n<h3>6）提高你对 boost 的了解</h3>\n<p>Boost 是设计良好的 C++ 库的集合，可移植且开源。很多现代 C++ 的特性都源自 Boost。</p>\n<p>了解 Boost 的内容很重要。有两个原因：第一，在代码中确实需要它们，因为 boost 主要应用于综合使用；第二，更重要的原因是即使你在产品代码中没有使用 boost，它可以给你一个通用的精心设计的 API 和 C++ 代码模型。<strong>留心 boost 中的内容可以给你自己的设计带来灵感</strong>。</p>\n<p>学习大量的 boost 库的一个方法是阅读 Boris Schäling 的书——《<a href=\"https://www.amazon.cn/gp/product/0982219199/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=0982219199&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The boost C++ Libraries</a>》。这本书有<a href=\"https://theboostcpplibraries.com/\">电子版</a>，但是纸质版可以放进沙滩包供你躺在沙滩上阅读（真的，我去年夏天就读的这本书）。不过这本书是基于 boost 1.55.0 的，所以它包含了很多库，但并不是所有。</p>\n<p>特别地，它没有包含 Boost Hana。Boost Hana 是一个流行的现代 C++ 元程序库。实际上，学习 Boost Hana 可以作为今年夏天的一个目标。</p>\n<p>我询问了 Louis Dionne（Boost Hana 的创始人）怎么样才能有效地学习 Boost Hana。从<a href=\"http://www.boost.org/doc/libs/1_61_0/libs/hana/doc/html/index.html\">官方指导</a>入手是一个好的开始，而且你可以看他的<a href=\"https://youtu.be/Oc4enqNH-Mc\"> ACCU 演讲</a>（或者<a href=\"https://www.youtube.com/watch?v=X_p9X5RzBJE\">Meeting C++ keynote</a>，内容相似）来获取初步的介绍。这里是<a href=\"http://ldionne.com/talks/\"> Louis 的所有演讲</a>，大多数都与元编程和 HANA 有关，可以帮助加深你的了解。</p>\n<h3>7）观看网络视频</h3>\n<p>C++ 社区上有超多网络视频，尤其是年会的视频。今年夏天是观看这些视频的好时机。</p>\n<p>下面是一些我觉得有近期指导性的演讲：</p>\n<ul>\n<li>Patrice Roy – <a href=\"https://youtu.be/Fno6suiXLPs\">异常处理（The Exception Situation）</a>。这个演讲让你对在 C++ 中使用异常处理对你的代码意味着什么有一个大致了解。该演讲结构合理，而且 Patrice 的演讲风格很让人愉快。</li>\n<li>Arthur O’Dwyer – <a href=\"https://youtu.be/vwrXHznaYLA\">Template Normal Programming</a>。在这个演讲中，Arthur 在不用模板元编程的情况下，展示了关于模板的所有知识，同样有板有眼。</li>\n<li>Stephan T. Lavave  – <a href=\"https://www.youtube.com/watch?v=JhgWFYfdIho\"> tuple＜＞：新特点以及它的用法（tuple＜＞: What’s New and How it Works）</a>。这里有很多关于 tuples 的有用信息和练习帮助你更了解标准库。</li>\n<li>Howard Hinnant – <a href=\"https://youtu.be/P32hvk8b13M\">chrono 导论（A ＜chrono＞ Tutorial）</a>。这个演讲教你使用 chrono 库，告诉你它是怎么用强类型来完成安全又表达清楚的代码。</li>\n<li>David Sankel –<a href=\"https://youtu.be/DiisKQAkGM4\"> Monoids, Monads, and Applicative Functors: Repeated Software Patterns</a>。David Sankel 展示了纯函数概念如何应用于 C++。</li>\n<li>David Sankel – <a href=\"https://youtu.be/k3O4EKX4z1c\">Variants：过去，现在和未来（Variants: Past, Present, and Future）</a>。一个关于 variant 的优秀展示，并且 variant 在 C++17 中被放进标准库里了。</li>\n<li>Dietmar Kühl – <a href=\"https://youtu.be/xWmdcvTedbc\">Constant Fun</a>。一个关于 constexpr 的优秀展示。</li>\n<li>Jason Turner –<a href=\"https://www.youtube.com/channel/UCxHAlbZQNFU2LgEtiqd2Maw\"> C++周刊（C++ Weekly）</a>。在这个周系列中，Jason 制作了一些短视频（5 到 10 分钟），每个视频都展示了一个 C++ 的精彩应用。我通常把这系列视频描述为“精彩 5 分钟”。</li>\n</ul>\n<p>这个列表绝没有包括所有优秀的视频。我看到过其他好视频，并且会有很多我没看过的。但是我觉得这个列表里的视频是个好开始。</p>\n<h3>实现你的夏季目标</h3>\n<p>现在已经有<strong>很多事要做</strong>啦。一个夏天之内不可能做完这些所有事情。所以你应该选择其中一部分来做，并且<strong>提前定好目标</strong>。不要从一件事情跳到另一件事情上，否则夏天会很快过去而且你也完不成任何一件事。</p>\n<p>此外，要想完成你的目标，你需要<strong>集中注意力</strong>。一个实用的方法是使用<a href=\"https://en.wikipedia.org/wiki/Pomodoro_Technique\">番茄工作法</a>，我是用 <a href=\"https://kanbanflow.com/\">kanbanflow</a> 来实现的。我现在就在使用这个方法而且结果也不错。</p>\n<p>我今年夏天的目标是读完《领域驱动设计》并且对 Lisp 有适当的理解。你的目标是什么呢？</p>\n<p>现在就选择<strong>两个目标</strong>吧，写在评论区内让我了解一下你们的选择。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112246\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112246votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112246\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "C/C++,开发,C++", "front_image_path": "full/f5d4611e2094787b56111e18af07ad9bad0e04f6.jpg"}
{"url_object_id": "2b39c6050457697bdcf56fe2481a09cf", "title": "编写高质量代码的思考", "create_time": "2017/08/10", "url": "http://blog.jobbole.com/112139/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/06/real-programmers-code-in-binary.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2 id=\"u524D_u8A00\">前言</h2>\n<p>最近在看《代码大全》，可以说是一本软件开发的百科全书，特别厚，但是干货也很多。平时写代码，代码规范是一个最低的要求（很多老代码连最低要求都达不到），为什么要这样规定代码要这么写，而不是那么写？这是一个值得深究的问题。而不是说我照着代码规范写代码就算完了，高质量的代码是一个专业工程师的追求。要知其然知其所以然，最近写发票解析的代码，因为涉及带解析PDF的算法，复杂度比较高，所以花了很多时间在重构，学以致用的时候积累了一些心得。</p>\n<h2 id=\"u4FE1_u606F_u9690_u85CF_u539F_u5219\">信息隐藏原则</h2>\n<p>信息隐藏是面向对象设计的一个原则，是对封装和模块化的一个更高维度的概括。从Java的整个访问限制设计就体现了信息隐藏的原则，各种访问修饰符：<code>public,protect,private</code>，在类设计的时候，我们就要决定什么暴露给外部，什么隐藏起来。</p>\n<p>举一个例子下面的代码表示一个有自增ID的<code>Person</code>类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef81ed296093334826\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef81ed296093334826-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed296093334826-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed296093334826-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed296093334826-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed296093334826-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed296093334826-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed296093334826-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef81ed296093334826-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed296093334826-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed296093334826-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed296093334826-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed296093334826-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed296093334826-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed296093334826-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><span style=\"font-weight: normal;\">上面的类设计有什么问题呢？它违反了信息隐藏的原则，直接将ID分配的方式暴露了，这会给后面的维护带来很多问题：当你想给id的范围做出限制的时候怎么办？当你在所有代码中使用</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">分配ID时突然需要修改ID分配的算法怎么办？是不是需要去改所有</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">出现的地方？更好的设计是将ID的分配算法隐藏起来。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef81ed2a0448756834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = NewId();\r\n    }\r\n    private int NewId() {\r\n      return ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a0448756834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a0448756834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a0448756834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a0448756834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a0448756834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a0448756834-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a0448756834-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a0448756834-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a0448756834-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a0448756834-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef81ed2a0448756834-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a0448756834-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a0448756834-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a0448756834-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a0448756834-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a0448756834-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a0448756834-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a0448756834-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a0448756834-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a0448756834-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p><span style=\"font-weight: normal;\">咋一看只是将</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">写到一个方法里面而已，但是它隐藏了ID分配的算法，让调用者不需要关心里面的实现，同时控制了变化，不管ID分配算法怎么变，都不会影响其他的代码。调用者了解的信息越多，受到的影响就越大，信息隐藏可以降低复杂度，控制变化的范围。</span></p>\n<p>上面的例子只是信息隐藏的一个简单应用，下面我们来举几个其他的应用例子：</p>\n<ul>\n<li>为什么不推荐使用魔法值（即未经定义的常量）？：这个明显违反了信息隐藏的原则，当你将字面量直接写在代码里面时，就将信息直接暴露了，后面需要修改的时候，一旦少改了某个地方的字面量，bug就出现了。</li>\n<li>循环依赖（即A调用B，B调用A的情况）：类或方法之间的循环依赖会破坏信息隐藏，一个很直接的影响就是在测试的时候，A，B都需要同时准备好才能进行测试，而无法mock任意一方。</li>\n<li>使用全局变量：这个就不用说了，所有人都可以访问你的时候信息就暴露无疑了，全局变量能不用就不用。</li>\n<li>考虑性能损失：有时候我们为了一些性能上的考虑就破坏信息隐藏原则，将一些变量全局化，这样性能提高得不多，维护成本却上升不少，完全是得不偿失。</li>\n</ul>\n<p>最后总结一下信息隐藏的好处：</p>\n<ul>\n<li>隐藏信息即隐藏了复杂度，降低了编程的负担。</li>\n<li>隐藏信息即隐藏了底层变化，以便于在局部控制变化。</li>\n</ul>\n<h2 id=\"u4E00_u4E9B_u4E0D_u592A_u5E38_u89C1_u7684_u7F16_u7A0B_u6280_u5DE7\">一些不太常见的编程技巧</h2>\n<h3 id=\"u51FD_u6570_28function_29_u4E0E_u8FC7_u7A0B_28procedure_29_u7684_u9009_u62E9\">函数(function)与过程(procedure)的选择</h3>\n<p>我们先来看看函数与过程区别：</p>\n<ul>\n<li>Function：有返回值的方法</li>\n<li>Procedure：没有返回值的方法</li>\n</ul>\n<p>平时我们编程其实没有太区别函数与过程，什么时候用函数，什么时候用过程其实没有过多的考虑，感觉都可以用。一个选择的规则就是<strong>当你的方法的目的是想返回跟你方法名称相符的值的时候用函数，否则用过程</strong></p>\n<p>举个例子，我看过很多<code>XXProcessor</code>接口里面的方法都是<code>XX process()</code>，严格来讲，这样的命名是不符合上面的规则的，<code>process</code>是一个没有含义的命名，但是却有返回值，如果没有返回值那它的命名才是合理的。</p>\n<p>当然了，上面的规则仅供参考，世事无绝对，具体情况具体分析，当你不清楚用函数还是用过程的时候，可以参考这个规则。</p>\n<h3 id=\"u4F7F_u7528boolean_u503C_u6765_u7ED9_u7A0B_u5E8F_u505A_u6CE8_u91CA\">使用boolean值来给程序做注释</h3>\n<p>相信大家看到一个if语句有很多条件的时候都会特别头痛，因为很难理解。例如下面的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef81ed2a6768334735\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) || elementIndex == lastElementIndex) {\r\n  do....\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a6768334735-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a6768334735-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a6768334735-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef81ed2a6768334735-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lastElementIndex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a6768334735-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a6768334735-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><span style=\"font-weight: normal;\">但如果换成下面的写法，用boolean值的名字来给if语句注释，看起来就很好理解了。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef81ed2a9208569284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfinished = ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) );\r\nrepeatedEntry = ( elementIndex == lastElementIndex );\r\nif ( finished || repeatedEntry ) {\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a9208569284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a9208569284-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a9208569284-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef81ed2a9208569284-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef81ed2a9208569284-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef81ed2a9208569284-1\"><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a9208569284-2\"><span class=\"crayon-v\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lastElementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a9208569284-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef81ed2a9208569284-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adef81ed2a9208569284-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">总结</span></p>\n<p>怎么写高质量的代码是一个很大的话题，这里只是抛砖引玉，其实面向对象设计的很多原则都能够给我们写代码的时候提供指导，写代码的时候要时刻记得学以致用，而不是敷衍了事，专业的软件工程师必然要能写得一手好代码。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/5bf123eeb2d2e5d53b487415f6c0555c.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c7fcb7a46ab889ed5518728242187ab5.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112139\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112139votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112139\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/b312ba4ffd5245fa2a1ab819ec0d0347.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            热爱阅读，喜欢挑战。热衷尝试新的技术，关注技术背后的原理。关注领域：Java 服务端开发，网络编程。关注语言：Java, C, Python。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Yonah\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yonah/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 39</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.xiaohansong.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/xiaohansong\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/x-hansong\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "开发,代码质量", "front_image_path": "full/e4f0172387cbbdb2d04cefa86ba2081b49678dc1.jpg"}
{"url_object_id": "d8da08036482631b2ae3f07034443561", "title": "GitHub 简易入门指南", "create_time": "2017/08/28", "url": "http://blog.jobbole.com/112281/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/e1c1cc8db1f52eec31747b94474b595a.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/getting-started-with-github\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8814-1.html\">Linux中国/firmianay</a>   </div><p><a href=\"http://www.linuxandubuntu.com/home/getting-started-with-github\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e1c1cc8db1f52eec31747b94474b595a.jpg\" alt=\"Getting Started With GitHub\"></a></p>\n<p><a href=\"https://github.com/\">GitHub</a> 是一个在线平台，旨在促进在一个共同项目上工作的个人之间的代码托管、版本控制和协作。通过该平台，无论何时何地，都可以对项目进行操作（托管和审查代码，管理项目和与世界各地的其他开发者共同开发软件）。<strong>GitHub 平台</strong>为开源项目和私人项目都提供了项目处理功能。</p>\n<p>关于团队项目处理的功能包括：GitHub 流Flow&gt;和 GitHub 页Pages。这些功能可以让需要定期部署的团队轻松处理工作流程。另一方面，GitHub 页提供了页面用于展示开源项目、展示简历、托管博客等。</p>\n<p>GitHub 也为个人项目提供了必要的工具，使得个人项目可以轻松地处理。它也使得个人可以更轻松地与世界分享他们的项目。</p>\n<h3 id=\"toc_1\">注册 GitHub 并启动一个项目</h3>\n<p>在 GitHub 上启动新项目时，您必须先使用您的电子邮件地址创建一个帐户。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/github-homepage_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/01c7882ef18db3d3f3887534261dc45c.jpg\" alt=\"github homepage\"></a></p>\n<p>然后，在验证邮箱的时候，用户将自动登录到他们的 GitHub 帐户。</p>\n<h4 id=\"toc_2\">1、 创建仓库</h4>\n<p>之后，我们会被带到一个用于创建仓库repository的页面。仓库存储着包括修订历史记录在内的所有项目文件。仓库可以是公开的或者是私有的。公开的仓库可以被任何人查看，但是，只有项目所有者授予权限的人才可以提交修改到这个仓库。另一方面，私有仓库提供了额外的控制，可以将项目设置为对谁可见。因此，公开仓库适用于开源软件项目，而私有仓库主要适用于私有或闭源项目。</p>\n<ul>\n<li>填写 “仓库名称Repository Name” 和 “简短描述Short Description”。</li>\n<li>选中 “以一个 README 文件初始化Initialize this repository with a README”。</li>\n<li>最后，点击底部的 “创建仓库Create Repository” 按钮。</li>\n</ul>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/create-a-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/14fcf6fd8154adb9a3c89cf0fa0a93fb.jpg\" alt=\"create a github repository\"></a></p>\n<h4 id=\"toc_3\">2、 添加分支</h4>\n<p>在 GitHub 中，分支branch是一种同时操作单个仓库的各种版本的方式。默认情况下，任何创建的单个仓库都会被分配一个名为 “MASTER” 的分支，它被认为是最后一个分支。在 GitHub 中，分支在被合并到主干master（最后的分支）之前，可以在对仓库进行实验和编辑中发挥作用。</p>\n<p>为了使项目适合每一个人的需求，通常情况下，总是需要添加几个格外的分支来匹配不同的项目。在主分支上创建一个分支和复制主分支时的当前状态是一样的。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/add-a-branch-to-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/09f5d75c22e6dee20daa51b241e8a809.jpg\" alt=\"add a branch to github repository\"></a></p>\n<p>创建分支与在不同版本中保存单个文件是类似的。它通过在特定仓库上执行的任务重命名来实现。</p>\n<p>分支在保持错误修复和功能添加工作中同样被证明是有效。在进行必要的修改后，这些分支会被合并到主分支中。</p>\n<p>在创建仓库后创建一个分支：</p>\n<ul>\n<li>在这个例子中，点击仓库名称 “Hello-World” 跳转到你的新仓库。</li>\n<li>点击顶部的 “Branch:Master” 按钮，会看到一个下拉菜单，菜单里有填写分支名称的空白字段。</li>\n<li>输入分支名称，在这个例子中我们输入 “readme-edits“。</li>\n<li>按下回车键或者点击蓝色的 “创建分支create branch” 框。</li>\n</ul>\n<p>这样就成功创建了两个分支：master 和 readme-edits。</p>\n<h4 id=\"toc_4\">3、 修改项目文件并提交</h4>\n<p>此步骤提供了关于如何更改仓库并保存修改的指导。在 GitHub 上，提交commit被定义为保存的修改的意思。每一次提交都与一个提交信息commit message相关联，该提交信息包含了保存的修改的历史记录，以及为何进行这些更改。这使得其他贡献者可以很轻松地知道你做出的更改以及更改的原因。</p>\n<p>要对仓库进行更改和提交更改，请执行以下步骤：</p>\n<ul>\n<li>点击仓库名称 “Hello-World”。</li>\n<li>点击右上角的铅笔图标查看和编辑文件。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/commit-changes-to-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/05ce163a30316ed081d9d40cf125afa5.jpg\" alt=\"commit changes to github repository\"></a></li>\n<li>在编辑器中，写一些东西来确定你可以进行更改。</li>\n<li>在提交消息commit message字段中做简要的总结，以解释为什么以及如何进行更改。</li>\n<li>点击提交更改 commit changes按钮保存更改。</li>\n</ul>\n<p>请注意，这些更改仅仅影响到 readme-edits 分支，而不影响主分支。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/commit-branch-to-master_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5424b71e6ca81e83e4abdaa2b6f369ee.jpg\" alt=\"commit branch to master\"></a></p>\n<h4 id=\"toc_5\">4、 开启一个拉取请求</h4>\n<p>拉取请求pull request是一个允许贡献者提出并请求某人审查和合并某些更改到他们的分支的功能。拉取请求还显示了几个分支的差异（diffs）。更改、添加和删减通常以红色和绿色来表示。一旦提交完成就可以开启拉取请求，即使代码还未完成。</p>\n<p>开启一个拉取请求：</p>\n<ul>\n<li>点击拉取请求pull requests选项卡。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/github-pull-request_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ff952c1eb62fd8adbd387eeb38e9673e.jpg\" alt=\"github pull request\"></a></li>\n<li>点击新建拉取请求new pull requests按钮。</li>\n<li>选择 readme-edits 分支与 master 分支进行比较。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/compare-commit-changes-github_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5eec8f40ee29eb37ecbf19b41584b56.jpg\" alt=\"compare commit changes github\"></a></li>\n<li>确定请求，并确定这是您要提交的内容。</li>\n<li>点击创建拉取请求绿色按钮并输入一个标题。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/open-a-pull-request-in-github-repository_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c581f47872c3af18d32d2dff1d05a4ad.jpg\" alt=\"open a pull request in github repository\"></a></li>\n<li>按下回车键。</li>\n</ul>\n<p>用户可以通过尝试创建并保存拉取请求来证实这些操作。</p>\n<h4 id=\"toc_6\">5、 合并拉取请求</h4>\n<p>最后一步是将 readme-edits 分支和 master 分支合并到一起。如果 readme-edits 分支和 master 分支不会产生冲突，则会显示merge pull request合并拉取请求的按钮。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/merge-the-pull-request-github_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c45ba98c142ca89fa2544a69baab31d6.jpg\" alt=\"merge the pull request github\"></a></p>\n<p>当合并拉取时，有必要确保评论comment和其他字段被正确填写。合并拉取：</p>\n<ul>\n<li>点击merge pull request合并拉取请求的按钮。</li>\n<li>确认合并。</li>\n<li>按下紫色的删除分支按钮，删除 readme-edits 分支，因为它已经被包含在 master 分支中。（LCTT 译注：如果是合并他人提交的拉取请求，则无需也无法删除合并过来的他人的分支。）</li>\n</ul>\n<p>本文提供了 GitHub 平台从注册到使用的基本操作，接下来由大家尽情探索吧。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112281\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112281votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112281\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Github", "front_image_path": "full/b59b8906ada19ba34aeeb1b1fe85cf79c826095c.jpg"}
{"url_object_id": "1b94069f855b02965e7341f1f26e4ce2", "title": "用神经网络训练一个文本分类器", "create_time": "2017/08/10", "url": "http://blog.jobbole.com/112049/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png"], "praise_num": "3", "comment_num": 0, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2106382253\">Anne90</a> 翻译，<a href=\"http://www.jobbole.com/members/oliverpp\">蒋生武</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://machinelearnings.co/text-classification-using-neural-networks-f5cd7b8765c6#.eessps9io\">machinelearnings</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>理解聊天机器人的工作原理是非常重要的。聊天机器人内部一个非常重要的组件就是文本分类器。我们看一下文本分类器的神经网络（ANN）的内部工作原理。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\"><img class=\"alignnone size-full wp-image-112152\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\" alt=\"1-DpMaU1p85ZSgamwYDkzL-A\"></a></p>\n<p style=\"text-align: center;\">多层神经网络</p>\n<p>我们将会使用2层网络（1个隐层）和一个“词包”的方法来组织我们的训练数据。文本分类有3个特点：模式匹配、算法、神经网络。虽然使用多项朴素贝叶斯算法的方法非常有效，但是它有3个致命的缺陷：</p>\n<ul>\n<li>这个算法输出一个分数而不是一个概率。我们可以使用概率来忽略特定阈值以下的预测结果。这类似于忽略收音机中的噪声。</li>\n<li>这个算法从一个样本中学习一个分类中包含什么，而不是一个分类中不包含什么。一个分类中不包含什么的的学习模式往往也很重要。</li>\n<li>不成比例的大训练集的分类将会导致扭曲的分类分数，迫使算法相对于分类规模来调整输出分数，这并不理想。</li>\n</ul>\n<p>和它“天真”的对手一样，这种分类器并不试图去理解句子的含义，而仅仅对它进行分类。事实上，所谓的“人工智能聊天机器人”并不理解语言，但那是<a href=\"https://medium.com/@gk_/the-ai-label-is-bullshit-559b171867ff#.cqbwy3eb7\">另一个故事</a>。</p>\n<p>如果你刚接触人工神经网络，这是它的<a href=\"https://medium.com/@gk_/how-neural-networks-work-ff4c7ad371f7\">工作原理</a>。</p>\n<p>理解分类算法，请看<a href=\"https://chatbotslife.com/text-classification-using-algorithms-e4d50dcba45\">这里</a>。</p>\n<p>我们来逐个分析文本分类器的每个部分。我们将按照以下顺序：</p>\n<ol>\n<li><strong>引用需要的库</strong></li>\n<li><strong>提供训练集</strong></li>\n<li>整理数据</li>\n<li>迭代：编写代码+测试预测结果+调整模型</li>\n<li>抽象</li>\n</ol>\n<p>代码在这里，我们使用ipython notebook这个在数据科学项目上非常高效的工具。代码语法是python。</p>\n<p>我们首先导入自然语言工具包。我们需要一个可靠的方法将句子切分成词并且将单词词干化处理。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb832056419492\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# use natural language toolkit\r\nimport nltk\r\nfrom nltk.stem.lancaster import LancasterStemmer\r\nimport os\r\nimport json\r\nimport datetime\r\nstemmer = LancasterStemmer()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb832056419492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb832056419492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb832056419492-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb832056419492-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb832056419492-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb832056419492-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb832056419492-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb832056419492-1\"><span class=\"crayon-p\"># use natural language toolkit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb832056419492-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">nltk</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb832056419492-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lancaster </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">LancasterStemmer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb832056419492-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">os</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb832056419492-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb832056419492-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">datetime</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb832056419492-7\"><span class=\"crayon-v\">stemmer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LancasterStemmer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下面是我们的训练集，12个句子属于3个类别（“意图”）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb83a925028891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 3 classes of training data\r\ntraining_data = []\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how are you?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is your day?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"good day\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is it going today?\"})\r\n\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"see you later\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"talk to you soon\"})\r\n\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"make me a sandwich\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"can you make a sandwich?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"having a sandwich today?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"what's for lunch?\"})\r\nprint (\"%s sentences in training data\" % len(training_data))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb83a925028891-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb83a925028891-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-1\"><span class=\"crayon-p\"># 3 classes of training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-2\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-3\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how are you?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-4\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is your day?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-5\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-6\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is it going today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-8\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-9\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"see you later\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-10\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-11\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"talk to you soon\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-13\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"make me a sandwich\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-14\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"can you make a sandwich?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-15\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"having a sandwich today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb83a925028891-16\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"what's for lunch?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb83a925028891-17\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s sentences in training data\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb841914729859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 sentences in training data</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb841914729859-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb841914729859-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sentences </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">training </span><span class=\"crayon-v\">data</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在我们可以将数据结构组织为：<em>documents</em>, <em>classes</em> 和<em>words</em>.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb844475190908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwords = []\r\nclasses = []\r\ndocuments = []\r\nignore_words = ['?']\r\n# loop through each sentence in our training data\r\nfor pattern in training_data:\r\n    # tokenize each word in the sentence\r\n    w = nltk.word_tokenize(pattern['sentence'])\r\n    # add to our words list\r\n    words.extend(w)\r\n    # add to documents in our corpus\r\n    documents.append((w, pattern['class']))\r\n    # add to our classes list\r\n    if pattern['class'] not in classes:\r\n        classes.append(pattern['class'])\r\n\r\n# stem and lower each word and remove duplicates\r\nwords = [stemmer.stem(w.lower()) for w in words if w not in ignore_words]\r\nwords = list(set(words))\r\n\r\n# remove duplicates\r\nclasses = list(set(classes))\r\n\r\nprint (len(documents), \"documents\")\r\nprint (len(classes), \"classes\", classes)\r\nprint (len(words), \"unique stemmed words\", words)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb844475190908-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb844475190908-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-1\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-2\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-3\"><span class=\"crayon-v\">documents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-4\"><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-5\"><span class=\"crayon-p\"># loop through each sentence in our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">training_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize each word in the sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sentence'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our words list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to documents in our corpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our classes list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-16\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-17\"><span class=\"crayon-p\"># stem and lower each word and remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-18\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-19\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-20\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-21\"><span class=\"crayon-p\"># remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-22\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-24\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"documents\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb844475190908-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"classes\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb844475190908-26\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unique stemmed words\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb849317437670\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 documents\r\n3 classes ['greeting', 'goodbye', 'sandwich']\r\n26 unique stemmed words ['sandwich', 'hav', 'a', 'how', 'for', 'ar', 'good', 'mak', 'me', 'it', 'day', 'soon', 'nic', 'lat', 'going', 'you', 'today', 'can', 'lunch', 'is', \"'s\", 'see', 'to', 'talk', 'yo', 'what']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb849317437670-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb849317437670-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb849317437670-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb849317437670-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">documents</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb849317437670-2\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb849317437670-3\"><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unique </span><span class=\"crayon-e\">stemmed </span><span class=\"crayon-i\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hav'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'for'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'good'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mak'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'me'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'it'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'day'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'soon'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'going'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'today'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'can'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lunch'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'is'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"'s\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'see'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yo'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'what'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>注意每个单词都是词根并且小写。词根有助于机器将“have”和“having”等同起来。同时我们也不关心大小写。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\"><img class=\"alignnone size-full wp-image-112153 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\" alt=\"1-eUedufAl7_sI_QWSEIstZg\"></a></p>\n<p>我们将训练集中的每个句子转换为词包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb84c016347936\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# create our training data\r\ntraining = []\r\noutput = []\r\n# create an empty array for our output\r\noutput_empty = [0] * len(classes)\r\n\r\n# training set, bag of words for each sentence\r\nfor doc in documents:\r\n    # initialize our bag of words\r\n    bag = []\r\n    # list of tokenized words for the pattern\r\n    pattern_words = doc[0]\r\n    # stem each word\r\n    pattern_words = [stemmer.stem(word.lower()) for word in pattern_words]\r\n    # create our bag of words array\r\n    for w in words:\r\n        bag.append(1) if w in pattern_words else bag.append(0)\r\n\r\n    training.append(bag)\r\n    # output is a '0' for each tag and '1' for current tag\r\n    output_row = list(output_empty)\r\n    output_row[classes.index(doc[1])] = 1\r\n    output.append(output_row)\r\n\r\n# sample training/output\r\ni = 0\r\nw = documents[i][0]\r\nprint ([stemmer.stem(word.lower()) for word in w])\r\nprint (training[i])\r\nprint (output[i])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb84c016347936-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb84c016347936-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-1\"><span class=\"crayon-p\"># create our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-2\"><span class=\"crayon-v\">training</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-3\"><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-4\"><span class=\"crayon-p\"># create an empty array for our output</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-5\"><span class=\"crayon-v\">output_empty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-6\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-7\"><span class=\"crayon-p\"># training set, bag of words for each sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doc </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># list of tokenized words for the pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># create our bag of words array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern_words </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-18\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output is a '0' for each tag and '1' for current tag</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_empty</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-24\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-25\"><span class=\"crayon-p\"># sample training/output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-26\"><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-27\"><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-28\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb84c016347936-29\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb84c016347936-30\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<figure id=\"29a3\" class=\"graf graf--figure graf--iframe graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb851371149976\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']\r\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb851371149976-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb851371149976-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb851371149976-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb851371149976-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb851371149976-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb851371149976-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面的步骤是文本分类中的一个经典步骤：每个训练句子被转化为一个包含0和1的数组，而不是语料库中包含独特单词的数组。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb857843284838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'are', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb857843284838-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb857843284838-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'are'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>被词干化为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb85a391625019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb85a391625019-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb85a391625019-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后转换为输入词包的形式：<em>1</em>代表单词存在于词包中（忽略问号？）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb85d953833369\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb85d953833369-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb85d953833369-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>输出：第一类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb860643081588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb860643081588-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb860643081588-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p style=\"text-align: center;\">注意：一个句子可以有多个分类，也可以没有。确保理解上面的内容，仔细阅读代码直到你理解它。</p>\n<h4>机器学习的第一步是要有干净的数据</h4>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\"><img class=\"alignnone size-full wp-image-112154\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\" alt=\"1-CcQPggEbLgej32mVF2lalg\"></a></p>\n<figure id=\"62c0\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--h4\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>接下来我们的学习2层神经网络的核心功能。</p>\n<p>如果你是人工神经网络新手，这里是它的工作原理</p>\n<p>我们使用<a href=\"http://www.numpy.org/\">numpy</a>，原因是它可以提供快速的矩阵乘法运算。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\"><img class=\"alignnone size-full wp-image-112155\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\" alt=\"1-8SJcWjxz8j7YtY6K-DWxKw\"></a></p>\n<figure id=\"4f9a\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>我们使用sigmoid函数对值进行归一化，用其导数来衡量错误率。通过不断迭代和调整，直到错误率低到一个可以接受的值。</p>\n<p>下面我们也实现了bag-of-words函数，将输入的一个句子转化为一个包含0和1的数组。这就是转换训练数据，得到正确的转换数据至关重要。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb864558926990\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy as np\r\nimport time\r\n\r\n# compute sigmoid nonlinearity\r\ndef sigmoid(x):\r\n    output = 1/(1+np.exp(-x))\r\n    return output\r\n\r\n# convert output of sigmoid function to its derivative\r\ndef sigmoid_output_to_derivative(output):\r\n    return output*(1-output)\r\n\r\ndef clean_up_sentence(sentence):\r\n    # tokenize the pattern\r\n    sentence_words = nltk.word_tokenize(sentence)\r\n    # stem each word\r\n    sentence_words = [stemmer.stem(word.lower()) for word in sentence_words]\r\n    return sentence_words\r\n\r\n# return bag of words array: 0 or 1 for each word in the bag that exists in the sentence\r\ndef bow(sentence, words, show_details=False):\r\n    # tokenize the pattern\r\n    sentence_words = clean_up_sentence(sentence)\r\n    # bag of words\r\n    bag = [0]*len(words)  \r\n    for s in sentence_words:\r\n        for i,w in enumerate(words):\r\n            if w == s: \r\n                bag[i] = 1\r\n                if show_details:\r\n                    print (\"found in bag: %s\" % w)\r\n\r\n    return(np.array(bag))\r\n\r\ndef think(sentence, show_details=False):\r\n    x = bow(sentence.lower(), words, show_details)\r\n    if show_details:\r\n        print (\"sentence:\", sentence, \"n bow:\", x)\r\n    # input layer is our bag of words\r\n    l0 = x\r\n    # matrix multiplication of input and hidden layer\r\n    l1 = sigmoid(np.dot(l0, synapse_0))\r\n    # output layer\r\n    l2 = sigmoid(np.dot(l1, synapse_1))\r\n    return l2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb864558926990-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb864558926990-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-4\"><span class=\"crayon-p\"># compute sigmoid nonlinearity</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-8\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-9\"><span class=\"crayon-p\"># convert output of sigmoid function to its derivative</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">output*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-13\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-20\"><span class=\"crayon-p\"># return bag of words array: 0 or 1 for each word in the bag that exists in the sentence</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-21\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># bag of words</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-31\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"found in bag: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-32\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-34\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-35\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sentence:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"n bow:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># input layer is our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># matrix multiplication of input and hidden layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb864558926990-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb864558926990-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>现在我们对神经网络训练函数进行编码，创造连接权重。别太激动，这主要是矩阵乘法——来自中学数学课堂。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\"><img class=\"alignnone size-medium wp-image-64665 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\" alt=\"2017-06-03_151025\"></a></p>\n<p>我们现在准备去构建我们的神经网络<em>模型</em>，我们将连接权重保存为json文件。</p>\n<p>你应该尝试不同的“α”（梯度下降参数），看看它是如何影响错误率。此参数有助于错误调整，并找到最低错误率：</p>\n<p>synapse_0 += <strong>alpha</strong> * synapse_0_weight_update</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\"><img class=\"alignnone size-full wp-image-112156\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\" alt=\"1-HZ-YQpdBM4hDbh4Q5FcsMA\"></a></p>\n<p>我们在隐藏层使用了20个神经元，你可以很容易地调整。这些参数将随着于您的训练数据规模的不同而不同，将错误率调整到低于10 ^ – 3是比较合理的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb869514874281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = np.array(training)\r\ny = np.array(output)\r\n\r\nstart_time = time.time()\r\n\r\ntrain(X, y, hidden_neurons=20, alpha=0.1, epochs=100000, dropout=False, dropout_percent=0.2)\r\n\r\nelapsed_time = time.time() - start_time\r\nprint (\"processing time:\", elapsed_time, \"seconds\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb869514874281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb869514874281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb869514874281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb869514874281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb869514874281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb869514874281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb869514874281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb869514874281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb869514874281-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb869514874281-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb869514874281-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb869514874281-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb869514874281-4\"><span class=\"crayon-v\">start_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb869514874281-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb869514874281-6\"><span class=\"crayon-e\">train</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden_neurons</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epochs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout_percent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb869514874281-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb869514874281-8\"><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_time</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb869514874281-9\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"processing time:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"seconds\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb86f603926971\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nTraining with 20 neurons, alpha:0.1, dropout:False \r\nInput matrix: 12x26    Output matrix: 1x3\r\ndelta after 10000 iterations:0.0062613597435\r\ndelta after 20000 iterations:0.00428296074919\r\ndelta after 30000 iterations:0.00343930779307\r\ndelta after 40000 iterations:0.00294648034566\r\ndelta after 50000 iterations:0.00261467859609\r\ndelta after 60000 iterations:0.00237219554105\r\ndelta after 70000 iterations:0.00218521899378\r\ndelta after 80000 iterations:0.00203547284581\r\ndelta after 90000 iterations:0.00191211022401\r\ndelta after 100000 iterations:0.00180823798397\r\nsaved synapses to: synapses.json\r\nprocessing time: 6.501226902008057 seconds</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb86f603926971-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb86f603926971-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-1\"><span class=\"crayon-e\">Training </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">neurons</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-2\"><span class=\"crayon-e\">Input </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12x26</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Output </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1x3</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-3\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.0062613597435</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-4\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00428296074919</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-5\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00343930779307</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-6\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00294648034566</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-7\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00261467859609</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-8\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00237219554105</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-9\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">70000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00218521899378</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-10\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00203547284581</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-11\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00191211022401</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-12\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00180823798397</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb86f603926971-13\"><span class=\"crayon-e\">saved </span><span class=\"crayon-e\">synapses </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb86f603926971-14\"><span class=\"crayon-e\">processing </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.501226902008057</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seconds</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>synapse.json文件中包含了全部的连接权重，<strong>这就是我们的模型</strong>。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\"><img class=\"alignnone size-full wp-image-112157\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\" alt=\"1-qYkCgPE3DD26VD-qDwsicA\"></a></p>\n<p>一旦连接权重已经计算完成，对于分类来说只需要classify()函数了：大约15行代码</p>\n<p>备注：如果训练集有变化，我们的模型需要重新计算。对于非常大的数据集，这需要较长的时间。</p>\n<p>现在我们可以生成一个句子属于一个或者多个分类的概率了。它的速度非常快，这是因为我们之前定义的think()函数中的点积运算。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb873361813186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# probability threshold\r\nERROR_THRESHOLD = 0.2\r\n# load our calculated synapse values\r\nsynapse_file = 'synapses.json' \r\nwith open(synapse_file) as data_file: \r\n    synapse = json.load(data_file) \r\n    synapse_0 = np.asarray(synapse['synapse0']) \r\n    synapse_1 = np.asarray(synapse['synapse1'])\r\n\r\ndef classify(sentence, show_details=False):\r\n    results = think(sentence, show_details)\r\n\r\n    results = [[i,r] for i,r in enumerate(results) if r&gt;ERROR_THRESHOLD ] \r\n    results.sort(key=lambda x: x[1], reverse=True) \r\n    return_results =[[classes[r[0]],r[1]] for r in results]\r\n    print (\"%s n classification: %s\" % (sentence, return_results))\r\n    return return_results\r\n\r\nclassify(\"sudo make me a sandwich\")\r\nclassify(\"how are you today?\")\r\nclassify(\"talk to you tomorrow\")\r\nclassify(\"who are you?\")\r\nclassify(\"make me some lunch\")\r\nclassify(\"how was your lunch today?\")\r\nprint()\r\nclassify(\"good day\", show_details=True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb873361813186-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb873361813186-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-1\"><span class=\"crayon-p\"># probability threshold</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-2\"><span class=\"crayon-v\">ERROR_THRESHOLD</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.2</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-3\"><span class=\"crayon-p\"># load our calculated synapse values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-4\"><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'synapses.json'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-5\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data_file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse0'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse1'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">ERROR</span><span class=\"crayon-sy\">_</span>THRESHOLD<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s n classification: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">return_results</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-18\"> </div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-19\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sudo make me a sandwich\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-20\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how are you today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-21\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"talk to you tomorrow\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-22\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"who are you?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-23\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"make me some lunch\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-24\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how was your lunch today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb873361813186-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb873361813186-26\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb877659431210\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;strong&gt;sudo make me a sandwich &lt;/strong&gt;\r\n [['sandwich', 0.99917711814437993]]\r\n&lt;strong&gt;how are you today? &lt;/strong&gt;\r\n [['greeting', 0.99864563257858363]]\r\n&lt;strong&gt;talk to you tomorrow &lt;/strong&gt;\r\n [['goodbye', 0.95647479275905511]]\r\n&lt;strong&gt;who are you? &lt;/strong&gt;\r\n [['greeting', 0.8964283843977312]]\r\n&lt;strong&gt;make me some lunch&lt;/strong&gt; \r\n [['sandwich', 0.95371924052636048]]\r\n&lt;strong&gt;how was your lunch today? &lt;/strong&gt;\r\n [['greeting', 0.99120883810944971], ['sandwich', 0.31626066870883057]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb877659431210-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb877659431210-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">me</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sandwich</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99917711814437993</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99864563257858363</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">talk </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">tomorrow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95647479275905511</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">who </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">you</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8964283843977312</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">some </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95371924052636048</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb877659431210-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">lunch </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb877659431210-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99120883810944971</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.31626066870883057</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>你可以用其它语句、不同概率来试验几次，也可以添加训练数据来改进／扩展当前的模型。尤其注意用很少的训练数据就得到稳定的预测结果。</p>\n<p>有一些句子将会产生多个预测结果（高于阈值）。你需要给你的程序设定一个合适的阈值。并非所有的文本分类方案都是相同的：<em>一些预测情况比其他预测需要更高的置信水平</em>。</p>\n<p>最后这个分类结果展示了一些内部的细节：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb87e277250278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: good\r\nfound in bag: day\r\nsentence: **good day** \r\n bow: [0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\ngood day \r\n [['greeting', 0.99664077655648697]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb87e277250278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb87e277250278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb87e277250278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb87e277250278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb87e277250278-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb87e277250278-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb87e277250278-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">good</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb87e277250278-2\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">day</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb87e277250278-3\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">good </span><span class=\"crayon-e \">day*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb87e277250278-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb87e277250278-5\"><span class=\"crayon-e\">good </span><span class=\"crayon-i\">day</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb87e277250278-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99664077655648697</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>从这个句子的词包中可以看到，有两个单词和我们的词库是匹配的。同时我们的神经网络从这些 0 代表的非匹配词语中学习了。</p>\n<p>如果提供一个仅仅有一个常用单词 ‘a’ 被匹配的句子，那我们会得到一个低概率的分类结果A：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add827bb882597537864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: a\r\nsentence: **a burrito! **\r\n bow: [0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\na burrito! \r\n [['sandwich', 0.61776860634647834]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add827bb882597537864-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb882597537864-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb882597537864-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add827bb882597537864-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add827bb882597537864-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add827bb882597537864-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb882597537864-2\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59add827bb882597537864-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add827bb882597537864-4\"><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59add827bb882597537864-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.61776860634647834</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>现在你已经掌握了构建聊天机器人的一些基础知识结构，它能处理大量不同的意图，并且对于有限或者海量的训练数据都能很好的适配。想要为某个意图添加一个或者多个响应实在轻而易举，就不必多讲了。</p>\n<h4>Enjoy!</h4>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/9d1537dc33c0a291a88e68a8d61b1cd2.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ac2801b765615f93574f10b0ac15990b.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112049\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112049votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112049\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">Anne90</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ee02ba031bee9222a2878fe9565d65a6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件开发测试工程师，关注互联网/软件测试相关        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2106382253\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2106382253/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2106382253\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,机器学习", "front_image_path": "full/dc3f3abe02d5786d6d2caa044b15d4e14cafdcfa.jpg"}
{"url_object_id": "6cbfecaa4a696000b1d800f677cb3f43", "title": "CoreOS，一款 Linux 容器发行版", "create_time": "2017/08/14", "url": "http://blog.jobbole.com/112189/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/linode-cube/the-what-why-and-wow-behind-the-coreos-container-linux-fa7ceae5593c\">Steven J. Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8768-1.html\">Linux中国/toyijiu</a>   </div><blockquote><p>CoreOS，一款最新的 Linux 发行版本，支持自动升级内核软件，提供各集群间配置的完全控制。</p></blockquote>\n<p>关于使用哪个版本的 Linux 服务器系统的争论，常常是以这样的话题开始的：</p>\n<blockquote><p>你是喜欢基于 <a href=\"https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux\">Red Hat Enterprise Linux （RHEL）</a> 的 <a href=\"https://www.centos.org/\">CentOS</a> 或者 <a href=\"https://getfedora.org/\">Fedora</a>，还是基于 <a href=\"https://www.debian.org/\">Debian</a> 的 <a href=\"https://www.ubuntu.com/\">Ubuntu</a>，抑或 <a href=\"https://www.suse.com/\">SUSE</a> 呢？</p></blockquote>\n<p>但是现在，一款名叫 <a href=\"https://coreos.com/os/docs/latest\">CoreOS 容器 Linux</a> 的 Linux 发行版加入了这场“圣战”。<a href=\"https://www.linode.com/docs/platform/use-coreos-container-linux-on-linode\">这个最近在 Linode 服务器上提供的 CoreOS</a>，和它的老前辈比起来，它使用了完全不同的实现方法。</p>\n<p>你可能会感到不解，这里有这么多成熟的 Linux 发行版本，为什么要选择用 CoreOS ？借用 Linux 主干分支的维护者，也是 CoreOS 顾问的 Greg Kroah-Hartman 先生的一句话：</p>\n<blockquote><p>CoreOS 可以控制发行版的升级（基于 ChromeOS 代码），并结合了 Docker 和潜在的核对/修复功能，这意味着不用停止或者重启你的相关进程，就可以<a href=\"https://plus.google.com/+gregkroahhartman/posts/YvWFmPa9kVf\">在线升级</a>。测试版本已经支持此功能，这是史无前例的。</p></blockquote>\n<p>当 Greg Kroah-Hartman 做出这段评价时，CoreOS 还处于 α 测试阶段，当时也许就是在硅谷的一个车库当中，<a href=\"https://www.wired.com/2013/08/coreos-the-new-linux/\">开发团队正在紧锣密鼓地开发此产品</a>，但 CoreOS 不像最开始的苹果或者惠普，其在过去的四年当中一直稳步发展。</p>\n<p>当我参加在旧金山举办的 <a href=\"https://coreos.com/fest/\">2017 CoreOS 大会</a>时，CoreOS 已经支持谷歌云、IBM、AWS 和微软的相关服务。现在有超过 1000 位开发人员参与到这个项目中，并为能够成为这个伟大产品的一员而感到高兴。</p>\n<p>究其原因，CoreOS 从开始就是为容器而设计的轻量级 Linux 发行版，其起初是作为一个 <a href=\"https://www.docker.com/\">Docker</a> 平台，随着时间的推移， CoreOS 在容器方面走出了自己的道路，除了 Docker 之外，它也支持它自己的容器 <a href=\"https://coreos.com/rkt\">rkt</a> （读作 rocket ）。</p>\n<p>不像大多数其他的 Linux 发行版，CoreOS 没有包管理器，取而代之的是通过 Google ChromeOS 的页面自动进行软件升级，这样能提高在集群上运行的机器/容器的安全性和可靠性。不用通过系统管理员的干涉，操作系统升级组件和安全补丁可以定期推送到 CoreOS 容器。</p>\n<p>你可以通过 <a href=\"https://coreos.com/products/coreupdate/\">CoreUpdate 和它的 Web 界面</a>上来修改推送周期，这样你就可以控制你的机器何时更新，以及更新以多快的速度滚动分发到你的集群上。</p>\n<p>CoreOS 通过一种叫做 <a href=\"https://github.com/coreos/etcd\">etcd</a> 的分布式配置服务来进行升级，etcd 是一种基于 <a href=\"http://yaml.org/\">YAML</a> 的开源的分布式哈希存储系统，它可以为 Linux 集群容器提供配置共享和服务发现等功能。</p>\n<p>此服务运行在集群上的每一台服务器上，当其中一台服务器需要下线升级时，它会发起领袖选举，以便服务器更新时整个Linux 系统和容器化的应用可以继续运行。</p>\n<p>对于集群管理，CoreOS 之前采用的是 <a href=\"https://github.com/coreos/fleet\">fleet</a> 方法，这将 etcd 和 <a href=\"https://www.freedesktop.org/wiki/Software/systemd/\">systemd</a> 结合到分布式初始化系统中。虽然 fleet 仍然在使用，但 CoreOS 已经将 etcd 加入到 <a href=\"https://kubernetes.io/\">Kubernetes</a> 容器编排系统构成了一个更加强有力的管理工具。</p>\n<p>CoreOS 也可以让你定制其它的操作系统相关规范，比如用 <a href=\"https://coreos.com/os/docs/latest/cloud-config.html\">cloud-config</a> 的方式管理网络配置、用户账号和 systemd 单元等。</p>\n<p>综上所述，CoreOS 可以不断地自行升级到最新版本，能让你获得从单独系统到集群等各种场景的完全控制。如 CoreOS 宣称的，你再也不用为了改变一个单独的配置而在每一台机器上运行 <a href=\"https://insights.hpe.com/articles/what-is-chef-a-primer-for-devops-newbies-1704.html\">Chef</a> 了。</p>\n<p>假如说你想进一步的扩展你的 DevOps 控制，<a href=\"https://blogs.dxc.technology/2017/06/08/coreos-moves-in-on-cloud-devops-with-kubernetes/\">CoreOS 能够轻松地帮助你部署 Kubernetes</a>。</p>\n<p>CoreOS 从一开始就是构建来易于部署、管理和运行容器的。当然，其它的 Linux　发行版，比如 RedHat 家族的<a href=\"http://www.projectatomic.io/\">原子项目</a>也可以达到类似的效果，但是对于那些发行版而言是以附加组件的方式出现的，而 CoreOS 从它诞生的第一天就是为容器而设计的。</p>\n<p>当前<a href=\"http://www.zdnet.com/article/what-is-docker-and-why-is-it-so-darn-popular/\">容器和 Docker 已经逐渐成为商业系统的主流</a>，如果在可预见的未来中你要在工作中使用容器，你应该考虑下 CoreOS，不管你的系统是在裸机硬件上、虚拟机还是云上。</p>\n<p>如果有任何关于 CoreOS 的观点或者问题，还请在评论栏中留言。如果你觉得这篇博客还算有用的话，还请分享一下~</p>\n<hr>\n<p>关于博主：Steven J. Vaughan-Nichols 是一位经验丰富的 IT 记者，许多网站中都刊登有他的文章，包括 <a href=\"http://www.zdnet.com/meet-the-team/us/steven-j-vaughan-nichols/\">ZDNet.com</a>、<a href=\"http://www.pcmag.com/author-bio/steven-j.-vaughan-nichols\">PC Magazine</a>、<a href=\"http://www.infoworld.com/author/Steven-J.-Vaughan_Nichols/\">InfoWorld</a>、<a href=\"http://www.computerworld.com/author/Steven-J.-Vaughan_Nichols/\">ComputerWorld</a>、<a href=\"http://www.linuxtoday.com/author/Steven+J.+Vaughan-Nichols/\">Linux Today</a> 和 <a href=\"http://www.eweek.com/cp/bio/Steven-J.-Vaughan-Nichols/\">eWEEK</a> 等。他拥有丰富的 IT 知识 – 而且他曾参加过智力竞赛节目 Jeopardy ！他的相关观点都是自身思考的结果，并不代表 Linode 公司，我们对他做出的贡献致以最真诚的感谢。如果想知道他更多的信息，可以关注他的 Twitter <a href=\"http://www.twitter.com/sjvn\"><em>@sjvn</em></a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112189\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112189votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112189\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux,容器", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "0b8ff310585249119a5b31d70bda767d", "title": "cp 命令两个高效的用法", "create_time": "2017/08/12", "url": "http://blog.jobbole.com/112170/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png"], "praise_num": "1", "comment_num": 0, "fav_num": 9, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/two-great-uses-cp-command\">Chris Hermansen</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8766-1.html\">bigdimple</a>   </div><blockquote><p>Linux 中高效的备份拷贝命令</p></blockquote>\n<p>在 Linux 上能使用鼠标点来点去的图形化界面是一件很美妙的事……但是如果你喜欢的开发交互环境和编译器是终端窗口、Bash 和 Vim，那你应该像我一样经常和终端打交道。</p>\n<p>即使是不经常使用终端的人，如果对终端环境深入了解也能获益良多。举个例子—— <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令，据 <a href=\"https://en.wikipedia.org/wiki/Cp_(Unix)\">维基百科</a> 的解释，<span style=\"color: #ff0000\"><strong>cp</strong></span> （意即 copy）命令是第一个版本的 <a href=\"https://en.wikipedia.org/wiki/Unix\">Unix</a> 系统的一部分。连同一组其它的命令 <span style=\"color: #ff0000\"><strong>ls</strong></span>、<span style=\"color: #ff0000\"><strong>mv</strong>、<strong>cd</strong>、<strong>pwd</strong>、<strong>mkdir</strong>、<strong>vi</strong>、<strong>sh</strong>、<strong>sed</strong></span> 和<span style=\"color: #ff0000\"> <strong>awk</strong></span> ，还有提到的<span style=\"color: #ff0000\"> <strong>cp</strong> </span>都是我在 1984 年接触 System V Unix 系统时所学习的命令之一。<span style=\"color: #ff0000\"><strong>cp</strong></span> 命令最常见的用法是制作文件副本。像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce73336091343\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp sourcefile destfile</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce73336091343-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce73336091343-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-e\">sourcefile </span><span class=\"crayon-v\">destfile</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在终端中执行此命令，上述命令将名为 <span style=\"color: #ff0000\"><strong>sourcefile</strong></span> 的文件复制到名为<span style=\"color: #ff0000\"> <strong>destfile</strong></span> 的文件中。如果在执行命令之前 <span style=\"color: #ff0000\"><strong>destfile</strong></span> 文件不存在，那将会创建此文件，如果已经存在，那就会覆盖此文件。</p>\n<p>这个命令我不知道自己用了多少次了（我也不想知道），但是我知道在我编写测试代码的时候，我经常用，为了保留当前正常的版本，而且又能继续修改，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce84730092147\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test1.bak</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce84730092147-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce84730092147-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bak</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在过去的30多年里，我使用了无数次这个命令。另外，当我决定编写我的第二个版本的测试程序时，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce8c175151613\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test2.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce8c175151613-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce8c175151613-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这样就完成了修改程序的第一步。</p>\n<p>我通常很少查看 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令的参考文档，但是当我在备份我的图片文件夹的时候（在 GUI 环境下使用 “file” 应用），我开始思考“在 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令中是否有个参数支持只复制新文件或者是修改过的文件。”果然，真的有！</p>\n<h1 id=\"toc_1\">高效用法 1：更新你的文件夹</h1>\n<p>比如说在我的电脑上有一个存放各种文件的文件夹，另外我要不时的往里面添加一些新文件，而且我会不时地修改一些文件，例如我手机里下载的照片或者是音乐。</p>\n<p>假设我收集的这些文件对我而言都很有价值，我有时候会想做个拷贝，就像是“快照”一样将文件保存在其它媒体。当然目前有很多程序都支持备份，但是我想更为精确的将目录结构复制到可移动设备中，方便于我经常使用这些离线设备或者连接到其它电脑上。</p>\n<p><span style=\"color: #ff0000\"><strong>cp</strong></span> 命令提供了一个易如反掌的方法。例子如下：</p>\n<p>在我的 <span style=\"color: #ff0000\"><strong>Pictures</strong></span> 文件夹下，我有这样一个文件夹名字为 <span style=\"color: #ff0000\"><strong>Misc</strong></span>。为了方便说明，我把文件拷贝到 USB 存储设备上。让我们开始吧！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce93836196448\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r Misc /media/clh/4388-D5FE\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce93836196448-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cce93836196448-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce93836196448-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cce93836196448-2\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>上面的命令是我从按照终端窗口中完整复制下来的。对于有些人来说不是很适应这种环境，在我们输入命令或者执行命令之前，需要注意的是 <span style=\"color: #ff0000\"><strong>me@mydesktop:~/Pictures</strong></span> 这个前缀，<span style=\"color: #ff0000\"><strong>me</strong></span> 这个是当前用户，<span style=\"color: #ff0000\"><strong>mydesktop</strong></span> 这是电脑名称，<span style=\"color: #ff0000\"><strong>~/Pictures</strong></span> 这个是当前工作目录，是 <span style=\"color: #ff0000\"><strong>/home/me/Pictures</strong></span> 完整路径的缩写。</p>\n<p>我输入这个命令 <span style=\"color: #ff0000\"><strong>cp -r Misc /media/clh/4388-D5FE</strong></span> 并执行后 ，拷贝<span style=\"color: #ff0000\"> <strong>Misc</strong></span> 目录下所有文件（这个 <span style=\"color: #ff0000\"><strong>-r</strong></span> 参数，全称 “recursive”，递归处理，意思为本目录下所有文件及子目录一起处理）到我的 USB 设备的挂载目录<span style=\"color: #ff0000\"> <strong>/media/clh/4388-D5FE</strong></span>。</p>\n<p>执行命令后回到之前的提示，大多数命令继承了 Unix 的特性，在命令执行后，如果没有任何异常什么都不显示，在任务结束之前不会显示像 “execution succeeded” 这样的提示消息。如果想获取更多的反馈，就使用 <span style=\"color: #ff0000\"><strong>-v</strong></span> 参数让执行结果更详细。</p>\n<p>下图中是我的 USB 设备中刚刚拷贝过来的文件夹 <span style=\"color: #ff0000\"><strong>Misc</strong></span> ，里面总共有 9 张图片。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\"><img class=\"aligncenter wp-image-112174 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"232\" height=\"197\"></a></p>\n<p>假设我要在原始拷贝路径下 <span style=\"color: #ff0000\"><strong>~/Pictures/Misc</strong></span> 下添加一些新文件，就像这样：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\"><img class=\"aligncenter wp-image-112172 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"272\" height=\"333\"></a></p>\n<p>现在我想只拷贝新的文件到我的存储设备上，我就使用 <span style=\"color: #ff0000\"><strong>cp</strong> </span>的“更新”和“详细”选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce9b763390002\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r -u -v Misc /media/clh/4388-D5FE\r\n'Misc/asunder.png' -&gt; '/media/clh/4388-D5FE/Misc/asunder.png'\r\n'Misc/editing tags guayadeque.png' -&gt; '/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'\r\n'Misc/misc on usb.png' -&gt; '/media/clh/4388-D5FE/Misc/misc on usb.png'\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce9b763390002-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cce9b763390002-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc503cce9b763390002-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cce9b763390002-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adc503cce9b763390002-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce9b763390002-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cce9b763390002-2\"><span class=\"crayon-s\">'Misc/asunder.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/asunder.png'</span></div><div class=\"crayon-line\" id=\"crayon-59adc503cce9b763390002-3\"><span class=\"crayon-s\">'Misc/editing tags guayadeque.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cce9b763390002-4\"><span class=\"crayon-s\">'Misc/misc on usb.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/misc on usb.png'</span></div><div class=\"crayon-line\" id=\"crayon-59adc503cce9b763390002-5\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>上面的第一行中是<span style=\"color: #ff0000\"> <strong>cp</strong></span> 命令和具体的参数（<span style=\"color: #ff0000\"><strong>-r</strong></span> 是“递归”， <span style=\"color: #ff0000\"><strong>-u</strong></span> 是“更新”，<span style=\"color: #ff0000\"><strong>-v</strong></span> 是“详细”）。接下来的三行显示被复制文件的信息，最后一行显示命令行提示符。</p>\n<p>通常来说，参数 <span style=\"color: #ff0000\"><strong>-r</strong></span> 也可用更详细的风格 <span style=\"color: #ff0000\"><strong>–recursive</strong></span>。但是以简短的方式，也可以这么连用 <span style=\"color: #ff0000\"><strong>-ruv</strong></span>。</p>\n<h1 id=\"toc_2\">高效用法 2：版本备份</h1>\n<p>回到一开始的例子中，我在开发的时候定期给我的代码版本进行备份。然后我找到了另一种更好用的 <span style=\"color: #ff0000\"><strong>cp</strong></span> 参数。</p>\n<p>假设我正在编写一个非常有用的 Python 程序，作为一个喜欢不断修改代码的开发者，我会在一开始编写一个程序简单版本，然后不停的往里面添加各种功能直到它能成功的运行起来。比方说我的第一个版本就是用 Python 程序打印出 “hello world”。这只有一行代码的程序就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cce9f034800659\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cce9f034800659-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cce9f034800659-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后我将这个代码保存成文件命名为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span>。我可以这么运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503ccea5761175817\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Test$ python test1.py\r\nhello world\r\nme@desktop:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503ccea5761175817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503ccea5761175817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc503ccea5761175817-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503ccea5761175817-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503ccea5761175817-2\"><span class=\"crayon-e\">hello </span><span class=\"crayon-e\">world</span></div><div class=\"crayon-line\" id=\"crayon-59adc503ccea5761175817-3\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在程序可以运行了，我想在添加新的内容之前进行备份。我决定使用带编号的备份选项，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503ccea9509264888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py &amp;nbsp;test1.py.~1~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503ccea9509264888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503ccea9509264888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc503ccea9509264888-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503ccea9509264888-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503ccea9509264888-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503ccea9509264888-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59adc503ccea9509264888-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">nbsp</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503ccea9509264888-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>所以，上面的做法是什么意思呢？</p>\n<p>第一，这个<span style=\"color: #ff0000\"> <strong>–backup=numbered</strong></span> 参数意思为“我要做个备份，而且是带编号的连续备份”。所以一个备份就是 1 号，第二个就是 2 号，等等。</p>\n<p>第二，如果源文件和目标文件名字是一样的。通常我们使用 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令去拷贝成自己，会得到这样的报错信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cceac526002814\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp: 'test1.py' and 'test1.py' are the same file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cceac526002814-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cceac526002814-1\"><span class=\"crayon-v\">cp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">same </span><span class=\"crayon-v\">file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在特殊情况下，如果我们想备份的源文件和目标文件名字相同，我们使用<span style=\"color: #ff0000\"> <strong>–force</strong></span> 参数。</p>\n<p>第三，我使用 <span style=\"color: #ff0000\"><strong>ls</strong> </span>（意即 “list”）命令来显示现在目录下的文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的是原始文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py.~1~</strong></span> 的是备份文件</p>\n<p>假如现在我要加上第二个功能，在程序里加上另一行代码，可以打印 “Kilroy was here.”。现在程序文件 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cceaf312788734\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'\r\nprint 'Kilroy was here'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cceaf312788734-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cceaf312788734-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cceaf312788734-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cceaf312788734-2\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Kilroy was here'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>看到 Python 编程多么简单了吗？不管怎样，如果我再次执行备份的步骤，结果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cceb2237502205\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py test1.py.~1~ test1.py.~2~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cceb2237502205-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cceb2237502205-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adc503cceb2237502205-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adc503cceb2237502205-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cceb2237502205-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cceb2237502205-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59adc503cceb2237502205-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adc503cceb2237502205-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>现在我有有两个备份文件：<span style=\"color: #ff0000\"> <strong>test1.py.~1~</strong></span> 包含了一行代码的程序，和<span style=\"color: #ff0000\"> <strong>test1.py.~2~</strong></span> 包含两行代码的程序。</p>\n<p>这个很好用的功能，我考虑做个 shell 函数让它变得更简单。</p>\n<h1 id=\"toc_3\">最后总结</h1>\n<p>第一，Linux 手册页，它在大多数桌面和服务器发行版都默认安装了，它提供了更为详细的使用方法和例子，对于 <span style=\"color: #ff0000\"><strong>cp</strong> </span>命令，在终端中输入如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adc503cceb6406745799\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman cp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adc503cceb6406745799-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adc503cceb6406745799-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-v\">cp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于那些想学习如何使用这些命令，但不清楚如何使用的用户应该首先看一下这些说明，然后我建议创建一个测试目录和文件来尝试使用命令和选项。</p>\n<p>第二，兴趣是最好的老师。在你最喜欢的搜索引擎中搜索 “linux shell tutorial”，你会获得很多有趣和有用的资源。</p>\n<p>第三，你是不是在想，“为什么我要用这么麻烦的方法，图形化界面中有相同的功能，只用点击几下岂不是更简单？”，关于这个问题我有两个理由。首先，在我们工作中需要中断其他工作流程以及大量使用点击动作时，点击动作可就不简单了。其次，如果我们要完成流水线般的重复性工作，通过使用 shell 脚本和 shell 函数以及 shell 重命名等功能就能很轻松的实现。</p>\n<p>你还知道关于 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令其他更棒的使用方式吗？请在留言中积极回复哦～</p>\n<hr>\n<p><strong>作者简介：</strong></p>\n<p>Chris Hermansen – 1978 年毕业于英国哥伦比亚大学后一直从事计算机相关职业，我从 2005 年开始一直使用 Linux、Solaris、SunOS，在那之前我就是 Unix 系统管理员了，在技术方面，我的大量的职业生涯都是在做数据分析，尤其是空间数据分析，我有大量的编程经验与数据分析经验，熟练使用 awk、Python、PostgreSQL、PostGIS 和 Groovy。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112170\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112170votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112170\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,命令行", "front_image_path": "full/7b24293fbe6045a1275fe33c8ba3bdde76732dbb.jpg"}
{"url_object_id": "85bd8601e0edbec62fafb940f1ad7501", "title": "6 个理由，为什么 GNOME 仍然是最好的 Linux 桌面环境", "create_time": "2017/08/16", "url": "http://blog.jobbole.com/112167/", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg"], "praise_num": "1", "comment_num": 1, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/8/reasons-i-come-back-gnome\">Jay LaCroix</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1510722\">开源中国</a>   </div><p>摘要: 一位资深 Linux 用户告诉你为什么 GNOME 仍然是最好的 Linux 桌面环境</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg\" width=\"690\" height=\"372\"></p>\n<blockquote><p>关于本文作者 Jay LaCroix</p>\n<p>Jay LaCroix 是来自密歇根州的技术专家，专注于 Linux 和开源软件。自 2002 年使用 Linux 以来，Jay 一直是它的“死忠粉”。他目前是云计算系统工程师和自由的咨询顾问，乐于教授他人使用 Linux，以充分利用这个优秀的系统。在空闲时间，Jay 会撰写图书，他是 Linux Mint Essentials, Mastering Linux Network Administration 这些书的作者，最近他成为了 Ubuntu Server 的会员。</p></blockquote>\n<p>我使用 Linux 大概已经有 15 年的时间了，在这期间一直都在尝试使用各种桌面环境。在我职业生涯的大部分时间里，我一直是一个坚定的 KDE Plasma 用户（从 2.x 版开始使用），一直坚持使用 Plasma 至 4.x 系列的大部分版本，最终由于稳定性问题，选择了迁移到其他的桌面环境。此后，我尝试过使用 Xfce, MATE, Openbox 等桌面环境。但自从我选择投入 <a href=\"https://www.gnome.org/gnome-3/\" target=\"_blank\" rel=\"nofollow\">GNOME 3</a> 的怀抱后，我就再没有离开过它了。GNOME 是一个稳定且反应灵敏的桌面环境，它使得我可以专注于自己的工作而尽可能少地受到干扰。</p>\n<p>下面说一下我彻底沉醉于 GNOME 3 Shell 的六个原因。</p>\n<h3 id=\"h2_0\">1. 智能且稳定</h3>\n<p>自从切换到 GNOME 3 以来，我并没有遇到过任何稳定性方面的问题。我已经在三台 System76 机器和两台戴尔 Latitude 笔记本电脑上运行 GNOME 3 了，而且它在每台机器上的表现都十分优秀。总之，在 GNOME 上的体验不能更好了 —— 它十分稳定并且永远不会崩溃，这是十分重要的。</p>\n<p>虽然我使用 GNOME 3 的体验一直都很稳定，但在使用测试的 beta 版时，仍然会遇到一些崩溃的场景。当出现这些通常由错误的 beta 版驱动引起的崩溃时（而不是 GNOME 本身），GNOME 3 的恢复功能仍能允许我从锁定中恢复。如果 shell 已经停止响应，我所要做的是按下 ALT+F2，然后按下 R 和 Enter 来重新启动会话，而这不会丢失正在运行的应用程序。事实上，即使强制重新启动 GNOME Shell，它不仅会把应用程序带回来，还会把它们放回到重新启动之前的同一个显示器/工作区上。</p>\n<p>上面的案例只是想告诉大家 GNOME 是如此的智能和稳定 —— 使用它的期间，我确实没遇到过崩溃的场景。而且 GNOME 内置的恢复功能，使得我可以重启整个会话而不用担心丢失正在运行的作业。</p>\n<h3 id=\"h2_1\">2. 不影响我的使用体验</h3>\n<p>我听过对于 GNOME 3 的一个抱怨是它的桌面组件太大，并且在显示器上占用了太多的空间。但我认为，相比其他的桌面环境，GNOME 3 拥有一个更干净的界面。它的大多数桌面组件都包含在 Activities 的概览中，屏幕顶部只有一个非常窄的面板，让桌面的其余部分用于任何正在进行的工作。GNOME 2.x 和 MATE 的默认布局都有两个面板，因此占用了两倍的空间。虽然可以像 MATE 一样自定义环境来使用单个面板。但 GNOME 3.x 不使用旧的两个面板的布局，为应用程序留出了更多的空间。</p>\n<p>由于 GNOME 的大部分桌面组件都包含在 Activities 概览中，所以它永远不会影响我的使用。如果我想更加专注于某些东西，我可以在使用 GNOME 的终端时按下 F11，使其占满整个屏幕。如果我想再次访问 GNOME 界面，我只需按下 <a href=\"https://help.gnome.org/users/gnome-help/stable/keyboard-key-super.html.en\" target=\"_blank\" rel=\"nofollow\">Super</a> 键。在我尝试过的所有桌面环境中（事实上我已经尝试过所有的桌面环境），GNOME 更能提高我的生产力，并且给我的显示屏留下更多的空间这个特性对我来说真的十分重要。</p>\n<h3>3. 显示器的切换能保持正常工作</h3>\n<p>多年以来，我都是使用一个带有扩展坞的笔记本电脑连接到双显示器，这是使用 Linux 唯一的最令人沮丧的地方。我也数不清丢失作业的次数了，因为我的笔记本电脑使用扩展坞与显示器进行连接时会出现死机的情况，或 Xorg Server 崩溃。我几乎习惯了 Linux 上混乱的扩展坞使用体验，直到切换至 GNOEM 3。</p>\n<p>到目前为止，GNOME 3 是我使用过的唯一一个对扩展坞是完全可靠的桌面环境。当我卸下扩展坞时，GNOME 会切换回笔记本电脑，并将所有在两个显示器上运行的应用程序移至单个的内置显示器上，GNOME 不仅可以在不锁定的情况下处理扩展坞，还可以在锁定前十分智能地将应用程序重新移动至启动的显示器上。对我而言，这是十分完美的 —— 没有死机或崩溃。因为我使用扩展坞，所以 GNOME 似乎是我最好的选择。</p>\n<h3 id=\"h2_3\">4. 大量的扩展</h3>\n<p>有人说 GNOME 3 的默认界面是十分有限的，你不能做太多的工作来进行定制。但是默认的设置已经可以很好地为我服务了，不能说 GNOME 不可以定制。它的界面可以通过扩展进行自定义，允许你按照自己的喜欢的方式调整桌面环境。这些扩展可以显示当前的天气状况，在 NetworkManager 的无线网络列表中添加一个刷新图标，插入新菜单，以及更多的其他事情。可通过 <a href=\"https://extensions.gnome.org/\" target=\"_blank\" rel=\"nofollow\">extensions.gnome.org</a> 获取扩展，也可以通过 <a href=\"https://git.gnome.org/browse/gnome-tweak-tool/\" target=\"_blank\" rel=\"nofollow\">GNOME Tweak</a> 工具来管理他们。</p>\n<p>但扩展既是天使也是魔鬼，因为不同的扩展有不同的程度的稳定性和质量。<a href=\"https://opensource.com/article/17/2/top-gnome-shell-extensions\" target=\"_blank\" rel=\"nofollow\">最好的扩展</a>能帮助你完成一些通常不能完成的事情，而糟糕的扩展可能会拖慢桌面环境的运行速度或导致其崩溃。我的建议是适量地使用扩展（质量比数量重要），因为太多的扩展可能会导致稳定性问题或混论的桌面环境。平均来说，我尽量不会安装超过三个以上的扩展。因为我发现大多数扩展只是稍微增强了使用的体验，并不是必需品。我个人最喜欢的三个扩展是 OpenWeather, TopIcons Plus, 和 Workspace Indicator。虽然 Dash to Dock 可能是最受欢迎的扩展，但我不使用它，因为 GNOME 3 默认的体验已经足够满足我的使用需求。</p>\n<p>虽然扩展可以使得体验更好，但在大多数情况下，我并不是真的需要它们。GNOME 3 的默认布局不仅适合我的需要，而且我安装的任何扩展只是增强了体验，但不是我完成工作所必需的。</p>\n<h3 id=\"h2_4\">5. 动态的工作区</h3>\n<p>动态的工作区(workspaces)是使我离不开 GNOME 3 的功能之一。它的概念十分简单，你可以从单个工作区开始，然后会根据需要自动添加更多的工作区。你可以通过按下 Super 键轻松查看在工作区上运行的所有应用程序。看起来这并没解决什么大的问题，但如果你是那种在将一个又一个的窗口叠加在一起的人，你可以使用此功能轻松查看正在运行的内容，并关闭未使用的应用程序。按住 Ctrl+Alt 键并同时按向上或向下的箭头可以在活动的工作区之间切换。当在工作区上打开应用时，会自动创建一个新的空白工作区以便开始使用。当关闭工作区中的所有应用程序时，它们也将被删除。</p>\n<p>这似乎与我们一直以来管理运行的应用程序的方式有很大的区别，但如果你尝试过之后，你可能会喜欢这种方式。我通常在每个工作区中运行一个应用程序，因为我发现使用 Ctrl+Alt+上/下箭头来进行切换比单击面板中的应用程序要快得多，而且效率更高。如果我需要在工作区中运行多个应用程序，我会将它们贴在显示器的左右边缘。</p>\n<p>关于 GNOME 3 处理工作区的方式的另一件事是，如果有多个显示器连接到计算机，默认情况下只有一个显示器启用了工作区。这意味着当我切换工作区时，只有左侧的显示器在它们之间循环，右侧的显示器则保持静止。这允许我在右边的显示器打开一个终端窗口，当我想检查我的消息时，我可以切换工作区以使用我的电子邮件客户端，而不会错过终端中发生的情况。</p>\n<h3 id=\"h2_5\">6. 自定义主题</h3>\n<p>老实说，GNOME 3 的默认主题不是我用过的桌面环境中最好看的（当然也不是最差的）。它的简洁性很好，但对于像我这种喜欢主题并修饰主题的人，可以自定义视觉效果以适应我的口味是十分重要的。</p>\n<p>幸运的是，在 GNOME 中安装主题十分容易。要安装新的主题，只需下载主题（<a href=\"https://www.opendesktop.org/s/Gnome\" target=\"_blank\" rel=\"nofollow\">gnome-look.org</a> 是一个不错的下载源），并将下载的文件解压到主目录的 <strong>.themes </strong>目录中。通过使用 GNOME Tweak 工具，可以在安装的主题之间进行循环。它允许你更改应用程序的外观以及 GNOME Shell 本身。</p>\n<p>最近还没有太多可用的 GNOME 3 主题，Arc 和 Numix 主题几乎占据了所有的焦点。这些主题当然是很好的，但有更多的选择就更好了。幸运的是，自从 Ubuntu 宣布将 GNOME 切换为默认的桌面环境之后，主题社区似乎正在加班工作，现在出现了更多的主题。我个人最喜欢的主题是 Vimix Dark，你的是什么？</p>\n<p>虽然我通常会尝试其他的桌面环境以与桌面 Linux 的发展同步，但我最后总会回归到 GNOME。GNOME 3.x 可能不适用于每个人，但我建议可以给它一次尝试的机会。GNOME 处理某些问题的方式初次看起来可能很奇怪，但它是一个很好的桌面环境，与其他我使用过的任何图形用户界面相比，它使得我更高效地完成我的工作。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112167\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112167votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112167\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,GNOME,Linux", "front_image_path": "full/92195357d24493250ceca135476203662d9775e6.jpg"}
{"url_object_id": "594e76e00f6ec905e2cdae3003e50c75", "title": "你的时间值多少钱？", "create_time": "2017/08/08", "url": "http://blog.jobbole.com/112127/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1ficm10dakhj20m80ciq37.jpg"], "praise_num": "3", "comment_num": 2, "fav_num": 7, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx879560138\">碎美</a> 翻译，<a href=\"http://www.jobbole.com/members/randomli\">欣仔</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://jamesclear.com/value-of-time\">James Clear</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：本文介绍了几种估算你每小时值多少钱的方法，方便你判断值不值得花时间做某事，比如：值得为了省 $95 的机票而花 5 小时转机 2 次么？值得花 2 小时与某人吃顿饭？值得花半小时回某封邮件么？</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1ficm10dakhj20m80ciq37.jpg\"></p>\n<p>并非所有对时间的利用都是均等的，而且这个简单的道理可以让生活大为不同。明白怎样充分利用自己的时间，始于了解到（准确地说是）你的时间价值多少。本文讲述如何系统计算你时间的价值。</p>\n<p>把时间花在更有利可图的事上的人，能赚更多的钱。把时间投注在他人身上的人，能建立良好的人际关系。把时间花在创建灵活的事业上的人，能享受更多自由。把时间花在具有高影响力的项目上的人，能为社会带来更多贡献。不论你想要更多财富，更多友谊，更多自由，还是更多影响力，问题都会回归到你如何支配自己的时间。</p>\n<p>如果你和我一样，你可能会想要上面提到的东西（友谊，自由，影响力），也许还有其他（健康）。但是，你不可能同时拥有所有东西，所以你需要明白日常生活中如何有效地权衡这些问题。本文告诉你如何计算时间的价值，以及如何利用这些信息来更有效地利用时间。</p>\n<h2>时间的价值：一小时值多少？</h2>\n<p>在动笔写这篇文章的几周前，我正想买一个小的旅行包。搜索了半天，我找到一个我喜欢并且只要 19 美元的包，价格很实惠。问题在于：这包是一个英国公司产的，寄到美国要收 45 美元运费。</p>\n<p>我立即打消了花 45 美元运费拿到一个 19 美元的包的念头，所以我开始搜索零售店的位置。这家公司在纽约市有一间店，而我恰好打算几周后去一趟纽约。我找到了店址，发现假如我旅途中特地去一下这间店，要花一小时。</p>\n<p>那时我脑海中出现了促使我写这篇文章的问题：“我的一小时值 45 美元吗？”</p>\n<p>我应该节省时间，花 45 美元，让他们把包直接寄给我，还是应该省下钱，花一小时自己去店里买？我完全不知道去店里买或者额外花运费，哪一种是对于时间和钱更好的利用。</p>\n<h2>时间 VS 金钱的两难</h2>\n<p>我们或多或少都对自己时间的价值有个内在判断。比如说，如果有人提供你每小时 0.07 美元薪水的工作，你肯定会立刻回绝。但如果有人愿意付你每小时 7000 美元，你会立刻接受这份工作。</p>\n<p>在这个范围的两端，你很容易判断一件事是否值得花费时间去做。但当你向时间-价值比的中间档滑动，某一任务是否值得花费时间就变得不那么明朗。问题就在此：生活的多数时间，我们都处在时间-价值比的灰色区域。</p>\n<p>例如：</p>\n<ul>\n<li>    应当购买直飞航班，节省两小时，还是选择有一次经停的航班，节省 90 美元？</li>\n<li>    要不要花 20 美元请邻居的小孩帮忙除草，以享用周末额外的一小时？</li>\n<li>    这一周，应当服务一个会立刻付你 2000 美元的客户，还是挖掘一个能在明年产生 20000 美元利润的商业构想？</li>\n</ul>\n<p>每一天我们都会做出类似的选择，但大多数人都是依直觉或猜测行事，而不去计算他们时间的实际价值。每个人都有一个每小时（时间）价值，但很少有人能确切地告诉你这个数字是多少。在此之前，我也不例外。</p>\n<h2>如何计算你的时间的实际价值</h2>\n<p>这个时间 vs 金钱的难题促使我询问了各种我能接触的这个话题上的专家。我和企业家、生产力顾问、企业教练甚至是职业扑克玩家都聊过怎样计算时间价值，以及怎样利用这一点来更好地做决策。</p>\n<p>然后，我记录了三个月中，每一小时我都做了什么，并用六种不同的方法计算了一小时的价值。别担心，我已经把这些研究和实验精简成了一个相对简单的过程，接下来就讲。</p>\n<p>本文剩余内容分为两部分。</p>\n<ul>\n<li><strong>第一部分快捷易懂，基本涵盖了大部分人需要的东西。</strong>在 15 分钟内，第一部分能帮助你建立一份合理的评估，你能通过这份对你时间价值的评估做出更明智的决策。我推荐所有人都读一下第一部分。</li>\n<li><strong>第二部分要花费一些时间，但也值得一看。</strong>企业家和管理者会发现第二部分尤其有用。第二部分建立在第一部分的基础上，能帮你评估不同时间用途的期望价值，以便你做出更好的战略决策，获得长期回报。</li>\n</ul>\n<p>在我们开始第一部分之前，我想先分享一个免费的表格，里面有关于本文中所有计算公式的例子。你可以将你的数据填入表格，它会算出你的时间价值。余下的内容中，我会经常提及这个表格。</p>\n<blockquote><p>时间价值表，下载链接：<a href=\"https://docs.google.com/spreadsheets/d/1xJm9BIpuf0Cu4P01YJQ_PNam7fds31KaDXgwxJaJWxc/edit?usp=sharing\">Google Docs</a>、百度网盘：<a href=\"https://pan.baidu.com/s/1i5ta2SP\" target=\"_blank\">https://pan.baidu.com/s/1i5ta2SP</a></p></blockquote>\n<h2><span style=\"color: #ff0000;\">第一部分：实际收入法</span></h2>\n<p>我们先讲讲怎样用实际收入法来计算你的时间价值。这些计算主要基于你实际得到（或实现）的收入，所以叫实际收入法。此法可以帮你优化日常花费的决策（例如上述的例子，花 45 美元网购或开车去店里）。</p>\n<p>首先，你需要两个数字：</p>\n<ul>\n<li>    你花了多少时间赚钱。</li>\n<li>    利用这些时间你赚了多少钱。</li>\n</ul>\n<p>我们来聊聊怎样估算这两项数据，以及怎样快速用这两个数据得出一个对你时间价值的估计。</p>\n<h3>第 1 步：如何追踪你的时间</h3>\n<p>第一步是估算你投资了多少时间在赚钱上，而不是你有多少小时在工作岗位上。举例来说，假如每天你有一小时在路途中，另有八小时在工作，那么实际上你每天花费了九小时在赚钱上。同样，你也应该算上你搞副业或者送孩子去日托中心的时间。我们将用这些数字来全面地了解一年中你花在赚钱上的总时间。</p>\n<p>不止你一个人会觉得估算时间有点困难。大部分人对于自己一天 24 小时做了什么只有一种模糊的意识。如果你不确定你花了多少时间工作，我推荐用一年 2500 小时作为起点。理由：假设你一天花了 10 小时工作、通勤或者做工作相关的事。一周工作五天，那就是每周 50 小时。再假设你每年工作 50 周（两周休假），那就是每年 2500 小时。你可以根据自己的实际情况调整，不过对于大多数全职员工或企业家来说，我觉得 2500 小时是一个基本准确的估计。</p>\n<h3>追踪时间：我是如何做的</h3>\n<p>我是个网络创业者，多数时间我都在电脑上工作。当我开始估算时间时，我安装了一个叫 <a href=\"https://www.rescuetime.com/\">RescueTime</a> 的软件。它能准确记录我在每件事上花费的时间：用了多久看每个网站、用每个软件、浏览社交媒体等等。</p>\n<p>在我完成三个月的收集后，我还整合了从其他应用中得到的数字，以完善我的估算。比如说，我算出了在 <a href=\"https://www.amazon.com/gp/product/B00NB86OYE/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00NB86OYE&amp;linkCode=as2&amp;tag=jamesclear-20&amp;linkId=IEHSPLRV25VARHV7\">Audible</a> 上面听有声书的时间，就得到了我花费在“读书”上的时间。</p>\n<p>利用从 RescueTime 获得的数字，加上几个合理的推算，我得出我每年工作 2742 小时的结论。</p>\n<p>RecueTime 是分类记录事件的，所以我还能分别了解我在写作、阅读、网站设计、市场营销等事上分别花了多少时间。这么细的分类其实不是很必要，不过在本文的第二部分中能派上用场。目前，你只需要对你每年花在赚钱上的总时间有一个合理的估计就好了。</p>\n<h3>第 2 步：如何记录你赚了多少钱</h3>\n<p>第二步你需要知道利用工作时间你赚了多少钱。</p>\n<p>这项非常简单。如果你是个小时工或赚薪水的职员，看看你最新的工资支票，乘上每年获取的支票数即可。如果你今年的薪水变化不大，还可以看看去年退了多少税。你还要加上从副业和自由工作中得到的钱，因为花在这些事情上的时间在第一步中已经包含在内了。</p>\n<p>我们现在计算的是你的税后收入，即扣除税款后得到的钱。对于多数职员来说，税款在工资支票中就已经扣除了，所以你的税后收入就是付给你的钱。如果你是个企业主，那你就需要从总收入中扣掉税款和其他业务支出。</p>\n<h3>追踪收入：我是如何做的</h3>\n<p>我用了一个叫 <a href=\"https://bench.co/?fbuy_ref_code=bnbQH\">Bench Accounting</a> 的服务来记录我生意的收入和开支。Bench 是一个在线的记账服务，可以自动从我的企业账户自动提取数据，然后会计就会将所有东西整理在一个算好税的财务报表中。点击几下，我就能看到在上个月、上个季度或者上一年中我赚了多少钱。</p>\n<p>如果你和我一样是一个小企业主，自由职业者或企业家，我推荐你使用全年的收入来做计算，因为小公司的月收入可能会波动（有时是激烈波动）。查看一段更长时期的收入可以消除这些差异，让你对时间价值有个更实际的估算。</p>\n<h3>第 3 步：计算你的时间价值</h3>\n<p>最后一步，用你的总收入（得自第二步）除以你总共花费的时间（得自第一步）即可。</p>\n<p>举例说明，假设你每年花了 2500 小时来赚钱：</p>\n<ul>\n<li>如果你的收入是 12316 美元/年，你的时间价值 4.93 美元/小时。这是 2014 年全美个人收入的贫困线。</li>\n<li>如果你的收入是 46226 美元/年，你的时间价值 18.49 美元/小时。这是 2014 年全美女性收入的中位数。</li>\n<li>如果你的收入是 62455 美元/年，你的时间价值 24.98 美元/小时。这是 2014 年全美男性收入的中位数。</li>\n<li>如果你的收入是 10 万美元/年，你的时间价值 40 美元/小时。</li>\n<li>如果你的收入是 100 万美元/年，你的时间价值 400 美元/小时。</li>\n</ul>\n<p>当然啦，这些都是假设你每年花费了 2500 小时在工作上。计算结果会随着不同的工作时间而改变。</p>\n<h3>这些数字精确吗？</h3>\n<p>当我第一次做这个计算的时候我很惊讶。我一小时的价值比我想象的低得多。</p>\n<p>想想有多少自由职业者每小时收费40美元，一年赚不到 10 万美元。或者想想多少顾问每小时收费 400 美元，一年却赚不到 100 万美元。怎么会这样呢？答案是，他们只是在部分工作时间获得 40 或 400 美元一小时的薪酬，而非所有的时间。当我们用他们的总收入除以总工作时间时，每小时的价值比他们每小时向顾客收的费用低得多。</p>\n<p>此外，虽然我们知道自己每小时收多少佣金，但我们很少会计算除了工作时间外还有多少时间也是花费在赚钱上。搞清楚到底多少时间投资在赚钱上，我们就对自己时间的实际价值有一个更清楚的认识——通常这个数字比你每小时收的佣金低得多。</p>\n<p>呐，如果你和我一样，你可能会想核实一下计算的准确度。有几种快速检查你计算的小时价值是否准确的方法。我们现在来看一下。</p>\n<h3>支票和余额</h3>\n<p>我们刚刚用的计算方法是税后实得法，因为它是根据你的税后收入算的。还有另外两种实际收入方法，可以用来和税后实得法对照。下面我会简单地介绍一下这两种方法，不过最简单的学习方法是参照时间价值表的步骤3.</p>\n<h3>市场价格法</h3>\n<p>市场价格法是第一种检查的方法。这个方法用的是一个估价，即假设你接受了另一个公司的一个你能胜任的职位，所预期能挣到的钱。举例来说，我花很多时间在写作上，所以我可以胜任一个“内容创造者”的职位。我还花时间来扩展业务，所以我也可能胜任一个业务拓展的职位。我查了一下我可能胜任的每个职位的薪水，按照我在每种工作上投入的时间进行划分，就得到了对于我时间价值的另一种估算。你可以把这种方法想成在就业市场上你的时间的价值。</p>\n<h3>基于成本的方法</h3>\n<p>基于成本的方法是另一种核实方法。这个方法用的是一个估价，即你会付多少钱来让另一个人做你的工作。换句话说，想象你是老板，需要雇人代替你工作。我先是把我的工作分成了具体的任务（写作，市场营销等等），然后估算了花费在每项任务上的时间。然后，我代入了我会付别人全职做这项工作的薪水。之后，我计算了所有任务放在一起的加权平均数，得出了我愿意支付给别人做我每天做的工作的价格。最后，我用这个价格除以总的工作小时数。</p>\n<p>我用这三种方法算出了三个数值，得到了我的时间价值的平均值。我料到我可能会用一种方法得到高一些的结果，而用另一种得到低一些的结果，但是当我们用三种方法来取平均值，得到的时间价值可能更精确一些。重申一次，在时间价值表中，你可以看到每一种方法。</p>\n<h3>怎样利用这项信息</h3>\n<p>我们已经完成了第一部分。有了上面的计算结果，我们对你的时间价值有了一个快捷准确的估计。现在，我们可以缩小不确定的范围，做出更好的决策。</p>\n<p>例如：</p>\n<ul>\n<li>    如果你的时间值 25 美元一小时，那就不该排半小时队来领取 10 美元的礼品卡。</li>\n<li>    如果你的时间值 60 美元一小时，那你就应该花 49 美元网购而不是花一小时去店里。</li>\n<li>    如果你的时间值 80 美元一小时，那你就应该买直飞航班，而不是花两小时等待转机，只为节省 150 美元。</li>\n</ul>\n<p>当你精确地知道你的一小时到底值多少钱时，你每天都可以做出更好的决策。</p>\n<p>至此，我们知道你的时间<u>至少</u>值你刚刚算出来的那么多，因为实际收入法只能计算你已经获得的收入。准备好来看看你的时间是否值更多了吗？我们来看第二部分。</p>\n<h2><span style=\"color: #ff0000;\">第二部分：期望值法</span></h2>\n<p>现在来看第二种方法：期望值法。这种计算法基于你对于一小时的工作在长远来看能创造的价值的期望。</p>\n<p>期望值法可以帮助你在重大的、战略性的决策中决定要把时间花在哪里。你的公司今年应该专注于哪个项目？哪些事务没什么效率，应当从你的日常工作中取消？你应该开创一项十年后会获得巨大成功，但不能即刻为你带来收入的事业，还是找一份有可靠收入的稳定工作？管理这些权衡的最佳方法是什么？</p>\n<p>让我们从最简单的期望值法开始吧。</p>\n<h3>增长倍数法</h3>\n<p>有一种简单的方法，可以解释你的决策带来的期望收入。将你前几年的净收入乘以一个合理的增长倍数。</p>\n<p>关键当然在于选择一个合适的增长倍数。举个例子，我的生意从去年到今年翻了一番，所以我选择 2× 作为我的增长倍数。用这种方法实际上相当于说，“你今年的行动会持续推动下一年的增长，所以你的时间的真实价值其实是高于你现在的实际收入。”</p>\n<p>增长倍数法能让你简单估算今天的工作在长远看来能获得多少回报，但它并不能告诉你如何更高效地利用你的时间。要获知这一点，我们需要使用完整的期望值法。</p>\n<h3>期望值法</h3>\n<p>期望值法是最终也是最难的计算时间价值的方法。我会努力用最简单的话来解释，但我想最简单的学习方法就是来看时间价值表中的步骤4。</p>\n<p>基本逻辑如下：</p>\n<p>首先按不同工作来分类时间。你越能具体地说出每份时间用来做了什么，你就越能分辨哪些工作驱动了最多利益。</p>\n<p>选择一个可以将每项工作和收入连接在一起的测量单位。对于大部分企业主来说，这意味着你需要知道你的生意中一个“引子”的价值。就我自己来说，我用的是邮件订阅数，因为我知道平均每个新的订阅者能带来的收益，并且我大部分的工作内容都可以关联到获取更多地邮件订阅上。</p>\n<ul>\n<li>估算每项工作的价值。假设我花一小时工作，获得 50 个新的邮件订阅。如果每个订阅者的总价值是 1 美元，那么这项工作的期望价值就是 50 美元一小时。重复估算你的每一项工作的价值。</li>\n<li>把所有期望值加在一起，获得总的期望值。</li>\n<li>如有需要，加上其他变量。期望值法可以像你希望的一样复杂。你可以处理一些因素，像是某项工作可以带给你的生活多少幸福感，或者现在一小时的工作有多少可能性在之后的几年持续给你回报。</li>\n</ul>\n<p>期望值法是高度个性化的，你可能需要多斟酌一番这些公式，来让它们满足你的需求。当然啦，最简单的还是从数字层面看这个方法是怎么用的。你可以在<a href=\"https://docs.google.com/spreadsheets/d/1xJm9BIpuf0Cu4P01YJQ_PNam7fds31KaDXgwxJaJWxc/edit#gid=0\">时间-价值表</a>的步骤4中看到所有加入计算的因子。</p>\n<h2>补充说明</h2>\n<p>其实这些计算的幕后还有很多其他的想法。如下是另外一些我在思考我的时间价值时一直惦记的因素。</p>\n<h3>误入歧途的成功</h3>\n<p>不要把时间浪费于在错误的事情上取得成功。简单地了解你时间的价值是有帮助的，但你仍需明白你想要怎样的生活，以获取最精确的对于时间价值的概念。太多人追逐金钱、权利或认同，因为他们身边的每个人都一样。倘若这不是你真正想要的呢？没错，你可以找到增加时间价值的方法，但如果你宁愿有更多空闲时间而非钞票呢？这就是为什么弄明白你的<a href=\"http://jamesclear.com/core-values\">核心价值观</a>，做<a href=\"http://jamesclear.com/integrity\">诚实报告</a>，弄清楚什么对你来说最重要，都是有用的。</p>\n<h3>权衡和机会加成</h3>\n<p>比尔·盖茨多次被被称为世界上最富有的人。在 2015 年，他以 727 亿美元净资产再次排在首位。根据一个分析师的推算，“有 720 亿美元，6%的回报率大概能让盖茨活着的每秒赚 114.15 美元。一张 100 美元的纸币掉在地上，都不值得他花时间捡起来。”</p>\n<p>虽然有趣又值得引用，但是这个掉在地上的 100 美元钞票不值得盖茨弯腰捡起来的想法是错的。为什么？因为捡起这 100 美元不妨碍盖茨在同时赚 114.16 美元。不管他捡不捡这 100 美元，他总归在赚钱。实际上，捡起这 100 美元，在那一秒他就赚了 214.16 美元，而不是常规的 114.16 美元。</p>\n<p>捡起 100 美元并不需要比尔·盖茨付出停止赚钱的代价。这是在他已获得的收入之上的机会加成。机会加成，指的是那种如果你把所有时间花在上面会使你减少时间价值，但如果你在有机会的时候才去做，却会增加时间价值的选择。举例来说，试想那种有时会做演讲的作家。如果他们把所有时间都花在演讲上，会减少他们的时间价值，因为这样一来他们就没法写新书了，这会导致他们逐渐过气，演讲的出场费也会降低。但是，偶尔做一些演讲——比如一月一两次——许多作家就可以在净收入中增加几千美元，并仍能保持足够的时间来写新书。</p>\n<h3>不能商量的空闲时间</h3>\n<p>计算你的时间价值有一个危险之处，即你可能会说服自己多一个“创造价值”的小时，就能增加总的时间价值了。引自<a href=\"https://www.wsj.com/articles/do-you-know-what-your-time-is-really-worth-1437500727\">华尔街日报</a>的一篇文章，“一些研究人员表示，给时间标注经济价值，有损害人们生活质量的风险。那些被怂恿而只专注于时间的金钱价值的人，倾向于变得不耐烦而且压力大，Jeffery Pfeffer，一个斯坦福商学院组织行为学教授说到，这些人工作太多，花太少的时间做一些奖励自己的事，例如参加志愿活动或享受音乐。”</p>\n<p>对我来说，我决定记录我的空闲时间，来看看相较于工作我有多少闲暇，但我不会给空闲时间标注金钱价值。相反，我决定我的空闲时间是不能商量的。空闲时我可以放松减压，让我可以在工作时间保持高效。你应当重视你的空闲时间、停工时间、休闲活动，因为它们能为你的生活提供全面的身心健康。</p>\n<h3>你应当再工作一小时吗?</h3>\n<p>想不想知道你是否应该再工作一小时？如下是我从 <a href=\"http://sebastianmarshall.com/\">Sebastian Marshall</a> 那里学来的一个很好的经验法则：想想你一天中的每个小时。早上 9 点到 10 点，10 点到 11 点，以此类推。平均下来，那一个小时中，你的净收益是正的还是负的？例如如果你工作到比较晚，晚上 9 点到 10 点那一小时的成果平均下来是正向的吗？还是说那一小时的工作出的错比完成的内容多？那一小时是拖延还是高产？如果这一小时总的来说是负产出，那你就该停止工作了。努力做一个项目是好的，但如果接下来下一小时的工作会让你筋疲力尽，而非创造价值，那么在此之前就该停下来。</p>\n<h3>幸福和意义</h3>\n<p>如果你想的话，你可以将一项工作带给你的幸福或意义之类的因素也加入考虑。不过，我没有把这些变量放入我的计算公式中，而是对于每项工作，将这些因素进行了基于实现程度的1到10的排序。虽然这些排序没有放入任何公式中，但是当几项工作的期望值很接近时，这些排序就可以作为决胜属性。</p>\n<h3>下一步去哪儿</h3>\n<p>计算时间的真实价值实际上比听上去难得多，也比看上去有用得多。</p>\n<p>你的时间价值可能每年都有变化，甚至变化得更快。本文中我列出的这些方法都很灵活，可以修改。如果你在某件事上花费了更多时间，或者有了更多的收入，仅需将新的数字代入表格中，就能得到新的结果。</p>\n<p>我希望本文分享的策略，随着时间的推移，还会一直对你有所帮助。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112127\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112127votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112127\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138\">碎美</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/14c9242bd4336d2c12ac8ba7e56bd6c8.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            University at Buffalo IE Human Factors PhD program 在读        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx879560138\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx879560138/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"QQ：274121119\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"Facebook主页\" target=\"_blank\" href=\"https://www.facebook.com/profile.php?id=100009659581170&amp;ref=bookmarks\"><i class=\"fa fa-facebook\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "其他,时间", "front_image_path": "full/5a100e2d6c9b049065e2a317a0a393644a168302.jpg"}
{"url_object_id": "20f251db4302493feab2277f2e28cf93", "title": "决策树算法及实现", "create_time": "2017/08/16", "url": "http://blog.jobbole.com/112206/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png"], "praise_num": "2", "comment_num": 0, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/c4d0837e9439\">ZPPenny</a>   </div><p>在计算机科学中，树是一种很重要的数据结构，比如我们最为熟悉的二叉查找树（Binary Search Tree），红黑树（Red-Black Tree）等，通过引入树这种数据结构，我们可以很快地缩小问题规模，实现高效的查找。</p>\n<p>在监督学习中，面对样本中复杂多样的特征，选取什么样的策略可以实现较高的学习效率和较好的分类效果一直是科学家们探索的目标。那么，树这种结构到底可以如何用于机器学习中呢？我们先从一个游戏开始。</p>\n<p>我们应该都玩过或者听过这么一种游戏：游戏中，出题者写下一个明星的名字，其他人需要猜出这个人是谁。当然，如果游戏规则仅此而已的话，几乎是无法猜出来的，因为问题的规模太大了。为了降低游戏的难度，答题者可以向出题者问问题，而出题者必须准确回答是或者否，答题者依据回答提出下一个问题，如果能够在指定次数内确定谜底，即为胜出。加入了问答规则之后，我们是否有可能猜出谜底呢？我们先实验一下，现在我已经写下了一个影视明星的名字，而你和我的问答记录如下：</p>\n<ol>\n<li>是男的吗？Y</li>\n<li>是亚洲人吗？Y</li>\n<li>是中国人吗？N</li>\n<li>是印度人吗？Y</li>\n<li> ……</li>\n</ol>\n<p>虽然只有短短四个问题，但是我们已经把答案的范围大大缩小了，那么接下，第5个问题你应该如何问呢？我相信你应该基本可以锁定答案了，因为我看过的印度电影就那么几部。我们将上面的信息结构化如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\"><img class=\"aligncenter wp-image-112208 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"521\" height=\"257\"></a></p>\n<p>在上面的游戏中，我们针对性的提出问题，每一个问题都可以将我们的答案范围缩小，在提问中和回答者有相同知识背景的前提下，得出答案的难度比我们想象的要小很多。</p>\n<p>回到我们最初的问题中，如何将树结构用于机器学习中？结合上面的图，我们可以看出，在每一个节点，依据问题答案，可以将答案划分为左右两个分支，左分支代表的是Yes，右分支代表的是No，虽然为了简化，我们只画出了其中的一条路径，但是也可以明显看出这是一个树形结构，这便是决策树的原型。</p>\n<h1>1. 决策树算法简介</h1>\n<p>我们面对的样本通常具有很多个特征，正所谓对事物的判断不能只从一个角度，那如何结合不同的特征呢？决策树算法的思想是，先从一个特征入手，就如同我们上面的游戏中一样，既然无法直接分类，那就先根据一个特征进行分类，虽然分类结果达不到理想效果，但是通过这次分类，我们的问题规模变小了，同时分类后的子集相比原来的样本集更加易于分类了。然后针对上一次分类后的样本子集，重复这个过程。在理想的情况下，经过多层的决策分类，我们将得到完全纯净的子集，也就是每一个子集中的样本都属于同一个分类。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\"><img class=\"aligncenter wp-image-112209 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"395\" height=\"376\"></a>比如上图中，平面坐标中的六个点，我们无法通过其x坐标或者y坐标直接就将两类点分开。采用决策树算法思想：我们先依据y坐标将六个点划分为两个子类（如水平线所示），水平线上面的两个点是同一个分类，但是水平线之下的四个点是不纯净的。但是没关系，我们对这四个点进行再次分类，这次我们以x左边分类（见图中的竖线），通过两层分类，我们实现了对样本点的完全分类。这样，我们的决策树的伪代码实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8b4193906158\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif y &gt; a:\r\n    output dot\r\nelse:\r\n    if x &lt; b:\r\n          output cross\r\n    else:\r\n          output dot</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8b4193906158-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8b4193906158-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8b4193906158-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8b4193906158-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8b4193906158-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8b4193906158-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8b4193906158-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8b4193906158-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8b4193906158-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">dot</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8b4193906158-3\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8b4193906158-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8b4193906158-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">cross</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8b4193906158-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8b4193906158-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">dot</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>由这个分类的过程形成一个树形的判决模型，树的每一个非叶子节点都是一个特征分割点，叶子节点是最终的决策分类。如下图所示：<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\"><img class=\"aligncenter wp-image-112210 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"423\" height=\"298\"></a>将新样本输入决策树进行判决时，就是将样本在决策树上自顶向下，依据决策树的节点规则进行遍历，最终落入的叶子节点就是该样本所属的分类。</p>\n<h1>2 决策树算法流程</h1>\n<p>上面我们介绍决策树算法的思想，可以简单归纳为如下两点：</p>\n<ol>\n<li>每次选择其中一个特征对样本集进行分类</li>\n<li>对分类后的子集递归进行步骤1</li>\n</ol>\n<p>看起来是不是也太简单了呢？实际上每一个步骤我们还有很多考虑的。在第一个步骤中，我们需要考虑的一个最重要的策略是，选取什么样的特征可以实现最好的分类效果，而所谓的分类效果好坏，必然也需要一个评价的指标。在上文中，我们都用纯净来说明分类效果好，那何为纯净呢？直观来说就是集合中样本所属类别比较集中，最理想的是样本都属于同一个分类。样本集的纯度可以用<a href=\"https://en.wikipedia.org/wiki/Entropy_(information_theory)\" target=\"_blank\">熵</a>来进行衡量。</p>\n<p>在信息论中，熵代表了一个系统的混乱程度，熵越大，说明我们的数据集纯度越低，当我们的数据集都是同一个类别的时候，熵为0，熵的计算公式如下：</p>\n<p><a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\" width=\"390\" height=\"56\"></a></p>\n<p>其中，P(xi)表示概率，b在此处取2。比如抛硬币的时候，正面的概率就是1/2，反面的概率也是1/2，那么这个过程的熵为：<a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\" width=\"649\" height=\"59\"></a>可见，由于抛硬币是一个完全随机事件，其结果正面和反面是等概率的，所以具有很高的熵。假如我们观察的是硬币最终飞行的方向，那么硬币最后往下落的概率是1，往天上飞的概率是0，带入上面的公式中，可以得到这个过程的熵为0，所以，熵越小，结果的可预测性就越强。在决策树的生成过程中，我们的目标就是要划分后的子集中其熵最小，这样后续的的迭代中，就更容易对其进行分类。</p>\n<p>既然是递归过程，那么就需要制定递归的停止规则。在两种情况下我们停止进一步对子集进行划分，其一是划分已经达到可以理想效果了，另外一种就是进一步划分收效甚微，不值得再继续了。用专业术语总结终止条件有以下几个：</p>\n<ol>\n<li>子集的熵达到阈值</li>\n<li>子集规模够小</li>\n<li>进一步划分的增益小于阈值</li>\n</ol>\n<p style=\"text-align: left\">其中，条件3中的增益代表的是一次划分对数据纯度的提升效果，也就是划分以后，熵减少越多，说明增益越大，那么这次划分也就越有价值，增益的计算公式如下：<a href=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"><img class=\"aligncenter\" src=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Gain\" width=\"316\" height=\"60\"></a></p>\n<p style=\"text-align: center\">Gain</p>\n<p>上述公式可以理解为：计算这次划分之后两个子集的熵之和相对划分之前的熵减少了多少，需要注意的是，计算子集的熵之和需要乘上各个子集的权重，权重的计算方法是子集的规模占分割前父集的比重，比如划分前熵为e，划分为子集A和B，大小分别为m和n，熵分别为e1和e2，那么增益就是<strong><span style=\"color: #ff0000\"><code>e - m/(m + n) * e1 - n/(m + n) * e2</code>。</span></strong></p>\n<h1>3. 决策树算法实现</h1>\n<p>有了上述概念，我们就可以开始开始决策树的训练了，训练过程分为：</p>\n<ol>\n<li>选取特征，分割样本集</li>\n<li>计算增益，如果增益够大，将分割后的样本集作为决策树的子节点，否则停止分割</li>\n<li>递归执行上两步</li>\n</ol>\n<p>上述步骤是依照ID3的算法思想（依据信息增益进行特征选取和分裂），除此之外还有C4.5以及CART等决策树算法。</p>\n<p>算法框架如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8c4196583973\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionTree(object):\r\n    def fit(self, X, y):\r\n        # 依据输入样本生成决策树\r\n        self.root = self._build_tree(X, y)\r\n\r\n    def _build_tree(self, X, y, current_depth=0):\r\n        #1. 选取最佳分割特征，生成左右节点\r\n        #2. 针对左右节点递归生成子树\r\n      \r\n    def predict_value(self, x, tree=None):\r\n        # 将输入样本传入决策树中，自顶向下进行判定\r\n        # 到达叶子节点即为预测值</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c4196583973-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c4196583973-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 依据输入样本生成决策树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">current_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#1. 选取最佳分割特征，生成左右节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#2. 针对左右节点递归生成子树</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-9\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c4196583973-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 将输入样本传入决策树中，自顶向下进行判定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c4196583973-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 到达叶子节点即为预测值</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>在上述代码中，实现决策树的关键是递归构造子树的过程，为了实现这个过程，我们需要做好三件事：分别是节点的定义，最佳分割特征的选择，递归生成子树。</p>\n<h2>3.1 节点定义</h2>\n<p>决策树的目的是用于分类预测，即各个节点需要选取输入样本的<strong>特征</strong>，进行<strong>规则</strong>判定，最终决定样本归属到哪一棵<strong>子树</strong>，基于这个目的，决策树的每一个节点需要包含以下几个关键信息：</p>\n<ol>\n<li>判决特征：当前节点针对哪一个特征进行判决</li>\n<li>判决规则：对于二类问题，这个规则一般是一个布尔表达式</li>\n<li>左子树：判决为TRUE的样本</li>\n<li>右子树：判决为FALSE的样本</li>\n</ol>\n<p>决策树节点的定义代码如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8c9885509357\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionNode():\r\n    \r\n    def __init__(self, feature_i=None, threshold=None,\r\n                 value=None, true_branch=None, false_branch=None):\r\n        self.feature_i = feature_i  # 用于测试的特征对应的索引\r\n        self.threshold = threshold  # 判断规则：&gt;=threshold为true\r\n        self.value = value  # 如果是叶子节点，用于保存预测结果\r\n        self.true_branch = true_branch  # 左子树\r\n        self.false_branch = false_branch  # 右子树</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c9885509357-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c9885509357-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c9885509357-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c9885509357-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c9885509357-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c9885509357-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c9885509357-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8c9885509357-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8c9885509357-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8c9885509357-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c9885509357-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c9885509357-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c9885509357-4\"><span class=\"crayon-h\">                 </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c9885509357-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 用于测试的特征对应的索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c9885509357-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 判断规则：&gt;=threshold为true</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c9885509357-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 如果是叶子节点，用于保存预测结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8c9885509357-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 左子树</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8c9885509357-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 右子树</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h2>3.2 特征选取</h2>\n<p>特征选取是构造决策树最关键的步骤，其目的是选出能够实现分割结果最纯净的那个特征，其操作流程的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8cc978765473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 遍历样本集中的所有特征，针对每一个特征计算最佳分割点\r\n# 再选取最佳的分割特征\r\nfor feature_i in range(n_features):\r\n    # 遍历集合中某个特征的所有取值\r\n    for threshold in unique_values:\r\n        # 以当前特征值作为阈值进行分割\r\n        Xy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n        # 计算分割后的增益\r\n        gain = gain(y, y1, y2)\r\n        # 记录最佳分割特征，最佳分割阈值\r\n        if gain &gt; largest_gain:\r\n        largest_gain = gain\r\n            best_criteria = {\r\n                \"feature_i\": feature_i, \r\n                \"threshold\": threshold \r\n                }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8cc978765473-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8cc978765473-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-1\"><span class=\"crayon-p\"># 遍历样本集中的所有特征，针对每一个特征计算最佳分割点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-2\"><span class=\"crayon-p\"># 再选取最佳的分割特征</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">feature_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_features</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 遍历集合中某个特征的所有取值</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">threshold </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unique_values</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 计算分割后的增益</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-13\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8cc978765473-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8cc978765473-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h2>3.3 节点分裂</h2>\n<p>节点分裂的时候有两条处理分支，如果增益够大，就分裂为左右子树，如果增益很小，就停止分裂，将这个节点直接作为叶子节点。节点分裂和Gain（分割后增益）的计算可以做一个优化，在上一个步骤中，我们寻找最优分割点的时候其实就可以将最佳分裂子集和Gain计算并保存下来，将上一步中的for循环改写为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8d0721208681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 以当前特征值作为阈值进行分割\r\nXy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n# 计算分割后的熵\r\ngain = gain(y, y1, y2)\r\n# 记录最佳分割特征，最佳分割阈值\r\nif gain &gt; largest_gain:\r\n    largest_gain = gain\r\n        best_criteria = {\r\n        \"feature_i\": feature_i, \r\n        \"threshold\": threshold ,\r\n        }\r\n    best_sets = {\r\n        \"left\": Xy1,\r\n        \"right\": Xy2,\r\n        \"gain\": gain\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d0721208681-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d0721208681-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-1\"><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-2\"><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-3\"><span class=\"crayon-p\"># 计算分割后的熵</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-4\"><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-5\"><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"left\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"right\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d0721208681-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d0721208681-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>为了防止过拟合，需要设置合适的停止条件，比如设置Gain的阈值，如果Gain比较小，就没有必要继续进行分割，所以接下来，我们就可以依据gain来决定分割策略：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8d4789296541\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif best_sets[\"gain\"] &gt; MIN_GAIN:\r\n    # 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树\r\n    # 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树\r\n    ...\r\nelse:\r\n    # 直接将父节点作为叶子节点\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d4789296541-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d4789296541-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d4789296541-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d4789296541-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d4789296541-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8d4789296541-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8d4789296541-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8d4789296541-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MIN_GAIN</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d4789296541-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d4789296541-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d4789296541-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d4789296541-5\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8d4789296541-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 直接将父节点作为叶子节点</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8d4789296541-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>下面，我们结合一组实验数据来学习决策树的训练方法。实验数据来源于<a href=\"http://www.onlamp.com/pub/a/python/2006/02/09/ai_decision_trees.html\" target=\"_blank\">这里</a>，下表中的数据是一组消费调查结果，我们训练决策树的目的，就是构造一个分类算法，使得有新的用户数据时，我们依据训练结果去推断一个用户是否购买这个商品：</p>\n<table>\n<thead>\n<tr>\n<th>AGE</th>\n<th>EDUCATION</th>\n<th>INCOME</th>\n<th>MARITAL STATUS</th>\n<th>PURCHASE?</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18</td>\n<td>high school</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n</tbody>\n</table>\n<p>从表中可以看出，我们一共有20组调查样本，每一组样本包含四个特征，分别是年龄段，学历，收入，婚姻状况，而最后一列是所属分类，在这个问题中就代表是否购买了该产品。</p>\n<p>监督学习就是在每一个样本都有正确答案的前提下，用算法预测结果，然后根据预测情况的好坏，调整算法参数。在决策树中，预测的过程就是依据各个特征划分样本集，评价预测结果的好坏标准是划分结果的纯度。</p>\n<p>为了方便处理，我们对样本数据进行了简化，将年龄特征按照样本的特点，转化为离散的数据，比如小于18对应0，18对应1，18-35对应2，36-55对应3，大于55对应4，以此类推，同样其他的特征也一样最数字化处理，教育水平分别映射为0(hight school)，1(bachelor’s)，2(master’s)，收入映射为0(low)和1(hight), 婚姻状况同样映射为0(single), 1(married)，最终处理后的样本，放到一个numpy矩阵中，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8da158591659\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX_y = np.array(\r\n        [[3, 2, 1, 0, 1],\r\n         [2, 0, 0, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [2, 1, 1, 0, 0],\r\n         [0, 0, 0, 0, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [3, 1, 0, 1, 0],\r\n         [4, 1, 1, 0, 1],\r\n         [3, 2, 0, 1, 0],\r\n         [4, 2, 0, 1, 1],\r\n         [3, 2, 1, 0, 1],\r\n         [4, 2, 1, 0, 1],\r\n         [1, 0, 1, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [3, 0, 0, 0, 1],\r\n         [0, 0, 0, 1, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [4, 0, 1, 1, 1],\r\n         [4, 1, 0, 0, 1],\r\n         [3, 0, 1, 1, 0]]\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8da158591659-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8da158591659-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-1\"><span class=\"crayon-v\">X_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-12\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-16\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-19\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-20\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8da158591659-21\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8da158591659-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p></p>\n<h1>4. 新样本预测</h1>\n<p>依照上面的算法构造决策树，我们将决策树打印出来，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8df040559665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-- Classification Tree --\r\n0 : 4? \r\n   T -&gt; 1\r\n   F -&gt; 3 : 1? \r\n      T -&gt; 0 : 2? \r\n            T -&gt; 0\r\n            F -&gt; 1\r\n      F -&gt; 0 : 3? \r\n            T -&gt; 1\r\n            F -&gt; 0 : 1? \r\n                        T -&gt; 0\r\n                        F -&gt; 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8df040559665-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8df040559665-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Classification </span><span class=\"crayon-v\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-2\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8df040559665-11\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8df040559665-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>其中，冒号前代表选择的分割特征，冒号后面代表判别规则，二者组合起来就是一个决策树的非叶子节点，每个非叶子节点进一步分割为分为True和False分支，对于叶子节点箭头后面表示最终分类，0表示不购买，1表示购买。由于我们的数据做过简化，所以上述结果不太直观，我们将对应的特征以及判断规则翻译一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8e2785600710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n年龄 : 大于55? \r\n   是 -&gt; 购买\r\n   否 -&gt; 收入 : 高? \r\n      是 -&gt; 年龄 : 大于18? \r\n            是 -&gt; 不购买\r\n            否 -&gt; 购买\r\n      否 -&gt; 年龄 : 大于36? \r\n            是 -&gt; 购买\r\n            否 -&gt; 年龄 : 大于等于18? \r\n                        是 -&gt; 不购买\r\n                        否 -&gt; 购买</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e2785600710-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e2785600710-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e2785600710-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e2785600710-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e2785600710-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e2785600710-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-1\">年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">55</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e2785600710-2\"><span class=\"crayon-h\">   </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-3\"><span class=\"crayon-h\">   </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>收入<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>高<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e2785600710-4\"><span class=\"crayon-h\">      </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-5\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e2785600710-6\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-7\"><span class=\"crayon-h\">      </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">36</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e2785600710-8\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-9\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于等于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e2785600710-10\"><span class=\"crayon-h\">                        </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e2785600710-11\"><span class=\"crayon-h\">                        </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>决策树构造完之后，我们就可以用来进行新样本的分类了。决策树的预测过程十分容易理解，只需要将从根节点开始，按照节点定义的规则进行判决，选择对应的子树，并重复这个过程，直到叶子节点即可。决策树的预测功能实现代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf3facc8e6551657837\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict_value(self, x, tree=None):\r\n        # 如果当前节点是叶子节点，直接输出其值\r\n        if tree.value is not None:\r\n            return tree.value\r\n        # 否则将x按照当前节点的规则进行判决\r\n        # 如果判决为true选择左子树，否则选择右子树，\r\n        feature_value = x[tree.feature_i]\r\n        if feature_value &gt;= tree.threshold:\r\n            branch = tree.true_branch\r\n        else:\r\n            branch = tree.false_branch\r\n        # 在选中的子树上递归进行判断\r\n        return self.predict_value(x, branch)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf3facc8e6551657837-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf3facc8e6551657837-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果当前节点是叶子节点，直接输出其值</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 否则将x按照当前节点的规则进行判决</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果判决为true选择左子树，否则选择右子树，</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">true_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf3facc8e6551657837-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 在选中的子树上递归进行判断</span></div><div class=\"crayon-line\" id=\"crayon-59adf3facc8e6551657837-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">branch</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h1>5. 总结</h1>\n<p>决策树是一种简单常用的分类器，通过训练好的决策树可以实现对未知的数据进行高效分类。从我们的例子中也可以看出，决策树模型具有较好的可读性和描述性，有助于辅助人工分析；此外，决策树的分类效率高，一次构建后可以反复使用，而且每一次预测的计算次数不超过决策树的深度。</p>\n<p>当然，决策树也有其缺点。对于连续的特征，比较难以处理，对于多分类问题，计算量和准确率都不理想。此外，在实际应用中，由于其最底层叶子节点是通过父节点中的单一规则生成的，所以通过手动修改样本特征比较容易欺骗分类器，比如在拦击邮件识别系统中，用户可能通过修改某一个关键特征，就可以骗过垃圾邮件识别系统。从实现上来讲，由于树的生成采用的是递归，随着样本规模的增大，计算量以及内存消耗会变得越来越大。</p>\n<p>此外，过拟合也是决策树面临的一个问题，完全训练的决策树(未进行剪纸，未限制Gain的阈值)能够100%准确地预测训练样本，因为其是对训练样本的完全拟合，但是，对与训练样本以外的样本，其预测效果可能会不理想，这就是过拟合。解决决策树的过拟合，除了上文说到的通过设置Gain的阈值作为停止条件之外，通常还需要对决策树进行剪枝，常用的剪枝策略有：</p>\n<ol>\n<li>Pessimistic Error Pruning：悲观错误剪枝</li>\n<li>Minimum Error Pruning：最小误差剪枝</li>\n<li>Cost-Complexity Pruning：代价复杂剪枝</li>\n<li> Error-Based Pruning：基于错误的剪枝，即对每一个节点，都用一组测试数据集进行测试，如果分裂之后，能够降低错误率，再继续分裂为两棵子树，否则直接作为叶子节点。</li>\n<li>Critical Value Pruning：关键值剪枝，这就是上文中提到的设置Gain的阈值作为停止条件。</li>\n</ol>\n<p>我们以最简单的方式展示了ID3决策树的实现方式，如果想要了解不同类型的决策树的差别，可以参考<a href=\"https://www.quora.com/What-are-the-differences-between-ID3-C4-5-and-CART\" target=\"_blank\">这个链接</a>。</p>\n<p>另外，关于各种机器学习算法的实现，强烈推荐参考Github仓库<a href=\"https://github.com/eriklindernoren/ML-From-Scratch.git\" target=\"_blank\">ML-From-Scratch</a>，下载代码之后，通过<strong><span style=\"color: #ff0000\"><code>pip install -r requirements.txt</code></span></strong>安装依赖库即可运行代码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112206\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112206votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112206\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,决策树,算法", "front_image_path": "full/1e981633d3d633f8ac4523b786bb76f0251e8b5e.jpg"}
{"url_object_id": "1e031f3dac72715c8de661ef03cc6ef1", "title": "Linux 包管理基础：apt、yum、dnf 和 pkg", "create_time": "2017/08/20", "url": "http://blog.jobbole.com/112219/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_num": "1", "comment_num": 0, "fav_num": 10, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.digitalocean.com/community/tutorials/package-management-basics-apt-yum-dnf-pkg\">Brennen Bearnes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8782-1.html\">Linux中国/Snapcrafter</a>   </div><h3 id=\"toc_1\">介绍</h3>\n<p>大多数现代的类 Unix 操作系统都提供了一种中心化的机制用来搜索和安装软件。软件通常都是存放在存储库中，并通过包的形式进行分发。处理包的工作被称为包管理。包提供了操作系统的基本组件，以及共享的库、应用程序、服务和文档。</p>\n<p>包管理系统除了安装软件外，它还提供了工具来更新已经安装的包。包存储库有助于确保你的系统中使用的代码是经过审查的，并且软件的安装版本已经得到了开发人员和包维护人员的认可。</p>\n<p>在配置服务器或开发环境时，我们最好了解下包在官方存储库之外的情况。某个发行版的稳定版本中的包有可能已经过时了，尤其是那些新的或者快速迭代的软件。然而，包管理无论对于系统管理员还是开发人员来说都是至关重要的技能，而已打包的软件对于主流 Linux 发行版来说也是一笔巨大的财富。</p>\n<p>本指南旨在快速地介绍下在多种 Linux 发行版中查找、安装和升级软件包的基础知识，并帮助您将这些内容在多个系统之间进行交叉对比。</p>\n<h3 id=\"toc_2\">包管理系统：简要概述</h3>\n<p>大多数包系统都是围绕包文件的集合构建的。包文件通常是一个存档文件，它包含已编译的二进制文件和软件的其他资源，以及安装脚本。包文件同时也包含有价值的元数据，包括它们的依赖项，以及安装和运行它们所需的其他包的列表。</p>\n<p>虽然这些包管理系统的功能和优点大致相同，但打包格式和工具却因平台而异：</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>操作系统</th>\n<th>格式</th>\n<th>工具</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>Ubuntu</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>.rpm</code></td>\n<td><code>yum</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>.rpm</code></td>\n<td><code>dnf</code></td>\n</tr>\n<tr>\n<td>FreeBSD</td>\n<td>Ports, <code>.txz</code></td>\n<td><code>make</code>, <code>pkg</code></td>\n</tr>\n</tbody>\n</table>\n<p>Debian 及其衍生版，如 Ubuntu、Linux Mint 和 Raspbian，它们的包格式是 <code>.deb</code>。APT 这款先进的包管理工具提供了大多数常见的操作命令：搜索存储库、安装软件包及其依赖项，并管理升级。在本地系统中，我们还可以使用 <code>dpkg</code> 程序来安装单个的 <code>deb</code> 文件，APT 命令作为底层 <code>dpkg</code> 的前端，有时也会直接调用它。</p>\n<p>最近发布的 debian 衍生版大多数都包含了 <code>apt</code> 命令，它提供了一个简洁统一的接口，可用于通常由 <code>apt-get</code> 和 <code>apt-cache</code> 命令处理的常见操作。这个命令是可选的，但使用它可以简化一些任务。</p>\n<p>CentOS、Fedora 和其它 Red Hat 家族成员使用 RPM 文件。在 CentOS 中，通过 <code>yum</code> 来与单独的包文件和存储库进行交互。</p>\n<p>在最近的 Fedora 版本中，<code>yum</code> 已经被 <code>dnf</code> 取代，<code>dnf</code> 是它的一个现代化的分支，它保留了大部分 <code>yum</code> 的接口。</p>\n<p>FreeBSD 的二进制包系统由 <code>pkg</code> 命令管理。FreeBSD 还提供了 <code>Ports</code> 集合，这是一个存在于本地的目录结构和工具，它允许用户获取源码后使用 Makefile 直接从源码编译和安装包。</p>\n<h3 id=\"toc_3\">更新包列表</h3>\n<p>大多数系统在本地都会有一个和远程存储库对应的包数据库，在安装或升级包之前最好更新一下这个数据库。另外，<code>yum</code> 和 <code>dnf</code> 在执行一些操作之前也会自动检查更新。当然你可以在任何时候对系统进行更新。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get update</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt update</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum check-update</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf check-update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo portsnap fetch update</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_4\">更新已安装的包</h3>\n<p>在没有包系统的情况下，想确保机器上所有已安装的软件都保持在最新的状态是一个很艰巨的任务。你将不得不跟踪数百个不同包的上游更改和安全警报。虽然包管理器并不能解决升级软件时遇到的所有问题，但它确实使你能够使用一些命令来维护大多数系统组件。</p>\n<p>在 FreeBSD 上，升级已安装的 ports 可能会引入破坏性的改变，有些步骤还需要进行手动配置，所以在通过 <code>portmaster</code> 更新之前最好阅读下 <code>/usr/ports/UPDATING</code> 的内容。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get upgrade</code></td>\n<td>只更新已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get dist-upgrade</code></td>\n<td>可能会增加或删除包以满足新的依赖项</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt upgrade</code></td>\n<td>和 <code>apt-get upgrade</code> 类似</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt full-upgrade</code></td>\n<td>和 <code>apt-get dist-upgrade</code> 类似</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum update</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>less /usr/ports/UPDATING</code></td>\n<td>使用 <code>less</code> 来查看 ports 的更新提示（使用上下光标键滚动，按 q 退出）。</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/ports-mgmt/portmaster &amp;&amp; sudo make install &amp;&amp; sudo portmaster -a</code></td>\n<td>安装 <code>portmaster</code> 然后使用它更新已安装的 ports</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_5\">搜索某个包</h3>\n<p>大多数发行版都提供针对包集合的图形化或菜单驱动的工具，我们可以分类浏览软件，这也是一个发现新软件的好方法。然而，查找包最快和最有效的方法是使用命令行工具进行搜索。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg search search_string</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -f search_string</code></td>\n<td>通过名字进行搜索并返回完整的描述</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -D search_string</code></td>\n<td>搜索描述</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports &amp;&amp; make search name=package</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports &amp;&amp; make search key=search_string</code></td>\n<td>搜索评论、描述和依赖</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_6\">查看某个软件包的信息</h3>\n<p>在安装软件包之前，我们可以通过仔细阅读包的描述来获得很多有用的信息。除了人类可读的文本之外，这些内容通常包括像版本号这样的元数据和包的依赖项列表。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache show package</code></td>\n<td>显示有关包的本地缓存信息</td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt show package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dpkg -s package</code></td>\n<td>显示包的当前安装状态</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum deplist package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf repoquery --requires package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg info package</code></td>\n<td>显示已安装的包的信息</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; cat pkg-descr</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_7\">从存储库安装包</h3>\n<p>知道包名后，通常可以用一个命令来安装它及其依赖。你也可以一次性安装多个包，只需将它们全部列出来即可。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y package</code></td>\n<td>在 <code>apt</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt install package</code></td>\n<td>显示一个彩色的进度条</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install -y package</code></td>\n<td>在 <code>yum</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install -y package</code></td>\n<td>在 <code>dnf</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; sudo make install</code></td>\n<td>从源码构建安装一个 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_8\">从本地文件系统安装一个包</h3>\n<p>对于一个给定的操作系统，有时有些软件官方并没有提供相应的包，那么开发人员或供应商将需要提供包文件的下载。你通常可以通过 web 浏览器检索这些包，或者通过命令行 <code>curl</code> 来检索这些信息。将包下载到目标系统后，我们通常可以通过单个命令来安装它。</p>\n<p>在 Debian 派生的系统上，<code>dpkg</code> 用来处理单个的包文件。如果一个包有未满足的依赖项，那么我们可以使用 <code>gdebi</code> 从官方存储库中检索它们。</p>\n<p>在 CentOS 和 Fedora 系统上，<code>yum</code> 和 <code>dnf</code> 用于安装单个的文件，并且会处理需要的依赖。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo dpkg -i package.deb</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y gdebi &amp;&amp; sudo gdebi package.deb</code></td>\n<td>安装 <code>gdebi</code>，然后使用 <code>gdebi</code> 安装 <code>package.deb</code> 并处理缺失的依赖</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg add package.txz</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg add -f package.txz</code></td>\n<td>即使已经安装的包也会重新安装</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_9\">删除一个或多个已安装的包</h3>\n<p>由于包管理器知道给定的软件包提供了哪些文件，因此如果某个软件不再需要了，它通常可以干净利落地从系统中清除这些文件。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf erase package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/path_to_port &amp;&amp; make deinstall</code></td>\n<td>卸载 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_10\"><code>apt</code> 命令</h3>\n<p>Debian 家族发行版的管理员通常熟悉 <code>apt-get</code> 和 <code>apt-cache</code>。较少为人所知的是简化的 <code>apt</code> 接口，它是专为交互式使用而设计的。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>传统命令</th>\n<th>等价的 <code>apt</code> 命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>apt-get update</code></td>\n<td><code>apt update</code></td>\n</tr>\n<tr>\n<td><code>apt-get dist-upgrade</code></td>\n<td><code>apt full-upgrade</code></td>\n</tr>\n<tr>\n<td><code>apt-cache search string</code></td>\n<td><code>apt search string</code></td>\n</tr>\n<tr>\n<td><code>apt-get install package</code></td>\n<td><code>apt install package</code></td>\n</tr>\n<tr>\n<td><code>apt-get remove package</code></td>\n<td><code>apt remove package</code></td>\n</tr>\n<tr>\n<td><code>apt-get purge package</code></td>\n<td><code>apt purge package</code></td>\n</tr>\n</tbody>\n</table>\n<p>虽然 <code>apt</code> 通常是一个特定操作的快捷方式，但它并不能完全替代传统的工具，它的接口可能会随着版本的不同而发生变化，以提高可用性。如果你在脚本或 shell 管道中使用包管理命令，那么最好还是坚持使用 <code>apt-get</code> 和 <code>apt-cache</code>。</p>\n<h3 id=\"toc_11\">获取帮助</h3>\n<p>除了基于 web 的文档，请记住我们可以通过 shell 从 Unix 手册页（通常称为 man 页面）中获得大多数的命令。比如要阅读某页，可以使用 <code>man</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ade8b1d80f9330705726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman page\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ade8b1d80f9330705726-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ade8b1d80f9330705726-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ade8b1d80f9330705726-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ade8b1d80f9330705726-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在 <code>man</code> 中，你可以用箭头键导航。按 <code>/</code> 搜索页面内的文本，使用 <code>q</code> 退出。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>man apt-get</code></td>\n<td>更新本地包数据库以及与包一起工作</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt-cache</code></td>\n<td>在本地的包数据库中搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man dpkg</code></td>\n<td>和单独的包文件一起工作以及能查询已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt</code></td>\n<td>通过更简洁，用户友好的接口进行最基本的操作</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>man yum</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>man dnf</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>man pkg</code></td>\n<td>和预先编译的二进制包一起工作</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>man ports</code></td>\n<td>和 Ports 集合一起工作</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_12\">结论和进一步的阅读</h3>\n<p>本指南通过对多个系统间进行交叉对比概述了一下包管理系统的基本操作，但只涉及了这个复杂主题的表面。对于特定系统更详细的信息，可以参考以下资源：</p>\n<ul>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/ubuntu-and-debian-package-management-essentials\">这份指南</a> 详细介绍了 Ubuntu 和 Debian 的软件包管理。</li>\n<li>这里有一份 CentOS 官方的指南 <a href=\"https://www.centos.org/docs/5/html/yum/\">使用 yum 管理软件</a></li>\n<li>这里有一个有关 Fedora 的 <code>dnf</code> 的 <a href=\"https://fedoraproject.org/wiki/Dnf\">wifi 页面</a> 以及一份有关 <code>dnf</code> <a href=\"https://dnf.readthedocs.org/en/latest/index.html\">官方的手册</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-manage-packages-on-freebsd-10-1-with-pkg\">这份指南</a> 讲述了如何使用 <code>pkg</code> 在 FreeBSD 上进行包管理</li>\n<li>这本 <a href=\"https://www.freebsd.org/doc/handbook/\">FreeBSD Handbook</a> 有一节讲述了<a href=\"https://www.freebsd.org/doc/handbook/ports-using.html\">如何使用 Ports 集合</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112219\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112219votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112219\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 10 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "5eda13472020b0a94aa6bc350676f012", "title": "如何做有效的Code Review？我有这些建议", "create_time": "2017/08/15", "url": "http://blog.jobbole.com/112050/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/8d67b7db1e9704c55aad01b886ec4c46.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/maifansnet\">maifans</a> 翻译，<a href=\"http://www.jobbole.com/members/hearingdog\">BEASTQ</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://codeahoy.com/2016/04/03/effective-code-reviews/\">codeahoy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>代码评审（Code review）是保证代码质量的一种有效手段，做得好的话，对公司来讲是一笔收益颇高的时间投资。但实践起来往往变成了炫耀编程技能、固执己见、恶言相向、同事关系恶化的事，这该如何是好？</p>\n<p>往往代码评审过程中，评审者（Reviewer）往往会过于关心旁枝末节，而忽视主要问题，也就是所谓的自行车棚效应。在批准价值百亿的核电站的建设提案中，专家们往往会浪费大量时间纠结于厂内自行车棚（bikeshed）的颜色；因为核电站太大、太复杂，“专家们”未必真懂，但总不能不说话啊，那就从无关痛痒的自行车棚挑毛病吧。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2013/02/how-to-code-review.jpg\" width=\"400\" height=\"649\"></p>\n<h3>有效的代码评审</h3>\n<p>代码评审是开发人员编写的代码由另一个人检查以查找缺陷和改进的过程。换句话说，开发人员大部分都是独立编写代码的，当代码完成之后，他们会召集一次评审。</p>\n<p>代码评审是提高软件质量的有效途径。在Google，所有代码都要经过同行评审。引用《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全（第2版）</a>》中的几个例子：</p>\n<blockquote>\n<ul>\n<li>IBM 的 Orbit 项目有 50 万行代码，使用了 11 级的检查。它提前交付，并且只有通常预期错误的百分之一。</li>\n<li>一份对 AT＆T 的一个 200 多人组织的研究报告显示，在引入评审后，生产率提高了14％，缺陷减少了90％。</li>\n<li>喷气推进实验室估计，通过早期发现和修复缺陷，每次评审节省约 25,000 美元。</li>\n</ul>\n</blockquote>\n<p>然而，不少团队在有效的代码评审争论中，失去了原本的效益。在功能失调的团队和组织中，对所有参与者来说它可以迅速变成一个<b>令人不快的经历</b>：</p>\n<ul>\n<li>它成为评审人员来展示技能的平台。他们在别人的代码中指出“错误”，并强加自己没有价值的“意见”。</li>\n<li>在代码完全就绪前，开发人员会非常抗拒别人审查他们的代码 ——可以说这可能是一件好事，但他没有真正理解评审的意义。</li>\n<li>开发人员放弃代码所有权，并开始依赖他人查找问题。</li>\n</ul>\n<p>在这篇文章中，我将讨论团队和组织可以做的一些事情，让代码评审为所有参与者带来愉快的体验。</p>\n<h3>对管理层的建议：营造健康文化</h3>\n<p><strong>有效的代码评审，需要一个重视质量和卓越的健康文化。</strong>如果团队不以提供高质量的产品为信仰，代码评审将不会给您所期望的结果。你需要一个人人参与的积极文化—立足于建设性批评，智者胜。</p>\n<p><strong>除了创造一个健康文化，并允许花时间和资源进行评审，管理者在代码评审中应保持低姿态。</strong>大多数人不想在上司面前暴露自己的秘密，这已是一种文化。代码评审最好由同行进行，管理层不应该询问可以用来评价人的细节<span style=\"font-family: Helvetica, sans-serif;\">。</span>的确有一些管理人员索要检查表和成绩，以便他们可以<span style=\"font-family: Helvetica, sans-serif;\">“</span>衡量<span style=\"font-family: Helvetica, sans-serif;\">”</span>并评价人。</p>\n<p><strong>可能你已经有一个健康的文化（算你幸运）。</strong>这还不够，营造健康的文化取决于许多因素（团队和组织内部）。这是非常具有挑战性的，没有灵丹妙药。没有正确的文化，代码评审不会带来期望的收获，甚至在极端情况下可能会适得其反。</p>\n<h3>对个人的建议：换位思考</h3>\n<p>Karl Wiegers 在他的《Peer Reviews in Software: A Practical Guide》中写道：</p>\n<blockquote><p>产品的作者与评审者之间的互动至关重要。<span style=\"color: #515151;\">作者必须足够信任和尊重评审者才能接受他们的意见。</span> <span style=\"color: #515151;\">同样，评审者必须尊重作者的才华和辛勤工作。评审者应谨慎选择他们用来提出问题的词汇，重点关注他们对产品的观察。说『我没有看到这些变量被初始化</span> <span style=\"color: #515151;\">』可能会引发建设性的反馈</span>， 而『你没有初始化这些变量』可能会让作者非常不爽。</p></blockquote>\n<p>关注代码很容易，但不要忘记，桌子（或计算机）的另一端有一个人。他有主见有<span style=\"font-family: Helvetica, sans-serif;\">“</span>自我<span style=\"font-family: Helvetica, sans-serif;\">”</span>。请记住，解决问题的方式有很多。</p>\n<ul>\n<li><strong>要谦虚。</strong>我既见过非常高效的评审，也见过因为吹毛求疵而非常低效的评审<span style=\"font-family: Helvetica, sans-serif;\">。</span>不要吹毛求疵<span style=\"font-family: Helvetica, sans-serif;\">！！！</span></li>\n<li><strong>确保您有编码标准<span style=\"font-family: Helvetica, sans-serif;\">。</span></strong>编码标准是在组织中共享的人人都认同的一套准则。如果你没有编码标准，那么不要让讨论变成一个比较编码风格的比赛（大括号 <span style=\"font-family: Helvetica, sans-serif;\"><strong><span style=\"color: #ff0000;\">{</span></strong> </span>在同一行还是下一行！）如果你遇到这样的情况，请在编码标准论坛上离线讨论<span style=\"font-family: Helvetica, sans-serif;\">。</span></li>\n<li><strong>学会良好地沟通。</strong>你必须能够清楚地表达想法和理由。</li>\n<li><strong>编程策略是一个仁者见仁智者见智的问题。</strong>评审者和开发人员应该寻求理解彼此的观点，而不应该成为哲学辩论</li>\n</ul>\n<h3>对评审者的建议：谦虚</h3>\n<ul>\n<li><strong>开发者不是冤大头。</strong>评审的目的不是证明谁是更优秀的程序员而是查找缺陷，并确保代码是简单和可维护的。</li>\n<li><strong>问问题。</strong>不要提出可能听起来带指责的要求或言论。例如，不要说：『你没有遵循标准<span style=\"font-family: Helvetica, sans-serif;\">XYZ</span>』。更好的方式是真正寻求理解开发者的观点：『你对标准 <span style=\"font-family: Helvetica, sans-serif;\">XYZ </span>有什么看法，它是否适用于这里？』，这可以引到我的下一个观点。</li>\n<li><strong>避免『你为什么』，『你为什么不』风格的问题。</strong>它会使人对立。 『为什么把它声明为全局变量？』可以更好地表达为『我不明白为什么这里用一个全局变量』。寻找方法来简化代码。代码评审的目标之一是创建<span style=\"font-family: Helvetica, sans-serif;\">“</span>可维护<span style=\"font-family: Helvetica, sans-serif;\">”</span>软件。</li>\n<li><strong>记住要欣赏并感谢对方。</strong>人们经常忘记一句简单的『干得好』或『它看起来很棒』的影响有多大。</li>\n</ul>\n<p>有些事情，如果看起来像排练过的或以讽刺的语气说出来，就不会奏效。像正常对话一样对待代码评审。你正在聆听他人，应该真正寻求理解他们的观点。需要时提供建议和提示。如果代码很棒，不要强迫找一些消极的来说。</p>\n<h3>对开发者的建议：它不是个人的事情</h3>\n<ul>\n<li><strong>不要感情用事。</strong>记住，别人说的不是，是代码中的缺陷或不足，而不是你。</li>\n<li><strong>意识到你和你的代码是捆绑在一起是正常的事情。</strong>如果你为自己的工作感到自豪，那是一个很好的迹象，说明你是一个关心作品的人。</li>\n<li><strong>有适当的自我。</strong><span style=\"font-family: Helvetica, sans-serif;\">足够信任和捍卫自己的观点，但又不至于盲目拒绝对方的好建议和意见</span>。</li>\n<li><strong>人非圣贤孰能无过。</strong>评审者作为第二双眼，可以指出你可能忽略的事情。问题与具体建议一样有价值。</li>\n<li><strong>提问题要有针对性。</strong>『将所有这些类纳入它们自己的软件包中是否更有意义』</li>\n<li><strong>感谢审稿人的时间和他们可能提供的任何反馈。</strong></li>\n</ul>\n<h3>总结</h3>\n<p><span style=\"font-family: Helvetica, sans-serif;\">同行评审是人们互相交流，而无效（ineffectiveness）则源于社会学问题。然而，管理者花费大量时间在操心使用哪些惊艳的工具。</span>工具会有所帮助，但只有工具并不会神奇地带来结果。立足于正确的文化同时<span style=\"font-family: Helvetica, sans-serif;\">…</span>换位思考，以人为本！<span style=\"font-family: Helvetica, sans-serif;\"> :-)</span></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112050\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112050votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112050\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">maifans</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件工程师，关注人工智能，关注医疗器械。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/maifansnet\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/maifansnet/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Code Review", "front_image_path": "full/dfa8fff3b99c7011381e1666d2c2ba0015a7c34f.jpg"}
{"url_object_id": "faa6574efe8657b757ee0f2971764f70", "title": "用 C 语言写一个简单的 Unix Shell（2）", "create_time": "2017/08/08", "url": "http://blog.jobbole.com/112126/", "front_image_url": ["https://indradhanush.github.io/images/shell-part-2/execvp.jpg"], "praise_num": "2", "comment_num": 0, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qdoverture\">效楚</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-2/\">indradhanush.github.io</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><a href=\"http://blog.jobbole.com/111738/\" target=\"_blank\">在第一部分中我们讨论了 <code>fork</code> 系统调用以及它的注意事项</a>。在本文中，我们将研究怎样执行命令。</p>\n<h3>这里将介绍 <code>exec</code> 函数家族。即以下函数：</h3>\n<ul>\n<li><code>execl</code></li>\n<li><code>execv</code></li>\n<li><code>execle</code></li>\n<li><code>execve</code></li>\n<li><code>execlp</code></li>\n<li><code>execvp</code></li>\n</ul>\n<p>为了满足需要，我们将使用 <code>execvp</code>，它的签名看起来像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5576515045435\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint execvp(const char *file, char *const argv[]);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5576515045435-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5576515045435-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>函数名中的 <code>vp</code> 表明：它接受一个文件名，将在系统 $PATH 变量中搜索此文件名，它还接受将要执行的一组参数。</p>\n<p>你可以阅读 <a href=\"https://linux.die.net/man/3/exec\">exec 的 man 页面</a> 以得到其它函数的更多信息。</p>\n<p>让我们看一下以下代码，它执行命令 <code>ls -l -h -a</code>：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-2/execvp.c\">execvp.c</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5580465024334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;unistd.h&gt;\r\n\r\nint main() {\r\n    char *argv[] = {\"ls\", \"-l\", \"-h\", \"-a\", NULL};\r\n    execvp(argv[0], argv);\r\n\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5580465024334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5580465024334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5580465024334-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5580465024334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5580465024334-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5580465024334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5580465024334-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5580465024334-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5580465024334-1\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5580465024334-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb5580465024334-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5580465024334-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-l\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-h\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-a\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5580465024334-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5580465024334-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb5580465024334-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5580465024334-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>关于 <code>execvp</code> 函数，有几点需要注意：</p>\n<ol>\n<li>第一个参数是命令名。</li>\n<li>第二个参数由命令名和传递给命令自身的参数组成。并且它必须以 <code>NULL</code> 结束。</li>\n<li>它将当前进程的映像交换为被执行的命令的映像，后面再展开说明。</li>\n</ol>\n<p>如果你编译并执行上面的代码，你会看到类似于下面的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5584144624638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntotal 32\r\ndrwxr-xr-x  5 dhanush  staff   170B Jun 11 11:32 .\r\ndrwxr-xr-x  4 dhanush  staff   136B Jun 11 11:30 ..\r\n-rwxr-xr-x  1 dhanush  staff   8.7K Jun 11 11:32 a.out\r\ndrwxr-xr-x  3 dhanush  staff   102B Jun 11 11:32 a.out.dSYM\r\n-rw-r--r--  1 dhanush  staff   130B Jun 11 11:32</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5584144624638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5584144624638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5584144624638-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5584144624638-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5584144624638-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5584144624638-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5584144624638-1\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5584144624638-2\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">170B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5584144624638-3\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">136B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5584144624638-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">8.7K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">out</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5584144624638-5\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">102B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dSYM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5584144624638-6\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">130B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>它和你在你的主 shell 中手动执行<code>ls -l -h -a</code>的结果完全相同。</p>\n<p>既然我们能执行命令了，我们需要使用在<a href=\"http://blog.jobbole.com/111738/\">第一部分</a>中学到的<code>fork</code> 系统调用构建有用的东西。事实上我们要做到以下这些：</p>\n<ol>\n<li>当用户输入时接受命令。</li>\n<li>调用 <code>fork</code> 以创建一个子进程。</li>\n<li>在子进程中执行命令，同时父进程等待命令完成。</li>\n<li>回到第一步。</li>\n</ol>\n<p>我们看看下面的函数，它接收一个字符串作为<code>输入</code>。我们使用库函数 <code>strtok</code> 以<code>空格</code>分割该字符串，然后返回一个字符串数组，数组也用 <code>NULL</code>来终结。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5589484934352\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninclude &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n\r\nchar **get_input(char *input) {\r\n    char **command = malloc(8 * sizeof(char *));\r\n    char *separator = \" \";\r\n    char *parsed;\r\n    int index = 0;\r\n\r\n    parsed = strtok(input, separator);\r\n    while (parsed != NULL) {\r\n        command[index] = parsed;\r\n        index++;\r\n\r\n        parsed = strtok(NULL, separator);\r\n    }\r\n\r\n    command[index] = NULL;\r\n    return command;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5589484934352-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5589484934352-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-1\"><span class=\"crayon-v\">include</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">stdlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">h</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-2\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-4\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">separator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">parsed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">separator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-14\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">separator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5589484934352-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5589484934352-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>如果该函数的<code>输入</code>是字符串 <code>\"ls -l -h -a\"</code>，那么函数将会创建这样形式的一个数组：<code>[\"ls\", \"-l\", \"-h\", \"-a\", NULL]</code>，并且返回指向此队列的指针。</p>\n<p>现在，我们在<code>主</code>函数中调用 <code>readline</code> 来读取用户的输入，并将它传给我们刚刚在上面定义的 <code>get_input</code>。一旦输入被解析，我们在子进程中调用 <code>fork</code> 和 <code>execvp</code>。在研究代码以前，看一下下面的图片，先理解 <code>execvp</code> 的含义：</p>\n<p><img class=\"aligncenter\" src=\"https://indradhanush.github.io/images/shell-part-2/execvp.jpg\" alt=\"\"></p>\n<p>当 <code>fork</code> 命令完成后，子进程是父进程的一份精确的拷贝。然而，当我们调用 <code>execvp</code> 时，它将当前程序替换为在参数中传递给它的程序。这意味着，虽然进程的当前文本、数据、堆栈段被替换了，进程 id 仍保持不变，但程序完全被覆盖了。如果调用成功了，那么 <code>execvp</code> 将不会返回，并且子进程中在这之后的任何代码都不会被执行。这里是<code>主</code>函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb558e686594785\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdlib.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;readline/readline.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n\r\nint main() {\r\n    char **command;\r\n    char *input;\r\n    pid_t child_pid;\r\n    int stat_loc;\r\n\r\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n        child_pid = fork();\r\n        if (child_pid == 0) {\r\n            /* Never returns if the call is successful */\r\n            execvp(command[0], command);\r\n            printf(\"This won't be printed if execvp is successuln\");\r\n        } else {\r\n            waitpid(child_pid, &amp;stat_loc, WUNTRACED);\r\n        }\r\n\r\n        free(input);\r\n        free(command);\r\n    }\r\n\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb558e686594785-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb558e686594785-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-1\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-2\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-3\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-4\"><span class=\"crayon-p\">#include &lt;readline/readline.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-5\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-6\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/* Never returns if the call is successful */</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"This won't be printed if execvp is successuln\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WUNTRACED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-26\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-30\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb558e686594785-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb558e686594785-32\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>全部代码可在<a href=\"https://indradhanush.github.io/code/shell-part-2/shell.c\">此处</a>的单个文件中获取。如果你用 <code>gcc -g -lreadline shell.c</code> 编译它，并执行二进制文件，你会得到一个最小的可工作 shell，你可以用它来运行系统命令，比如 <code>pwd</code> 和 <code>ls -lha</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5592674810635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunixsh&gt; pwd\r\n/Users/dhanush/github.com/indradhanush.github.io/code/shell-part-2\r\nunixsh&gt; ls -lha\r\ntotal 28K\r\ndrwxr-xr-x 6 root root  204 Jun 11 18:27 .\r\ndrwxr-xr-x 3 root root 4.0K Jun 11 16:50 ..\r\n-rwxr-xr-x 1 root root  16K Jun 11 18:27 a.out\r\ndrwxr-xr-x 3 root root  102 Jun 11 15:32 a.out.dSYM\r\n-rw-r--r-- 1 root root  130 Jun 11 15:38 execvp.c\r\n-rw-r--r-- 1 root root  997 Jun 11 18:25 shell.c\r\nunixsh&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5592674810635-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5592674810635-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5592674810635-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5592674810635-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5592674810635-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5592674810635-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-1\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5592674810635-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dhanush</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">indradhanush</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">part</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-3\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">lha</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5592674810635-4\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28K</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-5\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">204</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5592674810635-6\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.0K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-7\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">16K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">out</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5592674810635-8\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">102</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dSYM</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-9\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">130</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">execvp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5592674810635-10\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">997</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shell</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5592674810635-11\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>注意：<code>fork</code> 只有在用户输入命令后才被调用，这意味着接受用户输入的用户提示符是父进程。</p>\n<h2>错误处理</h2>\n<p>到目前为止，我们一直假设我们的命令总会完美的运行，还没有处理错误。所以我们要对 <a href=\"https://indradhanush.github.io/code/shell-part-2/shell.c\">shell.c</a>做一点改动：</p>\n<ul>\n<li><strong>fork</strong> – 如果操作系统内存耗尽或是进程数量已经到了允许的最大值，子进程就无法创建，会返回 -1。我们在代码里加上以下内容：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb5599962828374\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n        child_pid = fork();\r\n        if (child_pid &lt; 0) {\r\n            perror(\"Fork failed\");\r\n            exit(1);\r\n        }\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5599962828374-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5599962828374-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5599962828374-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5599962828374-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb5599962828374-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb5599962828374-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5599962828374-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5599962828374-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5599962828374-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5599962828374-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Fork failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb5599962828374-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb5599962828374-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<ul>\n<li><strong>execvp</strong> – 就像上面解释过的，被成功调用后它不会返回。然而，如果执行失败它会返回 -1。同样地，我们修改 <code>execvp</code> 调用：</li>\n<li>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb559d027929256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    ...\r\n        if (execvp(command[0], command) &lt; 0) {\r\n            perror(command[0]);\r\n            exit(1);\r\n        }\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb559d027929256-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb559d027929256-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb559d027929256-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb559d027929256-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb559d027929256-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb559d027929256-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb559d027929256-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb559d027929256-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb559d027929256-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb559d027929256-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb559d027929256-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb559d027929256-6\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<br>\n注意：虽然<code>fork</code>之后的<code>exit</code>调用终止整个程序，但<code>execvp</code>之后的<code>exit</code> 调用只会终止子进程，因为这段代码只属于子进程。</li>\n</ul>\n<ul>\n<li><strong>malloc</strong> – 如果操作系统内存耗尽，它就会失败。在这种情况下，我们应该退出程序：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb55a0577545402\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchar **get_input(char *input) {\r\nchar **command = malloc(8 * sizeof(char *));\r\nif (command == NULL) {\r\nperror(\"malloc failed\");\r\nexit(1);\r\n}\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a0577545402-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55a0577545402-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a0577545402-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55a0577545402-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a0577545402-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55a0577545402-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a0577545402-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb55a0577545402-1\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55a0577545402-2\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55a0577545402-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55a0577545402-4\"><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"malloc failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55a0577545402-5\"><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55a0577545402-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55a0577545402-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</li>\n<li><strong>动态内存分配</strong> – 目前我们的命令缓冲区只分配了8个块。如果我们输入的命令超过8个单词，命令就无法像预期的那样工作。这么做是为了让例子便于理解，如何解决这个问题留给读者作为一个练习。</li>\n</ul>\n<p>上面带有错误处理的代码可在<a href=\"https://indradhanush.github.io/code/shell-part-2/shell_with_error_handling.c\">这里</a>获取。</p>\n<h2>内建命令</h2>\n<p>如果你试着执行 <code>cd</code> 命令，你会得到这样的错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb55a4105946922\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd: No such file or directory\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a4105946922-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55a4105946922-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb55a4105946922-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">such </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">directory</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55a4105946922-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们的 shell 现在还不能识别<code>cd</code>命令。这背后的原因是：cd不是<code>ls</code>或<code>pwd</code>这样的系统程序。让我们后退一步，暂时假设<code>cd</code> 也是一个系统程序。你认为执行流程会是什么样？在继续阅读之前，你可能想要思考一下。</p>\n<p>流程是这样的：</p>\n<ol>\n<li>用户输入 <code>cd /</code>。</li>\n<li>shell对当前进程作 <code>fork</code>，并在子进程中执行命令。</li>\n<li>在成功调用后，子进程退出，控制权还给父进程。</li>\n<li>父进程的当前工作目录没有改变，因为命令是在子进程中执行的。因此，<code>cd</code> 命令虽然成功了，但并没有产生我们想要的结果。</li>\n</ol>\n<p>因此，要支持 <code>cd</code>，我们必须自己实现它。我们也需要确保，如果用户输入的命令是 <code>cd</code>（或属于预定义的内建命令），我们根本不要 <code>fork</code> 进程。相反地，我们将执行我们对 <code>cd</code>（或任何其它内建命令）的实现，并继续等待用户的下一次输入。<code></code>，幸运的是我们可以利用 <code>chdir</code> 函数调用，它用起来很简单。它接受路径作为参数，如果成功则返回0，失败则返回 -1。我们定义函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb55a7294547320\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint cd(char *path) {\r\n        return chdir(path);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a7294547320-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55a7294547320-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55a7294547320-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb55a7294547320-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55a7294547320-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55a7294547320-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>并且在我们的<code>主</code>函数中为它加入一个检查：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb55ad702087004\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n            if (strcmp(command[0], \"cd\") == 0) {\r\n            if (cd(command[1]) &lt; 0) {\r\n                perror(command[1]);\r\n            }\r\n\r\n                /* Skip the fork */\r\n            continue;\r\n        }\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55ad702087004-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55ad702087004-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strcmp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/* Skip the fork */</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55ad702087004-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55ad702087004-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>带有以上更改的代码可从<a href=\"https://indradhanush.github.io/code/shell-part-2/shell_with_builtin.c\">这里</a>获取，如果你编译并执行它，你将能运行 <code>cd</code> 命令。这里是一个示例输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef7bb55b1579666184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Shell</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunixsh&gt; pwd\r\n/Users/dhanush/github.com/indradhanush.github.io/code/shell-part-2\r\nunixsh&gt; cd /\r\nunixsh&gt; pwd\r\n/\r\nunixsh&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55b1579666184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55b1579666184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55b1579666184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55b1579666184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef7bb55b1579666184-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef7bb55b1579666184-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef7bb55b1579666184-1\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55b1579666184-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dhanush</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">github</span><span class=\"crayon-e\">.com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">indradhanush</span><span class=\"crayon-e\">.github</span><span class=\"crayon-e\">.io</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">part</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55b1579666184-3\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55b1579666184-4\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">pwd</span></div><div class=\"crayon-line\" id=\"crayon-59adef7bb55b1579666184-5\"><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef7bb55b1579666184-6\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>第二部分到此结束。这篇博客帖文中的所有代码示例可在<a href=\"https://github.com/indradhanush/indradhanush.github.io/tree/master/code/shell-part-2/\">这里</a>获取。在<a href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-3/\">下一篇博客帖文</a>中，我们将探讨信号的主题以及实现对用户中断（Ctrl-C）的处理。敬请期待。</p>\n<h2>致谢</h2>\n<p>谢谢 <a href=\"https://github.com/domspad\">Dominic Spadacene</a>和我搭档写这篇文章，谢谢 <a href=\"https://github.com/saulpw\">Saul Pwanson</a>帮我解决怪异的内存泄漏，当时代码貌似完全不能工作了。</p>\n<p><strong>更新</strong>：Saul提到：按照惯例，用 <code>&lt; 0</code> 来检查错误比用 <code>== -1</code> 更好，因为有些 API 可能返回除了 <code>-1</code> 以外的负值，<code>&lt;0</code> 有助于应对那些情况。我已经据此更新了本帖文和代码示例。</p>\n<p><strong>参考资料</strong></p>\n<ul>\n<li><a href=\"http://amzn.to/2sc0p8o\">UNIX 环境高级编程 – Stephens &amp; Rago</a></li>\n<li><a href=\"http://amzn.to/2sc3TYr\">Linux 系统编程 – Robert Love</a></li>\n<li><a href=\"https://linux.die.net/man/\">Linux man 页面</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/8204a635b9f0335c5b2e27498c3d5c97.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/0fbc02d33dc26bbfebc27f81bea9cdf9.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112126\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112126votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112126\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">效楚</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72a13d3690f7c6edc018286f0ae732f6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本职工作是IC设计，工作中也经常做脚本编写、嵌入式编程等，对软件和文字翻译亦有浓厚的兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qdoverture\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qdoverture/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "C/C++,其他,shell,Unix", "front_image_path": "full/4a9c9b00ce4180ed890c67d1dc80aad0cac72679.jpg"}
{"url_object_id": "ce3a7725a878dcf107e5503031e8e276", "title": "150 多个 ML、NLP 和 Python 相关的教程", "create_time": "2017/08/15", "url": "http://blog.jobbole.com/112185/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/dbe885c03af6141ab8f7f68f5778895d.png"], "praise_num": "2", "comment_num": 0, "fav_num": 20, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/over-150-of-the-best-machine-learning-nlp-and-python-tutorials-ive-found-ffce2939bd78\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习已经发展了很久，它的<a href=\"https://en.wikipedia.org/wiki/Machine_learning#History_and_relationships_to_other_fields\" target=\"_blank\" rel=\"external\">历史</a>可以追溯到1959年，但是如今此领域的发展速度可以说是空前的。在最近的几篇文章中，我讨论了人工智能领域为何会在现在以及不久的将来持续蓬勃发展。如今很多对机器学习感兴趣的同学都普遍表示入门很难。</p>\n<p>在准备博士课题的期间，我尝试在网络上搜索与机器学习和自然语言处理相关的优秀资源。当我找了一个有趣的教程或者视频，从这个教程或者视频出发我又可以找到三四个更多的教程或视频，最终就会出现的画面就是我还没有开始认真研究第一个找到的教程，浏览器已经打开了 20 个标签等待我去浏览了。（注: <a href=\"https://www.tabbundler.com/\" target=\"_blank\" rel=\"external\">Tab Bundler</a> 可以帮助让我们的标签更有条理）。</p>\n<p>在找到了超过 25 个与机器学习相关的速查表后，<a href=\"http://blog.jobbole.com/112009/\" target=\"_blank\">我写了篇文章, 在里面整理了所有优秀的速查表</a>。</p>\n<p>为了给后面学习的童鞋铺路，我将我找到的最好的一些教程内容整理成了一份列表。这份列表并没有包含所有网上能找到的与机器学习相关的教程，否则这份列表将会过于臃肿。我的目标就是将我在机器学习和自然语言处理领域各个方面找到的我认为最好的教程整理出来。</p>\n<p>在教程中，为了能够更好的让读者理解其中的概念，我将避免罗列书中每章的详细内容，而是总结一些概念性的介绍内容。为什么不直接去买本书？当你想要对某些特定的主题或者不同方面进行了初步了解时，我相信这些教程对你可能帮助更大。</p>\n<p>本文中我将分四个主题进行整理：机器学习、自然语言处理、Python 和数学。在每个主题中我将包含一个例子和多个资源。当然我不可能完全覆盖所有的主题啦。</p>\n<p>在将来，我也将会整理一系列类似的资源列表，包括书籍，视频和代码项目等。因为我目前也的确正在编译这些资源。</p>\n<p>如果你发现我在这里遗漏了好的教程资源，请联系告诉我。为了避免资源重复罗列，我在每个主题下只列出了5、6个教程。下面的每个链接都应该链接了和其他链接不同的资源，也会通过不同的方式（例如幻灯片代码段)或者不同的角度呈现出这些内容。</p>\n<h3 id=\"机器学习\">机器学习</h3>\n<ul>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-80ea3ec3c471\" target=\"_blank\" rel=\"external\">Machine Learning is Fun!</a> (medium.com/@ageitgey)</li>\n<li>Machine Learning Crash Course: <a href=\"https://ml.berkeley.edu/blog/2016/11/06/tutorial-1/\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"https://ml.berkeley.edu/blog/2016/12/24/tutorial-2/\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"https://ml.berkeley.edu/blog/2017/02/04/tutorial-3/\" target=\"_blank\" rel=\"external\">Part III</a> (Machine Learning at Berkeley)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/machine-learning-theory-an-introductory-primer\" target=\"_blank\" rel=\"external\">An Introduction to Machine Learning Theory and Its Applications: A Visual Tutorial with Examples</a>(toptal.com)</li>\n<li><a href=\"https://monkeylearn.com/blog/a-gentle-guide-to-machine-learning/\" target=\"_blank\" rel=\"external\">A Gentle Guide to Machine Learning</a> (monkeylearn.com)</li>\n<li><a href=\"https://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\">Which machine learning algorithm should I use?</a> (sas.com)</li>\n</ul>\n<h4 id=\"激活函数和损失函数\">激活函数和损失函数</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#sigmoid_neurons\" target=\"_blank\" rel=\"external\">Sigmoid neurons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://www.quora.com/What-is-the-role-of-the-activation-function-in-a-neural-network\" target=\"_blank\" rel=\"external\">What is the role of the activation function in a neural network?</a> (quora.com)</li>\n<li><a href=\"https://stats.stackexchange.com/questions/115258/comprehensive-list-of-activation-functions-in-neural-networks-with-pros-cons\" target=\"_blank\" rel=\"external\">Comprehensive list of activation functions in neural networks with pros/cons</a> (stats.stackexchange.com)</li>\n<li><a href=\"https://medium.com/towards-data-science/activation-functions-and-its-types-which-is-better-a9a5310cc8f\" target=\"_blank\" rel=\"external\">Activation functions and it’s types-Which is better?</a> (medium.com)</li>\n<li><a href=\"http://www.exegetic.biz/blog/2015/12/making-sense-logarithmic-loss/\" target=\"_blank\" rel=\"external\">Making Sense of Logarithmic Loss</a> (exegetic.biz)</li>\n<li><a href=\"http://cs231n.github.io/neural-networks-2/#losses\" target=\"_blank\" rel=\"external\">Loss Functions</a> (Stanford CS231n)</li>\n<li><a href=\"http://rishy.github.io/ml/2015/07/28/l1-vs-l2-loss/\" target=\"_blank\" rel=\"external\">L1 vs. L2 Loss function</a> (rishy.github.io)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap3.html#the_cross-entropy_cost_function\" target=\"_blank\" rel=\"external\">The cross-entropy cost function</a> (neuralnetworksanddeeplearning.com)</li>\n</ul>\n<h4 id=\"偏差\">偏差</h4>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/2480650/role-of-bias-in-neural-networks/2499936#2499936\" target=\"_blank\" rel=\"external\">Role of Bias in Neural Networks</a> (stackoverflow.com)</li>\n<li><a href=\"http://makeyourownneuralnetwork.blogspot.com/2016/06/bias-nodes-in-neural-networks.html\" target=\"_blank\" rel=\"external\">Bias Nodes in Neural Networks</a> (makeyourownneuralnetwork.blogspot.com)</li>\n<li><a href=\"https://www.quora.com/What-is-bias-in-artificial-neural-network\" target=\"_blank\" rel=\"external\">What is bias in artificial neural network?</a> (quora.com)</li>\n</ul>\n<h4 id=\"感知器\">感知器</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#perceptrons\" target=\"_blank\" rel=\"external\">Perceptrons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://natureofcode.com/book/chapter-10-neural-networks/#chapter10_figure3\" target=\"_blank\" rel=\"external\">The Perception</a> (natureofcode.com)</li>\n<li><a href=\"http://computing.dcu.ie/~humphrys/Notes/Neural/single.neural.html\" target=\"_blank\" rel=\"external\">Single-layer Neural Networks (Perceptrons)</a> (dcu.ie)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/an-introduction-to-deep-learning-from-perceptrons-to-deep-networks\" target=\"_blank\" rel=\"external\">From Perceptrons to Deep Networks</a> (toptal.com)</li>\n</ul>\n<h4 id=\"回归\">回归</h4>\n<ul>\n<li><a href=\"http://people.duke.edu/~rnau/regintro.htm\" target=\"_blank\" rel=\"external\">Introduction to linear regression analysis</a> (duke.edu)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/LinearRegression/\" target=\"_blank\" rel=\"external\">Linear Regression</a> (ufldl.stanford.edu)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/linear_regression.html\" target=\"_blank\" rel=\"external\">Linear Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/logistic_regression.html\" target=\"_blank\" rel=\"external\">Logistic Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://machinelearningmastery.com/simple-linear-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Simple Linear Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/logistic-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Logistic Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/SoftmaxRegression/\" target=\"_blank\" rel=\"external\">Softmax Regression</a> (ufldl.stanford.edu)</li>\n</ul>\n<h4 id=\"梯度下降\">梯度下降</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#learning_with_gradient_descent\" target=\"_blank\" rel=\"external\">Learning with gradient descent</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/27/python-network-part2/\" target=\"_blank\" rel=\"external\">Gradient Descent</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2017/04/simple-understand-gradient-descent-algorithm.html\" target=\"_blank\" rel=\"external\">How to understand Gradient Descent algorithm</a> (kdnuggets.com)</li>\n<li><a href=\"http://sebastianruder.com/optimizing-gradient-descent/\" target=\"_blank\" rel=\"external\">An overview of gradient descent optimization algorithms</a> (sebastianruder.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-1/\" target=\"_blank\" rel=\"external\">Optimization: Stochastic Gradient Descent</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"生成学习\">生成学习</h4>\n<ul>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes2.pdf\" target=\"_blank\" rel=\"external\">Generative Learning Algorithms</a> (Stanford CS229)</li>\n<li><a href=\"https://monkeylearn.com/blog/practical-explanation-naive-bayes-classifier/\" target=\"_blank\" rel=\"external\">A practical explanation of a Naive Bayes classifier</a> (monkeylearn.com)</li>\n</ul>\n<h4 id=\"支持向量机\">支持向量机</h4>\n<ul>\n<li><a href=\"https://monkeylearn.com/blog/introduction-to-support-vector-machines-svm/\" target=\"_blank\" rel=\"external\">An introduction to Support Vector Machines (SVM)</a> (monkeylearn.com)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes3.pdf\" target=\"_blank\" rel=\"external\">Support Vector Machines</a> (Stanford CS229)</li>\n<li><a href=\"http://cs231n.github.io/linear-classify/\" target=\"_blank\" rel=\"external\">Linear classification: Support Vector Machine, Softmax</a> (Stanford 231n)</li>\n</ul>\n<h4 id=\"反向传播\">反向传播</h4>\n<ul>\n<li><a href=\"https://medium.com/@karpathy/yes-you-should-understand-backprop-e2f06eab496b\" target=\"_blank\" rel=\"external\">Yes you should understand backprop</a> (medium.com/@karpathy)</li>\n<li><a href=\"https://github.com/rasbt/python-machine-learning-book/blob/master/faq/visual-backpropagation.md\" target=\"_blank\" rel=\"external\">Can you give a visual explanation for the back propagation algorithm for neural networks?</a>(github.com/rasbt)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap2.html\" target=\"_blank\" rel=\"external\">How the backpropagation algorithm works</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://www.wildml.com/2015/10/recurrent-neural-networks-tutorial-part-3-backpropagation-through-time-and-vanishing-gradients/\" target=\"_blank\" rel=\"external\">Backpropagation Through Time and Vanishing Gradients</a> (wildml.com)</li>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-backpropagation-time/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Backpropagation Through Time</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-2/\" target=\"_blank\" rel=\"external\">Backpropagation, Intuitions</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"深度学习\">深度学习</h4>\n<ul>\n<li><a href=\"http://nikhilbuduma.com/2014/12/29/deep-learning-in-a-nutshell/\" target=\"_blank\" rel=\"external\">Deep Learning in a Nutshell</a> (nikhilbuduma.com)</li>\n<li><a href=\"http://ai.stanford.edu/~quocle/tutorial1.pdf\" target=\"_blank\" rel=\"external\">A Tutorial on Deep Learning</a> (Quoc V. Le)</li>\n<li><a href=\"http://machinelearningmastery.com/what-is-deep-learning/\" target=\"_blank\" rel=\"external\">What is Deep Learning?</a> (machinelearningmastery.com)</li>\n<li><a href=\"https://blogs.nvidia.com/blog/2016/07/29/whats-difference-artificial-intelligence-machine-learning-deep-learning-ai/\" target=\"_blank\" rel=\"external\">What’s the Difference Between Artificial Intelligence, Machine Learning, and Deep Learning?</a> (nvidia.com)</li>\n</ul>\n<h4 id=\"优化和降维\">优化和降维</h4>\n<ul>\n<li><a href=\"https://www.knime.org/blog/seven-techniques-for-data-dimensionality-reduction\" target=\"_blank\" rel=\"external\">Seven Techniques for Data Dimensionality Reduction</a> (knime.org)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes10.pdf\" target=\"_blank\" rel=\"external\">Principal components analysis</a> (Stanford CS229)</li>\n<li><a href=\"http://videolectures.net/site/normal_dl/tag=741100/nips2012_hinton_networks_01.pdf\" target=\"_blank\" rel=\"external\">Dropout: A simple way to improve neural networks</a> (Hinton @ NIPS 2012)</li>\n<li><a href=\"http://rishy.github.io/ml/2017/01/05/how-to-train-your-dnn/\" target=\"_blank\" rel=\"external\">How to train your Deep Neural Network</a> (rishy.github.io)</li>\n</ul>\n<h4 id=\"长短期记忆-LSTM\">长短期记忆(LSTM)</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Long Short-Term Memory Networks by the Experts</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://colah.github.io/posts/2015-08-Understanding-LSTMs/\" target=\"_blank\" rel=\"external\">Understanding LSTM Networks</a> (colah.github.io)</li>\n<li><a href=\"http://blog.echen.me/2017/05/30/exploring-lstms/\" target=\"_blank\" rel=\"external\">Exploring LSTMs</a> (echen.me)</li>\n<li><a href=\"http://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/\" target=\"_blank\" rel=\"external\">Anyone Can Learn To Code an LSTM-RNN in Python</a> (iamtrask.github.io)</li>\n</ul>\n<h4 id=\"卷积神经网络-CNNs\">卷积神经网络(CNNs)</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap6.html#introducing_convolutional_networks\" target=\"_blank\" rel=\"external\">Introducing convolutional networks</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-3-deep-learning-and-convolutional-neural-networks-f40359318721\" target=\"_blank\" rel=\"external\">Deep Learning and Convolutional Neural Networks</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Conv-Nets-Modular/\" target=\"_blank\" rel=\"external\">Conv Nets: A Modular Perspective</a> (colah.github.io)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Understanding-Convolutions/\" target=\"_blank\" rel=\"external\">Understanding Convolutions</a> (colah.github.io)</li>\n</ul>\n<h4 id=\"循环神经网络-RNNs\">循环神经网络(RNNs)</h4>\n<p><a href=\"http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/\" target=\"_blank\" rel=\"external\">Recurrent Neural Networks Tutorial</a> (wildml.com)<br>\n<a href=\"http://distill.pub/2016/augmented-rnns/\" target=\"_blank\" rel=\"external\">Attention and Augmented Recurrent Neural Networks</a> (distill.pub)<br>\n<a href=\"http://karpathy.github.io/2015/05/21/rnn-effectiveness/\" target=\"_blank\" rel=\"external\">The Unreasonable Effectiveness of Recurrent Neural Networks</a> (karpathy.github.io)<br>\n<a href=\"http://nikhilbuduma.com/2015/01/11/a-deep-dive-into-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">A Deep Dive into Recurrent Neural Nets</a> (nikhilbuduma.com)</p>\n<h4 id=\"增强学习\">增强学习</h4>\n<ul>\n<li><a href=\"https://www.analyticsvidhya.com/blog/2017/01/introduction-to-reinforcement-learning-implementation/\" target=\"_blank\" rel=\"external\">Simple Beginner’s guide to Reinforcement Learning &amp; its implementation</a> (analyticsvidhya.com)</li>\n<li><a href=\"https://web.mst.edu/~gosavia/tutorial.pdf\" target=\"_blank\" rel=\"external\">A Tutorial for Reinforcement Learning</a> (mst.edu)</li>\n<li><a href=\"http://www.wildml.com/2016/10/learning-reinforcement-learning/\" target=\"_blank\" rel=\"external\">Learning Reinforcement Learning</a> (wildml.com)</li>\n<li><a href=\"http://karpathy.github.io/2016/05/31/rl/\" target=\"_blank\" rel=\"external\">Deep Reinforcement Learning: Pong from Pixels</a> (karpathy.github.io)</li>\n</ul>\n<h4 id=\"生成对抗网络-GANs\">生成对抗网络(GANs)</h4>\n<ul>\n<li><a href=\"https://blogs.nvidia.com/blog/2017/05/17/generative-adversarial-network/\" target=\"_blank\" rel=\"external\">What’s a Generative Adversarial Network?</a> (nvidia.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/abusing-generative-adversarial-networks-to-make-8-bit-pixel-art-e45d9b96cee7\" target=\"_blank\" rel=\"external\">Abusing Generative Adversarial Networks to Make 8-bit Pixel Art</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://blog.aylien.com/introduction-generative-adversarial-networks-code-tensorflow/\" target=\"_blank\" rel=\"external\">An introduction to Generative Adversarial Networks (with code in TensorFlow)</a> (aylien.com)</li>\n<li><a href=\"https://www.oreilly.com/learning/generative-adversarial-networks-for-beginners\" target=\"_blank\" rel=\"external\">Generative Adversarial Networks for Beginners</a> (oreilly.com)</li>\n</ul>\n<h4 id=\"多任务学习\">多任务学习</h4>\n<ul>\n<li><a href=\"http://sebastianruder.com/multi-task/index.html\" target=\"_blank\" rel=\"external\">An Overview of Multi-Task Learning in Deep Neural Networks</a> (sebastianruder.com)</li>\n</ul>\n<h3 id=\"自然语言处理-NLP\">自然语言处理(NLP)</h3>\n<ul>\n<li><a href=\"http://u.cs.biu.ac.il/~yogo/nnlp.pdf\" target=\"_blank\" rel=\"external\">A Primer on Neural Network Models for Natural Language Processing</a> (Yoav Goldberg)</li>\n<li><a href=\"https://monkeylearn.com/blog/the-definitive-guide-to-natural-language-processing/\" target=\"_blank\" rel=\"external\">The Definitive Guide to Natural Language Processing</a> (monkeylearn.com)</li>\n<li><a href=\"https://blog.algorithmia.com/introduction-natural-language-processing-nlp/\" target=\"_blank\" rel=\"external\">Introduction to Natural Language Processing</a> (algorithmia.com)</li>\n<li><a href=\"http://www.vikparuchuri.com/blog/natural-language-processing-tutorial/\" target=\"_blank\" rel=\"external\">Natural Language Processing Tutorial</a> (vikparuchuri.com)</li>\n<li><a href=\"https://arxiv.org/pdf/1103.0398.pdf\" target=\"_blank\" rel=\"external\">Natural Language Processing (almost) from Scratch</a> (arxiv.org)</li>\n</ul>\n<h4 id=\"深度学习与NLP\">深度学习与NLP</h4>\n<ul>\n<li><a href=\"https://arxiv.org/pdf/1703.03091.pdf\" target=\"_blank\" rel=\"external\">Deep Learning applied to NLP</a> (arxiv.org)</li>\n<li><a href=\"https://nlp.stanford.edu/courses/NAACL2013/NAACL2013-Socher-Manning-DeepLearning.pdf\" target=\"_blank\" rel=\"external\">Deep Learning for NLP (without Magic)</a> (Richard Socher)</li>\n<li><a href=\"http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/\" target=\"_blank\" rel=\"external\">Understanding Convolutional Neural Networks for NLP</a> (wildml.com)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-NLP-RNNs-Representations/\" target=\"_blank\" rel=\"external\">Deep Learning, NLP, and Representations</a> (colah.github.io)</li>\n<li><a href=\"https://explosion.ai/blog/deep-learning-formula-nlp\" target=\"_blank\" rel=\"external\">Embed, encode, attend, predict: The new deep learning formula for state-of-the-art NLP models</a>(explosion.ai)</li>\n<li><a href=\"https://devblogs.nvidia.com/parallelforall/understanding-natural-language-deep-neural-networks-using-torch/\" target=\"_blank\" rel=\"external\">Understanding Natural Language with Deep Neural Networks Using Torch</a> (nvidia.com)</li>\n<li><a href=\"http://pytorch.org/tutorials/beginner/deep_learning_nlp_tutorial.html\" target=\"_blank\" rel=\"external\">Deep Learning for NLP with Pytorch</a> (pytorich.org)</li>\n</ul>\n<h4 id=\"词向量\">词向量</h4>\n<ul>\n<li><a href=\"https://www.kaggle.com/c/word2vec-nlp-tutorial\" target=\"_blank\" rel=\"external\">Bag of Words Meets Bags of Popcorn</a> (kaggle.com)</li>\n<li>On word embeddings <a href=\"http://sebastianruder.com/word-embeddings-1/index.html\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"http://sebastianruder.com/word-embeddings-softmax/index.html\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"http://sebastianruder.com/secret-word2vec/index.html\" target=\"_blank\" rel=\"external\">Part III</a> (sebastianruder.com)</li>\n<li><a href=\"https://blog.acolyer.org/2016/04/21/the-amazing-power-of-word-vectors/\" target=\"_blank\" rel=\"external\">The amazing power of word vectors</a> (acolyer.org)</li>\n<li><a href=\"https://arxiv.org/pdf/1411.2738.pdf\" target=\"_blank\" rel=\"external\">word2vec Parameter Learning Explained</a> (arxiv.org)</li>\n<li>Word2Vec Tutorial — <a href=\"http://mccormickml.com/2016/04/19/word2vec-tutorial-the-skip-gram-model/\" target=\"_blank\" rel=\"external\">The Skip-Gram Model</a>, <a href=\"http://mccormickml.com/2017/01/11/word2vec-tutorial-part-2-negative-sampling/\" target=\"_blank\" rel=\"external\">Negative Sampling</a> (mccormickml.com)</li>\n</ul>\n<h4 id=\"编码器-解码器\">编码器-解码器</h4>\n<ul>\n<li><a href=\"http://www.wildml.com/2016/01/attention-and-memory-in-deep-learning-and-nlp/\" target=\"_blank\" rel=\"external\">Attention and Memory in Deep Learning and NLP</a> (wildml.com)</li>\n<li><a href=\"https://www.tensorflow.org/tutorials/seq2seq\" target=\"_blank\" rel=\"external\">Sequence to Sequence Models</a> (tensorflow.org)</li>\n<li><a href=\"https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf\" target=\"_blank\" rel=\"external\">Sequence to Sequence Learning with Neural Networks</a> (NIPS 2014)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-5-language-translation-with-deep-learning-and-the-magic-of-sequences-2ace0acca0aa\" target=\"_blank\" rel=\"external\">Machine Learning is Fun Part 5: Language Translation with Deep Learning and the Magic of Sequences</a>(medium.com/@ageitgey)</li>\n<li><a href=\"http://machinelearningmastery.com/how-to-use-an-encoder-decoder-lstm-to-echo-sequences-of-random-integers/\" target=\"_blank\" rel=\"external\">How to use an Encoder-Decoder LSTM to Echo Sequences of Random Integers</a>(machinelearningmastery.com)</li>\n<li><a href=\"https://google.github.io/seq2seq/\" target=\"_blank\" rel=\"external\">tf-seq2seq</a> (google.github.io)</li>\n</ul>\n<h3 id=\"Python\">Python</h3>\n<ul>\n<li><a href=\"http://www.kdnuggets.com/2015/11/seven-steps-machine-learning-python.html\" target=\"_blank\" rel=\"external\">7 Steps to Mastering Machine Learning With Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://nbviewer.jupyter.org/github/rhiever/Data-Analysis-and-Machine-Learning-Projects/blob/master/example-data-science-notebook/Example%20Machine%20Learning%20Notebook.ipynb\" target=\"_blank\" rel=\"external\">An example machine learning notebook</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"例子\">例子</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/implement-perceptron-algorithm-scratch-python/\" target=\"_blank\" rel=\"external\">How To Implement The Perceptron Algorithm From Scratch In Python</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://www.wildml.com/2015/09/implementing-a-neural-network-from-scratch/\" target=\"_blank\" rel=\"external\">Implementing a Neural Network from Scratch in Python</a> (wildml.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/12/basic-python-network/\" target=\"_blank\" rel=\"external\">A Neural Network in 11 lines of Python</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2016/01/implementing-your-own-knn-using-python.html\" target=\"_blank\" rel=\"external\">Implementing Your Own k-Nearest Neighbour Algorithm Using Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/\" target=\"_blank\" rel=\"external\">Demonstration of Memory with a Long Short-Term Memory Network in Python</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/How%20to%20Learn%20to%20Add%20Numbers%20with%20seq2seq%20Recurrent%20Neural%20Networks\">How to Learn to Add Numbers with seq2seq Recurrent Neural Networks</a> (machinelearningmastery.com)</li>\n</ul>\n<h4 id=\"Numpy和Scipy\">Numpy和Scipy</h4>\n<ul>\n<li><a href=\"http://www.scipy-lectures.org/\" target=\"_blank\" rel=\"external\">Scipy Lecture Notes</a> (scipy-lectures.org)</li>\n<li><a href=\"http://cs231n.github.io/python-numpy-tutorial/\" target=\"_blank\" rel=\"external\">Python Numpy Tutorial</a> (Stanford CS231n)</li>\n<li><a href=\"https://engineering.ucsb.edu/~shell/che210d/numpy.pdf\" target=\"_blank\" rel=\"external\">An introduction to Numpy and Scipy</a> (UCSB CHE210D)</li>\n<li><a href=\"http://nbviewer.jupyter.org/gist/rpmuller/5920182#ii.-numpy-and-scipy\" target=\"_blank\" rel=\"external\">A Crash Course in Python for Scientists</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"scikit-learn\">scikit-learn</h4>\n<ul>\n<li><a href=\"http://nbviewer.jupyter.org/github/jakevdp/sklearn_pycon2015/blob/master/notebooks/Index.ipynb\" target=\"_blank\" rel=\"external\">PyCon scikit-learn Tutorial Index</a> (nbviewer.jupyter.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-classifiers/blob/master/sklearn-classifiers-tutorial.ipynb\" target=\"_blank\" rel=\"external\">scikit-learn Classification Algorithms</a> (github.com/mmmayo13)</li>\n<li><a href=\"http://scikit-learn.org/stable/tutorial/index.html\" target=\"_blank\" rel=\"external\">scikit-learn Tutorials</a> (scikit-learn.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-beginners-tutorials\" target=\"_blank\" rel=\"external\">Abridged scikit-learn Tutorials</a> (github.com/mmmayo13)</li>\n</ul>\n<h4 id=\"Tensorflow\">Tensorflow</h4>\n<ul>\n<li><a href=\"https://www.tensorflow.org/tutorials/\" target=\"_blank\" rel=\"external\">Tensorflow Tutorials</a> (tensorflow.org)</li>\n<li><a href=\"https://medium.com/@erikhallstrm/hello-world-tensorflow-649b15aed18c\" target=\"_blank\" rel=\"external\">Introduction to TensorFlow — CPU vs GPU</a> (medium.com/@erikhallstrm)</li>\n<li><a href=\"https://blog.metaflow.fr/tensorflow-a-primer-4b3fa0978be3\" target=\"_blank\" rel=\"external\">TensorFlow: A primer</a> (metaflow.fr)</li>\n<li><a href=\"http://www.wildml.com/2016/08/rnns-in-tensorflow-a-practical-guide-and-undocumented-features/\" target=\"_blank\" rel=\"external\">RNNs in Tensorflow</a> (wildml.com)</li>\n<li><a href=\"http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/\" target=\"_blank\" rel=\"external\">Implementing a CNN for Text Classification in TensorFlow</a> (wildml.com)</li>\n<li><a href=\"http://pavel.surmenok.com/2016/10/15/how-to-run-text-summarization-with-tensorflow/\" target=\"_blank\" rel=\"external\">How to Run Text Summarization with TensorFlow</a> (surmenok.com)</li>\n</ul>\n<h4 id=\"PyTorch\">PyTorch</h4>\n<ul>\n<li><a href=\"http://pytorch.org/tutorials/\" target=\"_blank\" rel=\"external\">PyTorch Tutorials</a> (pytorch.org)</li>\n<li><a href=\"http://blog.gaurav.im/2017/04/24/a-gentle-intro-to-pytorch/\" target=\"_blank\" rel=\"external\">A Gentle Intro to PyTorch</a> (gaurav.im)</li>\n<li><a href=\"https://iamtrask.github.io/2017/01/15/pytorch-tutorial/\" target=\"_blank\" rel=\"external\">Tutorial: Deep Learning in PyTorch</a> (iamtrask.github.io)</li>\n<li><a href=\"https://github.com/jcjohnson/pytorch-examples\" target=\"_blank\" rel=\"external\">PyTorch Examples</a> (github.com/jcjohnson)</li>\n<li><a href=\"https://github.com/MorvanZhou/PyTorch-Tutorial\" target=\"_blank\" rel=\"external\">PyTorch Tutorial</a> (github.com/MorvanZhou)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/PyTorch%20Tutorial%20for%20Deep%20Learning%20Researchers\">PyTorch Tutorial for Deep Learning Researchers</a> (github.com/yunjey)</li>\n</ul>\n<h3 id=\"Math\">Math</h3>\n<ul>\n<li><a href=\"https://people.ucsc.edu/~praman1/static/pub/math-for-ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (ucsc.edu)</li>\n<li><a href=\"http://www.umiacs.umd.edu/~hal/courses/2013S_ML/math4ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (UMIACS CMSC422)</li>\n</ul>\n<h4 id=\"线性代数\">线性代数</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/linear-algebra-guide/\" target=\"_blank\" rel=\"external\">An Intuitive Guide to Linear Algebra</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/matrix-multiplication/\" target=\"_blank\" rel=\"external\">A Programmer’s Intuition for Matrix Multiplication</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/cross-product/\" target=\"_blank\" rel=\"external\">Understanding the Cross Product</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-dot-product/\" target=\"_blank\" rel=\"external\">Understanding the Dot Product</a> (betterexplained.com)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/LinearAlgebra.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra for Machine Learning</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"https://medium.com/towards-data-science/linear-algebra-cheat-sheet-for-deep-learning-cd67aba4526c\" target=\"_blank\" rel=\"external\">Linear algebra cheat sheet for deep learning</a> (medium.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-linalg.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra Review and Reference</a> (Stanford CS229)</li>\n</ul>\n<h4 id=\"概率论\">概率论</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\" target=\"_blank\" rel=\"external\">Understanding Bayes Theorem With Ratios</a> (betterexplained.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Review of Probability Theory</a> (Stanford CS229)</li>\n<li><a href=\"https://see.stanford.edu/materials/aimlcs229/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Probability Theory Review for Machine Learning</a> (Stanford CS229)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/Probability-Theory.pdf\" target=\"_blank\" rel=\"external\">Probability Theory</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"http://www.cs.toronto.edu/~urtasun/courses/CSC411_Fall16/tutorial1.pdf\" target=\"_blank\" rel=\"external\">Probability Theory for Machine Learning</a> (U. of Toronto CSC411)</li>\n</ul>\n<h4 id=\"微积分\">微积分</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/how-to-understand-derivatives-the-quotient-rule-exponents-and-logarithms/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Quotient Rule, Exponents, and Logarithms</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/derivatives-product-power-chain/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Product, Power &amp; Chain Rules</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-gradient/\" target=\"_blank\" rel=\"external\">Vector Calculus: Understanding the Gradient</a> (betterexplained.com)</li>\n<li><a href=\"http://web.stanford.edu/class/cs224n/lecture_notes/cs224n-2017-review-differential-calculus.pdf\" target=\"_blank\" rel=\"external\">Differential Calculus</a> (Stanford CS224n)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/calculus.html\" target=\"_blank\" rel=\"external\">Calculus Overview</a> (readthedocs.io)</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112185\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112185votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112185\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 20 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "工具与资源,nlp,Python,人工智能,机器学习,深度学习", "front_image_path": "full/f02d2e7eb1184040c7a09a8a14f24d219b467b39.jpg"}
{"url_object_id": "697cda33f7258dcfabbacb139fb85b20", "title": "程序员的自我修养：温故而知新", "create_time": "2017/08/11", "url": "http://blog.jobbole.com/112161/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png"], "praise_num": "2", "comment_num": 1, "fav_num": 14, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/Tan-sir/p/7272652.html\">目不识丁</a>   </div><h2>1.1从Hello World说起</h2>\n<p>目的：从最基本的编译，静态链接到操作系统如何转载程序，动态链接及运行库和标准库的实现，和一些操作系统的机制。了解计算机上程序运行的一个基本脉络。</p>\n<h2>1.2变不离其宗</h2>\n<p>计算机最关键的三个部分：CPU,内存,I/O控制芯片。</p>\n<ul>\n<li>早期的计算机：没有复杂的图形功能，CPU和内存频率一样，都连接在同一个总线上。</li>\n<li>CPU频率提升：内存跟不上CPU，产生了和内存频率一致的系统总线，CPU使用倍频的方式和总线通信。</li>\n<li>图形界面的出现：图形芯片需要和内存和CPU大量交换数据，慢速的I/O总线无法满足图形设备的巨大需求。为了高效处理数据，设计了一个高速的北桥芯片。后来有设计处理低速处理设备南桥芯片，磁盘，USB，键盘都是连接在南桥上。在由南桥将它们汇总到北桥上。</li>\n</ul>\n<h5><strong>北桥</strong></h5>\n<ul>\n<li>北桥左边CPU和cache：CPU负责所有控制和运算。</li>\n<li>北桥下面PCI总线</li>\n<li>北桥右边memory</li>\n</ul>\n<h5>SMP和多核</h5>\n<p>现在CPU已经达到物理极限，被4GHz所限制，于是，开始通过增加CPU数量来提高计算机速度。<br>\n<strong>对称多处理器（SMP）</strong>：最常见的一种形式。每个CPU在系统中所处的地位和所发挥的功能是一样，是相互对称的。但在处理程序时，我们并不能把他们分成若干个不相干的子问题，所以，使得多处理器速度实际提高得并没有理论上那么高。当对于相互独立的问题，多处理器就能最大效能的发挥威力了（比如：大型数据库,网络服务等）。<br>\n对处理器由于造价比较高昂，主要用在商用电脑上，对于个人电脑，主要是<strong>多核处理器</strong>。<br>\n多核处理器：其实际上是(SMP)的简化版，思想是将多个处理器合并在一起打包出售，它们之间共享比较昂贵的缓存部件，只保留了多个核心。在逻辑上看，它们和SMP完全相同。</p>\n<h2>1.3站得高,看得远</h2>\n<p><strong>系统软件</strong>：一般用于管理计算机本地的软件。</p>\n<p>主要分为两块：</p>\n<ul>\n<li>平台性的：操作系统内核，驱动程序，运行库。</li>\n<li>程序开发：编译器，汇编器，链接器。</li>\n</ul>\n<p>计算机系统软件体系结构采用一种<strong>层</strong>的结构。<br>\n每个层次之间都需要相互通信，那么它们之间就有通信协议，我们将它称为接口，接口下层是提供者，定义接口。上层是使用者，使用接口实现所需功能。<br>\n除了硬件和应用程序，其他的都是中间层，每个中间层都是对它下面的那层的包装和扩展。它们使得应用程序和硬件之间保持相对独立。<br>\n从整个层次结构来看，开发工具与应用程序属于同一个层次，因为它们都使用同一个接口—操作系统<strong>应用程序编程接口</strong>。应用程序接口提供者是运行库，什么样的运行库提供什么样的接口。winsows的运行库提供Windows API，Linux下的Gliba库提供POSIX的API。<br>\n运行库使用操作系统提供的<strong>系统调用接口</strong>。<br>\n系统调用接口在实现中往往以<strong>软件中断</strong>的方式提供。<br>\n操作系统内核层对于硬件层来说是硬件接口的使用者，而硬件是接口的定义者。这种接口叫做<strong>硬件规格</strong>。</p>\n<h2>1.4操作系统做了什么</h2>\n<p>操作系统的一个功能是提供抽象的接口，另外一个主要功能是管理硬件资源。<br>\n一个计算机中的资源主要分CPU,存储器（包括内存和磁盘）和I/O设备。下面从这3个方面来看如何挖机它们。</p>\n<h3>1.4.1不要让CPU打盹</h3>\n<p><strong>多道程序</strong>：编译一个监控程序，当程序不需要使用CPU时，将其他在等待CPU的程序启动。但它的弊端是不分轻重缓急，有时候一个交互操作可能要等待数十分钟。<br>\n改进后<br>\n<strong>分时系统</strong>：每个CPU运行一段时间后，就主动让出给其他CPU使用。完整的操作系统雏形在此时开始出现。但当一个程序死机的时候，无法主动让出CPU，那么，整个系统都无法响应。<br>\n目前操作系统采用的方式<br>\n<strong>多任务系统</strong>：操作系统接管了所有的硬件资源，并且本身运行在一个受硬件保护的级别。所有的应用都以<strong>进程</strong>的方式运行在比操作系统更低的级别，每个进程都有自己独立的地址空间，使得进程之间的地址空间相互隔离。CPU由操作系统进行同一分配，每个进程根据进程优先级的高低都有机会获得CPU，但如果运行超过一定的时间，CPU会将资源分配给其他进程，这种CPU分配方式是<strong>抢占式</strong>。如果操作系统分配每个进程的时间很短，就会造成很多进程都在同时运行的假象，即所谓的<strong>宏观并行，微观串行</strong>。</p>\n<h5><a name=\"%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8\"></a>设备驱动</h5>\n<p>操作系统作为硬件层的上层，它是对硬件的管理和抽象。<br>\n对于操作系统上面的运行库和应用程序来说，它们只希望看到一个统一的硬件访问模式。<br>\n当成熟的操作系统出现后，硬件逐渐成了抽象的概念。在UNIX中，硬件设备的访问形式和访问普通的文件形式一样。在Windows系统中，图形硬件被抽象成GDI，声音和多媒体设备被抽象成DirectX对象，磁盘被抽象成普通文件系统。<br>\n这些繁琐的硬件细节全都交给了操作系统中的硬件驱动。<br>\n文件系统管理这磁盘的存储方式。<br>\n<strong>磁盘的结构</strong>：一个硬盘往往有多个盘片，每个盘片分两面，每面按照同心圆划分为若干磁道，每个磁道划分为若干扇区，每个扇区一般512字节。<br>\n<strong>LBA</strong>：整个硬盘中所有扇区从0开始编号，一直到最后一个扇区，这个扇区编号叫做<strong>逻辑扇区号</strong>。<br>\n文件系统保存了这些文件的存储结构，负责维护这些数据结构并且保证磁盘中的扇区能有效的组织和利用。</p>\n<h2>1.5内存不够怎么办</h2>\n<p>在早期计算机中，程序是直接运行在物理内存上的，程序所访问的都是物理地址。<br>\n那么如何将计算机有限的地址分配给多个程序使用。<br>\n直接按物理内存分配将产生很多问题：</p>\n<ul>\n<li><strong>地址空间不隔离</strong>：所有的程序都直接访问物理地址，导致程序使用的物理地址不是相互隔离的，恶意的程序很容易串改其他程序的内存数据。</li>\n<li><strong>内存使用效率低</strong>：由于没有有效的内存管理机制，通常一个程序执行的时候，监控程序要将整个程序读入。内存不够的时候，需要先将内存中的程序读出，保存在硬盘上，才能将需要运行的程序读入。这样会使得整个过程有大量数据换入换出。</li>\n<li><strong>程序运行地址不确定</strong>：每次程序运行都需要内存分配一块足够大的内存空间，使得这个地址是不确定的。但在程序编写的时候，他访问的数据和指令跳转的目标地址都是固定的，这就涉及到了程序的<strong>重定向</strong>问题。</li>\n</ul>\n<p>一种解决办法：<br>\n<strong>中间层</strong>：使用一种间接的地址访问方法，我们把程序给出的地址看作一种<strong>虚拟地址</strong>。虚拟地址是物理地址的映射，只要处理好这个过程，就可以起到隔离的作用。</p>\n<h3>1.5.1关于隔离</h3>\n<p>普通的程序它只需要一个简单的执行环境，一个单一的地址空间，有自己的CPU。<br>\n地址空间比较抽象，如果把它想象成一个数组，每一个数组是一字节，数组大小就是地址空间的长度，那么32位的地址空间大小就是2^32=4294967296字节，即4G，地址空间有效位是0x00000000~0xFFFFFFFF。<br>\n地址空间分为两种：<br>\n<strong>物理空间</strong>：就是物理内存。32位的机器，地址线就有32条，物理空间4G，但如果值装有512M的内存，那么实际有效的空间地址就是0x00000000~0x1FFFFFFF，其他部分都是无效的。<br>\n虚拟空间：每个进程都有自己独立的虚拟空间，而且每个进程只能访问自己的空间地址，这样就有效的做到了进程隔离。</p>\n<h3>1.5.2分段<a name=\"152%E5%88%86%E6%AE%B5\"></a></h3>\n<p>基本思路：把一段与程序所需要的内存空间大小的虚拟空间映射到某个地址空间。虚拟空间的每个字节对应物理空间的每个字节。这个映射过程由软件来完成。<br>\n分段的方式可以解决之前的第一个（地址空间不隔离）和第三个问题（程序运行地址不确定）<br>\n第二问题内存使用效率问题依旧没有解决。</p>\n<h3>1.5.3分页</h3>\n<p>基本方法：把地址空间人为的分成固定大小的页，每一页大小有硬件决定或硬件支持多种大小的页，由操作系统决定页的大小。<br>\n目前几乎所有的PC上的操作系统都是4KB大小的页。<br>\n我们把进程的虚拟地址空间按页分割，把常用的数据和代码页转载到内存中，把不常用的代码和数据保存到磁盘里，当需要的时候从磁盘取出来。<br>\n虚拟空间的页叫做<strong>虚拟页（VP）</strong>,物理内存中页叫做<strong>物理页</strong>，把磁盘中的页叫做<strong>磁盘页</strong>。虚拟空间的有的页被映射到同一个物理页，这样就可以实现内存共享。<br>\n当进程需要一个页时，这个页是磁盘页时，硬件会捕获到这个消息，就是所谓的<strong>页错误</strong>，然后操作系统接管进程，负责从磁盘中读取内容装入内存中，然后再将内存和这个页建立映射关系。<br>\n<strong>保护</strong>也是页映射的目的之一，每个页都可以设置权限属性，只有操作系统可以修改这些属性，这样操作系统就可以保护自己保护进程。<br>\n<strong>虚拟存储</strong>的实现需要依靠硬件支持，所有硬件都采用一个叫做MMU的部件来进行页映射。<br>\nCPU发出虚拟地址经过MMU转换成物理地址，MMU一般都集成在CPU内部。</p>\n<h2>1.6众人拾柴火焰高</h2>\n<h3>1.6.1线程基础<a name=\"161%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80\"></a></h3>\n<p>多线程现在作为实现软件并发执行的一个重要方法，具有越来越重的地位。</p>\n<h5><a name=\"%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B\"></a>什么是线程</h5>\n<p><strong>线程</strong>有时被称为轻量级的进程，是程序执行流的最小单位。</p>\n<p>构成：</p>\n<ul>\n<li>线程ID</li>\n<li>当前指令指针</li>\n<li>寄存器集合</li>\n<li>堆栈空间（代码段，数据段，堆）</li>\n<li>进程级的资源（打开文件和信号）</li>\n</ul>\n<p>线程与进程的关系：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png\" alt=\"\"></p>\n<p>多线程可以互不干扰的并发执行，并共享进程的全局变量和堆的数据。<br>\n使用多线程的原因有如下几点：</p>\n<ul>\n<li>某个操作可能会陷入长时间等待，等待的线程会进入睡眠状态，无法继续执行。</li>\n<li>某个操作会消耗大量的时间，如果只有一个线程，程序和用户之间的交互会中断。</li>\n<li>程序逻辑本身就要求并发操作。</li>\n<li>多CPU或多核计算机，本身具备同时执行多个线程的能力。</li>\n<li>相对于多进程应用，多线程在数据共享方面效率要高很多。</li>\n</ul>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90\"></a>线程的访问权限</h5>\n<p>线程的访问非常自由，它可以访问进程内存里所有数据，包括其他线程的堆栈（如果知道地址的话，情况很少见）。<br>\n线程自己的私用存储空间：</p>\n<ul>\n<li>栈（并发完全无法被其他线程访问）</li>\n<li>线程局部存储。某些操作系统为线程提供私用空间，但容量有限。</li>\n<li>寄存器。执行流的基本数据，为线程私用。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>线程私用</th>\n<th>线程间共享（进程所有）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>局部变量</td>\n<td>全局变量</td>\n</tr>\n<tr>\n<td>函数参数</td>\n<td>堆上数据</td>\n</tr>\n<tr>\n<td>TLS数据</td>\n<td>函数里的静态变量</td>\n</tr>\n<tr>\n<td></td>\n<td>程序代码</td>\n</tr>\n<tr>\n<td></td>\n<td>打开的文件，A线程打开的文件可以由B线程读取</td>\n</tr>\n</tbody>\n</table>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7\"></a>线程调度与优先级</h5>\n<p>不论在多处理器还是单处理器上，线程都是“并发”的。<br>\n线程数量小于处理器数量时，是真正并发的。<br>\n单处理器下，并发是模拟的，操作系统会让这些多线程程序轮流执行，每次都只执行一小段时间，这就称为<strong>线程调度</strong>。<br>\n线程调度中，线程拥有三种状态：</p>\n<ul>\n<li>运行：线程正在执行</li>\n<li>就绪：线程可以立刻运行，但CPU被占用</li>\n<li>等待：线程正在等待某一事件发生，无法立即执行。</li>\n</ul>\n<p>处于运行中的线程拥有一段可以执行的时间，这称为<strong>时间片</strong>，当时间片用尽的时候，进程进入就绪状态，如果在用尽之前开始等待某事件，那么它就进入等待状态。每当一个线程离开运行状态的时候，调度系统就会选择一个其他的就绪线程继续执行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/98d32af045fd36e5fc3477f9fe4a2758.png\" alt=\"\"></p>\n<p>现在的主流调度方法尽管都不一样，但基本都带有<strong>优先级调度</strong>和<strong>轮转法</strong>。<br>\n轮转法：各个线程轮流执行一段时间。<br>\n优先级调度：按线程的优先级来轮流执行，每个线程都拥有各自的线程优先级。<br>\n在win和lin里面，线程优先级不仅可以由用户手动设置，系统还会根据不同线程表现自动调整优先级。<br>\n一般频繁等待的线程称之为<strong>IO密集型线程</strong>，而把很少等待的线程称为<strong>CPU密集型线程</strong>。<br>\n优先级调度下，存在一种<strong>饿死</strong>现象。<br>\n饿死：线程优先级较低，在它执行之前，总是有较高级的线程要执行，所以，低优先级线程总是无法执行的。<br>\n当一个CPU密集型线程获得较高优先级时，许多低优先级线程就可能被饿死。<br>\n为了避免饿死，操作系统常常会逐步提升那些等待时间过长的线程。<br>\n线程优先级改变一般有三种方式：</p>\n<ul>\n<li>用户指定优先级</li>\n<li>根据进入等待状态的频繁程度提升或降低优先级</li>\n<li>长时间得不到执行而被提升优先级</li>\n</ul>\n<h5><a name=\"%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B%E5%92%8C%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B\"></a>可抢占线程和不可抢占线程</h5>\n<p><strong>抢占</strong>：在线程用尽时间片之后被强制剥夺继续执行的权利，而进入就绪状态。<br>\n在早期的系统中，线程是<strong>不可抢占</strong>的，线程必须主动进入就绪状态。<br>\n在不可抢占线程中，线程主动放弃主要是2种：</p>\n<ul>\n<li>当线程试图等待某个事件（I/O）时</li>\n<li>线程主动放弃时间片</li>\n</ul>\n<p>不可抢占线程有一个好处，就是线程调度只会发生在线程主动放弃执行或线程等待某个事件的时候，这样就可以避免一些抢占式线程时间不确定而产生的问题。</p>\n<h5><a name=\"linux%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B\"></a>Linux的多线程</h5>\n<p>Linux内核中并不存在真正意义上的线程概念。Linux所有执行实体（线程和进程）都称为<strong>任务</strong>，每一个任务概念上都类似一个单线程的进程，具有内存空间，执行实体，文件资源等。Linux不同任务之间可以选择共享内存空间，相当于同一个内存空间的多个任务构成一个进程，这些任务就是进程中的线程。</p>\n<table>\n<thead>\n<tr>\n<th>系统调用</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>fork</td>\n<td>复制当前线程</td>\n</tr>\n<tr>\n<td>exec</td>\n<td>使用新的可执行映像覆盖当前可执行映像</td>\n</tr>\n<tr>\n<td>clone</td>\n<td>创建子进程并从指定位置开始执行</td>\n</tr>\n</tbody>\n</table>\n<p>fork产生新任务速度非常快，因为fork不复制原任务的内存空间，而是和原任务一起共享一个<strong>写时复制</strong>的内存空间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4c89163b6db707d13e93ae4f5ad6fdca.png\" alt=\"\"></p>\n<p>写时复制：两个任务可以同时自由读取内存，当任意一个任务试图对内存进行修改时，内存就会复制一份单独提供给修改方使用。<br>\nfork只能够产生本任务的镜像，因此需要和exec配合才能启动别的新任务。<br>\n而如果要产生新线程，则使用clone。<br>\nclone可以产生一个新的任务，从指定位置开始执行，并且共享当前进程的内存空间和文件等，实际效果就是产生一个线程。</p>\n<h3>1.6.2线程安全</h3>\n<p>多线程程序处于一个多变的环境中，可访问的全局变量和堆数据随时都可能被其他的线程改变。因此多线程程序在并发时数据的一致性变得非常重要。</p>\n<h5><a name=\"%E7%AB%9E%E4%BA%89%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C\"></a>竞争与原子操作</h5>\n<p>++i的实现方法：</p>\n<ul>\n<li>读取i到某个寄存器X</li>\n<li>X++</li>\n<li>将X的内容存储回i<br>\n单条指令的操作称为<strong>原子的</strong>，单挑指令的执行不会被打断。在windows里，有一套API专门进行一些原子操作，这些API称为Interlocked API。</li>\n</ul>\n<h5><a name=\"%E5%90%8C%E6%AD%A5%E4%B8%8E%E9%94%81\"></a>同步与锁</h5>\n<p>为了防止多个线程读取同一个数据产生不可预料结果，我们将各个线程对一个数据的访问同步。<br>\n<strong>同步</strong>：在一个线程对一个数据访问结束的时候，其他线程不能对同一个数据进行访问。对数据的访问被原子化。<br>\n<strong>锁</strong>：锁是一种非强制机制，每一个线程在访问数据或者资源之前会先获取锁，在访问结束后会释放锁。在锁被占用时候试图获取锁时，线程会等待，知道锁可以重新使用。<br>\n<strong>二元信号量</strong>：最简单的锁，它适合只能被唯一一个线程独占访问的资源，它的两种状态：</p>\n<ul>\n<li>非占用状态：第一个获取该二元信号量的线程会获得该锁，并将二元信号量置为占用状态，其他所有访问该二元信号量线程将会等待。</li>\n<li>占用状态</li>\n</ul>\n<p><strong>信号量</strong>：允许多个线程并发访问的资源。一个初始值为N的信号量允许N个线程并发访问。<br>\n操作如下：</p>\n<ul>\n<li>将信号量值键1</li>\n<li>如果信号量值小于0，就进入等待状态。</li>\n</ul>\n<p>访问完资源后，线程释放信号量：</p>\n<ul>\n<li>将信号量加1</li>\n<li>如果信号量的值小于1，唤醒一个等待中的线程。</li>\n</ul>\n<p><strong>互斥量</strong>：和二元信号量很类似，但和信号量不同的是：信号量在一个系统中，可以被任意线程获取或释放。互斥量要求那个线程获取互斥量，那么哪个线程就释放互斥量，其他线程释放无效。<br>\n<strong>临界区</strong>：比互斥量更加严格的手段。把临界区的锁获取称为进入临界区，而把锁的释放称为离开临界区。临界区和互斥量，信号量区别在与互斥量，信号量在系统中任意进程都是可见的。临界区的作用范围仅限于本线程，其他线程无法获取。其他性质与互斥量相同。<br>\n<strong>读写锁</strong>：致力于一种更加特定的场合的同步。如果使用之前使用的信号量、互斥量或临界区中的任何一种进行同步，对于读取频繁，而仅仅是偶尔写入的情况会显得非常低效。读写锁可以避免这个问题。对于同一个锁，读写锁有两种获取方式：</p>\n<ul>\n<li>共享的</li>\n<li>独占的</li>\n</ul>\n<p>读写锁的总结</p>\n<table>\n<thead>\n<tr>\n<th>读写锁状态</th>\n<th>以共享方式获取</th>\n<th>以独占方式获取</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>自由</td>\n<td>成功</td>\n<td>成功</td>\n</tr>\n<tr>\n<td>共享</td>\n<td>成功</td>\n<td>等待</td>\n</tr>\n<tr>\n<td>独占</td>\n<td>等待</td>\n<td>等待</td>\n</tr>\n</tbody>\n</table>\n<p><strong>条件变量</strong>：作为同步的手段，作用类似于一个栅栏。对于条件变量，线程有两个操作：</p>\n<ul>\n<li>线程可以等待条件变量，一个条件变量可以被多个线程等待</li>\n<li>线程可以唤醒条件变量，此时某个或所有等待此条件变量的线程都会被唤醒并继续支持</li>\n</ul>\n<p>使用条件变量可以让许多线程一起等待某个事件的发生，当事件发生时，所有线程可以一起恢复执行。</p>\n<h5><a name=\"%E5%8F%AF%E9%87%8D%E5%85%A5%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8\"></a>可重入与线程安全</h5>\n<p>一个函数被重入，表示这个函数没有执行完成，由于外部因素或内部调用，又一次进入该函数执行。<br>\n一个函数要被重入，只有两种情况：</p>\n<ul>\n<li>多个线程同时执行这个函数</li>\n<li>函数自身（可能经过多层调用之后）调用自身</li>\n</ul>\n<p>一个函数被称为可重入，表示重入之后不会产生任何不良影响</p>\n<p>可重入函数：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff32613752716287\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint sqr(int x) \r\n{\r\n    return x * x;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff32613752716287-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32613752716287-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32613752716287-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32613752716287-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff32613752716287-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sqr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32613752716287-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32613752716287-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">x *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32613752716287-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>一个函数要成为可重入，必须具有如下特点：</p>\n<ul>\n<li>不使用任何（局部）静态或全局的非const变量</li>\n<li>不返回任何（局部）静态或全部的非const变量的指针</li>\n<li>仅依赖调用方提供的参数</li>\n<li>不依赖任何单个资源的锁</li>\n<li>不调用任何不可重入的函数</li>\n</ul>\n<p>可重入是并发安全的强力保障，一个可重入的函数可以在多程序环境下方向使用</p>\n<h5><a name=\"%E8%BF%87%E5%BA%A6%E4%BC%98%E5%8C%96\"></a>过度优化</h5>\n<p>有时候合理的合理的使用了锁也不一定能保证线程的安全。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff32621096787909\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//Thread1\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();\r\n//Thread2\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff32621096787909-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32621096787909-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32621096787909-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32621096787909-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32621096787909-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32621096787909-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32621096787909-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32621096787909-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32621096787909-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32621096787909-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff32621096787909-1\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32621096787909-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32621096787909-3\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32621096787909-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32621096787909-5\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32621096787909-6\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32621096787909-7\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32621096787909-8\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32621096787909-9\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32621096787909-10\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>上面X的值应该为2，但如果编译器为了提高X的访问速度，把X放到了某个寄存器里面，不同线程的寄存器是各自独立的，因此，如果Thread1先获得锁，则程序的执行可能会呈现如下：<br>\n[Thread1]读取x的值到某个寄存器R [1] (R[1]=0);<br>\n[Thread1]R[1]++(由于之后可能要访问到x,所以Thread1暂时不将R[1]写回x);<br>\n[Thread2]读取x的值到某个寄存器R[2] (R[2]=0);<br>\n[Thread2]R[2]++(R[2]=1);<br>\n[Thread2]将R[2]写回至x(x=1);<br>\n[Thread1] (很久以后)将R[1]写回至x(x=1);<br>\n如果这样，即使加锁也不能保证线程安全</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff32627802522401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n//Thread1\r\nx=1;\r\nr1=y;\r\n//Thread2\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff32627802522401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32627802522401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32627802522401-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32627802522401-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32627802522401-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32627802522401-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32627802522401-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff32627802522401-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32627802522401-2\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32627802522401-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32627802522401-4\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32627802522401-5\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32627802522401-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32627802522401-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>上面代码有可能发生r1=r2=0的情况。<br>\n<strong>CPU动态调度</strong>：在执行程序的时候，为了提高效率有可能交换指令的顺序。<br>\n编译器在进行优化的时候，也可能为了效率交换两个毫不相干的相邻指令的执行顺序。<br>\n上面代码执行顺序可能是这样：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff3262a047555191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n[Thread1]\r\nr1=y;\r\nx=1;\r\n[Thread2]\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262a047555191-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262a047555191-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262a047555191-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262a047555191-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262a047555191-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262a047555191-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262a047555191-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff3262a047555191-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262a047555191-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262a047555191-3\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262a047555191-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262a047555191-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262a047555191-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262a047555191-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>使用volatile关键字可以阻止过度优化，colatile可以做两件事情：</p>\n<ul>\n<li>阻止编译器为了提高速度将一个变量缓存到寄存器内而不写回</li>\n<li>阻止编译器调整操作volatile变量的指令顺序</li>\n</ul>\n<p>但volatile无法阻止CPU动态调度换序<br>\nC++中，单例模式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff3262e001764727\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvolatile T * pInst = 0;\r\nT * GetInstance() \r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL)\r\n            pInst = new T;\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff3262e001764727-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff3262e001764727-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-1\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-2\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff3262e001764727-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff3262e001764727-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n\n</div>\n<p>CPU的乱序执行可能会对上面代码照成影响<br>\nC++里的new包含两个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>调用构造函数</li>\n</ul>\n<p>所以pInst=new T包含三个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>在内存的位置上调用构造函数</li>\n<li>将内存的地址赋值给pInst</li>\n</ul>\n<p>这三步中2和3的步骤可以颠倒，可能出现这种情况：pInst中的值不是NULL，但对象还是没有构造完成。<br>\n要阻止CPU换序，可以调用一条指令，这条指令常常被称为barrier：它会阻止CPU将该指令之前的指令交换到barrier之后。<br>\n许多体系的CPU都提供了barrier指令，不过，它们的名称各不相同。例如POWERPC提供的指令就叫做lwsync。所以我们可以这样保证线程安全：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adcdff32632891383056\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define barrier() __asm__ volatile(\"lwsync\")\r\nvolatile T * pInst = 0;\r\nT * GetInstance()\r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL) \r\n        {\r\n            T * temp = new T;\r\n            barrier();\r\n            pInst = temp;\r\n        }\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adcdff32632891383056-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adcdff32632891383056-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-1\"><span class=\"crayon-p\">#define barrier() __asm__ volatile(\"lwsync\")</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-2\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-3\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">barrier</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adcdff32632891383056-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adcdff32632891383056-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n\n</div>\n<h3>1.6.3多线程的内部情况</h3>\n<p>线程的并发执行是由多处理器或操作系统调度来实现的。windows和linux都在内核中提供线程支持，有多处理器或调度来实现并发。用户实际使用线程并不是内核线程，而是存在于用户态的用户线程。用户线程并不一定在操作系统内核里对应同等数量的内核线程。对用户来说，如果有三个线程同时执行，可能在内核中只有一个线程。</p>\n<h5><a name=\"%E4%B8%80%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>一对一模型</h5>\n<p>对于直接支持线程的系统，一对一模型始终是最为简单的模型。一个用户使用的线程就唯一对应一个内核使用的线程，但返回来，一个内核里面的线程在用户态不一定有对应的线程存在。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5b98d84c57ecfa88795e674e4a711ec.png\" alt=\"\"></p>\n<p>对于一对一模型，线程之间的并发是真正的并发，一个线程因为某个原因阻塞，并不会影响到其他线程。一对一模型也可以让多线程程序在多处理器的系统上有更好的表现。<br>\n一般直接使用API或者系统调用创建的线程均为一对一线程。<br>\n一对一线程的两个缺点：</p>\n<ul>\n<li>由于许多操作系统限制了内核线程数量，因此一对一线程会让用户的线程数量受到限制。</li>\n<li>许多操作系统内核线程调度是，上下文切换的开销较大，导致用户线程的执行效率下降。</li>\n</ul>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>多对一模型</h5>\n<p>多对一模型将多个用户线程映射到一个内核线程上，线程之间的切换由用户态的代码来进行，相对于一对一模型，多对一模型的线程切换要快速许多。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a464ae600296b61c454403e9cab160b.png\" alt=\"\"></p>\n<p>多对一模型的问题就是如果一个用户线程阻塞了，那么所有的线程都将无法执行。在多处理系统上，处理器的增多对多对一模型的线程性能不会有明显帮助。多对一模型得到的好处是高效的上下文切换和几乎无限制的线程数量。</p>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%A8%A1%E5%9E%8B\"></a>多对多模型</h5>\n<p>多对多模型结合了多对一和一对一的特点，将多个用户线程映射到少数但不止一个内核线程上。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/88cf46ce05bf777caef1b92def4dca9d.png\" alt=\"\"></p>\n<p>一个用户线程阻塞并不会使得所有的用户线程阻塞。并且对用户线程数量也没有什么限制，在多处理器系统上，多对多模型的线程也能得到一定的性能提升，不过提升的幅度没有一对一模型高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112161\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112161votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112161\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 14 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "职场,程序员", "front_image_path": "full/b019444f07f74231bdbf3445811ed2d3e5e85724.jpg"}
{"url_object_id": "fea447f655adc5e5a294480152ef9eb8", "title": "DevOps 团队之殇", "create_time": "2017/08/23", "url": "http://blog.jobbole.com/112237/", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>“你在团队里是做什么的？”“DevOps。”</p>\n<p>“DevOps是什么呢？”</p>\n<p>“DevOps是一种文化、一种实践，目标是加快软件迭代速度，让团队更快交付价值。”</p>\n<p>“能不能具体点，你们日常工作的主要内容是什么？”</p>\n<p>“修Pipeline…”</p></blockquote>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png\" alt=\"\"></p>\n<p>作为一名开发，在刚涉足DevOps领域的时候，最难的就是和传统运维撇清关系；等到DevOps不再被当成是运维，又容易被当成是专职修Pipeline的人。</p>\n<p>DevOps在一遍遍被人们提及、一次次在项目中被实践时，也在不断地被重新定义，DevOps是什么？这个问题可能到现在也比较难说清楚，但是项目中的“DevOps”做了些什么，却是清晰可见的。</p>\n<p>本文就结合笔者的切身经历，谈一谈关于DevOps交付的价值以及在企业转型过程中遇到的一些问题。</p>\n<h3 id=\"toc_0\">背景介绍</h3>\n<p>客户是一家澳洲大型金融保险企业，其IT部门总人数在千人以上，维护应用两百余个。在经历了几年的收购和合并之后，在业务上指定了“将收购来的多个品牌进行整合”的大方针，于是IT部门也开始面临系统整合、业务线整合、网站合并的问题，同时客户正在将他们的服务逐渐从自建数据中心向AWS公有云服务上迁移。</p>\n<h3 id=\"toc_1\">团队概览</h3>\n<p>在数字化转型的漫漫长路中，该企业已经在内部搭建起了一套持续交付系统，以<a href=\"https://jenkins.io/\">Jenkins</a>为中心，有制品库、依赖管理、代码管理、任务管理系统，敏捷实践成熟。</p>\n<p>我所在的团队是在整个组织向DevOps转型中的一个比较关键的团队，肩负着CI/CD优化、持续交付改进、运维能力输出的重任。类似的团队应该在很多DevOps转型的组织里都有，负责维护CI/CD基础设施、搭建应用开发脚手架、维护基础设施变更、做各种自动化的工作（姑且就将这类团队称之为Platform团队）。</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/2-Platform-700x402.png\" alt=\"\"></p>\n<p>比较特殊的是我在的这个团队实行轮岗制，由产品团队的成员（通常是开发人员）定期轮换到Platform团队，带着在产品团队遇到但是没能解决的问题，在这个团队中寻求最佳实践和解决方案，一段时间后（通常是三个月），开发人员从Platform团队回到开发团队，同时将DevOps技能和最佳实践带到产品开发团队。</p>\n<p>整个Platform团队基本维持在3-5人的规模，有一个IM（Iteration Manager迭代经理），其余全是开发人员。</p>\n<h3 id=\"toc_2\">取得的成就</h3>\n<p>回顾过去的五个月，Platform团队一共经历了10个迭代（每个迭代两个星期），我梳理了一下每个迭代的工作内容，整理出主要成就如下：</p>\n<ul>\n<li>围绕CI/CD做了很多优化，比如简化Jenkins slave创建流程、给自动化脚本（基础设施代码）贡献了许多新功能。</li>\n<li>新技术试点，比如尝试将静态文件部署到<a href=\"https://aws.amazon.com/cn/s3/\">AWS S3</a>中代替<a href=\"https://httpd.apache.org/\">Apache</a>服务。</li>\n<li>为应用设置监控，更新了基础设施脚本用于开启监控，并协助应用团队将配置脚本应用到各个环境。</li>\n<li>团队之间的沟通，了解开发团队痛点，帮助开发团队找到能够解决问题的团队（权限、责任划分、知识传递），技能培训等。</li>\n<li>响应变化，解决技术难题（虽然我认为这更像是一个沟通+权限的问题，但是其他所有团队都认为是技术难题，那我也就这样认为吧），以及修复一些类似于硬盘空间已满、网络延迟、权限的问题。</li>\n</ul>\n<h3 id=\"toc_3\">遇到的问题</h3>\n<p>当然在交付价值的同时，有很多痛点是非常折磨人的：</p>\n<ul>\n<li><strong>权限分配：</strong>作为一个跨开发团队工作的团队，不但没有拥有比开发团队更多的权限，甚至连开发团队的一些权限都没有，比如不能向开发团队的代码库提交代码(修改基础设施代码需要这个权限)，比如缺少Linux权限导致服务器底层问题没法直接修复，再比如 Jenkins 的问题追踪到了服务层需要维护Jenkins的团队支持，因为涉及到CI／CD的应用是由别的团队在管理。</li>\n<li><strong>沟通效率：</strong>为了解决一个bug，有时候要花上两周的时间发邮件，找关键人物，组织会议，跟不同的人解释五遍以上的上下文（技术细节的上下文是很繁琐的），最后解决问题的人还很有可能不是自己团队的（没有权限）。因为大家平时都很忙，而且建卡工作的方式让一部分人对团队请求帮助的问题不是很热心，这种情况在沟通的时候如果表现得情商不够高，对方就会要你发邮件给他们团队然后等 IM 建卡，规划到迭代里再说了，我遇到过一次这样的情况，最后还是通过社工手段拿下了这个关键人物，过程不可谓不曲折。</li>\n<li><strong>明确需求：</strong>Platform团队并不交付业务价值，因此没有BA(Business analyst业务分析师，通常扮演梳理需求的角色)，建卡的事基本都由IM和Dev来做，虽然感觉上是合理的，但实施起来却遇到很多问题，究其根本就是对需求的定义和划分不够明确，导致最后挪卡的时候大家都说不准这张卡算不算完成了，只能用拍脑袋的方式来决定。</li>\n<li><strong>质量分析：</strong>同上，团队缺少QA(Quality Assurance，质量工程师，测试人员)，Dev们都是自己做卡自己测，有时候会结对测试，但也会因为对需求理解不充分，或者说拆卡拆得有问题，导致一些卡完成得质量不够，直接影响受依赖的卡。举个例子，部署监控需要自动化脚本的两个模块支持，两个模块被分为两张卡，在做第一张卡的时候遇到了诸多问题，好不容易把代码提交到别人的版本库里了，在做第二张卡的时候却发现第一张卡代码里多写了一对引号，导致整个逻辑实现失败，这个时候再回过头来改之前的代码，又要重新解决之前遇到的各种问题（沟通、权限，PS：这个时候做第一张卡的人还下了项目），周期和浪费的工时是可想而知的。</li>\n<li><strong>人员轮岗：</strong>这是 IM 一直很头疼的一件事，Platform团队大量的时间花在给新来的团队成员输入上下文、同时又有成员离开团队要交接工作、尤其在沟通重要的工作中，成员的离开意味着需要新的人重新和干系人建立联系，再者，一些成员因为项目上的痛点，不是很有心思工作在团队的事务上，而是更关心自己过段时间会被分配到那个团队，如此种种都对团队的价值交付造成了很大的困扰。举一个例子，有一个端到端测试工具一直由Platform团队维护，从我加入Platform团队开始，这个测试工具就打算新增一个集成远程浏览器引擎的功能，这是一个非常有价值的功能，因为开发团队长期苦于浏览器版本支持过少，端到端测试不稳定；但是在实现过程中一直存在一个网络问题，这张卡先后被关闭、开启、标记完成、又重新开启，经历了大概五六个人的手，困扰我们的网络问题直到Platform团队解散，都没能解决。</li>\n<li><strong>关键角色管理：</strong>做了什么很重要，有时候让别人知道你做了什么比做了什么更重要。这一点在 Platform 团队体现的得尤为明显；在交付团队中，开发如果发现资源不足，需要和TL(Tech Lead 或是Team Lead，可以理解为项目组长)或者PM(Production Manager 产品经理)沟通，如果缺少合适的汇报对象，一方面在团队需要外部支持或更多资源（比如权限）的时候得不到及时的支持，另一方面意味着团队缺少了更高的视角来实时回顾自己做的事情是否是正确的，方向有没有走偏，或者是不是又在造别人造过的轮子。我在团队解散后的回顾会议中，IM还坚持认为我们团队被解散是因为没有一个强有力的领导在背后支持，这也从侧面反映了我们没有找到合适的汇报人，告诉他，我们在做什么，听他说，我们下一步可以做什么。</li>\n</ul>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/4-Tech-Lead-1-700x390.jpg\" alt=\"\"></p>\n<h3 id=\"toc_4\">分析</h3>\n<h4 id=\"toc_5\">问题背后的原因及可能的改进方案</h4>\n<p>团队解散后经过一段时间的沉淀，我针对以上痛点与过往的成员一一交谈，了解了他们的想法，总结分析出了以下原因，以及可能的解决方案。</p>\n<h4 id=\"toc_6\">原因1：团队方向不清晰</h4>\n<p>不同于交付业务价值的产品团队，Platform团队不对某一个具体的产品负责，也不直接产出业务价值，加上Platform团队对交付的价值缺乏有效的指标度量，造成了团队方向不清晰的状况。</p>\n<p><strong>可能的改进方案：</strong>Platform 团队应该是属于架构师的一个机动团队，在团队方向不清晰的时候应该立即与利益相关者(Stakeholder)沟通，即与架构师取得联系，取得高视角的资源，最好能建立交付价值指标，比如Platform团队的目标是加快持续交付，提高交付质量，那就可视化开发团队发布周期、质量报告，让每个团队成员看到Platform团队交付价值的体现，从而明确团队方向。</p>\n<h4 id=\"toc_7\">原因2：团队角色缺失</h4>\n<p>在架构师不能全权参与团队工作的情况下（甚至Platform团队还可能没有IM），一帮Dev就很容易失去对团队整体的感知，每个Dev只关心自己手里的工作，迭代开始初期容易考虑不到全局影响、不能准确建卡，迭代进行时因为没有合适的汇报人因而跨团队交流困难，迭代结束时没有优质的回顾。 在Micromanagement Culture（微观管理文化）中有一个Alignment(校准)和Autonomy(自治)两个互斥的指标，我们使用这两个指标作为向量构成四个象限，如下图所示：</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/5-Spotify-Engineering-Culture.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图片来源：<a href=\"https://www.youtube.com/watch?v=4GK1NDTWbkY\">Spotify Engineering Culture</a></p>\n<ul>\n<li>高校准、低自治的团队由领导决定做什么以及怎么做，团队只需要执行，这样会形成“领导说什么就是什么”的局面；</li>\n<li>而高校准且高自治的团队是由领导指出要解决的问题以及原因，然后由团队成员相互合作共同找到问题的解决方案；</li>\n<li>低校准、低自治的团队则缺乏活力，只能循规蹈矩；</li>\n<li>而高自治、低校准的团队成员可以做任何他们想做的事情，领导则很无助因为没有人关心真正需要解决的问题。</li>\n</ul>\n<p>在敏捷团队中，如果团队成员只剩下Dev，情形则很有可能变成图中左下象限（也有些许右下）的情况，要想达到右上象限的期望状态，需要提高自治，更多的是校准。</p>\n<p><strong>可能的改进方案：</strong>在意识到这个问题的时候，团队需要一个关键人物出面充当领导者的角色，扮演这个角色的人必须关注团队交付价值、目标和方向，并且有强大的沟通能力让团队成员目标一致；和利益相关者加强沟通，保证团队方向不会跑偏。</p>\n<h4 id=\"toc_8\">根本原因</h4>\n<p>Platform团队成立初期被定义为一个立意高远（DevOps转型）的组织，但是在项目实施过程中变得越来越边缘化，其中有“人”的原因，有组织架构的原因，当然还有一些客观原因。但我突然意识到这背后有一个原因一直忽视了，那就是——我们在实践DevOps反模式。</p>\n<p>国内近年来一直在对DevOps如何落地争论不休，DevOps提倡的是打破开发和运维的部门墙，将开发和运维（的能力）放在一个团队。然而国内大部分项目的现状是，开发不具备运维技能和意识，也不愿意做“背锅侠”（要求开发做运维一定程度上牺牲了开发的利益，比如亚马逊的开发每隔一周会被要求24小时On-call）。</p>\n<p>因此一些公司选择了在项目中先成立一个 “DevOps团队” 作为过渡，再慢慢将CI/CD的理念和技能扩散到其他团队，但是这种方式稍不注意就会变成“换了个名字的Ops ”，因为工作内容相似，写脚本、做高可用，这些是传统运维也会做的事情，这种形式非常不利于团队思维的转变，“团队整体对最终交付物负责”才是DevOps的精要，而不是把团队按职责划分（只对流程负责）。</p>\n<p>这样的要求无异是给项目成员增加了工作量和责任，对他们提出了更高的要求。然而很多职员不愿意无回报地多背负一些责任，比如说开发，谁不愿意每天写点代码一提交就早早回家，DevOps要求他们得看着新功能上线，确保无误之后才能离开；所以DevOps的推行在产品团队中是有阻力的，因此DevOps的成功不光需要团队内部努力，也需要得到高层支持并扫除障碍。</p>\n<h3 id=\"toc_9\">反思</h3>\n<blockquote><p>在一个不确定性多发的时代，快速的从成败经验中学习比找寻正确的路径更加重要。——ThoughtWorks高级咨询师顾宇</p></blockquote>\n<ul>\n<li><strong>尽早找到关键角色，并且管理好利益相关人。</strong>这一点在一个扁平化组织里往往是最容易被忽视的，在意识到要和 Stackholders(利益相关者)建立联系之前，Platform 团队走了很多弯路，也错失了很多机会。</li>\n<li><strong>让事情发生比如何发生更重要。</strong>应该说在这5个月的工作中，我认为最有价值的是最后两个迭代开始真正搜集来自应用团队的需求，开始在两地组织各个团队的 TL 开会搜集痛点和解决方案。作为 Platform 团队的一员，这件事其实我早就意识到会是非常有价值的，但始终没有去做，总是顾虑不知道怎么去开始、去推动，担心TL 们提出的问题不能得到真正解决。但是最后这件事终于发生了，才意识到真的是非常有价值，而且早该这么做了。关于这点在我还在 ThoughtWorks 试用期的时候我的 Buddy(由公司安排负责伴随新员工渡过试用期的人) 给了我一个非常好的建议，就是决定在讲一个分享之前先把日程表（邀请邮件）发出来，这种看似是“Deadline driven(截止日期驱动)”的方式，背后暗含了“这件事情必须发生”的道理，这和 MVP(Minumum viable product，产品原型) 的原理也是一样的，先上线，再搜集反馈，迭代改进；就算它是一个错误的行为，这也是一次有价值的试错。</li>\n</ul>\n<h3 id=\"toc_10\">我们是否还需要DevOps团队</h3>\n<p>结合我自身的经历，“DevOps 团队”应该是一次有价值的试错，让我看到了这种方式的一些弊端，应用开发团队自身如果不具备产品思维，要由一个独立的团队去影响它们是很难的，这种实践下的 DevOps 团队就像是披着 DevOps 外衣的 Ops 团队，不能产生理想的价值。</p>\n<p>相比之下如果有一种自上而下的方式让开发团队基于已有业务基础之上去优化交付流程，并对每一个提交的最终价值负责，将产品思维真正植入到开发团队，从而达到全局优化的效果，这种做法才更符合真正的 DevOps 精神。</p>\n<p>（文／ThoughtWorks杜屹东）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112237\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112237votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112237\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,DevOps", "front_image_path": "full/7a7918d976b65d75d9b90138280a1268fb97e0b4.jpg"}
{"url_object_id": "8ca27b6e450717e1a86cd115d118ba44", "title": "从分布式计算到分布式训练", "create_time": "2017/08/21", "url": "http://blog.jobbole.com/112222/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>对计算机来讲，所谓的计算，不过是将存储在各个地方的数据通过数据总线进行传输，然后经过算术逻辑单元执行一系列预设好的规则，最终再将输出写入到某个位置。</p>\n<p>在计算能力有限、存储成本偏高的情况下，就需要利用好计算机的资源，让它的计算能力发挥出最大的价值，所以在编程初期用指令直接操作硬件，例如汇编语言中常见的操纵寄存器，本质上都是为了减少数据传输的时间，充分利用CPU的计算能力，避免因为数据的长时间传输导致CPU进行过长的等待。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2.jpg\"><img class=\"aligncenter size-large wp-image-5162\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg\" alt=\"\" width=\"700\" height=\"390\"></a></p>\n<h3>分布式计算的到来</h3>\n<p>随着科技的发展，“数据存储”领域有了质和量的双向发展，除了稳定性、安全性的提升外，容量也呈指数级增长。因此可以在单机上直接构建整套服务，类似LAMP类似的这种一键搭建服务器的套装软件有了更多的应用场景。</p>\n<p>然而随着业务的发展，另一个问题逐渐显现出来：虽然磁盘容量增加了，但是机器的访问速度并没有变快。</p>\n<p>什么意思呢？举个例子：虽然20年前一个盘最大的存储空间只有100MB，但是读取完整磁盘只需要1分钟。如今虽然磁盘容量可以轻易的变成1TB、1PB，然而读取完整个盘的数据需要数小时之上。</p>\n<p>这背后的问题在于技术发展的限制：磁头在磁道上移动速度的增速远远低于磁盘容量的增长。用通俗的话来说就是，仓库的面积已经从10平米扩展到100平米甚至到1000平米了，但是一个搬运工一天搬运货物的速度并没有显著的提升，所以虽然仓库的容量越来越大，但是搬完整个仓库的货物需要的时间却越来越多。</p>\n<p>不过好在我们还有另一个好消息：带宽逐渐变得廉价。相比20年前，GB带宽的光纤已经非常普遍，网络能够实现一秒传输，数据量已经远远超过了整块盘的容量。于是一个大胆的想法被提出来了：既然读取完一个盘的数据需要几个小时，那把数据分成N份，分别放在不同的机器上并行读取，是不是一秒钟就读取完了？</p>\n<p>采用网络并行的方式进行读取，将瓶颈从磁头移动转移到了网络，而要增加一条高速带宽，已经不需要付出多么大的代价。</p>\n<p>还是仓库的例子，既然一个搬运工速度这么慢，搬完1000平米仓库需要1000分钟，那么我用1000个搬运工搬1000平米是不是1分钟就完了？这个时候影响搬运工的，仅仅是大门的大小，需要同时容纳1000个搬运工进出而已，但是开个大门似乎成本并不高，大不了把四面的墙都拆了做成门嘛。</p>\n<h3>MR一代</h3>\n<p>一个优秀的思想被提出来后，总会有许多追随者尝试将其落地，Google率先丢出了三大论文：BigTable、GFS、MapReduce，从理论上讲述了在分布式下如何做到数据的存储、计算，甚至提出了可以在分布式下做结构化的检索。</p>\n<p>三大论文开启了分布式计算的时代，然而对于工程界来说，仅有三篇论文并不足以解决生产上的问题，Google并没有将内部实现的内容进行开源，于是另一帮团队：Yahoo，自行根据论文进行实现，而后将其贡献给Apache，逐渐发展成时至今日依旧如日中天的：HDFS、Mapreduce、HBase。</p>\n<p>其中尤为重要的分布式计算模型：MapReuce，我们常称为第一代MR，也就是：MRV1。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1.png\"><img class=\"aligncenter size-large wp-image-5150\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-1024x485.png\" alt=\"\" width=\"700\" height=\"332\"></a></p>\n<p>上图是MRV1的主要架构图，我们可以看到，在MRV1里面，主要分为两个部分：运行环境和编程模型，所谓的运行环境，指的是用来进行分布式任务调度、资源分配等任务运行过程中涉及到的信息，而编程模型，则指的是提供给开发人员进行开发的接口。</p>\n<p>对于MRV1来说，它的运行结构图如下所示：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce.png\"><img class=\"aligncenter size-large wp-image-5151\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce-1024x514.png\" alt=\"\" width=\"700\" height=\"351\"></a></p>\n<p>可以看到，在MRV1里面，当我们的一个任务被提交上去之后，由统一的调度器进行任务的监控、分发，以及资源的申请、回收控制等操作。</p>\n<p>MRV1有着明显的两个阶段：Map和Reduce，Map阶段主要负责处理输入，每一个Map任务对应一个分片的数据，而后将数据送入到一个特有的数据结构：环形缓冲区。所谓的环形缓冲区，是用来记录数据和索引的一个区域。当环形缓冲区快要溢出的时候，数据将会被落地到磁盘。在数据输入完成后，将会调用用户自己实现的map函数，而后通过与jobtracker的通信，保持着联系，然后分别进入到reduce的阶段，renduce阶段会汇集所有的数据，这个动作在广义上会被很多人称为：shuffle。实际上shuffle并不是reduce才发生的，对于MR来说，从数据从HDFS上加载开始，shuffle就已经开始了，一直伴随到reduce结束。</p>\n<p>MRV1类似于工厂生产辣椒酱，很多工人负责把流水线送到自己身边的辣椒切碎，这个就是Map操作，所有工人切碎的辣椒汇集在一起做成辣椒酱，这个就是Reduce操作。也许某个工人把辣椒切成块的速度赶不上流水线送给他辣椒的速度，那么他就需要把辣椒从流水线拿下来放在他的自己的某个地方存着慢慢切，这个动作就相当于shuffle操作。因为最后汇总会等到所有的人都把辣椒切成块之后再处理，所以如果有一个人没有完成，就需要等待，这个时候就发生了我们常说的，数据倾斜。</p>\n<h3>MR二代</h3>\n<p>MRV1是统一管理资源的，类似于一家公司的所有决策都需要通过CEO来发出指令，所有人都听命于CEO，每个人做什么事全都是CEO一一安排，所以如果CEO忙不过来了，或者有事联系不上了，整个组织就成了无头苍蝇、完蛋了。</p>\n<p>因此对于MRV1来说，虽然它实现了一个并行计算模型，但是其暴露出来的问题也显而易见：</p>\n<ul>\n<li>固化的两阶段模式，限制了迭代任务的进行</li>\n<li>多次数据落地，整个运行时间大大延长</li>\n<li>所有任务由统一的jobtracker调度，存在单点故障。</li>\n<li>对资源的控制不到位，没有明确的任务优先级</li>\n<li>资源利用不合理，例如在V1里面，资源分为map solt和reduce solt，导致运行map的时候，reduce的solt全部闲置</li>\n<li>安全控制</li>\n</ul>\n<p>在这些问题逐渐暴露出来后，有很多补救的措施逐渐出现，例如Tez就是一个非常好的例子，它通过接管MRV1的输入和输出，减少其落地到磁盘的动作，目前Tez已经是Hive的内置计算模型。</p>\n<p>但是这些补救框架，并不能从根本上解决MRV1的问题，于是第二代MR被研究出来，也就是MRV2，那么对于MRV2来说，它是怎么做的呢？既然一个公司全靠CEO去安排任务和进行管理有风险，那么我们就把公司的所有人分成N个小团队，每个团队有自己的Lead负责进行工作安排，CEO干什么呢？CEO只负责把要做的事情丢给小团队的Lead，小团队的Lead自己去安排手下的人干活。</p>\n<p>大多数时候我们对MRV2这个名字并不熟悉，但是我们一定熟悉一个名字：Yarn。Yarn就是MRV2下最核心的功能。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2.png\"><img class=\"aligncenter size-large wp-image-5152\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2-1024x492.png\" alt=\"\" width=\"700\" height=\"336\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn.png\"><img class=\"aligncenter size-large wp-image-5164\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn-1024x399.png\" alt=\"\" width=\"700\" height=\"273\"></a></p>\n<p>通过上面的图我们发现，对于MRV2来说，它的资源的申请、控制、回收，不再由统一的jobtracker（前面举例中的CEO）来调度了。在MRV2里面，它产生了几个新的概念：</p>\n<ul>\n<li>Resource Manager：负责统一管理所有资源</li>\n<li>Application Master：负责一个任务的监控、资源分配、回收等工作（前面例子中的小团队Lead）</li>\n<li>Node Manager：各个节点的资源监控</li>\n</ul>\n<p>这里面并没有提到Yarn，因为Yarn并不是一个技术，而是一个概念，代表V2里面整个任务调度和资源管理系统。我们合并起来统一称为：Yarn。</p>\n<p>我们可以对比一下MRV1和MRV2的机构图：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2.png\"><img class=\"aligncenter size-large wp-image-5154\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2-1024x455.png\" alt=\"\" width=\"700\" height=\"311\"></a></p>\n<p>在MRV2里面，依旧分为两个部分：运行环境和编程模型。然而不一样的地方在于，每一个应用程序需要实现自己的Application Master，也就是资源管理系统。Resource Manager进行一次统一的资源分配，由Application Master自己去决定怎么把资源分给每一个Task，在实际开发中，我们发现自己似乎并没有写过资源分配相关的代码，MR的代码依旧可以运行，那是因为MRV2里面，默认提供了MR的Application Master，在MRV2里面，API也发生了变化，而为了兼容MRV1，分别存在两套API。</p>\n<p>同时由于MRV2的超高思想，将整个资源调度独立出来，这带来一个好处，那就是Yarn不单单能调度MR计算引擎，还能调度其他计算引擎，例如Spark。虽然目前有Mesos，但是大多数情况下我们还是会选择采用Yarn去作为资源调度器。</p>\n<h3>Spark分布式计算模型</h3>\n<p>看起来似乎MRV2向前迈进了一大步，解决了不少问题，然而对于MRV2来说，依然存在它无法跨越的问题。首先为了兼容MR计算模型，它依然保留着两阶段计算的模型，因为对迭代计算基本乏力。MR模型就像一个工厂流水线要生产辣椒酱，要先把辣椒切碎，然后再汇集起来做成辣椒酱，固定的2步操作，如果想在切碎之前再做点啥，或者做成辣椒酱之后再贴个标签啥的，MR模型就支撑不了，因此“需要任意灵活的进行迭代”这一需求就出来了，这个就是Spark的特点。</p>\n<p>同时，MR的核心思想是：运行在廉价服务器上，挪数据，所以对于实时计算，MVR2基本抓瞎。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark.png\"><img class=\"aligncenter size-large wp-image-5153\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark-1024x475.png\" alt=\"\" width=\"700\" height=\"325\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD.png\"><img class=\"aligncenter size-large wp-image-5155\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD-1024x493.png\" alt=\"\" width=\"700\" height=\"337\"></a></p>\n<p>在这些问题之上，Spark诞生。Spark的思想比较简单：挪计算不挪数据。既然要挪计算，那怎么去描述这个计算呢？于是通过RDD封装一个针对数据对应关系记录，在这个封装之上来记录计算。所以在Spark里面，操作分为两类：Action和Transformation。</p>\n<p>为什么会有这两类操作？我们可以想一下，如果数据被分散在100个阶段，我们需要做的是查询某个字段大于0的数据，那么这个计算根本不用把数据汇集在一起，统一过滤，分别在不同节点进行过滤就行了。</p>\n<p>而如果我们的操作是统计共有多少条数据，则需要将数据汇总，所以对于Spark来说，Action才真正会触发“挪数据”这个动作，Transformation只是做了一个标记转换。我们对Spark的各种调优，大部分时间也是在尽量减少Action的操作。由于在Spark里面，RDD是只读的，所以每一次操作，都会产生一个新的RDD，因此可以形成一系列的RDD依赖，我们也叫RDD链。</p>\n<h3>模型训练</h3>\n<p>模型训练更多的偏向于AI领域，在AI领域有两个明显的分支：概率论和神经网络。在计算能力欠缺的时候，概率论模型是最为普遍的做法，但是近年来发展起来的计算能力，让深度神经网络模型逐渐的展现出风采，很多框架都表明自己就是一个深度学习框架。</p>\n<p>模型训练本质上是对数据特征的提取，训练本身和大数据没有必然的关系，但是却相辅相成，数据量越大，提取的特征越多，模型训练出来的效果自然越好，然而数据量越大，对计算的要求就越高，也正因为如此，对模型的探索始终是在小数据、抽样领域进行尝试。</p>\n<p>那么什么是特征呢？举个例子，我们如果想要预测一个人能活多少岁，最简单的办法就是返回已知去世的人的平均年龄，无论是谁都返回这个值，要做这样的系统当然没有问题。但是仔细观察就会发现，男性能活多少岁和女性似乎不一样，那么我们可以简单的修改一下，在预测之前先判断一下性别，如果是男的就返回男的平均，女的则返回女性的平均。在这里我们已经无形的用了性别这个特征，是因为我们认为性别对结果是有影响的，而训练就需要找出无数个这样的特征。</p>\n<p>然而目前对于大数据的处理能力，似乎已经发展到了一个非常好的阶段，至少在分布式计算上，理论上是可以通过水平扩展无限的增加计算能力。</p>\n<p>可是模型的训练和应用在工程中的发展一直不是那么顺利，大约总结起来有如下几个原因：</p>\n<ul>\n<li>门槛较高，首先需要有比较专业的背景知识，同时还需要具备较强的编程能力，方能将其应用于工程之上。</li>\n<li>对于模型训练来说，没有大数据量的支持，生产上的效果始终差强人意，而数据量增大，如何去处理数据又成了另外一个领域的问题，能够同时处理好两方面的问题，人员较少。</li>\n<li>在实际工程中，我们获取到的数据集，往往不是训练模型直接能用的，要达到能够直接用于训练模型，还需要非常多的额外处理，这些代价甚至会高于模型训练本身，因此让模型训练这件事的成本变高。</li>\n<li>部分使用者，往往并没有达到模型训练的程度，例如连基本的数据平台都不存在，茫然的使用模型，导致效果不如预期，而将结果归结于模型本身的好坏之上。</li>\n</ul>\n<p>虽然模型训练的发展过程中有诸多问题，但是依旧能够看到其在向前发展，目前来说，基于GPU的训练，已经成了所有做模型训练的人的标配，Google甚至研发了自己的GPU：TPU。而很多芯片研发公司，也在致力于研究开发出专门用于模型训练的芯片。</p>\n<p>对于模型训练来说，目前一般会有两种做法：</p>\n<ul>\n<li>单机模型训练</li>\n<li>分布式模型训练</li>\n</ul>\n<h3>单机模型训练</h3>\n<p>所谓的单机训练，其实就是在一台机器上训练了，对于单机模型训练来讲，瓶颈主要在于提升单机的性能配置，例如不停的提高单个GPU的计算能力。而对于数据来说，大部分都是利用本地数据，虽然我们可以读取分布式文件系统的数据，但是实际上还是经过了shuffle操作，将数据读取到本地，而模型的训练，都是全程单机训练，我们可以通过各种优化算法，例如奇异值分解等手段，来降低计算成本。</p>\n<h3>分布式模型训练</h3>\n<p>对于单机训练来说，单个GPU，始终会陷入瓶颈，所以对于模型训练，也有人开始尝试，是否可以分布式训练？</p>\n<p>模型的分布式，相对于其他分布式计算会困难许多，首先模型依赖于数据，而模型本身的计算又要依赖于GPU，那么要如何将数据和计算能力结合？</p>\n<p>对于目前来讲，模型的分布式一般会有以下几种做法：</p>\n<ul>\n<li>数据分布式训练</li>\n<li>模型分布式训练</li>\n<li>混合训练</li>\n</ul>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism.png\"><img class=\"aligncenter size-large wp-image-5156\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism-1024x480.png\" alt=\"\" width=\"700\" height=\"328\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism.png\"><img class=\"aligncenter size-large wp-image-5157\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism-1024x258.png\" alt=\"\" width=\"700\" height=\"176\"></a></p>\n<p>上面的图片比较形象的描述了几种不同的训练方式，首先对于数据分布式来说，每一个节点都有一个完整模型的副本，而对于模型分布式来说，模型的计算会被分散到不同的节点上，例如Tensorflow就通过图形化的表达方法，将计算描述为一个图，然后再判断图中的哪些计算可以并行运行，分别拆分到不同的节点上进行训练，从而达到分布式训练的效果。在混合训练中，模型训练会被分散，同时数据也会分散，无论是哪种分布式训练，最终都会涉及一个操作：模型的归一。在目前来说，有不同的做法，可以将模型最终归一，例如集成算法就是逻辑上实现了模型的归一。</p>\n<h3>结尾</h3>\n<p>对于大数据和人工智能来讲，现在仅仅是萌芽时期，后面还有大量的工作要做，而模型的训练无论是单机还是分布式，都还没有达到真正稳定的生产批量效果，这些挑战，不仅仅来自于技术的实现，同时也来自于业务的配合，如何利用现有的技术能力，将其推广到业务上解决问题，才是重点需要关注的地方。</p>\n<p>文／ThoughtWorks白发川</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112222\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112222votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112222\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,spark,分布式计算,模型训练", "front_image_path": "full/426ef5967213f8fd73aeffa67da7449970de82dd.jpg"}
{"url_object_id": "919eee6bab5d88995a4efb5f71a1e9de", "title": "PHP实现定时任务（非linux-shell方式，与操作系统无关）", "create_time": "2017/08/16", "url": "http://blog.jobbole.com/112214/", "front_image_url": ["http://www.tkc8.com/images/sucai/img_crontab_1.png"], "praise_num": "2", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/3381391/blog/1510260\">大弹簧</a>   </div><p id=\"h3_0\">页面交互效果</p>\n<p>下面是写好的示例前端交互页面，主要是列表页面，编辑页面。</p>\n<p>主要交互有：</p>\n<p>1 开启定时任务进程<br>\n2 关闭定时任务进程<br>\n3 新增一项定时任务<br>\n4 编辑已有的定时任务<br>\n5 删除定时任务<br>\n6 开始一项定时任务<br>\n7 停止一项定时任务</p>\n<p>定时任务分两种：</p>\n<p>1 执行一次<br>\n2 循环执行</p>\n<p>定时任务执行的内容：</p>\n<p>定时任务执行的内容其实还是一个http请求。 通过定时的方式，指定时间执行或者循执行。</p>\n<h4 id=\"h4_1\">1 列表页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_1.png\" alt=\"图片名称\"></p>\n<h4 id=\"h4_2\">2 新建\\编辑页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_2.png\" alt=\"图片名称\"></p>\n<h3 id=\"h3_3\">代码地址，演示地址</h3>\n<p>示例代码是基于Laravel，Alpaca-spa框架编写，并且作为 ‘Alpaca-Spa-Laravel后台管理平台’的一个模块儿集成于系统中。</p>\n<p>代码 ： <a href=\"http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel\">http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel</a></p>\n<p>代码 ： <a href=\"https://github.com/big-sponge/Alpaca-Spa-Laravel\">https://github.com/big-sponge/Alpaca-Spa-Laravel</a></p>\n<p>Alpaca-Spa-Laravel ： <a href=\"http://full.tkc8.com/\">http://full.tkc8.com</a></p>\n<p>Alpaca-Spa ： <a href=\"http://www.tkc8.com/\">http://www.tkc8.com</a></p>\n<h3 id=\"h3_4\">适用范围</h3>\n<p>定时精确时间不低于1秒。web服务重启、或者php重启。该定时任务不会自动重启。</p>\n<h3 id=\"h3_5\">实现原理</h3>\n<p>用PHP实现定时任务（非linux-shell方式，与操作系统平台无关），主要两个技术点：</p>\n<p>1）PHP后台进程<br>\n2）PHP异步处理</p>\n<h4 id=\"h4_6\">1 PHP后台进程</h4>\n<p>一般情况，用命令行可以开启一个php后台进程。而在浏览器中通过HTTP请求一个php处理，会因为浏览器关闭，或者请求超时，使得后台的php处理中断。但是php提供了两个方法可以会忽略浏览器关闭、请求超时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11bd722946489\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nignore_user_abort(true);     // 忽略客户端断开\r\nset_time_limit(0);           // 设置执行不超时</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11bd722946489-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11bd722946489-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11bd722946489-1\"><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11bd722946489-2\"><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>因此，我们可以使用这两个函数从浏览器以HTTP请求的方式开启一个php后台进程。</p>\n<h4 id=\"h4_7\">2 PHP异步处理</h4>\n<p>php语言本身没有可以跨平台好用异步处理方法，但是可以通过curl或者fsockopen创建一个请求来实现异步处理。这里我们用fsockopen方法实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11d6215653891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11d6215653891-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11d6215653891-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11d6215653891-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11d6215653891-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h3 id=\"h3_8\">前台交互控制器</h3>\n<p>为了在前端界面方便控制定时任务的开启关闭，新增、编辑、删除，查看执行状态。 同时也可以添加权限控制。 主要有8个操作接口(下面是以Laravel 路由示例)：</p>\n<p>1 查看定时任务进程状态<br>\n2 开始定时任务进程 3 停止定时任务进程<br>\n4 添加,或者编辑定时任务<br>\n5 设置定时任务状态<br>\n6 获取指定定时任务明细<br>\n7 删除定时任务<br>\n8 获取定时任务列表</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11dc221657906\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* crontab - status 查看定时任务守护进程状态 */\r\nRoute::any('crontab/status', \"CrontabController@status\");\r\n\r\n/* crontab - start 开始定时任务 */\r\nRoute::any('crontab/start', \"CrontabController@start\");\r\n\r\n/* crontab - stop  停止定时任务守护进程*/\r\nRoute::any('crontab/stop', \"CrontabController@stop\");\r\n\r\n/* crontab - editTask  添加,或者编辑定时任务*/\r\nRoute::any('crontab/editTask', \"CrontabController@editTask\");\r\n\r\n/* crontab - changeTaskStatus  设置定时任务状态 */\r\nRoute::any('crontab/changeTaskStatus', \"CrontabController@changeTaskStatus\");\r\n\r\n/* crontab - getIndexTask  获取指定定时任务 */\r\nRoute::any('crontab/getIndexTask', \"CrontabController@getIndexTask\");\r\n\r\n/* crontab - removeTask  删除定时任务 */\r\nRoute::any('crontab/removeTask', \"CrontabController@removeTask\");\r\n\r\n/* crontab - listTask  获取定时任务列表 */\r\nRoute::any('crontab/listTask', \"CrontabController@listTask\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11dc221657906-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11dc221657906-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-1\"><span class=\"crayon-c\">/* crontab - status 查看定时任务守护进程状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-2\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/status'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@status\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-4\"><span class=\"crayon-c\">/* crontab - start 开始定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-5\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/start'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@start\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-6\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-7\"><span class=\"crayon-c\">/* crontab - stop  停止定时任务守护进程*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-8\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/stop'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@stop\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-10\"><span class=\"crayon-c\">/* crontab - editTask  添加,或者编辑定时任务*/</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-11\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/editTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@editTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-13\"><span class=\"crayon-c\">/* crontab - changeTaskStatus  设置定时任务状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-14\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/changeTaskStatus'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@changeTaskStatus\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-16\"><span class=\"crayon-c\">/* crontab - getIndexTask  获取指定定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-17\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/getIndexTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@getIndexTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-18\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-19\"><span class=\"crayon-c\">/* crontab - removeTask  删除定时任务 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-20\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/removeTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@removeTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11dc221657906-22\"><span class=\"crayon-c\">/* crontab - listTask  获取定时任务列表 */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11dc221657906-23\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/listTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@listTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>完整的类代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11e0150158986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace App\\Modules\\Manage\\Controllers;\r\n\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\nuse App\\Modules\\Manage\\Controllers\\Base\\BaseController;\r\nuse App\\Common\\Code;\r\nuse App\\Common\\Msg;\r\n\r\n/**\r\n * 定时任务管理控制器\r\n * @author Chengcheng\r\n * @date 2016-10-19 15:50:00\r\n */\r\nclass CrontabController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noLogin()\r\n    {\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 设置不需要权限验证的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noAuth()\r\n    {\r\n        // 以下Action不需要角色权限\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务守护进程状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function status()\r\n    {\r\n        //查看守护进程状态\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n        //异步开启守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaWorker::worker()-&gt;action(['REQUEST_URI' =&gt; \"/crontab/index/start\"]);\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 添加,或者编辑定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function editTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * BEGIN_TIME        开始时间\r\n         * END_TIME          结束时间\r\n         * INTERVAL          时间间隔\r\n         * NAME              名称\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * TASK_TYPE         类型 1-ONCE,      2-LOOP\r\n         * ACTION            要执行的Action\r\n         * INDEX             索引，null或者0时候，表示新建\r\n         * */\r\n        $this-&gt;requestData['NAME']       = $this-&gt;input('NAME', null);\r\n        $this-&gt;requestData['BEGIN_TIME'] = $this-&gt;input('BEGIN_TIME', null);\r\n        $this-&gt;requestData['END_TIME']   = $this-&gt;input('END_TIME', null);\r\n        $this-&gt;requestData['INTERVAL']   = $this-&gt;input('INTERVAL', null);\r\n        $this-&gt;requestData['TASK_TYPE']  = $this-&gt;input('TASK_TYPE', '1');\r\n        $this-&gt;requestData['ACTION']     = $this-&gt;input('ACTION', null);\r\n        $this-&gt;requestData['STATUS']     = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']      = $this-&gt;input('INDEX', null);\r\n        $this-&gt;requestData['LAST_TIME']  = $this-&gt;input('LAST_TIME', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'BEGIN_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['END_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'END_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['ACTION'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'ACTION');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['INTERVAL'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INTERVAL');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 设置结束时间\r\n        $now      = date('Y-m-d H:i:s', time());\r\n        $nextTime = date('Y-m-d H:i:s', strtotime($this-&gt;requestData['INTERVAL'], strtotime($this-&gt;requestData['BEGIN_TIME'])));\r\n        if ($this-&gt;requestData['TASK_TYPE'] == \"1\" || strtotime($now) &lt; strtotime($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $nextTime = $this-&gt;requestData['BEGIN_TIME'];\r\n        }\r\n\r\n        //4 创建任务\r\n        $task = array(\r\n            'NAME'       =&gt; $this-&gt;requestData['NAME'],           //NAME\r\n            'STATUS'     =&gt; $this-&gt;requestData['STATUS'],         // 1-ENABLED,   2-DISABLE\r\n            'TYPE'       =&gt; $this-&gt;requestData['TASK_TYPE'],      // 1-ONCE,      2-LOOP\r\n            'INTERVAL'   =&gt; $this-&gt;requestData['INTERVAL'],       //year（年），month（月），hour（小时）minute（分），second（秒）\r\n            'BEGIN_TIME' =&gt; $this-&gt;requestData['BEGIN_TIME'],     //开始时间\r\n            'NEXT_TIME'  =&gt; $nextTime,                            //下次执行时间\r\n            'LAST_TIME'  =&gt; $this-&gt;requestData['LAST_TIME'],      //上次执行时间\r\n            'ACTION'     =&gt; $this-&gt;requestData['ACTION'],         //执行的ACTION\r\n            'END_TIME'   =&gt; $this-&gt;requestData['END_TIME'],       //截止时间2\r\n        );\r\n\r\n        //5 判断是新建还是修改\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            //新建\r\n            $info = AlpacaCrontab::crontab()-&gt;addTask($task);\r\n        } else {\r\n            $this-&gt;requestData['INDEX'] -= 1;\r\n            $info = AlpacaCrontab::crontab()-&gt;editTask($this-&gt;requestData['INDEX'], $task);\r\n        }\r\n\r\n        //5 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $info;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 设置定时任务状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function changeTaskStatus()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['STATUS'] = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']  = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['STATUS'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'STATUS');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 修改状态\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;editTaskStatus($this-&gt;requestData['INDEX'], $this-&gt;requestData['STATUS']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查找单条定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function getIndexTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;getIndexTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function removeTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;removeTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务列表\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function listTask()\r\n    {\r\n        //查找\r\n        $data['task']   = AlpacaCrontab::crontab()-&gt;listTask();\r\n        $data['total']  = count($data['task']);\r\n        $data['status'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11e0150158986-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11e0150158986-294\">294</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-2\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-4\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-13\"><span class=\"crayon-c\"> * 定时任务管理控制器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-15\"><span class=\"crayon-c\"> * @date 2016-10-19 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CrontabController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noLogin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-31\"><span class=\"crayon-c\">     * 设置不需要权限验证的Action,不加Action前缀</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-33\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-34\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-35\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 以下Action不需要角色权限</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-43\"><span class=\"crayon-c\">     * 查看定时任务守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-44\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-45\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-46\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查看守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-59\"><span class=\"crayon-c\">     * 开始定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-60\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-61\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-62\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//异步开启守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/crontab/index/start\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-75\"><span class=\"crayon-c\">     * 停止定时任务守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-76\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-77\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-78\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-85\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-91\"><span class=\"crayon-c\">     * 添加,或者编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-92\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-93\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-94\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-98\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-99\"><span class=\"crayon-c\">         * BEGIN_TIME        开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-100\"><span class=\"crayon-c\">         * END_TIME          结束时间</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-101\"><span class=\"crayon-c\">         * INTERVAL          时间间隔</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-102\"><span class=\"crayon-c\">         * NAME              名称</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-103\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-104\"><span class=\"crayon-c\">         * TASK_TYPE         类型 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-105\"><span class=\"crayon-c\">         * ACTION            要执行的Action</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-106\"><span class=\"crayon-c\">         * INDEX             索引，null或者0时候，表示新建</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-107\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-117\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-120\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-122\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-125\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-126\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-133\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-137\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-138\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-140\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 设置结束时间</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-144\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-146\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 创建任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-149\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">//NAME</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//year（年），month（月），hour（小时）minute（分），second（秒）</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-153\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-154\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">                            </span><span class=\"crayon-c\">//下次执行时间</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-155\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">//上次执行时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">//执行的ACTION</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//截止时间2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 判断是新建还是修改</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//新建</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-164\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-168\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-169\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-170\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-171\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-172\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-173\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-174\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-175\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-177\"><span class=\"crayon-c\">     * 设置定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-178\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-179\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-180\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-181\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">changeTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-182\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-183\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-184\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-185\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-186\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-187\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-188\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-189\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-190\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-191\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-194\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-195\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-196\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-197\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-201\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-202\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 修改状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-204\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-205\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-206\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-207\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-208\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-209\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-210\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-211\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-212\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-213\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-214\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-215\"><span class=\"crayon-c\">     * 查找单条定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-216\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-217\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-218\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-221\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-222\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-223\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-224\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-225\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-226\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-227\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-228\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-230\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-232\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-233\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-234\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-235\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-236\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-237\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-238\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-239\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-240\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-241\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-242\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-243\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-244\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-245\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-246\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-247\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-248\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-249\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-250\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-251\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-252\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-253\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-254\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-255\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-256\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-257\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-258\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-260\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-261\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-262\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-263\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-264\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-265\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-266\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-267\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-268\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-269\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-270\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-271\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-272\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-273\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-274\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-275\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-276\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-277\"><span class=\"crayon-c\">     * 查看定时任务列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-278\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-279\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-280\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-281\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-282\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-283\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-284\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'total'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-286\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-287\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-288\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-289\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-290\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-291\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-292\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11e0150158986-293\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11e0150158986-294\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0393 seconds] -->\r\n<p></p>\n<h3 id=\"h3_9\">实现后台进程类</h3>\n<p>使用 ignore_user_abort(true); set_time_limit(0); 可以从浏览器开启一个php后台进程。为了避免出现多个后台进程，需要借助一个配置来标识该后台进程是否已经启动</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11f7576264591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"code\":\"1001\",\"message\":\"Stop at:2017-02-24 11:29:43\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11f7576264591-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11f7576264591-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Stop at:2017-02-24 11:29:43\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>当code是1001时候，表示后台进程未启动，这时通过http请求开启后台进程时，正常启动</p>\n<p>当code是1000时候，表示后台进程已经启动，这时通过http请求开启后台进程时，不做任何操作，以为进程已经启动</p>\n<p>当开启后台进程的请求到达后台时候，读取配置文件，如果code是1001，则启动进程，并且设置code为1000，保存配置文件。</p>\n<p>当关闭后台进程的请求到达后台时候，读取配置文件，设置code为1001，保存配置文件。</p>\n<p>后台进程在运行时候，每隔一秒读取配置文件，判断code状态，如果是1001，则结束执行； 如果是1000，则继续执行</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca11fd143414068\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 守护进程\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaDaemon\r\n{\r\n    private $daemon_json = __DIR__ . '/deamon.json';\r\n\r\n    private static $instance;\r\n\r\n    private $events = [];\r\n\r\n    public static function daemon()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;daemon_json = base_path('storage') . '/crontab/deamon.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function setDaemon($daemon_json)\r\n    {\r\n        $this-&gt;daemon_json = $daemon_json;\r\n        return $this;\r\n    }\r\n\r\n    public function setEvents(array $events)\r\n    {\r\n        $this-&gt;events = $events;\r\n        return $this;\r\n    }\r\n\r\n    public function status()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json),true);\r\n        if(empty($data)){\r\n            $data = array();\r\n        }\r\n        return $data;\r\n    }\r\n\r\n    public function stop()\r\n    {\r\n        $data =new \\stdClass();\r\n        $data-&gt;code=\"1001\";\r\n        $data-&gt;message=\"Stop at:\".date(\"Y-m-d H:i:s\" ,time());\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"操作成功\";\r\n        return $result;\r\n    }\r\n\r\n    public function start()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n        if(empty($data)){\r\n            $data['code']=\"1001\";\r\n        }\r\n\r\n        if($data['code'] == \"1000\" ){\r\n            //die(\"Error - exit,   Already running !\");\r\n            return;\r\n        }\r\n\r\n        $data['code']=\"1000\";\r\n        $data['message']=\"Start\";\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        ignore_user_abort(true);     // 忽略客户端断开\r\n        set_time_limit(0);           // 设置执行不超时\r\n\r\n\r\n        while(true){\r\n            $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n            if(empty($data) || empty($data['code']) || $data['code'] == \"1001\" ){\r\n                break;\r\n            }\r\n\r\n            if(!empty($this-&gt;events)){\r\n                foreach ($this-&gt;events as $e){\r\n                    $e();\r\n                }\r\n            }\r\n\r\n            $data['message'] = date(\"Y-m-d H:i:s\" ,time()).\" : Working ...\";\r\n            file_put_contents($this-&gt;daemon_json, json_encode($data), LOCK_EX);\r\n            sleep(1);\r\n        }\r\n        $this-&gt;stop();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca11fd143414068-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca11fd143414068-102\">102</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-2\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-5\"><span class=\"crayon-c\"> * 守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaDaemon</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-14\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-16\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-30\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setDaemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-36\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-42\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">stdClass</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Stop at:\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-58\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"操作成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-68\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-70\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//die(\"Error - exit,   Already running !\");</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Start\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-82\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-83\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-85\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-86\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-87\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-90\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-91\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">events </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-92\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">e</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-93\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-94\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-95\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-96\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\" : Working ...\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-100\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca11fd143414068-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca11fd143414068-102\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0141 seconds] -->\r\n<p></p>\n<h3 id=\"h3_10\">实现异步处理的类</h3>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca1204628883757\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\nclass AlpacaWorker\r\n{        \r\n    private static $instance;\r\n\r\n    private $accessToken = '';\r\n\r\n    public static function worker()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;accessToken= 'VyKfohBbwlkTOqp2jvIWPW92';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function action(array $worker = null)\r\n    {\r\n        //获取参数\r\n        $ip   = empty($worker['SERVER_ADDR']) ? $_SERVER['SERVER_NAME'] : $worker['SERVER_ADDR'];     //服务器IP地址\r\n        $port = empty($worker['SERVER_PORT']) ? $_SERVER['SERVER_PORT'] : $worker['SERVER_PORT'];     //服务器端口\r\n        $url  = empty($worker['REQUEST_URI']) ? '/' :$worker['REQUEST_URI'];                          //服务器URL\r\n        $data = empty($worker['REQUEST_DATA']) ? '' :$worker['REQUEST_DATA'];                         //请求参数\r\n\r\n        //格式化请求参数\r\n        $postData = \"\";\r\n        $needChar = false;\r\n        if(is_array($data)){\r\n            foreach($data as $key =&gt; $val) {\r\n                $postData .= ($needChar ? \"&amp;\" : \"\") . urlencode($key) . \"=\" . urlencode($val);\r\n                $needChar = true;\r\n            }\r\n        }else{\r\n            $postData = $data;\r\n        }\r\n\r\n        $url=$url.\"?accessToken=\".$this-&gt;accessToken;\r\n\r\n        //使用fsockopen方式异步调用action\r\n        $fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }       \r\n        return 'worker success!';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca1204628883757-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca1204628883757-63\">63</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-2\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaWorker</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-5\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-14\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'VyKfohBbwlkTOqp2jvIWPW92'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">ip</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器IP地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器端口</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                          </span><span class=\"crayon-c\">//服务器URL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                         </span><span class=\"crayon-c\">//请求参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//格式化请求参数</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">is_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"?accessToken=\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//使用fsockopen方式异步调用action</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-52\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker success!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca1204628883757-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca1204628883757-63\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0126 seconds] -->\r\n<p></p>\n<h3 id=\"h3_11\">定时任务处理类</h3>\n<p>定时任务处理类 主要是实现新增、编辑、删除定时任务，执行定时任务要处理的方法</p>\n<p>定时任务的信息以json格式存放在下面的配置文件中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca1209274432826\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[{\"NAME\":\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\",\"STATUS\":\"2\",\"TYPE\":\"1\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-02-21 11:55:00\",\"NEXT_TIME\":\"2017-02-21 11:55:00\",\"LAST_TIME\":null,\"ACTION\":\"\\/main\\/crontab\\/index2\",\"END_TIME\":\"2017-02-10 15:55:00\"},{\"NAME\":\"TEST - log\",\"STATUS\":\"2\",\"TYPE\":\"2\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-08-10 09:00:53\",\"NEXT_TIME\":\"2017-08-10 09:59:00\",\"LAST_TIME\":\"2017-08-10 09:58:55\",\"ACTION\":\"\\/crontab\\/task\\/test\",\"END_TIME\":\"2017-08-11 09:25:53\"}]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca1209274432826-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca1209274432826-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/main\\/crontab\\/index2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-10 15:55:00\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"TEST - log\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:00:53\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:59:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:58:55\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/crontab\\/task\\/test\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-11 09:25:53\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>主要的字段为：</p>\n<p>INDEX 索引<br>\nBEGIN_TIME 开始时间<br>\nEND_TIME 结束时间<br>\nINTERVAL 时间间隔<br>\nNAME 名称<br>\nSTATUS 状态 1-ENABLED, 2-DISABLE<br>\nTASK_TYPE 类型 1-ONCE, 2-LOOP<br>\nACTION 要执行的Action</p>\n<p>类中主要有7个方法：</p>\n<p>listTask() 查看定时任务列表 addTask() 添加定时任务 editTask() 编辑定时任务 editTaskStatus() 编辑定时任务状态 getIndexTask() 获取指定定时任务信息 removeTask() 删除定时任务 doTask() 执行定时任务指定的任务</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca120d304537596\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 定时任务\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaCrontab\r\n{\r\n    //定时任务文件\r\n    private $task_json = __DIR__ .'/crontab.json';\r\n\r\n    //单例\r\n    private static $instance;\r\n\r\n    //单例\r\n    public static function crontab()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    //单例\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;task_json = base_path('storage') . '/crontab/crontab.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    /**\r\n     * 配置\r\n     * @author Chengcheng\r\n     * @param array $crontab\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function setConfig($crontab)\r\n    {\r\n        $this-&gt;task_json = $crontab;\r\n        return $this;\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function listTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $i = 0;\r\n        foreach ($tasks as $task)\r\n        {\r\n            $tasks[$i]-&gt;INTERVAL = $this-&gt;timeToStr($tasks[$i]-&gt;INTERVAL);\r\n            $i++;\r\n        }\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 添加定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function addTask($task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"添加成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json),true);\r\n        $tasks[count($tasks)] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $task\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTask($index,$task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"修改成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务状态\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $status\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTaskStatus($index,$status)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"修改状态成功[\".$status.\"]\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index]-&gt;STATUS = $status;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 获取定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function getIndexTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"获取任务成功【\".$index.\"】\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $result_data[\"result_data\"] = $tasks[$index];\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function removeTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"删除任务【\".$index.\"】成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        array_splice($tasks, $index, 1);\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function doTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json) ,true);      \r\n        if(empty($tasks)){ return ;}\r\n\r\n        $now = date('Y-m-d H:i:s',time());\r\n        foreach ($tasks as &amp;$task){\r\n            if(empty($task['STATUS']) || empty($task['TYPE'])  || empty($task['BEGIN_TIME']) || empty($task['ACTION']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['STATUS'] != 1)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['END_TIME']) &amp;&amp; strtotime($now)&gt;=strtotime($task['END_TIME'])){\r\n                $task['NEXT_TIME']='END';\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; empty($task['NEXT_TIME']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2 &amp;&amp; empty($task['INTERVAL']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['NEXT_TIME']) &amp;&amp; $task['NEXT_TIME']=='END' )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; (strtotime($now)&gt;=strtotime($task['NEXT_TIME'])))\r\n            {\r\n                $task['LAST_TIME']= $now;\r\n                $task['NEXT_TIME']='END';\r\n                $task['STATUS']=2;\r\n                AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2)\r\n            {\r\n                if(empty($task['NEXT_TIME'])){\r\n                    $task['NEXT_TIME'] = $task['BEGIN_TIME'];\r\n                }\r\n\r\n                if(strtotime($now)&gt;=strtotime($task['NEXT_TIME'])){\r\n                    $task['LAST_TIME']= $now;\r\n                    $task['NEXT_TIME']= date('Y-m-d H:i:s',strtotime($task['INTERVAL']));\r\n                    AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 格式化时间\r\n     * @author Chengcheng\r\n     * @param string $interval\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    private function timeToStr($interval)\r\n    {\r\n        $result = \"\";\r\n        if($interval != null &amp;&amp; $interval != \"\"){\r\n            $temp = explode(\" \", $interval);\r\n            $iNumTemp = $temp[0];\r\n            $iType = $temp[1];\r\n            $iNum = str_replace(\"+\", \"\", $iNumTemp);\r\n            $str = \"\";\r\n            switch ($iType){\r\n                case \"year\":\r\n                    $str = \"（年）\";\r\n                    break;\r\n                case \"month\":\r\n                    $str = \"（月）\";\r\n                    break;\r\n                case \"day\":\r\n                    $str = \"（日）\";\r\n                    break;\r\n                case \"hour\":\r\n                    $str = \"（小时）\";\r\n                    break;\r\n                case \"minute\":\r\n                    $str = \"（分）\";\r\n                    break;\r\n                case \"second\":\r\n                    $str = \"（秒）\";\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n           $result = $iNum. $str;\r\n        }\r\n        return $result;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca120d304537596-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca120d304537596-262\">262</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-2\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-5\"><span class=\"crayon-c\"> * 定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaCrontab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//定时任务文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-16\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-22\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-32\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-34\"><span class=\"crayon-c\">     * 配置</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-35\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-36\"><span class=\"crayon-c\">     * @param array $crontab</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-37\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-38\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-39\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-47\"><span class=\"crayon-c\">     * 查看定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-48\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-49\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-50\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-51\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-65\"><span class=\"crayon-c\">     * 添加定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-66\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-67\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-68\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-69\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"添加成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-81\"><span class=\"crayon-c\">     * 编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-82\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-83\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-84\"><span class=\"crayon-c\">     * @param string $task</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-85\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-86\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-87\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-97\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-99\"><span class=\"crayon-c\">     * 编辑定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-100\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-101\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-102\"><span class=\"crayon-c\">     * @param string $status</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-103\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-104\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-105\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改状态成功[\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"]\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">STATUS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-115\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-117\"><span class=\"crayon-c\">     * 获取定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-118\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-119\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-120\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-121\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-122\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"获取任务成功【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_data\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-131\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-133\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-134\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-135\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-136\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-137\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-138\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"删除任务【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">array_splice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-148\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-150\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-151\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-152\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-153\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-154\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-155\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-156\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-157\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-164\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-166\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-167\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-168\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-169\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-171\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-172\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-173\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-174\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-175\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-176\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-177\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-178\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-179\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-181\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-184\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-185\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-186\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-188\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-189\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-190\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-191\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-192\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-194\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-195\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-196\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-197\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-198\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-200\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-203\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-204\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-205\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-206\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-207\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-208\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-209\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-210\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-211\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-212\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-213\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-214\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-215\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-216\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-217\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-218\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-219\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-221\"><span class=\"crayon-c\">     * 格式化时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-222\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-223\"><span class=\"crayon-c\">     * @param string $interval</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-224\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-225\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-226\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-227\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-229\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-230\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-232\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-233\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-234\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str_replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"+\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-235\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-236\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-237\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"year\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-238\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（年）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-239\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-240\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"month\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-241\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（月）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-242\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-243\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"day\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-244\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（日）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-245\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-246\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"hour\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-247\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（小时）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-248\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-249\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"minute\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-250\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（分）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-251\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-252\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"second\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-253\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（秒）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-254\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-255\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-256\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-258\"><span class=\"crayon-h\">           </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-260\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca120d304537596-261\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca120d304537596-262\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0352 seconds] -->\r\n<p></p>\n<h3 id=\"h3_12\">定时任务进程入口控制器</h3>\n<p>主要是为了实现异步开启后台进程</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add60ca121a212233512\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Controllers;\r\n\r\nuse Crontab\\Common\\Code;\r\nuse Crontab\\Common\\Msg;\r\nuse Crontab\\Controllers\\Base\\BaseController;\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\n\r\n/**\r\n * index\r\n * @author Chengcheng\r\n * @date 2017-02-22 15:50:00\r\n */\r\nclass IndexController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function withoutLoginActions()\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n\r\n        //开始守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n\r\n        //在守护进程中注入定时任务\r\n        $events = ['0'=&gt;function(){\r\n            AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"/crontab/index/task\"]);\r\n        }];\r\n        AlpacaDaemon::daemon()-&gt;setEvents($events);\r\n        AlpacaDaemon::daemon()-&gt;start();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function task()\r\n    {\r\n        //执行定时任务\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaCrontab::crontab()-&gt;doTask();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59add60ca121a212233512-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add60ca121a212233512-84\">84</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-2\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-4\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-13\"><span class=\"crayon-c\"> * index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-15\"><span class=\"crayon-c\"> * @date 2017-02-22 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IndexController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">withoutLoginActions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-31\"><span class=\"crayon-c\">     * 开始定时任务的守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-33\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-34\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//开始守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//在守护进程中注入定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'0'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"/crontab/index/task\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-48\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-52\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-54\"><span class=\"crayon-c\">     * 停止定时任务的守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-55\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-56\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-57\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-64\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-68\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-70\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-71\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-72\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-73\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-80\"> </div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add60ca121a212233512-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add60ca121a212233512-84\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0099 seconds] -->\r\n<p>以上是PHP实现定时任务的核心类与方法， 完整的代码请参看代码服务器中提供的源码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112214\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112214votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112214\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术", "front_image_path": "full/d37aff70183dd816975d0900846be5d88def1c7a.jpg"}
{"url_object_id": "14cfc2026b582f161bc18bdb5bf704ab", "title": "一文了解 Kubernetes 是什么？", "create_time": "2017/08/23", "url": "http://blog.jobbole.com/112243/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/\">Kubernetes.io</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8800-1.html\">Linux中国/songshuang00</a>   </div><p>这是一篇 Kubernetes 的概览。</p>\n<p>Kubernetes 是一个<a href=\"http://www.slideshare.net/BrianGrant11/wso2con-us-2015-kubernetes-a-platform-for-automating-deployment-scaling-and-operations\">自动化部署、伸缩和操作应用程序容器的开源平台</a>。</p>\n<p>使用 Kubernetes，你可以快速、高效地满足用户以下的需求：</p>\n<ul>\n<li>快速精准地部署应用程序</li>\n<li>即时伸缩你的应用程序</li>\n<li>无缝展现新特征</li>\n<li>限制硬件用量仅为所需资源</li>\n</ul>\n<p>我们的目标是培育一个工具和组件的生态系统，以减缓在公有云或私有云中运行的程序的压力。</p>\n<h4 id=\"toc_1\">Kubernetes 的优势</h4>\n<ul>\n<li>  <strong>可移动</strong>: 公有云、私有云、混合云、多态云</li>\n<li>  <strong>可扩展</strong>: 模块化、插件化、可挂载、可组合</li>\n<li>  <strong>自修复</strong>: 自动部署、自动重启、自动复制、自动伸缩</li>\n</ul>\n<p>Google 公司于 2014 年启动了 Kubernetes 项目。Kubernetes 是在 <a href=\"https://research.google.com/pubs/pub43438.html\">Google 的长达 15 年的成规模的产品级任务的经验下</a>构建的，结合了来自社区的最佳创意和实践经验。</p>\n<h3 id=\"toc_2\">为什么选择容器?</h3>\n<p>想要知道你为什么要选择使用 <a href=\"https://aucouranton.com/2014/06/13/linux-containers-parallels-lxc-openvz-docker-and-more/\">容器</a>?</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg\"></p>\n<p>程序部署的<em>传统方法</em>是指通过操作系统包管理器在主机上安装程序。这样做的缺点是，容易混淆程序之间以及程序和主机系统之间的可执行文件、配置文件、库、生命周期。为了达到精准展现和精准回撤，你可以搭建一台不可变的虚拟机镜像。但是虚拟机体量往往过于庞大而且不可转移。</p>\n<p>容器部署的<em>新的方式</em>是基于操作系统级别的虚拟化，而非硬件虚拟化。容器彼此是隔离的，与宿主机也是隔离的：它们有自己的文件系统，彼此之间不能看到对方的进程，分配到的计算资源都是有限制的。它们比虚拟机更容易搭建。并且由于和基础架构、宿主机文件系统是解耦的，它们可以在不同类型的云上或操作系统上转移。</p>\n<p>正因为容器又小又快，每一个容器镜像都可以打包装载一个程序。这种一对一的“程序 – 镜像”联系带给了容器诸多便捷。有了容器，静态容器镜像可以在编译/发布时期创建，而非部署时期。因此，每个应用不必再等待和整个应用栈其它部分进行整合，也不必和产品基础架构环境之间进行妥协。在编译/发布时期生成容器镜像建立了一个持续地把开发转化为产品的环境。相似地，容器远比虚拟机更加透明，尤其在设备监控和管理上。这一点，在容器的进程生命周期被基础架构管理而非被容器内的进程监督器隐藏掉时，尤为显著。最终，随着每个容器内都装载了单一的程序，管理容器就等于管理或部署整个应用。</p>\n<p>容器优势总结：</p>\n<ul>\n<li>  <strong>敏捷的应用创建与部署</strong>：相比虚拟机镜像，容器镜像的创建更简便、更高效。</li>\n<li>  <strong>持续的开发、集成，以及部署</strong>：在快速回滚下提供可靠、高频的容器镜像编译和部署（基于镜像的不可变性）。</li>\n<li>  <strong>开发与运营的关注点分离</strong>：由于容器镜像是在编译/发布期创建的，因此整个过程与基础架构解耦。</li>\n<li>  <strong>跨开发、测试、产品阶段的环境稳定性</strong>：在笔记本电脑上的运行结果和在云上完全一致。</li>\n<li>  <strong>在云平台与 OS 上分发的可转移性</strong>：可以在 Ubuntu、RHEL、CoreOS、预置系统、Google 容器引擎，乃至其它各类平台上运行。</li>\n<li>  <strong>以应用为核心的管理</strong>: 从在虚拟硬件上运行系统，到在利用逻辑资源的系统上运行程序，从而提升了系统的抽象层级。</li>\n<li>  <strong>松散耦联、分布式、弹性、无拘束的<a href=\"https://martinfowler.com/articles/microservices.html\">微服务</a></strong>：整个应用被分散为更小、更独立的模块，并且这些模块可以被动态地部署和管理，而不再是存储在大型的单用途机器上的臃肿的单一应用栈。</li>\n<li>  <strong>资源隔离</strong>：增加程序表现的可预见性。</li>\n<li>  <strong>资源利用率</strong>：高效且密集。</li>\n</ul>\n<h4 id=\"toc_3\">为什么我需要 Kubernetes，它能做什么?</h4>\n<p>至少，Kubernetes 能在实体机或虚拟机集群上调度和运行程序容器。而且，Kubernetes 也能让开发者斩断联系着实体机或虚拟机的“锁链”，从<strong>以主机为中心</strong>的架构跃至<strong>以容器为中心</strong>的架构。该架构最终提供给开发者诸多内在的优势和便利。Kubernetes 提供给基础架构以真正的<strong>以容器为中心</strong>的开发环境。</p>\n<p>Kubernetes 满足了一系列产品内运行程序的普通需求，诸如：</p>\n<ul>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod/\">协调辅助进程</a>，协助应用程序整合，维护一对一“程序 – 镜像”模型。</li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/storage/volumes/\">挂载存储系统</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">分布式机密信息</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/\">检查程序状态</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/\">复制应用实例</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/\">使用横向荚式自动缩放</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/\">命名与发现</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\">负载均衡</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/\">滚动更新</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/\">资源监控</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/cluster-administration/logging/\">访问并读取日志</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/\">程序调试</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/admin/authorization/\">提供验证与授权</a></li>\n</ul>\n<p>以上兼具平台即服务（PaaS）的简化和基础架构即服务（IaaS）的灵活，并促进了在平台服务提供商之间的迁移。</p>\n<h4 id=\"toc_4\">Kubernetes 是一个什么样的平台?</h4>\n<p>虽然 Kubernetes 提供了非常多的功能，总会有更多受益于新特性的新场景出现。针对特定应用的工作流程，能被流水线化以加速开发速度。特别的编排起初是可接受的，这往往需要拥有健壮的大规模自动化机制。这也是为什么 Kubernetes 也被设计为一个构建组件和工具的生态系统的平台，使其更容易地部署、缩放、管理应用程序。</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\">标签</a>（label）可以让用户按照自己的喜好组织资源。 <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/\">注释</a>（annotation）让用户在资源里添加客户信息，以优化工作流程，为管理工具提供一个标示调试状态的简单方法。</p>\n<p>此外，<a href=\"https://kubernetes.io/docs/concepts/overview/components/\">Kubernetes 控制面板</a>是由开发者和用户均可使用的同样的 <a href=\"https://kubernetes.io/docs/reference/api-overview/\">API</a> 构建的。用户可以编写自己的控制器，比如 <a href=\"https://git.k8s.io/community/contributors/devel/scheduler.md\">调度器</a>（scheduler），使用可以被通用的<a href=\"https://kubernetes.io/docs/user-guide/kubectl-overview/\">命令行工具</a>识别的<a href=\"https://git.k8s.io/community/contributors/design-proposals/extending-api.md\">他们自己的 API</a>。</p>\n<p>这种<a href=\"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/principles.md\">设计</a>让大量的其它系统也能构建于 Kubernetes 之上。</p>\n<h4 id=\"toc_5\">Kubernetes 不是什么？</h4>\n<p>Kubernetes 不是传统的、全包容的平台即服务（Paas）系统。它尊重用户的选择，这很重要。</p>\n<p>Kubernetes：</p>\n<ul>\n<li>  并不限制支持的程序类型。它并不检测程序的框架 (例如，<a href=\"http://wildfly.org/\">Wildfly</a>)，也不限制运行时支持的语言集合 (比如， Java、Python、Ruby)，也不仅仅迎合 <a href=\"https://12factor.net/\">12 因子应用程序</a>，也不区分 <em>应用</em> 与 <em>服务</em> 。Kubernetes 旨在支持尽可能多种类的工作负载，包括无状态的、有状态的和处理数据的工作负载。如果某程序在容器内运行良好，它在 Kubernetes 上只可能运行地更好。</li>\n<li>  不提供中间件（例如消息总线）、数据处理框架（例如 Spark）、数据库（例如 mysql），也不把集群存储系统（例如 Ceph）作为内置服务。但是以上程序都可以在 Kubernetes 上运行。</li>\n<li>  没有“点击即部署”这类的服务市场存在。</li>\n<li>  不部署源代码，也不编译程序。持续集成 (CI) 工作流程是不同的用户和项目拥有其各自不同的需求和表现的地方。所以，Kubernetes 支持分层 CI 工作流程，却并不监听每层的工作状态。</li>\n<li>  允许用户自行选择日志、监控、预警系统。（ Kubernetes 提供一些集成工具以保证这一概念得到执行）</li>\n<li>  不提供也不管理一套完整的应用程序配置语言/系统（例如 <a href=\"https://github.com/google/jsonnet\">jsonnet</a>）。</li>\n<li>  不提供也不配合任何完整的机器配置、维护、管理、自我修复系统。</li>\n</ul>\n<p>另一方面，大量的 PaaS 系统运行<em>在</em> Kubernetes 上，诸如 <a href=\"https://www.openshift.org/\">Openshift</a>、<a href=\"http://deis.io/\">Deis</a>，以及 <a href=\"http://eldarion.cloud/\">Eldarion</a>。你也可以开发你的自定义 PaaS，整合上你自选的 CI 系统，或者只在 Kubernetes 上部署容器镜像。</p>\n<p>因为 Kubernetes 运营在应用程序层面而不是在硬件层面，它提供了一些 PaaS 所通常提供的常见的适用功能，比如部署、伸缩、负载平衡、日志和监控。然而，Kubernetes 并非铁板一块，这些默认的解决方案是可供选择，可自行增加或删除的。</p>\n<p>而且， Kubernetes 不只是一个<em>编排系统</em> 。事实上，它满足了编排的需求。 <em>编排</em> 的技术定义是，一个定义好的工作流程的执行：先做 A，再做 B，最后做 C。相反地， Kubernetes 囊括了一系列独立、可组合的控制流程，它们持续驱动当前状态向需求的状态发展。从 A 到 C 的具体过程并不唯一。集中化控制也并不是必须的；这种方式更像是<em>编舞</em>。这将使系统更易用、更高效、更健壮、复用性、扩展性更强。</p>\n<h4 id=\"toc_6\">Kubernetes 这个单词的含义？k8s？</h4>\n<p><strong>Kubernetes</strong> 这个单词来自于希腊语，含义是 <em>舵手</em> 或 <em>领航员</em> 。其词根是 <em>governor</em> 和 <a href=\"http://www.etymonline.com/index.php?term=cybernetics\">cybernetic</a>。 <em>K8s</em> 是它的缩写，用 8 字替代了“ubernete”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112243\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112243votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112243\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,容器", "front_image_path": "full/5a5136cb07db18c3ddd05b650d26aa95a4c39b84.jpg"}
{"url_object_id": "42ebcbade0688b35076d01309348c96f", "title": "MySQL 高性能表设计规范", "create_time": "2017/07/27", "url": "http://blog.jobbole.com/112035/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "praise_num": "3", "comment_num": 2, "fav_num": 7, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/f797bbe11d76\">高广超</a>   </div><div>\n<div>\n<p>良好的逻辑设计和物理设计是高性能的基石， 应该根据系统将要执行的查询语句来设计schema, 这往往需要权衡各种因素。</p>\n<h2>一、选择优化的数据类型</h2>\n<p>MySQL支持的数据类型非常多， 选择正确的数据类型对于获得高性能至关重要。</p>\n<h4>更小的通常更好</h4>\n<p>更小的数据类型通常更快， 因为它们占用更少的磁盘、 内存和CPU缓存， 并且处理时需要的CPU周期也更少。</p>\n<h4>简单就好</h4>\n<p>简单数据类型的操作通常需要更少的CPU周期。 例如， 整型比字符操作代价更低， 因为字符集和校对规则（排序规则 ）使字符比较比整型比较更复杂。</p>\n<h4>尽量避免NULL</h4>\n<p>如果查询中包含可为NULL 的列， 对MySQL来说更难优化， 因为可为NULL 的列使得索引、 索引统计和值比较都更复杂。 可为NULL的列会使用更多的存储空间， 在MySQL里也需要特殊处理。 当可为NULL的列被索引时， 每个索引记录需要一个额外的字节， 在MyISAM里甚至还可能导致固定大小的索引（例如只有一个整数列的索引）变成可变大小的索引。<br>\n当然也有例外， 例如InnoDB 使用单独的位 (bit) 存储NULL值， 所以对于稀疏数据有很好的空间效率。</p>\n<h3>1.整数类型</h3>\n<p>有两种类型的数字：整数 (whole number) 和实数 (real number) 。 如果存储整数， 可以使用这几种整数类型：TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT。分别使用8,16, 24, 32, 64位存储空间。</p>\n<p>整数类型有可选的 **UNSIGNED ** 属性，表示不允许负值，这大致可以使正数的上限提高一倍。 例如 TINYINT. UNSIGNED 可以存储的范围是 0 – 255, 而 TINYINT 的存储范围是 -128 -127 。</p>\n<p><strong>有符号和无符号类型使用相同的存储空间，并具有相同的性能</strong> ， 因此可以根据实际情况选择合适的类型。</p>\n<p>你的选择决定 MySQL 是怎么在内存和磁盘中保存数据的。 然而， 整数计算一般使用64 位的 BIGINT 整数， 即使在 32 位环境也是如此。（ 一些聚合函数是例外， 它们使用DECIMAL 或 DOUBLE 进行计算）。</p>\n<p>MySQL 可以为整数类型指定宽度， 例如 INT(11), 对大多数应用这是没有意义的：它不会限制值的合法范围，只是规定了MySQL 的一些交互工具（例如 MySQL 命令行客户端）用来显示字符的个数。 对于存储和计算来说， INT(1) 和 INT(20) 是相同的。</p>\n<h3>2.实数类型</h3>\n<p>实数是带有小数部分的数字。 然而， 它们不只是为了存储小数部分，也可以使用DECIMAL 存储比 BIGINT 还大的整数。</p>\n<p>FLOAT和DOUBLE类型支持使用标准的浮点运算进行近似计算。<br>\nDECIMAL类型用于存储精确的小数。<br>\n浮点和DECIMAL类型都可以指定精度。 对于DECIMAL列， 可以指定小数点前后所允许的最大位数。这会影响列的空间消耗。</p>\n<p>有多种方法可以指定浮点列所需要的精度， 这会使得MySQL选择不同的数据类型，或者在存储时对值进行取舍。 这些精度定义是非标准的，<strong>所以我们建议只指定数据类型，不指定精度。</strong></p>\n<p><strong>浮点类型在存储同样范围的值时， 通常比DECIMAL使用更少的空间。FLOAT使用4个字节存储。DOUBLE占用8个字节，相比FLOAT有更高的精度和更大的范围。和整数类型一样， 能选择的只是存储类型； MySQL使用DOUBLE作为内部浮点计算的类型。</strong></p>\n<p>因为需要额外的空间和计算开销，所以应该尽量只在对小数进行精确计算时才使用DECIMAL。<strong>但在数据最比较大的时候， 可以考虑使用BIGINT代替DECIMAL, 将需要存储的货币单位根据小数的位数乘以相应的倍数即可。</strong></p>\n<h3>3.字符串类型</h3>\n<h4>VARCHAR</h4>\n<p>用于存储可变⻓字符串，长度支持到65535<br>\n需要使用1或2个额外字节记录字符串的长度<br>\n适合：字符串的最大⻓度比平均⻓度⼤很多；更新很少</p>\n<h4>CHAR</h4>\n<p>定⻓，⻓度范围是1~255<br>\n适合：存储很短的字符串，或者所有值接近同一个长度；经常变更</p>\n<h4>慷慨是不明智的</h4>\n<p>使用VARCHAR(5)和VARCHAR(200)存储’hello’的空间开销是一样的。 那么使用更短的列有什么优势吗？</p>\n<p>事实证明有很大的优势。 更长的列会消耗更多的内存， 因为MySQL通常会分配固定大小的内存块来保存内部值。 尤其是使用内存临时表进行排序或操作时会特别糟糕。 在利用磁盘临时表进行排序时也同样糟糕。</p>\n<p>所以最好的策略是只分配真正需要的空间。</p>\n<h3>4.BLOB和TEXT类型</h3>\n<p>BLOB和 TEXT都是为存储很大的数据而设计的字符串数据类型， 分别采用 二进制和字符方式存储 。</p>\n<p>与其他类型不同， MySQL把每个BLOB和TEXT值当作一个独立的对象处理。 存储引擎在存储时通常会做特殊处理。 当BLOB和TEXT值太大时，InnoDB会使用专门的 “外部“存储区域来进行存储， 此时每个值在行内需要1 – 4个字节存储 存储区域存储实际的值。</p>\n<p>BLOB 和 TEXT 之间仅有的不同是 BLOB 类型存储的是二进制数据， 没有排序规则或字符集， 而 TEXT类型有字符集和排序规则</p>\n<h3>5.日期和时间类型</h3>\n<p>大部分时间类型都没有替代品， 因此没有什么是最佳选择的问题。 唯一的问题是保存日期和时间的时候需要做什么。 MySQL提供两种相似的日期类型： DATE TIME和 TIMESTAMP。</p>\n<p>但是目前我们更建议存储时间戳的方式，因此该处不再对 DATE TIME和 TIMESTAMP做过多说明。</p>\n<h3>5.其他类型</h3>\n<h4>5.1选择标识符</h4>\n<p>在可以满足值的范围的需求， 井且预留未来增长空间的前提下， 应该选择最小的数据类型。</p>\n<h5>整数类型</h5>\n<p>整数通常是标识列最好的选择， 因为它们很快并且可以使用AUTO_INCREMENT。</p>\n<h5>ENUM和SET类型</h5>\n<p>对于标识列来说，EMUM和SET类型通常是一个糟糕的选择， 尽管对某些只包含固定状态或者类型的静态 ”定义表” 来说可能是没有问题的。ENUM和SET列适合存储固定信息， 例如有序的状态、 产品类型、 人的性别。</p>\n<h5>字符串类型</h5>\n<p>如果可能， 应该避免使用字符串类型作为标识列， 因为它们很消耗空间， 并且通常比数字类型慢。</p>\n<p>对于完全 “随机” 的字符串也需要多加注意， 例如 MDS() 、 SHAl() 或者 UUID() 产生的字符串。 这些函数生成的新值会任意分布在很大的空间内， 这会导致 INSERT 以及一些SELECT语句变得很慢。如果存储 UUID 值， 则应该移除 “-“符号。</p>\n<h4>5.2特殊类型数据</h4>\n<p>某些类型的数据井不直接与内置类型一致。 低千秒级精度的时间戳就是一个例子，另一个例子是以个1Pv4地址，人们经常使用VARCHAR(15)列来存储IP地址，然而， 它们实际上是32位无符号整数， 不是字符串。用小数点将地址分成四段的表示方法只是为了让人们阅读容易。所以应该用无符号整数存储IP地址。MySQL提供INET_ATON()和INET_NTOA()函数在这两种表示方法之间转换。</p>\n<h2>二、表结构设计</h2>\n<h3>1.范式和反范式</h3>\n<p>对于任何给定的数据通常都有很多种表示方法， 从完全的范式化到完全的反范式化， 以及两者的折中。 在范式化的数据库中， 每个事实数据会出现并且只出现一次。 相反， 在反范式化的数据库中， 信息是冗余的， 可能会存储在多个地方。</p>\n<h4>范式的优点和缺点</h4>\n<p>为性能提升考虑时，经常会被建议对 schema 进行范式化设计，尤其是写密集的场景。</p>\n<ul>\n<li>范式化的更新操作通常比反范式化要快。</li>\n<li>当数据较好地范式化时，就只有很少或者没有重复数据，所以只需要修改更少的数据。</li>\n<li>范式化的表通常更小，可以更好地放在内存里，所以执行操作会更快。</li>\n<li>很少有多余的数据意味着检索列表数据时更少需要 DISTINCT 或者 GROUP BY语句。</li>\n</ul>\n<h4>反范式的优点和缺点</h4>\n<p>不需要关联表，则对大部分查询最差的情况——即使表没有使用索引——是全表扫描。 当数据比内存大时这可能比关联要快得多，因为这样避免了随机I/0。</p>\n<p>单独的表也能使用更有效的索引策略。</p>\n<h4>混用范式化和反范式化</h4>\n<p>在实际应用中经常需要混用，可能使用部分范式化的 schema 、 缓存表，以及其他技巧。<br>\n表适当增加冗余字段，如性能优先，但会增加复杂度。可避免表关联查询。</p>\n<h4>简单熟悉数据库范式</h4>\n</div>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf7fbc261d197143388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n第一范式(1NF)：字段值具有原子性,不能再分(所有关系型数据库系统都满足第一范式);\r\n 例如：姓名字段,其中姓和名是一个整体,如果区分姓和名那么必须设立两个独立字段;\r\n \r\n第二范式(2NF)：一个表必须有主键,即每行数据都能被唯一的区分;\r\n 备注：必须先满足第一范式;\r\n \r\n第三范式(3NF)：一个表中不能包涵其他相关表中非关键字段的信息,即数据表不能有沉余字段;\r\n 备注：必须先满足第二范式;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf7fbc261d197143388-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf7fbc261d197143388-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf7fbc261d197143388-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf7fbc261d197143388-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf7fbc261d197143388-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf7fbc261d197143388-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf7fbc261d197143388-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf7fbc261d197143388-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf7fbc261d197143388-1\">第一范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1NF</span><span class=\"crayon-sy\">)</span>：字段值具有原子性<span class=\"crayon-sy\">,</span>不能再分<span class=\"crayon-sy\">(</span>所有关系型数据库系统都满足第一范式<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf7fbc261d197143388-2\"><span class=\"crayon-h\"> </span>例如：姓名字段<span class=\"crayon-sy\">,</span>其中姓和名是一个整体<span class=\"crayon-sy\">,</span>如果区分姓和名那么必须设立两个独立字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf7fbc261d197143388-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf7fbc261d197143388-4\">第二范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2NF</span><span class=\"crayon-sy\">)</span>：一个表必须有主键<span class=\"crayon-sy\">,</span>即每行数据都能被唯一的区分<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf7fbc261d197143388-5\"><span class=\"crayon-h\"> </span>备注：必须先满足第一范式<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf7fbc261d197143388-6\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf7fbc261d197143388-7\">第三范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3NF</span><span class=\"crayon-sy\">)</span>：一个表中不能包涵其他相关表中非关键字段的信息<span class=\"crayon-sy\">,</span>即数据表不能有沉余字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf7fbc261d197143388-8\"><span class=\"crayon-h\"> </span>备注：必须先满足第二范式<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<div>\n<div>\n<h3>2.表字段少⽽精</h3>\n<ul>\n<li>I/O高效</li>\n<li>字段分开维护简单</li>\n<li>单表1G体积 500W⾏行评估</li>\n<li>单⾏行不超过200Byte</li>\n<li>单表不超过50个INT字段</li>\n<li>单表不超过20个CHAR(10)字段</li>\n<li>建议单表字段数控制在20个以内</li>\n<li>拆分TEXT/BLOB，TEXT类型处理性能远低于VARCHAR，强制生成硬盘临时表浪费更多空间。</li>\n</ul>\n<h4>参考资料：</h4>\n<p>高性能mysql第三版</p>\n</div>\n</div>\n<hr>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112035\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112035votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112035\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,MySQL,数据库", "front_image_path": "full/75f6595b87bc254afe77bc1151f1aea91fb72f4b.jpg"}
{"url_object_id": "edadb3aea0db398bd4790e74f9295bb1", "title": "27 个机器学习、数学、Python 速查表", "create_time": "2017/07/27", "url": "http://blog.jobbole.com/112009/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/ff247977ac3e5237654ad324e8c880ed.jpg"], "praise_num": "5", "comment_num": 2, "fav_num": 25, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/cheat-sheet-of-machine-learning-and-python-and-math-cheat-sheets-a4afe4e791b6\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习涉及到的方面非常多。当我开始准备复习这些内容的时候，我找到了许多不同的”速查表”, 这些速查表针对某一主题都罗列出了所有我需要知道的知识重点。最终我编译了超过 20 份机器学习相关的速查表，其中一些是我经常用到的而且我相信其他人也会从中受益。本文整理了我在网络上找到的 27 个速查表，我认为比较好。如果我有遗漏，欢迎补充。</p>\n<p>如今机器学习领域的发展相当迅速，我可以想象出来这些资源将会很快过时，但是至少在当前，在2017年6月1日，他们都是相当流行的。</p>\n<p>如果你们像我一样想要一次性批量下载所有资源，我已经将 27 个速查表整理打包（<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a>）好了，请尽情享用吧！</p>\n<p>如果你喜欢本文，记得给我在下面点个 zan 哦。</p>\n<h2 id=\"机器学习\">机器学习\n</h2><p>这里我从一些和机器学习算法相关的流程图和表格中选择了我认为最全面的几个并在下面罗列出来。</p>\n<h3 id=\"Neural-Network-Architectures\">Neural Network Architectures\n</h3><p>链接: <a href=\"http://www.asimovinstitute.org/neural-network-zoo/\" target=\"_blank\" rel=\"external\">http://www.asimovinstitute.org/neural-network-zoo/</a><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NN.png\" alt=\"\"></p>\n<p> </p>\n<p style=\"text-align: center;\"><em>The Neural Network Zoo</em></p>\n<h3 id=\"Microsoft-Azure-Algorithm-Flowchart\">Microsoft Azure Algorithm Flowchart\n</h3><p>链接: <a href=\"https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/MS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>Machine learning algorithm cheat sheet for Microsoft Azure Machine Learning Studio</em></p>\n<h3 id=\"SAS-Algorithm-Flowchart\">SAS Algorithm Flowchart\n</h3><p>链接: <a href=\"http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/SAS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>SAS: Which machine learning algorithm should I use?</em></p>\n<h3 id=\"Algorithm-Summary\">Algorithm Summary\n</h3><p>链接: <a href=\"http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/AS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>A Tour of Machine Learning Algorithms</em></p>\n<p style=\"text-align: center;\"><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" alt=\"\"></a><br>\n<em>Which are the best known machine learning algorithms?</em></p>\n<h3 id=\"Algorithm-Pro-Con\">Algorithm Pro/Con\n</h3><p>链接: <a href=\"https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" alt=\"\"></span></a></p>\n<h2 id=\"Python\">Python\n</h2><p>网上在线的Python资源可以说是相当的多。在这一部分，我挑选了我遇到的几个最好的速查表呈献给大家。</p>\n<h3 id=\"ML算法\">ML算法\n</h3><p>链接: <a href=\"https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" alt=\"\"></span></a></p>\n<h3 id=\"Python基础\">Python基础\n</h3><p>链接: <a href=\"http://datasciencefree.com/python.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/python.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Numpy\">Numpy\n</h3><p>链接: <a href=\"https://www.dataquest.io/blog/numpy-cheat-sheet/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.dataquest.io/blog/numpy-cheat-sheet/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://datasciencefree.com/numpy.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/numpy.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pandas\">Pandas\n</h3><p>链接: <a href=\"http://datasciencefree.com/pandas.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/pandas.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Matplotlib\">Matplotlib\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Scikit-Learn\">Scikit Learn\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Tensorflow\">Tensorflow\n</h3><p>链接: <a href=\"https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pytorch\">Pytorch\n</h3><p>链接: <a href=\"https://github.com/bfortuner/pytorch-cheatsheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/bfortuner/pytorch-cheatsheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" alt=\"\"></span></a></p>\n<h2 id=\"数学\">数学\n</h2><p>如果你想真正的理解机器学习，你需要有扎实的统计学(尤其是概率论), 线性代数以及微积分基础。我在上大学的时候辅修了数学专业，但是我肯定还是需要对这些数学知识进行复习。如果你想理解常用机器学习算法背后的数学原理，那么下面的这些速查表将会是你需要的。</p>\n<h3 id=\"概率论\">概率论\n</h3><p>链接: <a href=\"http://www.wzchen.com/s/probability_cheatsheet.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://www.wzchen.com/s/probability_cheatsheet.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" alt=\"\"></span></a></p>\n<h3 id=\"线性代数\">线性代数\n</h3><p>链接: <a href=\"https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" alt=\"\"></span></a></p>\n<h3 id=\"统计学\">统计学\n</h3><p>链接: <a href=\"http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" alt=\"\"></span></a></p>\n<h3 id=\"微积分\">微积分\n</h3><p>链接: <a href=\"http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" alt=\"\"></a></p>\n<p>打包下载：<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112009\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112009votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112009\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 25 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "工具与资源,Python,数学,机器学习", "front_image_path": "full/eadb28355fab57e9672e5c965147ef4caca04ac4.jpg"}
{"url_object_id": "292ef81058f5bce6e38e7bbd0bae9103", "title": "MySQL 死锁与日志二三事", "create_time": "2017/07/31", "url": "http://blog.jobbole.com/112054/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_num": "2", "comment_num": 1, "fav_num": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/leejun2005/blog/1484511\">xrzs</a>   </div><p>最近线上 MySQL 接连发生了几起数据异常，都是在凌晨爆发，由于业务场景属于典型的数据仓库型应用，白天压力较小无法复现。甚至有些异常还比较诡异，最后 root cause 分析颇费周折。那实际业务当中咱们如何能快速的定位线上 MySQL 问题，修复异常呢？下文我会根据两个实际 case，分享下相关的经验与方法。</p>\n<h3>1、Case1：部分数据更新失败</h3>\n<p>某天渠道同学反馈某报表极个别渠道数据为 0，大部分渠道数据正常。这个数据是由一个统计程序每天凌晨例行更新的，按理来说，要么全部正常，要么全部失败，那会是什么原因导致极个别数据异常呢？</p>\n<p>首先我们能想到的自然是根据统计任务日志来看了，但是看了统计程序打印的日志没有发现诸如 SQL update 失败的异常描述，那当时的数据库究竟发生了什么呢？在查看 MySQL-server 日志之前，习惯性的看了下数据库状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac25514178491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSHOW ENGINE INNODB STATUS\\G</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac25514178491-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac25514178491-1\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-e\">ENGINE </span><span class=\"crayon-e\">INNODB </span><span class=\"crayon-v\">STATUS</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">G</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>恰好看到了凌晨这个 update 发生了死锁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac2f896752706\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n------------------------\r\nLATEST DETECTED DEADLOCK\r\n------------------------\r\n2017-07-17 04:09:01 0x7f6de03c8700\r\n*** (1) TRANSACTION:\r\nTRANSACTION 215208479, ACTIVE 0 sec fetching rows\r\nmysql tables in use 3, locked 3\r\nLOCK WAIT 5 lock struct(s), heap size 1136, 3 row lock(s)\r\nMySQL thread id 27844824, OS thread handle 140092183037696, query id 412503674 10.126.95.84 zeye Searching rows for update\r\nupdate t_channel_final_datas set nr_register=133,nr_add_goods=29,nr_order_normal=11,nr_pay_normal=8,nr_order_special=0,nr_pay_special=0,n_add_user_num=16 where count_date='2017-07-16' and channel_id='16' and channel_type='10' and terminal='26'\r\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\r\nRECORD LOCKS space id 464 page no 5459 n bits 392 index index_countdate_type_terminal of table `db_zz_flow`.`t_channel_final_datas` trx id 215208479 lock_mode X locks rec but not gap waiting\r\nRecord lock, heap no 304 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\r\n 0: len 10; hex 323031372d30372d3136; asc 2017-07-16;;\r\n 1: len 1; hex 30; asc 0;;\r\n 2: len 4; hex 80000010; asc     ;;\r\n 3: len 4; hex 8009055e; asc    ^;;\r\n\r\n*** (2) TRANSACTION:\r\nTRANSACTION 215208474, ACTIVE 0 sec fetching rows\r\nmysql tables in use 3, locked 3\r\n6 lock struct(s), heap size 1136, 7 row lock(s)\r\nMySQL thread id 27844825, OS thread handle 140109890225920, query id 412503669 10.135.6.41 zeye Searching rows for update\r\nupdate t_channel_final_datas set nr_register=24,nr_add_goods=32,nr_order_normal=0,nr_pay_normal=0,nr_order_special=0,nr_pay_special=0,n_add_user_num=11 where count_date='2017-07-16' and channel_id='114' and channel_type='10' and terminal='116'\r\n*** (2) HOLDS THE LOCK(S):\r\nRECORD LOCKS space id 464 page no 5459 n bits 392 index index_countdate_type_terminal of table `db_zz_flow`.`t_channel_final_datas` trx id 215208474 lock_mode X locks rec but not gap\r\nRecord lock, heap no 304 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\r\n 0: len 10; hex 323031372d30372d3136; asc 2017-07-16;;\r\n 1: len 1; hex 30; asc 0;;\r\n 2: len 4; hex 80000010; asc     ;;\r\n 3: len 4; hex 8009055e; asc    ^;;\r\n\r\n...\r\n\r\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\r\nRECORD LOCKS space id 464 page no 4743 n bits 264 index PRIMARY of table `db_zz_flow`.`t_channel_final_datas` trx id 215208474 lock_mode X locks rec but not gap waiting\r\nRecord lock, heap no 168 PHYSICAL RECORD: n_fields 32; compact format; info bits 0\r\n 0: len 4; hex 80090569; asc    i;;\r\n 1: len 6; hex 00000cd3b9d0; asc       ;;\r\n...\r\n\r\n*** WE ROLL BACK TRANSACTION (1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac2f896752706-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac2f896752706-42\">42</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-2\"><span class=\"crayon-e\">LATEST </span><span class=\"crayon-e\">DETECTED </span><span class=\"crayon-v\">DEADLOCK</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-4\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f6de03c8700</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-5\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TRANSACTION</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-6\"><span class=\"crayon-i\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208479</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ACTIVE</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sec </span><span class=\"crayon-e\">fetching </span><span class=\"crayon-e\">rows</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-7\"><span class=\"crayon-e\">mysql </span><span class=\"crayon-e\">tables </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">locked</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-8\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-i\">WAIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1136</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-9\"><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27844824</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">handle</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140092183037696</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">412503674</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.126.95.84</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zeye </span><span class=\"crayon-e\">Searching </span><span class=\"crayon-e\">rows </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-10\"><span class=\"crayon-e\">update </span><span class=\"crayon-e\">t_channel_final_datas </span><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nr_register</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">133</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_add_goods</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">29</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n_add_user_num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'2017-07-16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'26'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-11\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WAITING </span><span class=\"crayon-st\">FOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">THIS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LOCK </span><span class=\"crayon-st\">TO</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BE </span><span class=\"crayon-v\">GRANTED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-12\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5459</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">392</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">index_countdate_type_terminal </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208479</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap </span><span class=\"crayon-e\">waiting</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-13\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">304</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">323031372d30372d3136</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000010</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8009055e</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-18\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-19\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TRANSACTION</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-20\"><span class=\"crayon-i\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ACTIVE</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sec </span><span class=\"crayon-e\">fetching </span><span class=\"crayon-e\">rows</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-21\"><span class=\"crayon-e\">mysql </span><span class=\"crayon-e\">tables </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">locked</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-22\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1136</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-23\"><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27844825</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">handle</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140109890225920</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">412503669</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.135.6.41</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zeye </span><span class=\"crayon-e\">Searching </span><span class=\"crayon-e\">rows </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-24\"><span class=\"crayon-e\">update </span><span class=\"crayon-e\">t_channel_final_datas </span><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nr_register</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_add_goods</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n_add_user_num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'2017-07-16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'114'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'116'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-25\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HOLDS </span><span class=\"crayon-e\">THE </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">S</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-26\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5459</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">392</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">index_countdate_type_terminal </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-27\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">304</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-28\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">323031372d30372d3136</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-29\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-30\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000010</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-31\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8009055e</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-32\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-33\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-34\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-35\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WAITING </span><span class=\"crayon-st\">FOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">THIS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LOCK </span><span class=\"crayon-st\">TO</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BE </span><span class=\"crayon-v\">GRANTED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-36\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4743</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">264</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap </span><span class=\"crayon-e\">waiting</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-37\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">168</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-38\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80090569</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-39\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00000cd3b9d0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-40\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac2f896752706-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac2f896752706-42\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WE </span><span class=\"crayon-e\">ROLL </span><span class=\"crayon-e\">BACK </span><span class=\"crayon-e\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0187 seconds] -->\r\n<p>篇幅所限，上下文我这里省略了很多，从这段日志里可以看到，TRANSACTION 1 和 TRANSACTION 2 分别持有一定数量的行锁，然后又等待对方的锁，最后 MySQL 检测到 deadlock ，然后选择回滚了 TRANSACTION 1：Innodb目前处理死锁的方法是将持有最少行级排他锁的事务进行回滚。</p>\n<p>那这里就有 3 个问题了：</p>\n<h4>（1）innodb 行锁不是只锁一行？</h4>\n<p>因为这张表是 innodb 引擎的，InnoDB 支持行锁和表锁。而InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，后者是通过在数据块中对相应数据行加锁来实现的。InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁，会把所有扫描过的行都锁定！在实际应用中，要特别注意InnoDB行锁的这一特性，不然的话，可能导致大量的锁冲突，从而影响并发性能。由于MySQL的行锁是针对索引加的锁，不是针对记录加的锁，所以虽然是访问不同行的记录，但是如果是使用相同的索引键，是会出现锁冲突的。当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；另外间隙锁也会锁多行，InnoDB除了通过范围条件加锁时使用间隙锁外，如果使用相等条件请求给一个不存在的记录加锁，InnoDB也会使用间隙锁！</p>\n<p>话都说到这了，那就看下咱们业务表的索引情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac35615802567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow INDEX from `db_zz_flow`.`t_channel_final_datas`;\r\n+-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------+\r\n| Table | Non_unique | Key_name | Seq_in_index | Column_namt | Packed | Null | Index_type | Comment | Index_comment |\r\n|-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------|\r\n| t_channel_final_datas | 0 | PRIMARY | 1 | id &gt; | &lt;null&gt; | | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 1 | count_date&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 2 | channel_ty&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 3 | terminal &gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_channelid | 1 | count_date&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_channelid | 2 | channel_id&gt; | &lt;null&gt; | YES | BTREE | | |\r\n+-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac35615802567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac35615802567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac35615802567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac35615802567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac35615802567-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac35615802567-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">INDEX </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac35615802567-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Non_unique</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Key_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq_in_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Column_namt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Packed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Index_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Index_comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac35615802567-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PRIMARY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac35615802567-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_ty</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac35615802567-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_channelid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac35615802567-10\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_channelid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac35615802567-11\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0283 seconds] -->\r\n<p>可以看到这张表的索引极不合理：有3个索引，但是 update 却没有完全的用上索引，导致 update 没有精确的用上索引，需要锁定多行范围数据，从而引发死锁。</p>\n<p>知道原理后，咱们再精心构建一个四字段的组合索引即可让 update 精准的走 innodb 索引，实际上，我们更新索引后，这个死锁问题即得到了解决。<br>\n注：innodb不仅会打印出事务和事务持有和等待的锁，而且还有记录本身，不幸的是，它可能超过innodb为输出结果预留的长度（只能打印1M的内容且只能保留最近一次的死锁信息），如果你无法看到完整的输出，此时可以在任意库下创建innodb_monitor或innodb_lock_monitor表，这样innodb status信息会完整且每15s一次被记录到错误日志中。如：create table innodb_monitor(a int)engine=innodb;，不需要记录到错误日志中时就删掉这个表即可。</p>\n<h4>（2）回滚的话，为什么只有部分 update 语句失败，而不是整个事务里的所有 update 都失败？</h4>\n<p>这是因为咱们的 innodb 默认是自动提交的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac3a659867850\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow variables like 'autocommit';\r\n+-----------------+---------+\r\n| Variable_name   | Value   |\r\n|-----------------+---------|\r\n| autocommit      | ON      |\r\n+-----------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3a659867850-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3a659867850-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3a659867850-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3a659867850-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3a659867850-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3a659867850-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3a659867850-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3a659867850-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'autocommit'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3a659867850-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3a659867850-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3a659867850-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3a659867850-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">autocommit</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ON</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3a659867850-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3a659867850-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>在多个 update 或 insert 语句情况下，每执行完一条 SQL，innodb 就立即 commit 一次以持久化变更，同时释放锁，这也正是本例中死锁回滚事务后只有极个别语句失败的原因。</p>\n<p>需要注意的是，通常还有另外一种情况也可能导致部分语句回滚，需要格外留意。在 innodb 里有个参数叫：innodb_rollback_on_timeout</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac3e352464018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow VARIABLES LIKE 'innodb_rollback_on_timeout'\r\n+----------------------------+---------+\r\n| Variable_name              | Value   |\r\n|----------------------------+---------|\r\n| innodb_rollback_on_timeout | OFF     |\r\n+----------------------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3e352464018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3e352464018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3e352464018-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3e352464018-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3e352464018-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac3e352464018-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac3e352464018-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3e352464018-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">VARIABLES </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'innodb_rollback_on_timeout'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3e352464018-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3e352464018-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3e352464018-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3e352464018-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">innodb_rollback_on_timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OFF</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac3e352464018-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac3e352464018-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>官方手册里这样描述：</p>\n<blockquote><p>In MySQL 5.1, InnoDB rolls back only the last statement on a transaction timeout by default. If –innodb_rollback_on_timeout is specified, a transaction timeout causes InnoDB to abort and roll back the entire transaction (the same behavior as in MySQL 4.1). This variable was added in MySQL 5.1.15.</p></blockquote>\n<p>解释：这个参数关闭或不存在的话遇到超时只回滚事务最后一个Query，打开的话事务遇到超时就回滚整个事务。</p>\n<h3>（3）怎样降低 innodb 死锁几率？</h3>\n<p>死锁在行锁及事务场景下很难完全消除，但可以通过表设计和SQL调整等措施减少锁冲突和死锁，包括：</p>\n<ul>\n<li>尽量使用较低的隔离级别，比如如果发生了间隙锁，你可以把会话或者事务的事务隔离级别更改为 RC(read committed)级别来避免，但此时需要把 binlog_format 设置成 row 或者 mixed 格式</li>\n<li>精心设计索引，并尽量使用索引访问数据，使加锁更精确，从而减少锁冲突的机会；</li>\n<li>选择合理的事务大小，小事务发生锁冲突的几率也更小；</li>\n<li>给记录集显示加锁时，最好一次性请求足够级别的锁。比如要修改数据的话，最好直接申请排他锁，而不是先申请共享锁，修改时再请求排他锁，这样容易产生死锁；</li>\n<li>不同的程序访问一组表时，应尽量约定以相同的顺序访问各表，对一个表而言，尽可能以固定的顺序存取表中的行。这样可以大大减少死锁的机会；</li>\n<li>尽量用相等条件访问数据，这样可以避免间隙锁对并发插入的影响；</li>\n<li>不要申请超过实际需要的锁级别；除非必须，查询时不要显示加锁；</li>\n<li>对于一些特定的事务，可以使用表锁来提高处理速度或减少死锁的可能。</li>\n</ul>\n<h3>2、Case2：诡异的 Lock wait timeout</h3>\n<p>连续几天凌晨6点和早上8点 都分别有一个任务失败，load data local infile 的时候报 Lock wait timeout exceeded try restarting transaction innodb 的 Java SQL 异常，和平台的同学沟通得知，这是我们自己的业务数据库的 Lock 时间太短或者锁冲突的问题。但是回头一想不应该啊？这不一直好好的吗？而且基本都是单表单任务，不存在多人冲突。</p>\n<p>甭管谁的问题，那咱们还是先看自己的数据库有没有问题：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac42733014906\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow variables like 'innodb_lock_wait_timeout';\r\n+--------------------------+---------+\r\n| Variable_name            |   Value |\r\n|--------------------------+---------|\r\n| innodb_lock_wait_timeout |      50 |\r\n+--------------------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac42733014906-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac42733014906-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac42733014906-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac42733014906-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac42733014906-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac42733014906-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac42733014906-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac42733014906-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'innodb_lock_wait_timeout'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac42733014906-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac42733014906-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac42733014906-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac42733014906-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">innodb_lock_wait_timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac42733014906-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac42733014906-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>默认 lock 超时时间 50s，这个时间真心不短了，估计调了也没用，事实上确实死马当活马医的试了下没用。。。</p>\n<p>而且这次 SHOW ENGINE INNODB STATUSG 也没出现任何死锁信息，然后又将目光转向 MySQL-server 日志，希望能从日志里看一看那个时刻前后数据究竟在做什么操作。这里先简单的介绍下MySQL日志文件系统的组成：</p>\n<p>(a) error 日志：记录启动、运行或停止 mysqld 时出现的问题，默认开启。<br>\n(b) general 日志：通用查询日志，记录所有语句和指令，开启数据库会有 5% 左右性能损失。<br>\n(c) binlog 日志：二进制格式，记录所有更改数据的语句，主要用于 slave 复制和数据恢复。<br>\n(d) slow 日志：记录所有执行时间超过 long_query_time 秒的查询或不使用索引的查询，默认关闭。<br>\n(e) Innodb日志：innodb redo log、undo log，用于恢复数据和撤销操作。</p>\n<p>从上面的介绍可以看到，目前这个问题的日志可能在 d 和 b 中，看了下 d 中没有，那就只能开启 b 了，但 b 对数据库的性能有一定损耗，由于是全量日志，量非常巨大，所以开启一定要谨慎：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac46631066316\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-- general_log 日志默认关闭，开启会影响数据库 5% 左右性能：\r\nshow variables like 'general%';\r\n+------------------+---------------------------------+\r\n| Variable_name    | Value                           |\r\n|------------------+---------------------------------|\r\n| general_log      | OFF                             |\r\n| general_log_file | /opt/data/mysql/tjtx-103-26.log |\r\n+------------------+---------------------------------+\r\n\r\n-- 全局 session 级别开启：\r\nset global general_log=1\r\n\r\n-- 如果需要对当前 session 生效需要：\r\nset general_log=1\r\n\r\n-- set 指令设置的动态参数在 MySQL 重启后失效，如果需要永久生效需要在 /etc/my.cnf 中配置静态变量/参数。\r\n-- 如果不知道 my.cnf 位置，可以根据 mysql -? | grep \".cnf\" 查询\r\n                      order of preference, my.cnf, $MYSQL_TCP_PORT,\r\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac46631066316-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac46631066316-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general</span><span class=\"crayon-sy\">_</span>log<span class=\"crayon-h\"> </span>日志默认关闭，开启会影响数据库<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span>左右性能：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-2\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'general%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-3\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">                           </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OFF</span><span class=\"crayon-h\">                             </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">103</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26.log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-8\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>全局<span class=\"crayon-h\"> </span><span class=\"crayon-i\">session</span><span class=\"crayon-h\"> </span>级别开启：</div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-11\"><span class=\"crayon-e\">set </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-13\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>如果需要对当前<span class=\"crayon-h\"> </span><span class=\"crayon-i\">session</span><span class=\"crayon-h\"> </span>生效需要：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-14\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-16\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span>指令设置的动态参数在<span class=\"crayon-h\"> </span><span class=\"crayon-i\">MySQL</span><span class=\"crayon-h\"> </span>重启后失效，如果需要永久生效需要在<span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cnf</span><span class=\"crayon-h\"> </span>中配置静态变量<span class=\"crayon-o\">/</span>参数。</div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-17\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>如果不知道<span class=\"crayon-h\"> </span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cnf</span><span class=\"crayon-h\"> </span>位置，可以根据<span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".cnf\"</span><span class=\"crayon-h\"> </span>查询</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac46631066316-18\"><span class=\"crayon-h\">                      </span><span class=\"crayon-e\">order </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">MYSQL_TCP_PORT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac46631066316-19\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<p>我这里只是每天在出问题的前后半小时开启下全量日志，结果没有发现任何 MySQL-client 请求到我们的业务数据库！该日志格式如下，记录了所有的连接与命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac4a571845905\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/usr/sbin/mysqld, Version: 5.7.12-log (MySQL Community Server (GPL)). started with:\r\nTcp port: 3306  Unix socket: /opt/data/mysql/mysql.sock\r\nTime                 Id Command    Argument\r\n2017-07-20T21:45:01.880828Z28556028 Quit\r\n2017-07-20T21:45:02.708621Z28401469 Query       SELECT 1\r\n2017-07-20T21:45:02.736734Z28556029 Connect     ooxx@127.0.0.1 on db_zz_system using TCP/IP\r\n2017-07-20T21:45:02.737242Z28556029 Query       /* mysql-connector-java-5.1.6 ( Revision: ${svn.Revision} ) */SHOW VARIABLES WHERE Variable_name ='language' OR Variable_name = 'net_write_timeout' OR Variable_name = 'interactive_timeout' OR Variable_name = 'wait_timeout' OR Variable_name = 'character_set_client' OR Variable_name = 'character_set_connection' OR Variable_name = 'character_set' OR Variable_name = 'character_set_server' OR Variable_name = 'tx_isolation' OR Variable_name = 'transaction_isolation' OR Variable_name = 'character_set_results' OR Variable_name = 'timezone' OR Variable_name = 'time_zone' OR Variable_name = 'system_time_zone' OR Variable_name = 'lower_case_table_names' OR Variable_name = 'max_allowed_packet' OR Variable_name = 'net_buffer_length' OR Variable_name = 'sql_mode' OR Variable_name = 'query_cache_type' OR Variable_name = 'query_cache_size' OR Variable_name = 'init_connect'\r\n2017-07-20T21:45:02.738868Z28556029 Query       SHOW COLLATION\r\n2017-07-20T21:45:02.739941Z28556029 Query       SET character_set_results = NULL\r\n2017-07-20T21:45:02.740275Z28556029 Query       SET autocommit=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4a571845905-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4a571845905-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4a571845905-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4a571845905-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4a571845905-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4a571845905-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4a571845905-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4a571845905-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4a571845905-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4a571845905-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4a571845905-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.7.12</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">Community </span><span class=\"crayon-e\">Server</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GPL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">started </span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4a571845905-2\"><span class=\"crayon-e\">Tcp </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3306</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Unix </span><span class=\"crayon-v\">socket</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sock</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4a571845905-3\"><span class=\"crayon-e\">Time                 </span><span class=\"crayon-e\">Id </span><span class=\"crayon-e\">Command    </span><span class=\"crayon-i\">Argument</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4a571845905-4\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01.880828Z28556028</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Quit</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4a571845905-5\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.708621Z28401469</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4a571845905-6\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.736734Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connect     </span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">db_zz_system </span><span class=\"crayon-e\">using </span><span class=\"crayon-v\">TCP</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">IP</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4a571845905-7\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.737242Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Query</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">/* mysql-connector-java-5.1.6 ( Revision: ${svn.Revision} ) */</span><span class=\"crayon-e\">SHOW </span><span class=\"crayon-e\">VARIABLES </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'language'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net_write_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'interactive_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wait_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_client'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_connection'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_server'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tx_isolation'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'transaction_isolation'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_results'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'timezone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'time_zone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'system_time_zone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lower_case_table_names'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'max_allowed_packet'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net_buffer_length'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sql_mode'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'query_cache_type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'query_cache_size'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'init_connect'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4a571845905-8\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.738868Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SHOW </span><span class=\"crayon-i\">COLLATION</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4a571845905-9\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.739941Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">character_set_results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4a571845905-10\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.740275Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">autocommit</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p>那问题基本确定了，客户端请求都没到我们这边就抛出了上述的异常，和平台方再三沟通确认下，最后平台方查证是因为在执行插入前他们需要先从 SQL task 表取出 SQL 和更新 task 状态，结果这张表由于在整点存在大量 insert 和 update 并发，导致部分 SQL 等待 lock 超时了。。。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d29579706b846656c946e30891c2c075.jpg\" alt=\"\" width=\"280\" height=\"200\"></p>\n<h3>3、MySQL 日志分析脚本</h3>\n<p>由于凌晨是数据仓库的业务高峰，很多问题都是在这个时候爆发，一些诡异的问题往往是过了这个村就没这个店了，白天无法复现。如何能捕获我们关心的日志，便于快速的定位问题，这个是重中之重，这里我写了个小脚本，crontab 部署，可以选择时间范围开启，每分钟采样一次日志，需要说明的是 general log 没事别轻易开启，否则对数据库性能损耗较大。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adefaf0ac4f143285901\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# crontab 部署方式：\r\n# */1 0-10 * * * cd /opt/ooxx/script &amp;&amp; bash mysql_perf.sh &gt;&gt; logs/mysql_perf.log.`date -I` 2&gt;&amp;1\r\n\r\ndate -Iseconds\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; top -bn1|head'\r\ntop -bn1|head \r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SHOW ENGINE INNODB STATUS\\G '\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SHOW ENGINE INNODB STATUS\\G'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show open tables where in_use&gt;0;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show full processlist;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show full processlist;'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`; '\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;' \r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_locks`;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SELECT * FROM `information_schema`.`innodb_locks`;'\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show status like '%lock%';\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"show status like '%lock%';\"\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show global status like \"table_locks%\";'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show global status like \"table_locks%\";'\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"select r.trx_isolation_level, r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_trx_thread, r.trx_state waiting_trx_state, lr.lock_mode waiting_trx_lock_mode, lr.lock_type waiting_trx_lock_type, lr.lock_table waiting_trx_lock_table, lr.lock_index waiting_trx_lock_index, r.trx_query waiting_trx_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_trx_thread, b.trx_state blocking_trx_state, lb.lock_mode blocking_trx_lock_mode, lb.lock_type blocking_trx_lock_type, lb.lock_table blocking_trx_lock_table, lb.lock_index blocking_trx_lock_index, b.trx_query blocking_query from information_schema.innodb_lock_waits w inner join information_schema.innodb_trx b on b.trx_id=w.blocking_trx_id inner join information_schema.innodb_trx r on r.trx_id=w.requesting_trx_id inner join information_schema.innodb_locks lb on lb.lock_trx_id=w.blocking_trx_id inner join information_schema.innodb_locks lr on lr.lock_trx_id=w.requesting_trx_id\\G\"\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"SELECT r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_thread, r.trx_query waiting_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_thread, b.trx_query blocking_query FROM information_schema.innodb_lock_waits w INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id\\G\"\r\necho\r\n\r\n\r\ndate -Iseconds\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;=================================================================================='\r\necho\r\n\r\nfile_name=mysql_perf.log.`date -I`\r\nif [[ `date +%-H%-M` == 1059 ]]\r\nthen\r\n cd /opt/ooxx/script/logs\r\n chmod 777 /home/work/ooxx/$file_name\r\n find /home/work/ooxx -name 'mysql_perf.log.*' -mtime +7 -delete\r\n \r\n cd /opt/data/mysql\r\n cp tjtx-ooxx-slow.log /home/work/ooxx/tjtx-ooxx-slow.log.`date -I`\r\n chmod 777 /home/work/ooxx/tjtx-ooxx-slow.log.`date -I`\r\n find /home/work/ooxx -name 'tjtx-ooxx-slow.log.*' -mtime +7 -delete\r\n \r\n cp mysqld.log /home/work/ooxx/mysqld.log.`date -I`\r\n chmod 777 /home/work/ooxx/mysqld.log.`date -I`\r\n find /home/work/ooxx -name 'mysqld.log.*' -mtime +7 -delete\r\nfi\r\n\r\n\r\n################\r\n# 开启 general_log 全量明细日志会降低数据库 5% 性能\r\n#if [[ \"`date +%H%M`\" == \"0545\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0630\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#elif [[ \"`date +%H%M`\" == \"0745\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0830\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#elif [[ \"`date +%H%M`\" == \"0001\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0002\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#fi\r\n\r\n\r\n\r\n\r\n\r\n#[[ 10#`date +%H%M` -lt 10#0550 || 10#`date +%H%M` -gt 10#0830 ]] &amp;&amp; echo \"`date +%H%M` ------- set global general_log=0;\" &amp;&amp; mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n\r\n\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;show full processlist;SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;SELECT * FROM `information_schema`.`innodb_locks`;SHOW ENGINE INNODB STATUS\\G'\r\n\r\n# --show variables like '%tx_isolation%';\r\n# --SELECT @@GLOBAL.tx_isolation, @@tx_isolation, @@session.tx_isolation;\r\n# -- SET GLOBAL tx_isolation = 'READ-COMMITTED';\r\n# \r\n# --show variables like '%timeout%';\r\n# --show variables like 'innodb_lock_wait_timeout';\r\n# -- SET GLOBAL innodb_lock_wait_timeout=60\r\n# \r\n# --show variables like 'long_query_time';\r\n# -- SET global long_query_time=3;\r\n\r\n\r\n# -- show variables like 'innodb_rollback_on_timeout';\r\n\r\n# -- show VARIABLES like '%max_allowed_packet%';\r\n# -- set global max_allowed_packet = 100*1024*1024;\r\n\r\n# 自动提交\r\n# -- show variables like 'autocommit';\r\n\r\n# 慢查询\r\n# -- show variables like '%slow_query_log%';\r\n# set global 只对当前数据库生效，如果MySQL重启后则会失效。如果要永久生效，就必须修改配置文件my.cnf（其它系统变量也是如此）。\r\n# set global slow_query_log=1;\r\n# -- show variables like 'long_query_time%';\r\n# set global long_query_time=4;\r\n# show global variables like 'long_query_time'; \r\n# select sleep(5);\r\n# -- show variables like 'log_queries_not_using_indexes';\r\n# set global log_queries_not_using_indexes=1;\r\n# -- show variables like 'log_slow_admin_statements';\r\n# -- show global status like '%Slow_queries%';\r\n# http://www.cnblogs.com/kerrycode/p/5593204.html\r\n\r\n\r\n\r\n# -- show variables like \"%time_zone%\";\r\n#set global time_zone = '+8:00';\r\n\r\n#开启general_log日志\r\n# -- show variables like 'general%';\r\n#可以在my.cnf里添加,1开启（0关闭）,当然了,这样要重启才能生效,有点多余了\r\n#general-log = 1\r\n#log = /log/mysql_query.log路径\r\n#也可以设置变量那样更改,1开启（0关闭）,即时生效,不用重启,首选当然是这样的了\r\n# set global general_log=1\r\n#这个日志对于操作频繁的库,产生的数据量会很快增长,出于对硬盘的保护,可以设置其他存放路径\r\n#set global general_log_file=/tmp/general_log.log\r\n\r\n#mysql记录客户端IP：init_connect，有super权限的用户是不记录的，\r\n# create table t1 ( cur_user varchar(100), n_user varchar(100),in_time timestamp default current_timestamp()) ;\r\n# set global init_connect='insert into test.t1 (cur_user,n_user) values (current_user(),user())'; \r\n# SHOW CREATE TABLE mysql.general_log\\G ，开启general_log日志也行：\r\n# https://dba.stackexchange.com/questions/33654/mysql-logging-activity-from-specific-user-or-ip \r\n#SELECT REVERSE(SUBSTRING_INDEX(REVERSE(USER()),'@',1)) as ip;\r\n#SELECT SUBSTRING(USER(), LOCATE('@', USER())+1) as ip;\r\n#select SUBSTRING_INDEX(host,':',1) as 'ip' from information_schema.processlist WHERE ID=connection_id();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59adefaf0ac4f143285901-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adefaf0ac4f143285901-162\">162</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-1\"><span class=\"crayon-p\"># crontab 部署方式：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-2\"><span class=\"crayon-p\"># */1 0-10 * * * cd /opt/ooxx/script &amp;&amp; bash mysql_perf.sh &gt;&gt; logs/mysql_perf.log.`date -I` 2&gt;&amp;1</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-4\"><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Iseconds</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-6\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; top -bn1|head'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-7\"><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bn1</span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">head </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-8\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-10\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SHOW ENGINE INNODB STATUS\\G '</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-11\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SHOW ENGINE INNODB STATUS\\G'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-12\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show open tables where in_use&gt;0;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-15\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show open tables where in_use&gt;0;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-16\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-18\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show full processlist;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-19\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show full processlist;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-20\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-22\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`; '</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-23\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-24\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-26\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_locks`;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-27\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SELECT * FROM `information_schema`.`innodb_locks`;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-28\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-30\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show status like '%lock%';\"</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-31\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"show status like '%lock%';\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-32\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-34\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show global status like \"table_locks%\";'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-35\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show global status like \"table_locks%\";'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-36\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-38\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-39\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"select r.trx_isolation_level, r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_trx_thread, r.trx_state waiting_trx_state, lr.lock_mode waiting_trx_lock_mode, lr.lock_type waiting_trx_lock_type, lr.lock_table waiting_trx_lock_table, lr.lock_index waiting_trx_lock_index, r.trx_query waiting_trx_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_trx_thread, b.trx_state blocking_trx_state, lb.lock_mode blocking_trx_lock_mode, lb.lock_type blocking_trx_lock_type, lb.lock_table blocking_trx_lock_table, lb.lock_index blocking_trx_lock_index, b.trx_query blocking_query from information_schema.innodb_lock_waits w inner join information_schema.innodb_trx b on b.trx_id=w.blocking_trx_id inner join information_schema.innodb_trx r on r.trx_id=w.requesting_trx_id inner join information_schema.innodb_locks lb on lb.lock_trx_id=w.blocking_trx_id inner join information_schema.innodb_locks lr on lr.lock_trx_id=w.requesting_trx_id\\G\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-40\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-42\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-43\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"SELECT r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_thread, r.trx_query waiting_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_thread, b.trx_query blocking_query FROM information_schema.innodb_lock_waits w INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id\\G\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-44\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-46\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-47\"><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Iseconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-48\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;=================================================================================='</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-49\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-50\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-51\"><span class=\"crayon-v\">file_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mysql_perf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-52\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">%</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">H</span><span class=\"crayon-o\">%</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">M</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1059</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-53\"><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-54\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">logs</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-55\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">file_name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-56\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mysql_perf.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-57\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-58\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mysql</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-59\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-60\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-61\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tjtx-ooxx-slow.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-63\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-64\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-65\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mysqld.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-66\"><span class=\"crayon-v\">fi</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-68\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-69\"><span class=\"crayon-p\">################</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-70\"><span class=\"crayon-p\"># 开启 general_log 全量明细日志会降低数据库 5% 性能</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-71\"><span class=\"crayon-p\">#if [[ \"`date +%H%M`\" == \"0545\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-72\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-73\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-74\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-75\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0630\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-76\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-77\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-78\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-79\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0745\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-80\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-81\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-82\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-83\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0830\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-84\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-85\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-86\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-87\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0001\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-88\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-89\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-90\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-91\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0002\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-92\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-93\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-94\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-95\"><span class=\"crayon-p\">#fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-96\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-97\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-98\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-100\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-101\"><span class=\"crayon-p\">#[[ 10#`date +%H%M` -lt 10#0550 || 10#`date +%H%M` -gt 10#0830 ]] &amp;&amp; echo \"`date +%H%M` ------- set global general_log=0;\" &amp;&amp; mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-102\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-103\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-104\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;show full processlist;SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;SELECT * FROM `information_schema`.`innodb_locks`;SHOW ENGINE INNODB STATUS\\G'</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-105\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-106\"><span class=\"crayon-p\"># --show variables like '%tx_isolation%';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-107\"><span class=\"crayon-p\"># --SELECT @@GLOBAL.tx_isolation, @@tx_isolation, @@session.tx_isolation;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-108\"><span class=\"crayon-p\"># -- SET GLOBAL tx_isolation = 'READ-COMMITTED';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-109\"><span class=\"crayon-p\"># </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-110\"><span class=\"crayon-p\"># --show variables like '%timeout%';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-111\"><span class=\"crayon-p\"># --show variables like 'innodb_lock_wait_timeout';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-112\"><span class=\"crayon-p\"># -- SET GLOBAL innodb_lock_wait_timeout=60</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-113\"><span class=\"crayon-p\"># </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-114\"><span class=\"crayon-p\"># --show variables like 'long_query_time';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-115\"><span class=\"crayon-p\"># -- SET global long_query_time=3;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-116\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-117\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-118\"><span class=\"crayon-p\"># -- show variables like 'innodb_rollback_on_timeout';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-119\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-120\"><span class=\"crayon-p\"># -- show VARIABLES like '%max_allowed_packet%';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-121\"><span class=\"crayon-p\"># -- set global max_allowed_packet = 100*1024*1024;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-122\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-123\"><span class=\"crayon-p\"># 自动提交</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-124\"><span class=\"crayon-p\"># -- show variables like 'autocommit';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-125\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-126\"><span class=\"crayon-p\"># 慢查询</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-127\"><span class=\"crayon-p\"># -- show variables like '%slow_query_log%';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-128\"><span class=\"crayon-p\"># set global 只对当前数据库生效，如果MySQL重启后则会失效。如果要永久生效，就必须修改配置文件my.cnf（其它系统变量也是如此）。</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-129\"><span class=\"crayon-p\"># set global slow_query_log=1;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-130\"><span class=\"crayon-p\"># -- show variables like 'long_query_time%';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-131\"><span class=\"crayon-p\"># set global long_query_time=4;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-132\"><span class=\"crayon-p\"># show global variables like 'long_query_time'; </span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-133\"><span class=\"crayon-p\"># select sleep(5);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-134\"><span class=\"crayon-p\"># -- show variables like 'log_queries_not_using_indexes';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-135\"><span class=\"crayon-p\"># set global log_queries_not_using_indexes=1;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-136\"><span class=\"crayon-p\"># -- show variables like 'log_slow_admin_statements';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-137\"><span class=\"crayon-p\"># -- show global status like '%Slow_queries%';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-138\"><span class=\"crayon-p\"># http://www.cnblogs.com/kerrycode/p/5593204.html</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-140\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-141\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-142\"><span class=\"crayon-p\"># -- show variables like \"%time_zone%\";</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-143\"><span class=\"crayon-p\">#set global time_zone = '+8:00';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-144\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-145\"><span class=\"crayon-p\">#开启general_log日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-146\"><span class=\"crayon-p\"># -- show variables like 'general%';</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-147\"><span class=\"crayon-p\">#可以在my.cnf里添加,1开启（0关闭）,当然了,这样要重启才能生效,有点多余了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-148\"><span class=\"crayon-p\">#general-log = 1</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-149\"><span class=\"crayon-p\">#log = /log/mysql_query.log路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-150\"><span class=\"crayon-p\">#也可以设置变量那样更改,1开启（0关闭）,即时生效,不用重启,首选当然是这样的了</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-151\"><span class=\"crayon-p\"># set global general_log=1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-152\"><span class=\"crayon-p\">#这个日志对于操作频繁的库,产生的数据量会很快增长,出于对硬盘的保护,可以设置其他存放路径</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-153\"><span class=\"crayon-p\">#set global general_log_file=/tmp/general_log.log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-154\"> </div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-155\"><span class=\"crayon-p\">#mysql记录客户端IP：init_connect，有super权限的用户是不记录的，</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-156\"><span class=\"crayon-p\"># create table t1 ( cur_user varchar(100), n_user varchar(100),in_time timestamp default current_timestamp()) ;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-157\"><span class=\"crayon-p\"># set global init_connect='insert into test.t1 (cur_user,n_user) values (current_user(),user())'; </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-158\"><span class=\"crayon-p\"># SHOW CREATE TABLE mysql.general_log\\G ，开启general_log日志也行：</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-159\"><span class=\"crayon-p\"># https://dba.stackexchange.com/questions/33654/mysql-logging-activity-from-specific-user-or-ip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-160\"><span class=\"crayon-p\">#SELECT REVERSE(SUBSTRING_INDEX(REVERSE(USER()),'@',1)) as ip;</span></div><div class=\"crayon-line\" id=\"crayon-59adefaf0ac4f143285901-161\"><span class=\"crayon-p\">#SELECT SUBSTRING(USER(), LOCATE('@', USER())+1) as ip;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adefaf0ac4f143285901-162\"><span class=\"crayon-p\">#select SUBSTRING_INDEX(host,':',1) as 'ip' from information_schema.processlist WHERE ID=connection_id();</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0147 seconds] -->\r\n<p></p>\n<h3>Refer：</h3>\n<p>[1] MySQL批量SQL插入性能优化</p>\n<p><a href=\"http://database.51cto.com/art/201309/411050.htm\" target=\"_blank\" rel=\"nofollow\">http://database.51cto.com/art/201309/411050.htm</a></p>\n<p>[2] MySQL 四种事务隔离级的说明</p>\n<p><a href=\"http://www.cnblogs.com/zhoujinyi/p/3437475.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/zhoujinyi/p/3437475.html</a></p>\n<p>[3] innodb_rollback_on_timeout参数对锁的影响</p>\n<p><a href=\"http://q.fireflyclub.org/?/article/37\" target=\"_blank\" rel=\"nofollow\">http://q.fireflyclub.org/?/article/37</a></p>\n<p>[4] 日均万条数据丢失，一个隐式骚操作导致的奇葩事故！</p>\n<p><a href=\"https://mp.weixin.qq.com/s/OpPV24ILewVc2lRDrV4vvA\" target=\"_blank\" rel=\"nofollow\">https://mp.weixin.qq.com/s/OpPV24ILewVc2lRDrV4vvA</a></p>\n<p>[5] mysql之show engine innodb status解读（转）</p>\n<p><a href=\"http://www.cnblogs.com/ajianbeyourself/p/6941905.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/ajianbeyourself/p/6941905.html</a></p>\n<p><a href=\"http://www.cnblogs.com/olinux/p/5497176.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/olinux/p/5497176.html</a></p>\n<p>[6] Mysql 锁机制笔记</p>\n<p><a href=\"http://www.jianshu.com/p/fa28035656a9\" target=\"_blank\" rel=\"nofollow\">http://www.jianshu.com/p/fa28035656a9</a></p>\n<p><a href=\"http://www.jianshu.com/p/ec4a343c49f0\" target=\"_blank\" rel=\"nofollow\">http://www.jianshu.com/p/ec4a343c49f0</a></p>\n<p><a href=\"http://hudeyong926.iteye.com/blog/1490687\" target=\"_blank\" rel=\"nofollow\">http://hudeyong926.iteye.com/blog/1490687</a></p>\n<p>[7] MySQL索引原理及慢查询优化</p>\n<p><a href=\"https://tech.meituan.com/mysql-index.html\" target=\"_blank\" rel=\"nofollow\">https://tech.meituan.com/mysql-index.html</a></p>\n<p>[8] [译文]MySQL发生死锁肿么办？</p>\n<p><a href=\"http://www.10tiao.com/html/672/201612/2653929751/1.html\" target=\"_blank\" rel=\"nofollow\">http://www.10tiao.com/html/672/201612/2653929751/1.html</a></p>\n<p>[9] MySQL的timeout那点事</p>\n<p><a href=\"http://www.penglixun.com/tech/database/mysql_timeout.html\" target=\"_blank\" rel=\"nofollow\">http://www.penglixun.com/tech/database/mysql_timeout.html</a></p>\n<p>[10] mysql死锁(deadlock)分析及解决 （索引 间隙锁 sql顺序）</p>\n<p><a href=\"http://www.youyong.top/article/1158d0e3bcf\" target=\"_blank\" rel=\"nofollow\">http://www.youyong.top/article/1158d0e3bcf</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112054\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112054votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112054\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,MySQL,数据库", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "092a09180ce44fb76ec5789f381f96da", "title": "开发团队面临的 3 大安全挑战", "create_time": "2017/07/27", "url": "http://blog.jobbole.com/112007/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>应用安全不能只依靠防火墙，必须要在应用开发阶段采取适当的安全控制措施，使得应用在发布上线前就具备较好的安全性，避免人为失误造成安全隐患。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg\" alt=\"\" width=\"1000\" height=\"414\"></p>\n<p>不少企业早就意识到了这一点，然而理想和现实之间还隔着几十个安全漏洞，尤其是那些采用敏捷或者精益开发模式的团队，在具体的实践过程中，几乎无可避免的会遭遇到下面几个挑战。</p>\n<h3>挑战1：一次性的安全检查无法匹配持续性的交付</h3>\n<p>为确保团队开发出来的应用具有足够的安全性，最常见的选择是对其进行全方位的安全渗透测试。无论这样的测试是由企业自己的安全团队执行，还是购买外部第三方服务，最终都会得到一份详细的安全报告，团队接下来需要做的就是基于这份报告所揭露的漏洞，对应用进行相应的调整，直到安全漏洞被修复为止。</p>\n<p>持续交付是敏捷、精益开发团队的核心能力之一，这意味着团队可以做到每周甚至任意时刻发布产品，持续性的从真实环境中获取市场反馈，然后基于这些反馈对产品进行调整。一个可以参考的案例是，早在2014年的时候，亚马逊平均每秒有一次以上的产品部署，每天如此。</p>\n<p>与此同时，安全渗透测试却没有这么高的“交付”速度。由于渗透测试的特殊性，虽然有大量的自动化漏洞扫描工具可以使用，但是一次全面、高质量的渗透测试依然需要人工参与，几天甚至一两周之后才能得到测试报告是普遍现象。</p>\n<p>那么问题来了，一方面开发团队持续性的每周都有新功能上线和旧功能调整，另一方面渗透测试却没办法在这么短的时间里完成，它只能是阶段性、或者定期性的进行，例如每个季度测试一次。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-develop-team-1024x614.jpg\" alt=\"\" width=\"700\" height=\"420\"></p>\n<p>这种情况下，开发团队该何去何从？如果要安全，那么就得等着做渗透测试，而且一旦发现安全漏洞还要花额外的时间去修复，产品发布必定会延期。如果要效率，那么就只能冒着风险发布，因为谁也不知道当前应用有没有安全漏洞，万一被黑客发现并且加以利用，后果不堪设想。</p>\n<p>问题的关键在于，开发团队是在持续的发布应用到生产环境，然而渗透测试却是个相当耗时的一次性活动，它没办法跟上这么快的交付速度。</p>\n<h3>挑战2：缺乏自动化、自助化的支持，安全实践落地难</h3>\n<p>开发团队其实明白安全对于应用而言至关重要，也知道在开发过程中就应当通过运用各种安全最佳实践来主动消除安全问题，把安全风险降至最低。不过现状却是，不少安全实践要么无法落地实施，要么有流于形式的倾向。</p>\n<p><strong>一个真实的案例</strong></p>\n<p><em>一个开发团队在做完业务需求梳理后，立即进入了开发阶段。安全团队虽然在项目启动时提出过安全要求，例如要求团队采用威胁建模活动，识别出应用面临的安全威胁，并制定应对措施。然而由于该项目交付压力大，时间紧任务重，再加上团队成员对于威胁建模并不熟悉，最后这个活动被一拖再拖，直到应用开发完毕进行上线前的审批时，才发现没有做威胁建模，而此刻为了能让应用按时上线，只好回过头来临时补一份威胁建模的文档，仅用于应付安全部门的要求。这种情况下，安全威胁根本得不到全面的分析和应对，风险由此而生。</em></p>\n<p>在项目前期的设计阶段是进行威胁识别的最佳时刻，开发团队只要在这时做一次威胁建模，就能识别出潜在的安全风险，并且在接下来的开发过程中采取适当的措施加以应对。但是开发团队却仿佛是懒癌晚期患者，硬是拖到上线前才把威胁建模补上，而此时它早已失去意义。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-useless-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></p>\n<p>为何开发团队一边认同安全的重要性，一边却又对安全实践如此怠慢呢？本质原因在于，某些安全实践需要大量人工参与，或者对人员安全技能有很高的要求，与此同时又缺乏自动化、自助化的支持，因此在开发团队看来，这些实践的采纳成本太高，在面临交付压力的情况下选择性的忽略，或者认认真真的走个形式，就成了再正常不过的结果。</p>\n<h3>挑战3：高耸的部门墙让开发和安全团队难以进行高效的协作</h3>\n<p>随着敏捷、精益开发模式的普及，再加上DevOps转型的助推，不少企业已经开始组建全功能开发团队，团队中各个角色有着共同的目标，相互协作以更高的效率交付应用。但是安全团队却依然隶属于一墙之隔的安全部门。</p>\n<p>别小看了这堵墙，说它是万恶之源有点太夸张，但它的存在确确实实阻碍了企业实现其业务价值最大化。墙的这边，开发团队竭尽所能的以最快的速度完成应用开发，以求尽快上线获取反馈；墙的另一边，安全团队只关心应用是否安全，至于是否急着上线，那不是他们关心的问题。但是他们都忽略了一个事实，那就是企业的成功需要两者共同高效的协作。</p>\n<h3>小结</h3>\n<p>敏捷、精益团队一方面要保持快速的交付速度，一方面还要提高应用的安全质量，看上去这是鱼和熊掌不可兼得的事情，然而事实上我们依然有办法解决这些挑战。</p>\n<p>开发团队可以通过自动化，显著降低安全实践的实施难度和成本，把一次性的安全检查转变为持续性的安全质量反馈。对于安全团队，也应当向着开发团队迈进一步，打通开发和安全部门之间的隔离，以更加紧密和高效协作的方式，共同确保应用具备更高的安全质量。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112007\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112007votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112007\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,安全,开发", "front_image_path": "full/5df4d74ef333e85bce73952b363632b42fa5301b.jpg"}
{"url_object_id": "8d43f3214a6d4c3595599b41dd869a1d", "title": "这些奇怪的排序算法，你没见过吧？", "create_time": "2017/07/31", "url": "http://blog.jobbole.com/112051/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/15cdc9eaec6ba9ac858b0eaebfb6b949.jpg"], "praise_num": "3", "comment_num": 1, "fav_num": 6, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.quora.com/What-is-the-strangest-sorting-algorithm\">Quora</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：如果有人问你哪种排序算法最奇怪，可能你会先在冒泡排序、选择排序、快速排序等常见排序算法中「搜索」了。</p>\n<p>有人在 Quora 上也发帖问了这个问题。于是乎，各种脑洞大开的奇特算法就被列出来了。它们可能存在性能问题或无法实现，但是不可否认其创造性。</p>\n<p><img class=\"alignnone wp-image-112059\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/15cdc9eaec6ba9ac858b0eaebfb6b949.jpg\" alt=\"黑人问号\" width=\"571\" height=\"326\"></p>\n<h3>睡眠排序（Nipun Ramakrishnan 的回答）</h3>\n<p>这个搞笑算法流传于 4chan 的 /prog/ 板块。无从查证具体出自哪位程序员，伪代码如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add59fee3bd271376417\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprocedure printNumber(n)\r\n    sleep n seconds\r\n    print n\r\nend\r\n\r\nfor arg in args\r\n    run printNumber(arg) in background\r\nend\r\nwait for all processes to finish</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add59fee3bd271376417-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3bd271376417-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3bd271376417-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3bd271376417-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3bd271376417-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3bd271376417-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3bd271376417-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3bd271376417-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3bd271376417-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add59fee3bd271376417-1\"><span class=\"crayon-e\">procedure </span><span class=\"crayon-e\">printNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3bd271376417-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seconds</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3bd271376417-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3bd271376417-4\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3bd271376417-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3bd271376417-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">arg </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3bd271376417-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">run </span><span class=\"crayon-e\">printNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">background</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3bd271376417-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3bd271376417-9\"><span class=\"crayon-e\">wait </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finish</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>算法运行如下： 对于数组中每个元素 x，开启一个新程序：</p>\n<ul>\n<li>休眠 x 秒</li>\n<li>打印 x 所有元素同时开始计时。 只适用于非负数字。</li>\n</ul>\n<h3>Bogo 排序/猴子排序 （Ryan Turner的回答）</h3>\n<p>Bogo 排序/猴子排序，名字很奇怪。它是<a href=\"https://en.m.wikipedia.org/wiki/Stupid_sort\">愚蠢排序</a>中的一员。</p>\n<p>主要来说，算法就是你把元素随机排列。</p>\n<p>如果没有排好序，再次把元素随机排列。</p>\n<p>如果还没有排好序，你懂的。下面是个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add59fee3d0591043055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n4, 7, 9, 6, 5, 5, 2, 1 (未排序)\r\n2, 5, 4, 7, 5, 9, 6, 1 (随机排列)\r\n1, 4, 5, 6, 9, 7, 5, 2 (再次随机排列)\r\n1, 2, 4, 5, 5, 6, 7, 9 (天呐，真幸运)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d0591043055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d0591043055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d0591043055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d0591043055-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add59fee3d0591043055-1\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>未排序<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d0591043055-2\"><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>随机排列<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3d0591043055-3\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>再次随机排列<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d0591043055-4\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>天呐，真幸运<span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>你不停地随机排序，直到得到一个有序数组。</p>\n<p>毫无疑问这是最低效的排序算法之一，除非你非常非常幸运。它时间复杂度是令人窒息的 O(n!)，而且随着元素数量增加，很有 O(∞) 的趋势。</p>\n<h3>量子 Bogo 排序（Tyler Schroeder 的回答）</h3>\n<p>我是量子 Bogo 排序的粉丝：</p>\n<ul>\n<li>随机排列数组中元素。</li>\n<li>如果数组没有排好序，摧毁当前宇宙（这一步就拜托你了）</li>\n<li>存活的宇宙将会有排好序的数组。 时间复杂度仅仅 O(n) 注意：这种算法依赖于量子力学的平行宇宙理论的可靠性。如果量子力学的平行宇宙理论不准确，这个算法时间复杂度达不到 O(n)</li>\n</ul>\n<h3>打印店页码排序 （Yi Wang的回答）</h3>\n<p>这并不是我发明的，我从别处看到的。</p>\n<p>一个学生去打印店打印材料。他需要两份，但并没有直接打印两份，而是将每一页打印了两次，像下面这样：</p>\n<p>需要的页码顺序: 1 2 3 4 … N; 1 2 3 4 … N</p>\n<p>手上的页码顺序: 1 1 2 2 3 3 4 4 …. N N</p>\n<p>他开始对打印材料排序，取一页放在左边，然后取一页放在右边。打印店老板看不下去了，直接把材料拿过来。</p>\n<p>老板首先取一页放在左边，然后两页放在右边，再然后两页左边，两页右边…… 排序速度瞬间翻倍 ……</p>\n<p>（有网友评论提醒：这是归纳，不是排序）</p>\n<h2>下面是其他网友的回答：</h2>\n<h3>慢排序</h3>\n<p>这是一个非常幽默却没什么用的排序算法。它基于“合而不治”的原则（分治算法基本思想“分而治之”的反义词，文字游戏），它由 Andrei Broder 和 Jorge Stolfi 于 1986 年发表在论文《Pessimal Algorithms and Simplexity Analysis（最坏排序和简单性分析）》中，伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59add59fee3d8074040583\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction slowSort(array,start,end){\r\n    if( start &gt;= end ) return; //已经不能再慢了\r\n    middle = floor( (start+end)/2 );\r\n\r\n    //递归\r\n    slowSort(array,start,middle);\r\n    slowSort(array,middle+1,end);\r\n\r\n    //比较得出最大值放在队尾\r\n    if( array[end] &lt; array[middle] )\r\n        swap array[end] and array[middle]\r\n\r\n    //去掉最大值之后再排序\r\n    slowsort(array,start,end-1);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59add59fee3d8074040583-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59add59fee3d8074040583-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//已经不能再慢了</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">middle</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">start</span><span class=\"crayon-o\">+</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-4\"> </div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//递归</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">middle</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-8\"> </div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//比较得出最大值放在队尾</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">swap </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-12\"> </div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//去掉最大值之后再排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59add59fee3d8074040583-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowsort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59add59fee3d8074040583-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p></p>\n<ul>\n<li>递归排序好前一半</li>\n<li>递归排序好后一半</li>\n<li>比较中间和队尾的值，得到整个数组的最大值，将最大值放到队尾。</li>\n<li>去掉最大值，递归整个数组</li>\n</ul>\n<h3>Stack 排序</h3>\n<p>从 StackOverflow 上搜索标题含有“数组排序”的帖子，复制粘贴并运行其中的代码片段，直到数组排好序。我认为这种排序算法事实上验证了整个数组。它被发表在<a href=\"https://xkcd.com/1185/\">xkcd网站</a>上，这里有一个在线版的具体实现<a href=\"https://gkoberger.github.io/stacksort/\">stacksort</a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/87e983d6fd4a07bf10518f60d84c2595.png\"><img class=\"alignnone size-medium wp-image-65367\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/87e983d6fd4a07bf10518f60d84c2595.png\" alt=\"stacksort\"></a></p>\n<h3>随机排序</h3>\n<p>运行如下： 创建一个随机程序。 传入数组并运行随机程序。 如果程序的输出恰好是排好序的，完成。 否则重复上面过程。</p>\n<h3>太阳能比特翻转排序</h3>\n<p>太阳发出的阿尔法粒子偶尔能够翻转内存中的比特位，所以这种算法主要基于希望这种翻转能够使元素正确排序。运行方式如下：</p>\n<p>检查数组是否排好序。 如果排好序，返回这个数组。 如果没有，等 10 秒钟并祈祷太阳辐射使得比特位翻转，而且使得数组排好序，重复第一步。</p>\n<h3>意大利面排序</h3>\n<p>这是一种线性时间算法，是需要 O(n) 空间的稳定排序。它需要并行处理器。简单来说，假设我们排序一列自然数。排序方法需要使用很多根生的意大利面条。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb19bcfbd683bded0fdd0b92891aac90.png\"><img class=\"size-medium wp-image-65368\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb19bcfbd683bded0fdd0b92891aac90.png\" alt=\"意大利面\"></a></p>\n<p>将数据按比例转换成表示意大利面条长度的数字。 在每根面条上写下数字，并将面条折断成数字表示的长度。 把所有面条攥成一捆并把底部在平面上敲击。 取出最突出的一根面条，也就是最长的一根，获取上面的数字，转换成原始的数据并记录下来。 重复这个过程直到处理完所有意大利面。</p>\n<h3>指鹿为马排序</h3>\n<p>这个算法时间复杂度 O(n)。 聚集一帮人并向他们展示数组。 询问他们这个数组是否是排序好的。 干掉其中认为没有排序好的人。 重复几次，直到所有人同意这个数组是排序好的。</p>\n<h3>智能设计排序</h3>\n<p>无论你的数组状态是什么样的，它都算是排好序的。 解释：原始输入按照某种顺序的概率是 1/(n!)。概率是如此小，（当前的顺序）归结于运气成分显然是荒谬的，所以它是按照“智能设计”排序过的。所以完全可以说数组已经排好序了，只是不是我们传统意义上的“升序”。如果按照我们传统观点对它进行操作，只会让它乱序。（<a href=\"https://zh.wikipedia.org/wiki/%E6%99%BA%E8%83%BD%E8%AE%BE%E8%AE%A1\">“智能设计”涉及宗教和哲学，不过多解释</a>）</p>\n<h3>互联网排序</h3>\n<p>这是一种冒泡排序，但每次比较都依靠互联网的搜索。比如 “0.211 和 0.75 哪个大？”</p>\n<h3>委员会排序</h3>\n<p>排序一个包含 N 个自然数的数组，首先用纸打印出 N 份整个数组。 然后在办公室周围选择几个恰好路过的倒霉委员。每个委员对应数组中的一个数字。 给每个委员一份打印的数组，并让他们通过开会或其他手段，来决定自己代表的数字应该在有序数组中的位置。 当这些委员有结论并答复你时，数组自然排好序了。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112051\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112051votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112051\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 18</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,趣文小说,排序算法", "front_image_path": "full/d6573fc92df4aa98014ce9dc55320411b7b5bf1d.jpg"}
{"url_object_id": "5e8243d793df35a9502c06640a79ceee", "title": "可能是迄今为止最好的 GitHub 代码浏览插件", "create_time": "2017/07/28", "url": "http://blog.jobbole.com/112011/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "praise_num": "1", "comment_num": 2, "fav_num": 9, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.geeksense.cn/plugin/\">geeksense</a>   </div><p>【伯乐在线转注】：以前曾介绍过一个 Chrome 插件 <a href=\"http://t.cn/RPZJZfD\" target=\"_blank\">Octotree</a>。安装之后，浏览托管在 Github上的项目，可看到左侧的树形结构，更方便查看代码。今天这篇文章介绍另外一个同类插接。</p>\n<hr>\n<p>GitHub是很多开发者远(tong)程(xing)协(jiao)作(you)的重要工具，其社交化编码的理念伴随着开源运动改变着整个开发社区的生态，无数优质项目依托GitHub在全球开源开发者的参与下蓬勃发展。</p>\n<p><strong>不过，讲真，你有在GitHub上好好读过代码吗？</strong></p>\n<p>对于大部分人来说恐怕是没有，GitHub作为一款基于Git的代码管理工具和协同工具是很优秀的，然而作为代码浏览和搜索工具，就和IDE差的很远了。不然为什么到今天GitHub连个侧栏的文件树没有，很多开发者要专门去下载浏览器插件才能有文件树？为什么你还是需要git clone到本地在把代码装到你的IDE里才能愉快的阅读代码？是不是有想过如果能像IDE那样在GitHub上浏览代码多好？</p>\n<p>今天我们就来介绍一款Chrome浏览器插件Insight.io，让你能像在GitHub上像你的IDE里一样浏览和搜索代码，让你的Github就像穿上了钢铁侠的战衣。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg5vidjjg20dq094wp8.gif\"></p>\n<h2 id=\"\">功能总览</h2>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio/pmhfgjjhhomfplgmbalncpcohgeijonh\">下载安装</a>后，打开一个GitHub上的项目，会看到左边有个侧边栏，是不是已经有了自己在IDE里面的感觉了？插件提供以下功能</p>\n<ul>\n<li><strong>跳转到定义</strong></li>\n<li><strong>查找引用</strong></li>\n<li><strong>目录树功能</strong></li>\n<li><strong>基于符号的代码搜索</strong></li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5waddog21410osb29.gif\" alt=\"Glance\"></p>\n<p> </p>\n<h2 id=\"\">交叉引用</h2>\n<p>用<a href=\"https://github.com/apache/spark\">Apache Spark</a>做例子，悬浮在某个节点(类，方法，变量等)上就可以看到相应的类型和文档说明。点击左边的结构(Structure)按钮就可以看到改文件的类结构，包括成员变量，成员函数等，点击也可以跳到相应的行。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5y5wqwg21400ot1l0.gif\" alt=\"Cross Reference\"></p>\n<h2 id=\"\">查找引用</h2>\n<p>点击任何节点的用例就能跳到这个类，方法或者变量定义的地方（类似于IDE中的Ctrl + click）。</p>\n<p>点击类，方法和变量的定义节点，则可以找出所有该节点的使用例子。其中使用例子又会以被引用(Referenced At), 继承 (Inherit), 被继承(Inherited By), 重写(Override)等类型进一步分类方便查找。如果结果太多，用例的右上方也会有支持regular expression的文本框可以用来过滤出感兴趣的文件。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5zayzeg21650q4kjn.gif\" alt=\"Find References\"></p>\n<h2 id=\"\">目录树</h2>\n<p>点击文件(File)按钮你会看到树状的目录结构，忘记GitHub上切换文件的痛苦吧，文件树让你轻松的在项目之内的文件中自如切换。</p>\n<p>对于私有项目需要点击下方的<strong>Sign In</strong>按钮并到insight.io上导入私有项目文件树才会生效。</p>\n<p><img src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fhzg60wyodg21420othdv.gif\" alt=\"Directory Tree\"></p>\n<h2 id=\"\">代码搜索</h2>\n<p>GitHub只支持纯文本搜索，这时常让搜索代码变得很困难，特别是当你想搜的关键词是常用词的时候，大量的无用结果会让搜索功能完全不可用。而是用Insight.io插件，点击搜索(Search)按钮可以按类名，方法名，变量名，文件名等等搜索代码，并且有自动补全功能。试试在Insight.io和GitHub原生搜索上搜一下RDD.map对比下搜索结果吧？</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg62hd81g21660q44qr.gif\" alt=\"Code Search\"></p>\n<h2 id=\"insightio\">跳转到Insight.io</h2>\n<p>你也可以一键点击跳转到Insight.io上获得更好的浏览体验。</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg645xmfg21410oru0y.gif\" alt=\"View on insight.io\"></p>\n<h2 id=\"insightio\">提交项目给Insight.io</h2>\n<p>Insight.io目前收录了2000多个最活跃的开源项目，包括<a href=\"https://github.com/apache/kafka\">Apache Kafka</a>, <a href=\"https://github.com/torvalds/linux\">Linux-kernel</a>这样的大型项目，也有像<a href=\"https://github.com/daimajia/AndroidSwipeLayout\">AndroidSwipeLayout</a>这样优质的个人项目。如果你需要的项目并未被我们收录，点击<strong>Information</strong>栏下的<strong>Request Analyze</strong>就可以提交你目前正在浏览的项目了。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg65lh83g213y0oru0x.gif\" alt=\"Request Analyze\"></p>\n<h2 id=\"\">快捷键</h2>\n<p>用快捷键可以快速打开关闭插件功能:</p>\n<ul>\n<li><strong>文件树</strong>: <code>⌘+⇧+f</code></li>\n<li><strong>类结构</strong>: <code>⌘+⇧+o</code></li>\n<li><strong>信息</strong>: <code>⌘+⇧+i</code></li>\n<li><strong>搜索</strong>: <code>⌘+⇧+s</code></li>\n</ul>\n<hr>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio-for-github/pmhfgjjhhomfplgmbalncpcohgeijonh/\" target=\"_blank\">插件下载传送门</a></p>\n<p>目前插件支持的语言有Java, C/C++, Scala, Python和Ruby。想跟开发团队吐个槽或者点个赞？想知道最好的编程语言PHP什么时候支持？想知道怎么让公司代码库也能用上Insight.io？欢迎邮件到 support@insight.io 。想实时吐槽的也可以加入我们的gitter房间</p>\n<p><a href=\"https://gitter.im/Insight-io/Lobby\"><img title=\"\" src=\"https://badges.gitter.im/Insight-io/Lobby.png\" alt=\"Gitter chat\"></a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112011\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112011votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112011\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "工具与资源,Github", "front_image_path": "full/4ccab0a38c3c13879135519b200e0c60ce7498bb.jpg"}
{"url_object_id": "1a8e6c64968ed6db401b5769221f9b4f", "title": "Neo4j 图数据库基础", "create_time": "2017/07/31", "url": "http://blog.jobbole.com/112064/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_num": "2", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/fundamentals-graph-databases-neo4j\">Ruth Holloway</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8728-1.html\">Linux中国/geekpi</a>   </div><blockquote><p>在这个三篇系列文章的第一篇文章中，我们将学习图数据库（graph database）的基础知识，它支持了这地球上最大的一些数据池。</p></blockquote>\n<p>对于海量的各种非结构化信息来说，图数据库已经成为帮助收集、管理和搜索大量数据的技术。在这三篇系列文章中，我们将使用开源图数据库软件 Neo4j 来研究图数据库。</p>\n<p>在本文中，我将向你展示图数据库的基础知识，帮助你快速了解概念模型。在第二篇中，我将向你展示如何启动 Neo4j 数据库，并使用内置的浏览器工具填充一些数据。而且，在本系列的最后一篇文章中，我们将探讨一些在开发工作中使用的 Neo4j 编程库。</p>\n<p>掌握图数据库的概念模型是有用的，所以我们从那里开始。图数据库中只存储两种数据：节点node和边edge。</p>\n<ul>\n<li><strong>节点是实体：</strong>诸如人物、发票、电影、书籍或其他具体事物。这些有些等同于关系数据库中的记录或行。</li>\n<li><strong>边名关系：</strong>连接节点的概念、事件或事物。在关系数据库中，这些关系通常存储在具有链接字段的数据库行中。在图数据库中，它们本身就是有用的，是可以以其自己的权限搜索的对象。</li>\n</ul>\n<p>节点和边都可以拥有可搜索的<em>属性</em>。例如，如果你的节点代表人，他们可能拥有名字、性别、出生日期、身高等属性。而边的属性可能描述了两个人之间的关系何时建立，见面的情况或关系的性质。</p>\n<p>这是一个帮助你可视化的图表：</p>\n<p><img class=\"aligncenter\" title=\"Graph database image 1\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61f03ca246db79a877365543604ae7de.jpg\" alt=\"Graph database image 1\"></p>\n<p>在这张图中，你知道 Jane Doe 有一个新的丈夫 John；一个女儿（来自她以前的夫妻关系）Mary Smith 和朋友 Robert 和 Rhonda Roe。Roes 有一个儿子 Ryan，他正在与 Mary Smith 约会。</p>\n<p>看看它怎么工作？每个节点代表一个独立于其他节点的人。你需要找到关于<em>那个</em>人的一切都可以存储在节点的属性中。边描述了人们之间的关系，这与你在程序中需要的一样多。</p>\n<p>关系是单向的，且不能是无向的，但这没有问题。由于数据库可以以相同的速度遍历两个方向，并且方向可以忽略，你只需要定义一次此关系。如果你的程序需要定向关系，则可以自由使用它们，但如果双向性是暗含的，则不需要。</p>\n<p>另外需要注意的是，图数据库本质上是无 schema 的。这与关系数据库不同，关系数据库每行都有一组列表，并且添加新的字段会给开发和升级带来很多工作。</p>\n<p>每个节点都可以拥有一个标签label；对于大多数程序你需要“输入”这个标签，是对典型的关系数据库中的表名的模拟。标签可以让你区分不同的节点类型。如果你需要添加新的标签或属性，修改程序来用它就行！</p>\n<p>使用图数据库，你可以直接开始使用新的属性和标签，节点将在创建或编辑时获取它们。不需要转换东西；只需在你的代码中使用它们即可。在这里的例子中，你可以看到，我们知道 Jane 和 Mary 最喜欢的颜色和 Mary 的出生日期，但是别人没有（这些属性）。这个系统不需要知道它；用户可以在正常使用程序的过程中访问节点时为其添加信息（属性）。</p>\n<p>作为一名开发人员，这是一个有用的特性。你可以将新的标签或属性添加到由节点处理的表单中并开始使用它，而不必进行数据库 schema 的修改。对于没有该属性的节点，将不显示任何内容。你可以使用任何一种类型的数据库来为表单进行编码，但是你可以放下在关系型数据库中要进行的许多后端工作了。</p>\n<p>让我们添加一些新的信息：</p>\n<p><img class=\"aligncenter\" title=\"Graph database image 2, defining a new type of node\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5362edb32fd33fc06def8b3a179b978a.jpg\" alt=\"Graph database image 2, defining a new type of node\"></p>\n<p>这是一个新的节点类型，它代表一个位置，以及一些相关关系。现在我们看到 John Doe 出生在加利福尼亚州的 Petaluma，而他的妻子 Jane 则出生在德克萨斯州的 Grand Prairie。 他们现在住在得克萨斯州的赛普拉斯，因为 Jane 在附近的休斯顿工作。Ryan Roe 缺乏城市关系对数据库来说没有什么大不了的事情，我们<em>不知道</em>那些信息而已。当用户输入更多数据时，数据库可以轻松获取新数据并添加新数据，并根据需要创建新的节点和关系。</p>\n<p>了解节点和边应该足以让你开始使用图形数据库。如果你像我一样，已经在考虑如何在一个图中重组你的程序。在本系列的下一篇文章中，我将向你展示如何安装 Neo4j、插入数据，并进行一些基本的搜索。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112064\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112064votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112064\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "965945816f129cd59abb415e3b1e26c9", "title": "ss：查看网络连接的另一种方法", "create_time": "2017/07/31", "url": "http://blog.jobbole.com/112061/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/149000d5c8b1bb08b8de6914ed749f28.gif"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://insights.ubuntu.com/2017/07/25/ss-another-way-to-get-socket-statistics/\">Mathieu Trudel-lapierre</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8727-1.html\">Linux中国/Vic020</a>   </div><p>在之前的文章中，我提到过 <code>ss</code>，它是 iproute2 包附带的另一个工具，允许你查询 socket 的有关统计信息。可以完成 <code>netstat</code> 同样的任务，但是，<code>ss</code> 稍微快一点而且命令更简短。</p>\n<p>直接输入 <code>ss</code>，默认会显示与 <code>netstat</code> 同样的内容，并且输入类似的参数可以获取你想要的类似输出。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3e2438922412553\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss -t\r\nState       Recv-Q Send-Q       Local Address:Port                        Peer Address:Port\r\nESTAB       0      0                127.0.0.1:postgresql                     127.0.0.1:48154\r\nESTAB       0      0            192.168.0.136:35296                      192.168.0.120:8009\r\nESTAB       0      0            192.168.0.136:47574                     173.194.74.189:https\r\n[…]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2438922412553-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2438922412553-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2438922412553-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2438922412553-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2438922412553-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2438922412553-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3e2438922412553-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2438922412553-2\"><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e2438922412553-3\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">postgresql</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48154</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2438922412553-4\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35296</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.120</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8009</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e2438922412553-5\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">47574</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">173.194.74.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">https</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2438922412553-6\"><span class=\"crayon-sy\">[</span>…<span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p><code>ss -t</code> 只显示 TCP 连接。<code>ss -u</code> 用于显示 UDP 连接，<code>-l</code> 参数只会显示监听的端口，而且可以进一步过滤到任何想要的信息。</p>\n<p>我并没有测试所有可用参数，但是你甚至可以使用 <code>-K</code> 强制关闭 socket。</p>\n<p><code>ss</code> 真正耀眼的地方是其内置的过滤能力。让我们列出所有端口为 22（ssh）的连接：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3e244e642843062\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state all sport = :ssh\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   LISTEN     0      128                    *:ssh                                  *:*\r\ntcp   ESTAB      0      0          192.168.0.136:ssh                      192.168.0.102:46540\r\ntcp   LISTEN     0      128                   :::ssh                                 :::*</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e244e642843062-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e244e642843062-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e244e642843062-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e244e642843062-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e244e642843062-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3e244e642843062-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">all </span><span class=\"crayon-v\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">ssh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e244e642843062-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e244e642843062-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">LISTEN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e244e642843062-4\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.102</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46540</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e244e642843062-5\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">LISTEN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>如果只想看已建立的 socket（排除了 <em>listening</em> 和 <em>closed</em> ）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3e2452006760661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state connected sport = :ssh\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   ESTAB      0      0          192.168.0.136:ssh                      192.168.0.102:46540</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2452006760661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2452006760661-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2452006760661-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3e2452006760661-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">connected </span><span class=\"crayon-v\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">ssh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2452006760661-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e2452006760661-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.102</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46540</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>类似的，可以列出指定的 host 或者 ip 段。例如，列出到达 74.125.0.0/16 子网的连接，这个子网属于 Google：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3e2457491631116\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state all dst 74.125.0.0/16\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   ESTAB      0      0          192.168.0.136:33616                   74.125.142.189:https\r\ntcp   ESTAB      0      0          192.168.0.136:42034                    74.125.70.189:https\r\ntcp   ESTAB      0      0          192.168.0.136:57408                   74.125.202.189:https</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2457491631116-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2457491631116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2457491631116-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3e2457491631116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3e2457491631116-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3e2457491631116-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">all </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.0.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">16</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2457491631116-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e2457491631116-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33616</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.142.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">https</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3e2457491631116-4\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42034</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">74.125.70.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">https</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3e2457491631116-5\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">57408</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.202.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">https</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p><code>ss</code>与 iptables 的语法非常相同，如果已经熟悉了其语法，<code>ss</code> 非常容易上手。也可以安装 iproute2-doc 包， 通过 <code>/usr/share/doc/iproute2-doc/ss.html</code> 获得完整文档。</p>\n<p>还不快试试! 你就可以知道它有多棒。无论如何，让我输入的字符越少我越高兴。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112061\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112061votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112061\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux", "front_image_path": "full/e8f8b7fe8c56ba964bd5eb1fadab627b06618a67.jpg"}
{"url_object_id": "ac282b4e104c307d34b2e97c8a8a1aa6", "title": "优秀的程序员都有哪些习惯？", "create_time": "2017/08/01", "url": "http://blog.jobbole.com/112067/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/68569d6253986872f6d708b3c9fb1426.jpeg"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qingfeng6438\">阿慧</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://news.ycombinator.com/item?id=14709076\">nostrademons</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：「我不是卓越的程序员，我只不过是一个有着卓越习惯的程序员。」技术大牛 Kent Beck 曾这样说过自己。</p>\n<p>7月初，nostrademons 在 Hacker News 发起一个讨论，是哪些习惯成就了优秀/卓越的程序员？</p>\n<hr>\n<p>可变的习惯：学习着在不同的情况中采用不同的习惯。考虑到这一点，我总结了一些适用于不同情况的通用技巧：</p>\n<h3>为了数据科学类问题研究新领域的发展：</h3>\n<p>1.尽量亲自动手去完成事情。你将会有一种直觉，知道如何去处理该事物。</p>\n<p>2.积累案例，从数据表中标注着你已获得的数据开始。</p>\n<p style=\"padding-left: 30px;\"><span style=\"color: #999999;\">（关于这一点：rluhar 评论补充说，这不仅适用于数据科学，也适用于解决任何数值问题。用一个电子表格（或一个R／Python Notebook）来实现算法并获得一些结果，在过去帮助我真正理解了问题，避免走死胡同。例如，在建立一个外汇定价系统时，我能够使用电子表格来描述定价算法是如何工作的，并向交易者（最终用户）解释它。在执行和部署算法之前，我们可以调整计算并确保一切都清楚。很好的建议！）</span></p>\n<p>3.在找到通用办法之前，先找到一种能解决当前问题的办法。</p>\n<p>4.让算法本身输出调试信息。你应该能够转储每一步的中间结果，并用文本编辑器或是 Web 浏览器手动检查它们。</p>\n<p>5.不要为单元测试操心，定义出正确行为才是首要的。</p>\n<h3>维护大的、不熟悉的代码库程序：</h3>\n<p>1.检查文件的大小。最大的文件总是包含了程序的实体部分，至少是指向程序实体内容的分派程序。 main.cc  通常很小，并且对寻找代码结构毫无用处。</p>\n<p>2.从主循环调度开始单步调试程序。可以学到很多关于控制流的东西。</p>\n<p>3.寻找数据结构，特别是做为参数传递到许多函数中的那些。大多数程序具有一个小的关键数据结构集合，找到它们，理解代码的其余部分会变得容易的多。</p>\n<p>4.写单元测试。这是确认你所理解的代码与真实代码工作方式无误的最好方法。</p>\n<p>5.移除代码，看看什么出问题了。（但不要 check in！）</p>\n<h3>性能工作：</h3>\n<p>0.一般不需要做，除非你所构建的东西对用户来说太慢了。制定出需要提高的性能目标，达成这个目标即可。</p>\n<p>1.在开始所有工作之前，甚至是在剖析（profile）之前，建立一套代表典型现实世界的使用基准。别让性能倒退，除非你确信已经登峰造极，高处不胜寒，并且更好的解决方法还藏在世界的某个角落里无人发现（如果出现了那种情况，在版本控制系统（VCS）中标记你的分支，以便在发现错误之后回来更改。）。</p>\n<p>2.许多性能瓶颈都出现在系统的交叉处。在所有 RPC 框架中搜集时间统计数据，并且有一些方式来传播和可视化每个服务器的请求时间，以及哪些部分的请求是并行的，哪里是关键路径。</p>\n<p>3.剖析（Profile）。</p>\n<p>4.通常，避免不必要的工作可使你赢在起跑线上。缓存最大的计算结果，粗略评估不常用的东西。</p>\n<p>5.不要忽视常量因素。有时候一个渐进性更差的算法在实践中执行的很好，原因是其具有更好的缓存局部性。为此，你可以在多次调用的函数中识别出威胁。</p>\n<p>6.当你获得了程序大致剖析之后，更改数据结构往往会获得更多收益。注意内存的使用，时常缩小内存需求来减小缓存压力，可显著地提高系统的速度。注意局部性，将常用数据放到一起。如果你的编程语言允许（为 Java 感到遗憾 ），可以消除指针雕镂（pointer-chasing）来支持值控制。</p>\n<blockquote><p>译注：指针雕镂（Pointer-chasing）程序：该程序中会遍历一个由指针链在一起的数据结构，即一个链表。但是在遍历的过程中会不断的引起内存操作。因为下一个元素总不在 Cache 中。</p></blockquote>\n<h3>编码常规</h3>\n<p>1.不要想当然地去构建，确保你所加入的每个特性都有客户在用。</p>\n<p>2.谨慎地控制依赖。为了某个效果而引入的库，可能会帮你节省一个小时，但也会导致更多地方被破坏——部署、版本控制、安全性、日志记录、意外的进程死亡。</p>\n<p>3.当为个人或小团体开发的时候，把出现的问题累积起来，然后一次性全部解决（或者扔掉代码库，然后重新启动）。当为大型团队开发时，永远都不要让问题堆积，代码库应该始终处于新的开发人员可以看懂的状态，他们会说：“我知道这是做什么的，也知道如何更改它”（代码的）阅读者/编写者的比例结果是这样的：初始代码的编写多过阅读，因此可读性不那么重要，但成熟代码的阅读多过编写。（当你要求开发前一种初始代码去获得用户、资金和存活了，转换到后一种成熟代码中去就是给阅读者留下的操练了。）</p>\n<p> </p>\n<p>欢迎大家补充。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/f9e94e087837b17681c87206c9d540dd.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/748ed21a8038cdafa65b3b4ab9a0185a.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112067\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112067votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112067\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438\">阿慧</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/c169e93746e89947e9a2f0fce3f937cc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            什么东西没头没尾没中间？        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qingfeng6438\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qingfeng6438/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a> · <a title=\"QQ：1305735677\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：chenahui1996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "开发,程序员", "front_image_path": "full/21812d9d62b935e7b375b95677300b715fa3a48f.jpg"}
{"url_object_id": "c7e0ae15f1eab36a802669e93f9b1844", "title": "系统管理员应该知道的 20 条 Linux 命令", "create_time": "2017/08/02", "url": "http://blog.jobbole.com/112085/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/7599b213c6d67d39e4bb2391c276fbb5.png"], "praise_num": "1", "comment_num": 1, "fav_num": 7, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com\">OpenSource</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1499026\">开源中国/局长</a>   </div><p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7599b213c6d67d39e4bb2391c276fbb5.png\"><img class=\"aligncenter wp-image-112080 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7599b213c6d67d39e4bb2391c276fbb5.png\" alt=\"203755_92u8_2918182\" width=\"520\" height=\"292\"></a></p>\n<p>在这个全新的工具和多样化的开发环境井喷的大环境下，任何开发者和工程师都有必要学习一些基本的系统管理命令。特定的命令和工具包可帮助开发者组织、排查故障并优化他们的应用程序，而且当出现错误时，也可以为运维人员和系统管理员提供有价值的分类信息。</p>\n<p>无论你是新手开发者还是希望管理自己的应用程序，下面 20 条基本的系统管理命令都可以帮助您更好地了解您的应用程序。它们还可以帮助解决为什么应用程序可在本地正常工作但不能在远程主机上工作这类的系统故障。这些命令适用于 Linux 开发环境、容器和虚拟机。</p>\n<h1>1. curl</h1>\n<p>curl 用于传输一个 URL。可以使用这条命令用于测试应用程序的端点或与上游服务端点的连接。curl 还可用于检查你的应用程序是否能连接到其他服务，例如数据库，或检查您的服务是否处于健康的状态。</p>\n<p>举个例子，假如你的应用程序抛出一个 HTTP 500 错误，表示无法访问 MongoDB 数据库：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d1e514482689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -I -s myapplication:5000\r\n\r\nHTTP/1.0 500 INTERNAL SERVER ERROR</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d1e514482689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d1e514482689-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d1e514482689-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d1e514482689-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">myapplication</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d1e514482689-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d1e514482689-3\"><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INTERNAL </span><span class=\"crayon-e\">SERVER </span><span class=\"crayon-v\">ERROR</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><strong>-I </strong>选项用于显示头信息，<strong>-s </strong>选项表示使用静默模式，不显示错误和进度。检查数据库的端点是否正确：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d28123718454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -I -s database:27017\r\n\r\nHTTP/1.0 200 OK</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d28123718454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d28123718454-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d28123718454-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d28123718454-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27017</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d28123718454-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d28123718454-3\"><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OK</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>那么可能是什么问题呢？ 检查您的应用程序是否可以访问数据库以外的其他位置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d54322578018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -I -s https://opensource.com\r\n\r\nHTTP/1.1 200 OK</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d54322578018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d54322578018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d54322578018-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d54322578018-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//opensource.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d54322578018-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d54322578018-3\"><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OK</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>看起来这没问题，现在尝试访问数据库。您的应用程序正在使用数据库的主机名，因此请先尝试：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d58543168189\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl database:27017\r\n\r\ncurl: (6) Couldn't resolve host 'database'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d58543168189-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d58543168189-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d58543168189-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d58543168189-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27017</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d58543168189-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d58543168189-3\"><span class=\"crayon-v\">curl</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Couldn</span><span class=\"crayon-s\">'t resolve host '</span><span class=\"crayon-i\">database</span>'</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这表示您的应用程序无法解析数据库，因为数据库的 URL 不可用或主机（容器或VM）没有可用于解析主机名的域名服务器。</p>\n<h1>2. python -m json.tool / jq</h1>\n<p>使用 curl 后，API 调用的输出可读性可能较差。有时候，你希望将生成的 JSON 数据格式化输出以查找特定的条目。Python 有一个内置的库可帮助您实现这个需求。可以使用 <strong>python -m json.tool </strong>来缩进和组织 JSON。要使用 Python 的 JSON 模块，需要使用管道机制，将 JSON 文件的输出作为输入，写入到 <strong>python -m json.tool</strong> 命令行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d5c908724722\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat test.json\r\n{\"title\":\"Person\",\"type\":\"object\",\"properties\":{\"firstName\":{\"type\":\"string\"},\"lastName\":{\"type\":\"string\"},\"age\":{\"description\":\"Age in years\",\"type\":\"integer\",\"minimum\":0}},\"required\":[\"firstName\",\"lastName\"]}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5c908724722-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5c908724722-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d5c908724722-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5c908724722-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Person\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"object\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"properties\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"lastName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"description\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Age in years\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"integer\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"minimum\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"required\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"lastName\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>要使用 Python 库，使用 <strong>-m</strong> (module) 选项将输出内容和 Python 库组合成管道。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d5f541641640\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat test.json | python -m json.tool\r\n{\r\n    \"properties\": {\r\n        \"age\": {\r\n            \"description\": \"Age in years\",\r\n            \"minimum\": 0,\r\n            \"type\": \"integer\"\r\n        },\r\n        \"firstName\": {\r\n            \"type\": \"string\"\r\n        },\r\n        \"lastName\": {\r\n            \"type\": \"string\"\r\n        }\r\n    },\r\n    \"required\": [\r\n        \"firstName\",\r\n        \"lastName\"\r\n    ],\r\n    \"title\": \"Person\",\r\n    \"type\": \"object\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d5f541641640-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d5f541641640-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">tool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"properties\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"description\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Age in years\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"minimum\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"integer\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"lastName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"required\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"lastName\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d5f541641640-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"object\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d5f541641640-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>对于更高级的 JSON 解析，可以安装 <strong><a href=\"https://stedolan.github.io/jq/download/\" target=\"_blank\" rel=\"nofollow\">jq</a>。j</strong><strong>q </strong>提供了一些从 JSON 输入中提取特定值的选项。要像上面的 Python 模块一样将 JSON 输出格式化，只需将 jq 应用到输出即可。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d63365771803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat test.json | jq\r\n{\r\n  \"title\": \"Person\",\r\n  \"type\": \"object\",\r\n  \"properties\": {\r\n    \"firstName\": {\r\n      \"type\": \"string\"\r\n    },\r\n    \"lastName\": {\r\n      \"type\": \"string\"\r\n    },\r\n    \"age\": {\r\n      \"description\": \"Age in years\",\r\n      \"type\": \"integer\",\r\n      \"minimum\": 0\r\n    }\r\n  },\r\n  \"required\": [\r\n    \"firstName\",\r\n    \"lastName\"\r\n  ]\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d63365771803-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d63365771803-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jq</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"object\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"properties\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"lastName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"description\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Age in years\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"integer\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"minimum\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"required\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"firstName\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"lastName\"</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d63365771803-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d63365771803-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h1>3. ls</h1>\n<p><strong>ls </strong>用于列出目录中的文件，系统管理员和开发者会经常使用这个命令。在容器空间中，这条命令可以帮助确定容器镜像中的目录和文件。除了查找文件，<strong>ls </strong>还可以用于检查权限。下面的示例中，由于权限问题，你不能运行 myapp。当你使用 <strong>ls -l </strong>检查权限时，你会发现它的权限在 <strong>-rw-r–r–</strong> 中没有”x”，只有读写的权限。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d67316669024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./myapp\r\nbash: ./myapp: Permission denied\r\n$ ls -l myapp\r\n-rw-r--r--. 1 root root 33 Jul 21 18:36 myapp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d67316669024-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d67316669024-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d67316669024-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d67316669024-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d67316669024-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">myapp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d67316669024-2\"><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myapp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Permission </span><span class=\"crayon-i\">denied</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d67316669024-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">myapp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d67316669024-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">myapp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h1>4. tail</h1>\n<p><strong>tail </strong>显示文件的最后一部分内容。通常情况下，你不需要浏览每行日志以进行故障排除。而是需要检查日志中对应用程序的最新请求的说明。例如，当你向 Apache HTTP 服务器发起请求时，可以使用 <strong>tail</strong> 来检查日志中发生的情况。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d3bb1474cbffe499ef82ea809c54c078.png\"><img class=\"aligncenter wp-image-112081 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d3bb1474cbffe499ef82ea809c54c078.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"321\"></a></p>\n<p><em>使用 <strong>tail -f </strong>来跟踪日志文件并在发起请求时查看它们。</em></p>\n<p><strong>-f</strong> 选项表示跟随的意思，它可在日志被写入文件时输出它们。下面的示例具有每隔几秒访问端点的后台脚本，日志会记录请求。除了实时跟踪日志，还可以使用 <strong>tail </strong>带上 <strong>-n </strong>选项来查看文件的最后 100 行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d6a833068740\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tail -n 100 /var/log/httpd/access_log</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d6a833068740-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d6a833068740-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">httpd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">access_log</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h1>5. cat</h1>\n<p><strong>cat </strong>主要用于查看文件内容和合并文件。你可能会使用 <strong>cat </strong>来检查依赖项文件的内容，或确认已在本地构建的应用程序的版本。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d6e960570447\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat requirements.txt\r\nflask\r\nflask_pymongo</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d6e960570447-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d6e960570447-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d6e960570447-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d6e960570447-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d6e960570447-2\"><span class=\"crayon-e\">flask</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d6e960570447-3\"><span class=\"crayon-v\">flask_pymongo</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上面的示例检查您的 Python Flask 应用程序是否已将 Flask 列为依赖项。</p>\n<h1>6. grep</h1>\n<p>grep 能使用特定模式匹配（包括正则表达式）搜索文本。如果你在另一条命令的输出中寻找特定的模式，<strong>grep </strong>会高亮显示相关的行。可使用这条命令来搜索日志文件以及特定的进程等。如果想查看 Apache Tomcat 是否启动，你可能会命令行的数量给淹没。但讲输出的内容和 <strong>grep </strong>命令组合成管道，可以将表示服务器已启动的行独立出来。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d71334127019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat tomcat.log | grep org.apache.catalina.startup.Catalina.start\r\n01-Jul-2017 18:03:47.542 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 681 ms</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d71334127019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d71334127019-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d71334127019-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">tomcat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">startup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">start</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d71334127019-2\"><span class=\"crayon-cn\">01</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Jul</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">03</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">47.542</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">INFO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">startup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Catalina</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start </span><span class=\"crayon-e\">Server </span><span class=\"crayon-e\">startup </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">681</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h1>7. ps</h1>\n<p><strong>ps </strong>用于查看进程的各种状态信息。使用该命令可确定正在运行的应用程序或确认预期的进程。例如，如果要检查正在运行的 Tomcat Web 服务器，可使用带有选项的 <strong>ps </strong>来获取 Tomcat 的进程 ID。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d74765750387\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ps -ef\r\nUID        PID  PPID  C STIME TTY          TIME CMD\r\nroot         1     0  2 18:55 ?        00:00:02 /docker-java-home/jre/bi\r\nroot        59     0  0 18:55 pts/0    00:00:00 /bin/sh\r\nroot        75    59  0 18:57 pts/0    00:00:00 ps -ef</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d74765750387-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d74765750387-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d74765750387-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d74765750387-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d74765750387-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d74765750387-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">ef</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d74765750387-2\"><span class=\"crayon-e\">UID        </span><span class=\"crayon-e\">PID  </span><span class=\"crayon-i\">PPID</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STIME </span><span class=\"crayon-e\">TTY          </span><span class=\"crayon-e\">TIME </span><span class=\"crayon-e\">CMD</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d74765750387-3\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">jre</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d74765750387-4\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">59</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sh</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d74765750387-5\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">75</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">59</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">57</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>为了更好的易读性，可使用 <strong>grep </strong>和 <strong>ps </strong>组合成管道。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d78998714776\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ps -ef | grep tomcat\r\nroot         1     0  1 18:55 ?        00:00:02 /docker-java-home/jre/bi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d78998714776-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d78998714776-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d78998714776-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">tomcat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d78998714776-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">jre</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h1>8. env</h1>\n<p><strong>env </strong>用于列出所有环境变量及为其赋值。在故障排除期间，你可能会发现需要检查是否有错误的环境变量来阻止应用程序启动。在下面的示例中，该命令用于检查程序主机上设置的环境变量。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d7b870292265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ env\r\nPYTHON_PIP_VERSION=9.0.1\r\nHOME=/root\r\nDB_NAME=test\r\nPATH=/usr/local/bin:/usr/local/sbin\r\nLANG=C.UTF-8\r\nPYTHON_VERSION=3.4.6\r\nPWD=/\r\nDB_URI=mongodb://database:27017/test</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7b870292265-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d7b870292265-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7b870292265-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d7b870292265-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7b870292265-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d7b870292265-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7b870292265-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d7b870292265-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7b870292265-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d7b870292265-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">env</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d7b870292265-2\"><span class=\"crayon-v\">PYTHON_PIP_VERSION</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9.0.1</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d7b870292265-3\"><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d7b870292265-4\"><span class=\"crayon-v\">DB_NAME</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">test</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d7b870292265-5\"><span class=\"crayon-v\">PATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sbin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d7b870292265-6\"><span class=\"crayon-v\">LANG</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d7b870292265-7\"><span class=\"crayon-v\">PYTHON_VERSION</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3.4.6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d7b870292265-8\"><span class=\"crayon-v\">PWD</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d7b870292265-9\"><span class=\"crayon-v\">DB_URI</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//database:27017/test</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>请注意，该应用程序正在使用 Python 3，并具有连接到 MongoDB 数据库的环境变量。</p>\n<h1>9. top</h1>\n<p><strong>top </strong>用于显示系统中各个进程的信息和资源占用状况，类似于 Windows 的任务管理器。使用该命令可确定哪些进程正在运行，以及它们消耗了多少的内存和 CPU。一种常见的情况是当你运行一个应用程序时，它在一分钟后挂掉。这时，你首先检查应用程序的返回错误，发现是一个内存错误。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d7e658662500\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tail myapp.log\r\nTraceback (most recent call last):\r\nMemoryError</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7e658662500-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d7e658662500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d7e658662500-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d7e658662500-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tail </span><span class=\"crayon-v\">myapp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d7e658662500-2\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d7e658662500-3\"><span class=\"crayon-v\">MemoryError</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你的应用是否真的内存不足？要确认这个问题，可使用 <strong>top </strong>来查看应用程序消耗多少 CPU 和内存。当使用 <strong>top </strong>命令后，您注意到一个 Python 应用程序使用了大部分的 CPU，其内存使用量也迅速攀升。当它运行时，如果进程是你的应用程序，则按”C”键来查看完整命令并进行逆向工程。发现原来是你的内存密集型应用程序(<strong>memeater.py</strong>)。当你的应用程序已经用尽内存，系统会杀掉它并返回一个内存不足(OOM)的错误。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/eeb3863a3e031513712e9556d1c6eeed.png\"><img class=\"aligncenter wp-image-112086 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/eeb3863a3e031513712e9556d1c6eeed.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"332\"></a></p>\n<p><em>应用程序的内存和 CPU 使用量增加，最终因为内存不足而被杀掉。</em></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/8cef41f3180be447f1405efebfc8420c.png\"><img class=\"aligncenter wp-image-112087 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8cef41f3180be447f1405efebfc8420c.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"290\"></a></p>\n<p><em>通过按下”C”键，可以看到启动该应用程序的完整命令</em></p>\n<p>除了检查应用程序，还可以使用 <strong>top </strong>来调试其他使用 CPU 或内存的进程。</p>\n<h1>10. netstat</h1>\n<p><strong>netstat </strong>用于显示网络状态信息。该命令可显示正在使用的网络端口及其传入连接。但是，<strong>netstat </strong>在 Linux 中不能开箱即用。如果需要安装它，需要在 <strong><a href=\"https://wiki.linuxfoundation.org/networking/net-tools\" target=\"_blank\" rel=\"nofollow\">net-tools</a> </strong>包中找到它。作为在本地进行试验或将应用程序推送到主机的开发者，可能会收到端口已被分配或地址已被使用的错误。使用 <strong>netstat</strong> 得到协议、进程和端口这些信息，下图表明 Apache HTTP 服务器已经在下面的主机上使用了 80 端口。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/da463bd1dfe1c75df76fff92f6fa4842.png\"><img class=\"aligncenter wp-image-112088 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/da463bd1dfe1c75df76fff92f6fa4842.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"284\"></a></p>\n<p><em>使用 <strong>netstat -tulpn </strong>表明 Apache 已经在这台机器上使用了 80 端口。</em></p>\n<h1>11. ip address</h1>\n<p>如果 <strong>ip address </strong>在你的主机上不能使用，必须使用 <strong><a href=\"https://wiki.linuxfoundation.org/networking/iproute2\" target=\"_blank\" rel=\"nofollow\">iproute2</a> </strong>包进行安装。<strong>i</strong><strong>p address </strong>用于显示应用程序的主机接口和 IP 地址。可使用 <strong>i</strong><strong>p address </strong>来验证你的容器或主机的 IP 地址。例如，当你的容器连接到两个网络时，<strong>i</strong><strong>p address </strong>可显示哪个接口连接到了哪个网络。对于简单的检查，可以随时使用 <strong>ip address </strong>命令获取主机的 IP 地址。下面的示例展示了在接口 eth0 上的 Web 层容器的 IP 地址为 172.17.0.2</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f47acafef2423ba78048bffb330f5a06.png\"><img class=\"aligncenter wp-image-112089 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f47acafef2423ba78048bffb330f5a06.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"89\"></a></p>\n<p><em>使用 <strong>ip address </strong>显示 eth0 接口的 IP 地址为 172.17.0.2</em></p>\n<h1>12. lsof</h1>\n<p><strong>lsof </strong>用于列出当前系统打开的文件(list open files)。在某些 Linux 系统中，可能需要使用 <a href=\"http://www.linuxfromscratch.org/blfs/view/svn/general/lsof.html\" target=\"_blank\" rel=\"nofollow\">lsof</a> 包来安装<strong>lsof</strong>。在 Linux 中，几乎任何和系统的交互都被视为一个文件。因此，如果你的应用程序写入文件或代开网络连接，<strong>lsof </strong>将会把这个交互映射为一个文件。与 <strong>netstat </strong>类似，可使用 <strong>lsof </strong>来检查侦听端口。例如，如果要检查 80 端口是否正在被使用，可使用 <strong>lsof </strong>来检查哪个进程正在使用它。下面的示例中，可以看到 httpd (Apache) 在 80 端口上侦听。还可以使用 <strong>lsof </strong>来检查 httpd 的进程ID，检查 Web 服务器的二进制文件所在位置(<strong>/usr/sbin/httpd</strong>)。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c03a535f9ce77f7c52d661cbdd907bfe.png\"><img class=\"aligncenter wp-image-112090 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c03a535f9ce77f7c52d661cbdd907bfe.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"252\"></a></p>\n<p><em><strong>Lsof </strong>表明了 httpd 在 80 端口上侦听。检查 httpd 的进程ID还可以显示所有需要运行的文件httpd。</em></p>\n<p>打开文件列表中的打开文件的名称有助于确定进程的来源，特别是 Apache。</p>\n<h1>13. df</h1>\n<p>可以使用 <strong>df</strong> 显示空闲的磁盘空间(display free disk space)以排查磁盘空间问题。挡在容器管理器上运行应用程序时，可能会收到一条错误信息，提示容器主机上缺少可用空间。虽然磁盘空间应该由系统管理程序来管理和优化，你仍可以使用 <strong>df </strong>找出目录中的现有空间并确认是否没有空间。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d4981e341da22b6f3dd72ffc98003b59.png\"><img class=\"aligncenter wp-image-112091 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d4981e341da22b6f3dd72ffc98003b59.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"258\"></a></p>\n<p><em><strong>Df</strong> 显示每个文件系统的磁盘空间、绝对空间以及其可用性。</em></p>\n<p><strong>-h </strong>选项表示以可读性较高的方式来显示信息，上面的例子表示这个主机具有大量的磁盘空间。</p>\n<h1>14. du</h1>\n<p><strong>du</strong> 命令也是用于查看使用空间的，但是与 df 命令不同的是 du 命令是对文件和目录磁盘使用的空间的查看，要获取有关哪些文件在目录中使用磁盘空间的更多详细信息，可以使用 du 命令，和 df 命令还是有一些区别的。例如，你想了解那个日志文件占用 <strong>/var/log </strong>目录最多的空间，可以使用 <strong>du</strong> 命令加上 <strong>-h</strong> 选项和用于获取总大小的 <strong>-s </strong>选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d85393091065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du -sh /var/log/*\r\n1.8M  /var/log/anaconda\r\n384K  /var/log/audit\r\n4.0K  /var/log/boot.log\r\n0 /var/log/chrony\r\n4.0K  /var/log/cron\r\n4.0K  /var/log/maillog\r\n64K /var/log/messages</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d85393091065-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d85393091065-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d85393091065-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d85393091065-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d85393091065-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d85393091065-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d85393091065-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d85393091065-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d85393091065-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d85393091065-2\"><span class=\"crayon-cn\">1.8M</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">anaconda</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d85393091065-3\"><span class=\"crayon-cn\">384K</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">audit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d85393091065-4\"><span class=\"crayon-cn\">4.0K</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d85393091065-5\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">chrony</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d85393091065-6\"><span class=\"crayon-cn\">4.0K</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cron</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d85393091065-7\"><span class=\"crayon-cn\">4.0K</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">maillog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d85393091065-8\"><span class=\"crayon-cn\">64K</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">messages</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面的示例中显示了 <strong>/var/log </strong>下的的最大目录为 <strong>/var/log/audit</strong>。可以将 <strong>du</strong> 和 <strong>df</strong> 搭配使用，以确定在应用程序的主机上使用的磁盘空间。</p>\n<h1>15. id</h1>\n<p>要检查运行应用程序的用户，可使用 <strong>id </strong>命令来返回用户身份。<strong>id </strong>命令可以显示真实有效的用户ID(UID)和组ID(GID)。下面的示例使用 <a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"nofollow\">Vagrant</a> 来测试应用程序并隔离其开发环境。登录进 Vagrant 盒子后，如果尝试安装 Apache HTTP Server（依赖关系），系统会提示你需要以 root 身份执行该命令。要检查你的用户ID和组ID，使用 <strong>id </strong>命令，会发现你正在”vagrant”组中以”vagrant”用户身份运行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d89989574719\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ yum -y install httpd\r\nLoaded plugins: fastestmirror\r\nYou need to be root to perform this command.\r\n$ id\r\nuid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d89989574719-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d89989574719-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d89989574719-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d89989574719-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d89989574719-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d89989574719-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">httpd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d89989574719-2\"><span class=\"crayon-e\">Loaded </span><span class=\"crayon-v\">plugins</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fastestmirror</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d89989574719-3\"><span class=\"crayon-e\">You </span><span class=\"crayon-e\">need </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">root </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">perform </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d89989574719-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d89989574719-5\"><span class=\"crayon-v\">uid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vagrant</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vagrant</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">groups</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vagrant</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">unconfined_u</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">unconfined_r</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">unconfined_t</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">s0</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s0</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">c0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c1023</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>要解决此问题，必须以超级用户的身份运行该命令，这将提供提升的权限。</p>\n<h1>16. chmod</h1>\n<p><strong>c</strong><strong>hmod</strong> 命令用来变更文件或目录的权限。当你在主机上首次运行应用程序的二进制文件时，可能会收到错误提示信息“拒绝访问”。如 <strong>ls </strong>的示例所示，可以用于检查应用程序二进制文件的权限。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d8c076589176\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -l\r\ntotal 4\r\n-rw-rw-r--. 1 vagrant vagrant 34 Jul 11 02:17 test.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d8c076589176-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d8c076589176-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d8c076589176-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d8c076589176-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d8c076589176-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d8c076589176-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vagrant </span><span class=\"crayon-i\">vagrant</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这表明您没有权限（没有“x”）来运行二进制文件。<strong>c</strong><strong>hmod </strong>可以修改权限，使的用户能够运行二进制文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d90605363798\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ chmod +x test.sh\r\n[vagrant@localhost ~]$ ls -l\r\ntotal 4\r\n-rwxrwxr-x. 1 vagrant vagrant 34 Jul 11 02:17 test.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d90605363798-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d90605363798-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d90605363798-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d90605363798-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d90605363798-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d90605363798-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">vagrant</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d90605363798-3\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d90605363798-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwxrwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vagrant </span><span class=\"crayon-i\">vagrant</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>如例子所示，这将更新权限，使其具有可执行的权限。现在当你尝试执行二进制文件时，应用程序不会抛出拒绝访问的错误。当将二进制文件加载到容器时，<strong>Chmod</strong> 可能很有用。它能保证容器具有合适的权限以执行二进制文件。</p>\n<h1>17. dig / nslookup</h1>\n<p><strong>dig </strong>命令是常用的域名查询工具，可以用来测试域名系统工作是否正常。域名服务器(DNS)有助于将 URL 解析为一组应用程序服务器。然而，你会发现有些 URL 不能被解析，这会导致应用程序的连接问题。例如，假如你尝试从应用程序的主机访问你的数据库。你收到一个”不能解析”的错误。要进行故障排查，你尝试使用 <strong>dig</strong>（DNS 查询工具）或 <strong>nslookup</strong>（查询 Internet 域名服务器）来确定应用程序似乎无法解析数据的原因。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d94788827615\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ nslookup mydatabase\r\nServer:   10.0.2.3\r\nAddress:  10.0.2.3#53\r\n\r\n** server can't find mydatabase: NXDOMAIN</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d94788827615-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d94788827615-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d94788827615-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d94788827615-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d94788827615-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d94788827615-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nslookup </span><span class=\"crayon-e\">mydatabase</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d94788827615-2\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">10.0.2.3</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d94788827615-3\"><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">10.0.2.3</span><span class=\"crayon-p\">#53</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d94788827615-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d94788827615-5\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">server </span><span class=\"crayon-i\">can</span>'<span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-v\">mydatabase</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NXDOMAIN</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>使用 <strong>nslookup </strong>显示无法解析 <strong>mydatabase</strong>。尝试使用 <strong>dig </strong>解决，但仍是相同的结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d97825781375\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dig mydatabase\r\n\r\n; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-50.el7_3.1 &lt;&lt;&gt;&gt; mydatabase\r\n;; global options: +cmd\r\n;; connection timed out; no servers could be reached</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d97825781375-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d97825781375-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d97825781375-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d97825781375-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d97825781375-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d97825781375-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dig </span><span class=\"crayon-i\">mydatabase</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d97825781375-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf85da2d97825781375-3\"><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DiG</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9.9.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">RedHat</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9.9.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">50.el7_3.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mydatabase</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d97825781375-4\"><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">cmd</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d97825781375-5\"><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">timed </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">no </span><span class=\"crayon-e\">servers </span><span class=\"crayon-e\">could </span><span class=\"crayon-e\">be </span><span class=\"crayon-v\">reached</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这些错误可能是由许多不同的问题引起的。如果无法调试出根本原因，与系统管理员联系以进行更多的调查。对于本地测试，这些问题可能表示你的主机的域名服务器未正确配置。要使用这些命令，需要安装 <strong><a href=\"http://www.linuxfromscratch.org/blfs/view/svn/basicnet/bind-utils.html\" target=\"_blank\" rel=\"nofollow\">BIND Utilities</a> </strong>包<strong>。</strong></p>\n<h1>18. iptables</h1>\n<p>iptables 用于阻止或允许 Linux 主机上的流量，用于 IP 包过滤器管理，类似于网络防火墙。此工具可阻止某些应用程序接收或发送请求。更具体地说，如果您的应用程序难以访问另一个端点，可能已被 iptables 拒绝流量访问该端点。例如，假设您的应用程序的主机无法访问 Opensource.com，您使用 <strong>curl </strong>来测试连接。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d9a385764942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -vvv opensource.com\r\n* About to connect() to opensource.com port 80 (#0)\r\n*   Trying 54.204.39.132...\r\n* Connection timed out\r\n* Failed connect to opensource.com:80; Connection timed out\r\n* Closing connection 0\r\ncurl: (7) Failed connect to opensource.com:80; Connection timed out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9a385764942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9a385764942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9a385764942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9a385764942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9a385764942-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9a385764942-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9a385764942-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d9a385764942-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">vvv </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9a385764942-2\"><span class=\"crayon-e \">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">About </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-p\">#0)</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9a385764942-3\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">Trying</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54.204.39.132...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9a385764942-4\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-e\">timed </span><span class=\"crayon-e \">out</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9a385764942-5\"><span class=\"crayon-e \">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Failed </span><span class=\"crayon-e\">connect </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-e\">timed </span><span class=\"crayon-e \">out</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9a385764942-6\"><span class=\"crayon-e \">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Closing </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9a385764942-7\"><span class=\"crayon-v\">curl</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Failed </span><span class=\"crayon-e\">connect </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-e\">timed </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>连接超时。您怀疑某些东西可能会阻塞流量，因此您使用 <strong>-S </strong>选项显示 <strong>iptables </strong>规则。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2d9e166796883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ iptables -S\r\n-P INPUT DROP\r\n-P FORWARD DROP\r\n-P OUTPUT DROP\r\n-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT\r\n-A INPUT -i eth0 -p udp -m udp --sport 53 -j ACCEPT\r\n-A OUTPUT -p tcp -m tcp --sport 22 -j ACCEPT\r\n-A OUTPUT -o eth0 -p udp -m udp --dport 53 -j ACCEPT</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9e166796883-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9e166796883-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9e166796883-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9e166796883-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9e166796883-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9e166796883-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2d9e166796883-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2d9e166796883-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2d9e166796883-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iptables</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9e166796883-2\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INPUT </span><span class=\"crayon-v\">DROP</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9e166796883-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FORWARD </span><span class=\"crayon-v\">DROP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9e166796883-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OUTPUT </span><span class=\"crayon-v\">DROP</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9e166796883-5\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INPUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">dport</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACCEPT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9e166796883-6\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INPUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">udp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">udp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACCEPT</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2d9e166796883-7\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OUTPUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACCEPT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2d9e166796883-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OUTPUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">udp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">udp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">dport</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACCEPT</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>前三个规则显示，默认情况下流量已被丢弃。剩下的规则表示允许 SSH 和 DNS 流量。在这种情况下，如果需要允许流量到外部端点的规则，请跟上 sysadmin。如果这是用于本地开发或测试的主机，可使用 <strong>iptables </strong>命令来允许合适的流量。添加允许到主机的流量的规则时一定要谨慎。</p>\n<h1>19. sestatus</h1>\n<p>通常会在企业管理的应用程序主机上使用 SELinux（一个 Linux 安全模块）。SELinux 对主机上运行的进程提供最低权限的访问，防止潜在的恶意进程访问系统上的重要文件。某些情况下，应用程序需要访问特定文件，但可能会发生错误。要检查 SELinux 是否阻止了应用程序，使用 <strong>tail </strong>和 <strong>grep </strong>在 <strong>/var/log/audit </strong>日志记录中查找”denied”（被拒绝）的信息。否则，使用 <strong>sestatus </strong>来检查是否启动了 SELinux。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2da1048413261\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sestatus\r\nSELinux status:                 enabled\r\nSELinuxfs mount:                /sys/fs/selinux\r\nSELinux root directory:         /etc/selinux\r\nLoaded policy name:             targeted\r\nCurrent mode:                   enforcing\r\nMode from config file:          enforcing\r\nPolicy MLS status:              enabled\r\nPolicy deny_unknown status:     allowed\r\nMax kernel policy version:      28</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da1048413261-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da1048413261-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da1048413261-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da1048413261-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da1048413261-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da1048413261-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da1048413261-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da1048413261-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da1048413261-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da1048413261-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2da1048413261-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sestatus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da1048413261-2\"><span class=\"crayon-e\">SELinux </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                 </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2da1048413261-3\"><span class=\"crayon-e\">SELinuxfs </span><span class=\"crayon-v\">mount</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fs</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">selinux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da1048413261-4\"><span class=\"crayon-e\">SELinux </span><span class=\"crayon-e\">root </span><span class=\"crayon-v\">directory</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">selinux</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2da1048413261-5\"><span class=\"crayon-e\">Loaded </span><span class=\"crayon-e\">policy </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">             </span><span class=\"crayon-e\">targeted</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da1048413261-6\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">mode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">enforcing</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2da1048413261-7\"><span class=\"crayon-e\">Mode </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">config </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">enforcing</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da1048413261-8\"><span class=\"crayon-e\">Policy </span><span class=\"crayon-e\">MLS </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2da1048413261-9\"><span class=\"crayon-e\">Policy </span><span class=\"crayon-e\">deny_unknown </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-e\">allowed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da1048413261-10\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">kernel </span><span class=\"crayon-e\">policy </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">28</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面的输出表示应用程序的主机已启用 SELinux。在本地开发环境中，可以更新 <strong>SELinux</strong> 使得权限更宽松。</p>\n<h1>20. history</h1>\n<p>当你使用大量的命令进行测试和调试时，可能会忘记有用的命令。每个 shell 都有一个 <strong>history </strong>命令的变体。它可显示自会话开始以来使用的命令的历史记录。可以使用 <strong>history </strong>来记录用来排除应用程序故障的命令。history 命令用于显示指定数目的指令命令，读取历史命令文件中的目录到历史命令缓冲区和将历史命令缓冲区中的目录写入命令文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf85da2da5446153338\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ history\r\n    1  clear\r\n    2  df -h\r\n    3  du</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da5446153338-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da5446153338-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf85da2da5446153338-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf85da2da5446153338-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf85da2da5446153338-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">history</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da5446153338-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line\" id=\"crayon-59adf85da2da5446153338-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf85da2da5446153338-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">du</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>如果希望执行之前历史记录中的命令，但又不想重新输入，该怎么办？使用符号 <strong>!</strong> 即可，可以使用符号 <strong>!</strong> 执行指定序号的历史命令。例如，要执行第 2 个历史命令，则输入<strong>!</strong>2，</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/84a8a291f13fb68c3468a03906458adb.png\"><img class=\"aligncenter wp-image-112092 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/84a8a291f13fb68c3468a03906458adb.png\" alt=\"205506_GAYc_2918182\" width=\"800\" height=\"121\"></a></p>\n<p>在需要重新执行的命令的指定编号前添加 <strong>! </strong>即可重新执行</p>\n<p>这些基本命令能增强排查故障的专业技能，可检查为什么应用程序可以在一个开发环境中工作，而在另一个开发环境中则不可以。许多系统管理员使用这些命令来调试系统问题。了解一些有用的故障排查命令可帮助解决应用程序的问题。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112085\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112085votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112085\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux,命令,系统管理员", "front_image_path": "full/0ef7e28a091392634bf93187b140a9a9a1296cf7.jpg"}
{"url_object_id": "1e1a2c0afbf124146e1e745069e53328", "title": "REST 的 6 个约束", "create_time": "2017/07/28", "url": "http://blog.jobbole.com/112006/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/544851c6c17d5b59f6fe22f223db85aa.png"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Representational_state_transfer#Client-server\">wikipedia</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>定义个一个 RESTful 系统的时候应该遵循 6 个约束。</p>\n<p>它们限制了服务端只能遵循这些约束来处理和响应客户端请求，但是遵循这些约束服务也可以获取理想的非函数化的属性，例如性能、可伸缩、简单程度、可变能力、可见度、灵活性、可信度。</p>\n<p>如果任何一个服务违背了其中一个原则，将不能被称作 RESTful 系统。</p>\n<p>标准的 REST 约束如下：</p>\n<h3 id=\"客户端-服务器\">客户端-服务器</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Client%E2%80%93server_model\" target=\"_blank\" rel=\"external\">客户端-服务器模型</a></em></p>\n<p>第一个约束是基于<strong>客户端-服务器</strong>架构背后的原则——关注点分离。通过分离用户界面和数据存储这两个关注点，提高了用户界面跨平台的可能性，通过简化服务器组件提高了其可伸缩性。这种分离对于Web来说更加重要的意义是，它使得组件能够进行独立修改和扩展，从而能够支持大量组织的网络化需求。</p>\n<h3 id=\"无状态\">无状态</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Stateless_protocol\" target=\"_blank\" rel=\"external\">无状态协议</a></em></p>\n<p>客户端-服务器通信的一个制约条件就是服务端无法存储客户端的上下文执行环境。从任何客户端发出的每个请求都包含了服务端所必要的信息，但是会话状态仍留在客户端。</p>\n<p>然而在服务端会话状态可以轻松实现跨服务调用，例如利用数据库做持久化来保存一段时间内的身份认证信息。客户端开始发送请求时，它已准备好过渡到一个新的状态。当一个或多个请求正在发送时，客户端处于过渡状态。每个应用程序状态的表示包含可在下一次客户端选择发起一个新的状态过渡使用的链接。</p>\n<h3 id=\"可缓存\">可缓存</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Web_cache\" target=\"_blank\" rel=\"external\">网页缓存</a></em></p>\n<p>互联网中的客户端和中间层服务器可以缓存响应。因此响应必须直接或间接定义自身是否可被缓存，以免客户端使用过期的响应数据来发送其它请求。良好的缓存策略可以有效减少客户端-服务器之间的交互，从而进一步提高系统的可伸缩性和性能。</p>\n<h3 id=\"分层系统\">分层系统</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/w/index.php?title=Representational_state_transfer&amp;action=edit&amp;section=7\" target=\"_blank\" rel=\"external\">分层系统</a></em></p>\n<p>客户端通常无法判断它是否是直接连接到后端服务器，还是中间服务器。中间服务器可通过启用负载平衡，并通过提供共享高速缓存来提高系统的可扩展性。当然也可以强制执行安全政策。</p>\n<h3 id=\"按需代码（可选）\">按需代码（可选）</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Dynamic_web_page#Client-side_scripting\" target=\"_blank\" rel=\"external\">客户端脚本</a></em></p>\n<p>服务端可以通过传递可执行代码临时为客户端扩展或自定义功能。这方面的例子包括可编译的组件如Java applets和客户机端脚本如JavaScript。</p>\n<h3 id=\"统一的接口\">统一的接口</h3>\n<p>统一接口约束是设计任何REST服务的基础。它简化和解耦的架构，使得每个部分可以独立被修改。这个统一的接口包含了四个约束：</p>\n<h3 id=\"资源的标识\">资源的标识</h3>\n<p>各种资源都在请求中被确定，例如在使用URI的Web REST系统中，资源本身就表明它们想要被返回给客户端的格式。例如服务端可以从它的数据库发送HTML，XML或JSON格式的数据，即使这些都不是服务端的内部数据格式。</p>\n<h3 id=\"通过表述来操作资源\">通过表述来操作资源</h3>\n<p>当一个客户端持有一种资源的表述时，包括任何关联的元数据，它都有足够的信息来修改或删除该资源。</p>\n<h3 id=\"自描述的消息\">自描述的消息</h3>\n<p>每条信息都包含足够的信息来描述如何处理消息本身。例如，一个网络媒体类型本身就定义了能运行该媒体的解析器（以前被称为MIME类型）。</p>\n<h3 id=\"超媒体作为应用程序状态的引擎（HATEOAS）\">超媒体作为应用程序状态的引擎（HATEOAS）</h3>\n<p>已经初始化URI的REST客户端应用，应该就像人们访问了一个Web网站主页一样，能够使用服务器提供的动态链接，请求它所需的资源和进行所需的操作。</p>\n<p>处理客户端访问时，服务端将响应内容也包括当前可用的其它行为的超链接。没有必要对REST服务的结构或动态信息进行硬编码来响应客户端客户端。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/981844a17323ad7e3f25209b78bc671c1.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/ccd097a7b57abdd91d882ff55cda32091.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112006\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112006votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112006\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/4a4b7e0673565612b7c599e582face0c.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            JSP工程师，多年大型国际项目开发经验。WEB前端工程师，擅长PC端以及移动端开发。js全栈工程师，熟悉node.js、mongoDB。开发者头条top10专栏作者慕课网签约讲师个人博客：yalishizhude.github.io        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/yalishizhude\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yalishizhude/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://yalishizhude.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/arisjutle\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：381355576\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/yalishizhude\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,API,Rest", "front_image_path": "full/947d74929f5809c543dc9539bb00815a461c9e7c.jpg"}
{"url_object_id": "268ed36a9d88d05b0a9312d6a01644d8", "title": "DB 分库分表（3）：关于使用框架还是自主开发以及 sharding 实现层面的考量", "create_time": "2017/07/17", "url": "http://blog.jobbole.com/111869/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7766508\">Laurence的技术博客</a>   </div><p>当团队对系统业务和数据库进行了细致的梳理，确定了切分方案后，接下来的问题就是如何去实现切分方案了，目前在sharding方面有不少的开源框架和产品可供参考，同时很多团队也会选择自主开发实现，而不管是选择框架还是自主开发，都会面临一个在哪一层上实现sharding逻辑的问题，本文会对这一系列的问题逐一进行分析和考量。<br>\n一、sharding逻辑的实现层面</p>\n<p>从一个系统的程序架构层面来看，sharding逻辑可以在DAO层、JDBC API层、介于DAO与JDBC之间的Spring数据访问封装层(各种spring的template)以及介于应用服务器与数据库之间的sharding代理服务器四个层面上实现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/90c47aa9156611bbeb56a649c14a6337.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">图1. Sharding实现层面与相关框架/产品</p>\n<div>\n<ul>\n<li>在DAO层实现</li>\n</ul>\n</div>\n<p>当团队决定自行实现sharding的时候，DAO层可能是嵌入sharding逻辑的首选位置，因为在这个层面上，每一个DAO的方法都明确地知道需要访问的数据表以及查询参数，借助这些信息可以直接定位到目标shard上，而不必像框架那样需要对SQL进行解析然后再依据配置的规则进行路由。另一个优势是不会受ORM框架的制约。由于现在的大多数应用在数据访问层上会依赖某种ORM框架，而多数的shrading框架往往无法支持或只能支持一种orm框架，这使得在选择和应用框架时受到了很大的制约，而自行实现sharding完全没有这方面的问题，甚至不同的shard使用不同的orm框架都可以在一起协调工作。比如现在的java应用大多使用hibernate，但是当下还没有非常令人满意的基于hibernate的sharding框架，（关于hibernate hards会在下文介绍），因此很多团队会选择自行实现sharding。</p>\n<p>简单总结一下，在DAO层自行实现sharding的优势在于：不受ORM框架的制约、实现起来较为简单、易于根据系统特点进行灵活的定制、无需SQL解析和路由规则匹配，性能上表现会稍好一些;劣势在于：有一定的技术门槛，工作量比依靠框架实现要大(反过来看，框架会有学习成本)、不通用，只能在特定系统里工作。当然，在DAO层同样可以通过XML配置或是注解将sharding逻辑抽离到“外部”，形成一套通用的框架. 不过目前还没有出现此类的框架。</p>\n<ul>\n<li>在ORM框架层实现</li>\n</ul>\n<p>在ORM框架层实现sharding有两个方向，一个是在实现O-R Mapping的前提下同时提供sharding支持，从而定位为一种分布式的数据访问框架，这一类类型的框架代表就是<a href=\"http://code.google.com/p/guzz/\" target=\"_blank\">guzz</a>另一个方向是通过对既有ORM框架进行修改增强来加入sharding机制。此类型的代表产品是<a href=\"http://www.hibernate.org/subprojects/shards.html\" target=\"_blank\">hibernate shard</a>. 应该说以hibernate这样主流的地位，行业对于一款面向hibernate的sharding框架的需求是非常迫切的，但是就目前的hibernate shards来看，表现还算不上令人满意，主要是它对使用hibernate的限制过多，比如它对HQL的支持就非常有限。在mybatis方面，目前还没有成熟的相关框架产生。有人提出利用mybatis的插件机制实现sharding,但是遗憾的是，mybatis的插件机制控制不到多数据源的连接层面，另一方面，离开插件层又失去了对sql进行集中解析和路由的机会，因此在mybatis框架上，目前还没有可供借鉴的框架，团队可能要在DAO层或Spring模板类上下功夫了。</p>\n<ul>\n<li>在JDBC API层实现</li>\n</ul>\n<p>JDBC API层是很多人都会想到的一个实现sharding的绝佳场所，如果我们能提供一个实现了sharding逻辑的JDBC API实现，那么sharding对于整个应用程序来说就是完全透明的，而这样的实现可以直接作为通用的sharding产品了。但是这种方案的技术门槛和工作量显然不是一般团队能做得来的，因此基本上没有团队会在这一层面上实现sharding,甚至也没有此类的开源产品。笔者知道的只有一款商业产品<a href=\"http://www.dbshards.com/\" target=\"_blank\">dbShards</a>采用的是这一方案。</p>\n<ul>\n<li>在介于DAO与JDBC之间的Spring数据访问封装层实现</li>\n</ul>\n<p>在springd大行其道的今天，几乎没有哪个java平台上构建的应用不使用spring，在DAO与JDBC之间，spring提供了各种template来管理资源的创建与释放以及与事务的同步，大多数基于spring的应用都会使用template类做为数据访问的入口，这给了我们另一个嵌入sharding逻辑的机会，就是通过提供一个嵌入了sharding逻辑的template类来完成sharding工作.这一方案在效果上与基于JDBC API实现的方案基本一致，同样是对上层代码透明，在进行sharding改造时可以平滑地过度，但它的实现却比基于JDBC API的方式简单，因此成为了不少框架的选择，阿里集团研究院开源的<a href=\"http://write.blog.csdn.net/postedit/code.alibabatech.com/wiki/display/CobarClient/Home\" target=\"_blank\">Cobar Client</a>就是这类方案的一种实现。</p>\n<ul>\n<li>在应用服务器与数据库之间通过代理实现</li>\n</ul>\n<p>在应用服务器与数据库之间加入一个代理，应用程序向数据发出的数据请求会先通过代理，代理会根据配置的路由规则，对SQL进行解析后路由到目标shard，因为这种方案对应用程序完全透明，通用性好，所以成为了很多sharding产品的选择。在这方面较为知名的产品是mysql官方的代理工具：<a href=\"http://dev.mysql.com/doc/refman/5.6/en/mysql-proxy.html\" target=\"_blank\">Mysql Proxy</a>和一款国人开发的产品:<a href=\"http://code.google.com/p/amoeba/\" target=\"_blank\">amoeba</a>。mysql proxy本身并没有实现任何sharding逻辑，它只是作为一种面向mysql数据库的代理，给开发人员提供了一个嵌入sharding逻辑的场所，它使用lua作为编程语言，这对很多团队来说是需要考虑的一个问题。amoeba则是专门实现读写分离与sharding的代理产品，它使用非常简单，不使用任何编程语言，只需要通过xml进行配置。不过amoeba不支持事务(从应用程序发出的包含事务信息的请求到达amoeba时，事务信息会被抹去，因此，即使是单点数据访问也不会有事务存在)一直是个硬伤。当然，这要看产品的定位和设计理念，我们只能说对于那些对事务要求非常高的系统，amoeba是不适合的。</p>\n<p>二、使用框架还是自主开发？</p>\n<p>前面的讨论中已经罗列了很多开源框架与产品，这里再整理一下：基于代理方式的有MySQL Proxy和Amoeba，基于Hibernate框架的是Hibernate Shards，通过重写spring的ibatis template类是Cobar Client，这些框架各有各的优势与短板，架构师可以在深入调研之后结合项目的实际情况进行选择，但是总的来说，我个人对于框架的选择是持谨慎态度的。一方面多数框架缺乏成功案例的验证，其成熟性与稳定性值得怀疑。另一方面，一些从成功商业产品开源出框架（如阿里和淘宝的一些开源项目）是否适合你的项目是需要架构师深入调研分析的。当然，最终的选择一定是基于项目特点、团队状况、技术门槛和学习成本等综合因素考量确定的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111869\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111869votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111869\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,分库分表,数据库", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "8e038afd8794ddc5ae01ab185cacbf44", "title": "使用 Kdump 检查 Linux 内核崩溃", "create_time": "2017/08/02", "url": "http://blog.jobbole.com/112099/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/6/kdump-usage-and-internals\">opensource</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8737-1.html\">Linux中国/firmianay</a>   </div><div>\n<blockquote><p>让我们先看一下 kdump 的基本使用方法，和 kdump/kexec 在内核中是如何实现。</p></blockquote>\n<p><a href=\"https://www.kernel.org/doc/Documentation/kdump/kdump.txt\">kdump</a> 是获取崩溃的 Linux 内核转储的一种方法，但是想找到解释其使用和内部结构的文档可能有点困难。在本文中，我将研究 kdump 的基本使用方法，和 kdump/kexec 在内核中是如何实现。</p>\n<p><a href=\"https://linux.die.net/man/8/kexec\">kexec</a> 是一个 Linux 内核到内核的引导加载程序，可以帮助从第一个内核的上下文引导到第二个内核。kexec 会关闭第一个内核，绕过 BIOS 或固件阶段，并跳转到第二个内核。因此，在没有 BIOS 阶段的情况下，重新启动变得更快。</p>\n<p>kdump 可以与 kexec 应用程序一起使用 —— 例如，当第一个内核崩溃时第二个内核启动，第二个内核用于复制第一个内核的内存转储，可以使用 <span style=\"color: #ff6600;\"><code>gdb</code></span> 和 <span style=\"color: #ff6600;\"><code>crash</code></span> 等工具分析崩溃的原因。（在本文中，我将使用术语“第一内核”作为当前运行的内核，“第二内核” 作为使用 kexec 运行的内核，“捕获内核” 表示在当前内核崩溃时运行的内核。）</p>\n<p>kexec 机制在内核以及用户空间中都有组件。内核提供了几个用于 kexec 重启功能的系统调用。名为 kexec-tools 的用户空间工具使用这些调用，并提供可执行文件来加载和引导“第二内核”。有的发行版还会在 kexec-tools 上添加封装器，这有助于捕获并保存各种转储目标配置的转储。在本文中，我将使用名为 distro-kexec-tools 的工具来避免上游 kexec 工具和特定于发行版的 kexec-tools 代码之间的混淆。我的例子将使用 Fedora Linux 发行版。</p>\n<h3 id=\"toc_1\">Fedora kexec-tools 工具</h3>\n<p>使用 <span style=\"color: #ff6600;\"><code>dnf install kexec-tools</code></span> 命令在 Fedora 机器上安装 fedora-kexec-tools。在安装 fedora-kexec-tools 后可以执行 <span style=\"color: #ff6600;\"><code>systemctl start kdump</code></span> 命令来启动 kdump 服务。当此服务启动时，它将创建一个根文件系统（initramfs），其中包含了要挂载到目标位置的资源，以保存 vmcore，以及用来复制和转储 vmcore 到目标位置的命令。然后，该服务将内核和 initramfs 加载到崩溃内核区域内的合适位置，以便在内核崩溃时可以执行它们。</p>\n<p>Fedora 封装器提供了两个用户配置文件：</p>\n<ol>\n<li><span style=\"color: #ff6600;\"><code>/etc/kdump.conf</code></span> 指定修改后需要重建 initramfs 的配置参数。例如，如果将转储目标从本地磁盘更改为 NFS 挂载的磁盘，则需要由“捕获内核”所加载的 NFS 相关的内核模块。</li>\n<li><span style=\"color: #ff6600;\"><code>/etc/sysconfig/kdump</code></span> 指定修改后不需要重新构建 initramfs 的配置参数。例如，如果只需修改传递给“捕获内核”的命令行参数，则不需要重新构建 initramfs。</li>\n</ol>\n<p>如果内核在 kdump 服务启动之后出现故障，那么“捕获内核”就会执行，其将进一步执行 initramfs 中的 vmcore 保存过程，然后重新启动到稳定的内核。</p>\n<h3 id=\"toc_2\">kexec-tools 工具</h3>\n<p>编译 kexec-tools 的源代码得到了一个名为 <span style=\"color: #ff6600;\"><code>kexec</code></span> 的可执行文件。这个同名的可执行文件可用于加载和执行“第二内核”，或加载“捕获内核”，它可以在内核崩溃时执行。</p>\n<p>加载“第二内核”的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245c1788271132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# kexec -l kernel.img --initrd=initramfs-image.img –reuse-cmdline</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245c1788271132-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245c1788271132-1\"><span class=\"crayon-p\"># kexec -l kernel.img --initrd=initramfs-image.img –reuse-cmdline</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><span style=\"color: #ff6600;\"><code>--reuse-command</code></span> 参数表示使用与“第一内核”相同的命令行。使用 <span style=\"color: #ff6600;\"><code>--initrd</code></span> 传递 initramfs。 <span style=\"color: #ff6600;\"><code>-l</code></span> 表明你正在加载“第二内核”，其可以由 <span style=\"color: #ff6600;\"><code>kexec</code></span> 应用程序本身执行（<span style=\"color: #ff6600;\"><code>kexec -e</code></span>）。使用 <span style=\"color: #ff6600;\"><code>-l</code></span> 加载的内核不能在内核崩溃时执行。为了加载可以在内核崩溃时执行的“捕获内核”，必须传递参数 <span style=\"color: #ff6600;\"><code>-p</code></span> 取代 <span style=\"color: #ff6600;\"><code>-l</code></span>。</p>\n<p>加载捕获内核的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245cf648051468\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# kexec -p kernel.img --initrd=initramfs-image.img –reuse-cmdline</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245cf648051468-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245cf648051468-1\"><span class=\"crayon-p\"># kexec -p kernel.img --initrd=initramfs-image.img –reuse-cmdline</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><span style=\"color: #ff6600;\"><code>echo c &gt; /pros/sysrq-trigger</code></span> 可用于使内核崩溃以进行测试。有关 kexec-tools 提供的选项的详细信息，请参阅 <span style=\"color: #ff6600;\"><code>man kexec</code></span>。在转到下一个部分之前，请看这个 kexec_dump 的演示：</p>\n<p style=\"text-align: center;\"><a href=\"https://v.qq.com/x/page/k0531jsbps7.html\" target=\"_blank\">https://v.qq.com/x/page/k0531jsbps7.html</a></p>\n<h3 id=\"toc_3\">kdump: 端到端流</h3>\n<p>下图展示了流程图。必须在引导“第一内核”期间为捕获内核保留 crashkernel 的内存。您可以在内核命令行中传递 <span style=\"color: #ff6600;\"><code>crashkernel=Y@X</code></span>，其中 <span style=\"color: #ff6600;\"><code>@X</code></span> 是可选的。<span style=\"color: #ff6600;\"><code>crashkernel=256M</code></span> 适用于大多数 x86_64 系统；然而，为崩溃内核选择适当的内存取决于许多因素，如内核大小和 initramfs，以及 initramfs 中包含的模块和应用程序运行时的内存需求。有关传递崩溃内核参数的更多方法，请参阅 <a href=\"https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/kernel-parameters.txt\">kernel-parameters 文档</a>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/673c86f0c1d5d2c8ade8526b1370a25f.png\" alt=\"pratyush_f1.png\"></p>\n<p>您可以将内核和 initramfs 镜像传递给 <span style=\"color: #ff6600;\"><code>kexec</code></span> 可执行文件，如（<span style=\"color: #ff6600;\"><code>kexec-tools</code></span>）部分的命令所示。“捕获内核”可以与“第一内核”相同，也可以不同。通常，一样即可。Initramfs 是可选的；例如，当内核使用 <span style=\"color: #ff6600;\"><code>CONFIG_INITRAMFS_SOURCE</code></span> 编译时，您不需要它。通常，从第一个 initramfs 中保存一个不一样的捕获 initramfs，因为在捕获 initramfs 中自动执行 vmcore 的副本能获得更好的效果。当执行 <span style=\"color: #ff6600;\"><code>kexec</code></span> 时，它还加载了 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 数据和 purgatory 可执行文件（LCTT 译注：purgatory 就是一个引导加载程序，是为 kdump 定作的。它被赋予了“炼狱”这样一个古怪的名字应该只是一种调侃）。 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 具有关于系统内存组织的信息，而 purgatory 可以在“捕获内核”执行之前执行并验证第二阶段的二进制或数据是否具有正确的 SHA。purgatory 也是可选的。</p>\n<p>当“第一内核”崩溃时，它执行必要的退出过程并切换到 purgatory（如果存在）。purgatory 验证加载二进制文件的 SHA256，如果是正确的，则将控制权传递给“捕获内核”。“捕获内核”根据从 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 接收到的系统内存信息创建 vmcore。因此，“捕获内核”启动后，您将看到 <span style=\"color: #ff6600;\"><code>/proc/vmcore</code></span> 中“第一内核”的转储。根据您使用的 initramfs，您现在可以分析转储，将其复制到任何磁盘，也可以是自动复制的，然后重新启动到稳定的内核。</p>\n<h3 id=\"toc_4\">内核系统调用</h3>\n<p>内核提供了两个系统调用：<span style=\"color: #ff6600;\"><code>kexec_load()</code></span> 和 <span style=\"color: #ff6600;\"><code>kexec_file_load()</code></span>，可以用于在执行 <span style=\"color: #ff6600;\"><code>kexec -l</code></span> 时加载“第二内核”。它还为 <span style=\"color: #ff6600;\"><code>reboot()</code></span> 系统调用提供了一个额外的标志，可用于使用 <span style=\"color: #ff6600;\"><code>kexec -e</code></span> 引导到“第二内核”。</p>\n<p><span style=\"color: #ff6600;\"><code>kexec_load()</code></span>：<span style=\"color: #ff6600;\"><code>kexec_load()</code></span> 系统调用加载一个可以在之后通过 <span style=\"color: #ff6600;\"><code>reboot()</code></span> 执行的新的内核。其原型定义如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245d5480390699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlong kexec_load(unsigned long entry, unsigned long nr_segments,\r\nstruct kexec_segment *segments, unsigned long flags);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d5480390699-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d5480390699-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245d5480390699-1\"><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kexec_load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">entry</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nr_segments</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d5480390699-2\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">kexec_segment *</span><span class=\"crayon-v\">segments</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>用户空间需要为不同的组件传递不同的段，如内核，initramfs 等。因此，<span style=\"color: #ff6600;\"><code>kexec</code></span> 可执行文件有助于准备这些段。<span style=\"color: #ff6600;\"><code>kexec_segment</code></span> 的结构如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245d9779568764\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct kexec_segment {\r\n    void *buf;\r\n    /* 用户空间缓冲区 */\r\n    size_t bufsz;\r\n    /* 用户空间中的缓冲区长度 */\r\n    void *mem;\r\n    /* 内核的物理地址 */\r\n    size_t memsz;\r\n    /* 物理地址长度 */\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d9779568764-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d9779568764-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d9779568764-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d9779568764-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d9779568764-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d9779568764-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d9779568764-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d9779568764-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245d9779568764-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245d9779568764-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245d9779568764-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kexec_segment</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d9779568764-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245d9779568764-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 用户空间缓冲区 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d9779568764-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">bufsz</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245d9779568764-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 用户空间中的缓冲区长度 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d9779568764-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">mem</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245d9779568764-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 内核的物理地址 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d9779568764-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">memsz</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245d9779568764-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 物理地址长度 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245d9779568764-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>当使用 <span style=\"color: #ff6600;\"><code>LINUX_REBOOT_CMD_KEXEC</code></span> 调用 <span style=\"color: #ff6600;\"><code>reboot()</code></span> 时，它会引导进入由 <span style=\"color: #ff6600;\"><code>kexec_load</code></span> 加载的内核。如果标志 <span style=\"color: #ff6600;\"><code>KEXEC_ON_CRASH</code></span> 被传递给 <span style=\"color: #ff6600;\"><code>kexec_load()</code></span>，则加载的内核将不会使用 <span style=\"color: #ff6600;\"><code>reboot(LINUX_REBOOT_CMD_KEXEC)</code></span> 来启动；相反，这将在内核崩溃中执行。必须定义 <span style=\"color: #ff6600;\"><code>CONFIG_KEXEC</code></span> 才能使用 <span style=\"color: #ff6600;\"><code>kexec</code></span>，并且为 <span style=\"color: #ff6600;\"><code>kdump</code></span> 定义 <span style=\"color: #ff6600;\"><code>CONFIG_CRASH_DUMP</code></span>。</p>\n<p><span style=\"color: #ff6600;\"><code>kexec_file_load()</code></span>：作为用户，你只需传递两个参数（即 <span style=\"color: #ff6600;\"><code>kernel</code></span> 和 <span style=\"color: #ff6600;\"><code>initramfs</code></span>）到 <span style=\"color: #ff6600;\"><code>kexec</code></span> 可执行文件。然后，<span style=\"color: #ff6600;\"><code>kexec</code></span> 从 sysfs 或其他内核信息源中读取数据，并创建所有段。所以使用 <span style=\"color: #ff6600;\"><code>kexec_file_load()</code></span> 可以简化用户空间，只传递内核和 initramfs 的文件描述符。其余部分由内核本身完成。使用此系统调用时应该启用 <span style=\"color: #ff6600;\"><code>CONFIG_KEXEC_FILE</code></span>。它的原型如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245dd657796243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlong kexec_file_load(int kernel_fd, int initrd_fd, unsigned long\r\ncmdline_len, const char __user * cmdline_ptr, unsigned long\r\nflags);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245dd657796243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245dd657796243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245dd657796243-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245dd657796243-1\"><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kexec_file_load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initrd_fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245dd657796243-2\"><span class=\"crayon-v\">cmdline_len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">__user *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmdline_ptr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245dd657796243-3\"><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0103 seconds] -->\r\n<p>请注意，<span style=\"color: #ff6600;\"><code>kexec_file_load</code></span> 也可以接受命令行，而 <span style=\"color: #ff6600;\"><code>kexec_load()</code></span> 不行。内核根据不同的系统架构来接受和执行命令行。因此，在 <span style=\"color: #ff6600;\"><code>kexec_load()</code></span> 的情况下，<span style=\"color: #ff6600;\"><code>kexec-tools</code></span> 将通过其中一个段（如在 dtb 或 ELF 引导注释等）中传递命令行。</p>\n<p>目前，<span style=\"color: #ff6600;\"><code>kexec_file_load()</code></span> 仅支持 x86 和 PowerPC。</p>\n<h4 id=\"toc_5\">当内核崩溃时会发生什么</h4>\n<p>当第一个内核崩溃时，在控制权传递给 purgatory 或“捕获内核”之前，会执行以下操作：</p>\n<ul>\n<li>准备 CPU 寄存器（参见内核代码中的 <span style=\"color: #ff6600;\"><code>crash_setup_regs()</code></span>）;</li>\n<li>更新 vmcoreinfo 备注（请参阅 <span style=\"color: #ff6600;\"><code>crash_save_vmcoreinfo()</code></span>）;</li>\n<li>关闭非崩溃的 CPU 并保存准备好的寄存器（请参阅 <span style=\"color: #ff6600;\"><code>machine_crash_shutdown()</code></span> 和 <span style=\"color: #ff6600;\"><code>crash_save_cpu()</code></span>）;</li>\n<li>您可能需要在此处禁用中断控制器；</li>\n<li>最后，它执行 kexec 重新启动（请参阅 <span style=\"color: #ff6600;\"><code>machine_kexec()</code></span>），它将加载或刷新 kexec 段到内存，并将控制权传递给进入段的执行文件。输入段可以是下一个内核的 purgatory 或开始地址。</li>\n</ul>\n<h4 id=\"toc_6\">ELF 程序头</h4>\n<p>kdump 中涉及的大多数转储核心都是 ELF 格式。因此，理解 ELF 程序头部很重要，特别是当您想要找到 vmcore 准备的问题。每个 ELF 文件都有一个程序头：</p>\n<ul>\n<li>由系统加载器读取，</li>\n<li>描述如何将程序加载到内存中，</li>\n<li>可以使用 <span style=\"color: #ff6600;\"><code>Objdump -p elf_file</code></span> 来查看程序头。</li>\n</ul>\n<p>vmcore 的 ELF 程序头的示例如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245e2562332128\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# objdump -p vmcore\r\nvmcore:\r\nfile format elf64-littleaarch64\r\nProgram Header:\r\nNOTE off 0x0000000000010000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**0 filesz\r\n0x00000000000013e8 memsz 0x00000000000013e8 flags ---\r\nLOAD off 0x0000000000020000 vaddr 0xffff000008080000 paddr 0x0000004000280000 align 2**0 filesz\r\n0x0000000001460000 memsz 0x0000000001460000 flags rwx\r\nLOAD off 0x0000000001480000 vaddr 0xffff800000200000 paddr 0x0000004000200000 align 2**0 filesz\r\n0x000000007fc00000 memsz 0x000000007fc00000 flags rwx\r\nLOAD off 0x0000000081080000 vaddr 0xffff8000ffe00000 paddr 0x00000040ffe00000 align 2**0 filesz\r\n0x00000002fa7a0000 memsz 0x00000002fa7a0000 flags rwx\r\nLOAD off 0x000000037b820000 vaddr 0xffff8003fa9e0000 paddr 0x00000043fa9e0000 align 2**0 filesz\r\n0x0000000004fc0000 memsz 0x0000000004fc0000 flags rwx\r\nLOAD off 0x00000003807e0000 vaddr 0xffff8003ff9b0000 paddr 0x00000043ff9b0000 align 2**0 filesz\r\n0x0000000000010000 memsz 0x0000000000010000 flags rwx\r\nLOAD off 0x00000003807f0000 vaddr 0xffff8003ff9f0000 paddr 0x00000043ff9f0000 align 2**0 filesz\r\n0x0000000000610000 memsz 0x0000000000610000 flags rwx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e2562332128-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d3245e2562332128-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-1\"><span class=\"crayon-p\"># objdump -p vmcore</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-2\"><span class=\"crayon-v\">vmcore</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-3\"><span class=\"crayon-e\">file </span><span class=\"crayon-e\">format </span><span class=\"crayon-v\">elf64</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">littleaarch64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-4\"><span class=\"crayon-e\">Program </span><span class=\"crayon-v\">Header</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-5\"><span class=\"crayon-e\">NOTE </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000010000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-6\"><span class=\"crayon-cn\">0x00000000000013e8</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000000000013e8</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-7\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000020000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff000008080000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000004000280000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-8\"><span class=\"crayon-cn\">0x0000000001460000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000001460000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-e\">rwx</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-9\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000001480000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff800000200000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000004000200000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-10\"><span class=\"crayon-cn\">0x000000007fc00000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x000000007fc00000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-e\">rwx</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-11\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000081080000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff8000ffe00000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000040ffe00000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-12\"><span class=\"crayon-cn\">0x00000002fa7a0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000002fa7a0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-e\">rwx</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-13\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x000000037b820000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff8003fa9e0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000043fa9e0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-14\"><span class=\"crayon-cn\">0x0000000004fc0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000004fc0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-e\">rwx</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-15\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000003807e0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff8003ff9b0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000043ff9b0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-16\"><span class=\"crayon-cn\">0x0000000000010000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000010000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-e\">rwx</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d3245e2562332128-17\"><span class=\"crayon-e\">LOAD </span><span class=\"crayon-i\">off</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000003807f0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xffff8003ff9f0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">paddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000043ff9f0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">align</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filesz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d3245e2562332128-18\"><span class=\"crayon-cn\">0x0000000000610000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">memsz</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000000610000</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flags </span><span class=\"crayon-v\">rwx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0106 seconds] -->\r\n<p>在这个例子中，有一个 note 段，其余的是 load 段。note 段提供了有关 CPU 信息，load 段提供了关于复制的系统内存组件的信息。</p>\n<p>vmcore 从 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 开始，它具有与 ELF 程序头相同的结构。参见下图中 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 的表示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/85d3f4c654785d18b750564db21ded7b.png\" alt=\"pratyush_f2.png\"></p>\n<p><span style=\"color: #ff6600;\"><code>kexec-tools</code></span> 读取 <span style=\"color: #ff6600;\"><code>/sys/devices/system/cpu/cpu%d/crash_notes</code></span> 并准备 <span style=\"color: #ff6600;\"><code>CPU PT_NOTE</code></span> 的标头。同样，它读取 <span style=\"color: #ff6600;\"><code>/sys/kernel/vmcoreinfo</code></span> 并准备 <span style=\"color: #ff6600;\"><code>vmcoreinfo PT_NOTE</code></span> 的标头，从 <span style=\"color: #ff6600;\"><code>/proc/iomem</code></span> 读取系统内存并准备存储器 <span style=\"color: #ff6600;\"><code>PT_LOAD</code></span> 标头。当“捕获内核”接收到 <span style=\"color: #ff6600;\"><code>elfcorehdr</code></span> 时，它从标头中提到的地址中读取数据，并准备 vmcore。</p>\n<h4 id=\"toc_7\">Crash note</h4>\n<p>Crash notes 是每个 CPU 中用于在系统崩溃的情况下存储 CPU 状态的区域；它有关于当前 PID 和 CPU 寄存器的信息。</p>\n<h4 id=\"toc_8\">vmcoreinfo</h4>\n<p>该 note 段具有各种内核调试信息，如结构体大小、符号值、页面大小等。这些值由捕获内核解析并嵌入到 <span style=\"color: #ff6600;\"><code>/proc/vmcore</code></span> 中。 <span style=\"color: #ff6600;\"><code>vmcoreinfo</code></span> 主要由 <span style=\"color: #ff6600;\"><code>makedumpfile</code></span> 应用程序使用。在 Linux 内核，<span style=\"color: #ff6600;\"><code>include/linux/kexec.h</code></span> 宏定义了一个新的 <span style=\"color: #ff6600;\"><code>vmcoreinfo</code></span>。 一些示例宏如下所示：</p>\n<ul>\n<li><span style=\"color: #ff6600;\"><code>VMCOREINFO_PAGESIZE()</code></span></li>\n<li><span style=\"color: #ff6600;\"><code>VMCOREINFO_SYMBOL()</code></span></li>\n<li><span style=\"color: #ff6600;\"><code>VMCOREINFO_SIZE()</code></span></li>\n<li><span style=\"color: #ff6600;\"><code>VMCOREINFO_STRUCT_SIZE()</code></span></li>\n</ul>\n<h4 id=\"toc_9\">makedumpfile</h4>\n<p>vmcore 中的许多信息（如可用页面）都没有用处。<span style=\"color: #ff6600;\"><code>makedumpfile</code></span> 是一个用于排除不必要的页面的应用程序，如：</p>\n<ul>\n<li>填满零的页面；</li>\n<li>没有私有标志的缓存页面（非专用缓存）;</li>\n<li>具有私有标志的缓存页面（专用缓存）;</li>\n<li>用户进程数据页；</li>\n<li>可用页面。</li>\n</ul>\n<p>此外，<span style=\"color: #ff6600;\"><code>makedumpfile</code></span> 在复制时压缩 <span style=\"color: #ff6600;\"><code>/proc/vmcore</code></span> 的数据。它也可以从转储中删除敏感的符号信息； 然而，为了做到这一点，它首先需要内核的调试信息。该调试信息来自 <span style=\"color: #ff6600;\"><code>VMLINUX</code></span> 或 <span style=\"color: #ff6600;\"><code>vmcoreinfo</code></span>，其输出可以是 ELF 格式或 kdump 压缩格式。</p>\n<p>典型用法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d3245e7604521381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# makedumpfile -l --message-level 1 -d 31 /proc/vmcore makedumpfilecore</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d3245e7604521381-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d3245e7604521381-1\"><span class=\"crayon-p\"># makedumpfile -l --message-level 1 -d 31 /proc/vmcore makedumpfilecore</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>详细信息请参阅 <span style=\"color: #ff6600;\"><code>man makedumpfile</code></span>。</p>\n<h3 id=\"toc_10\">kdump 调试</h3>\n<p>新手在使用 kdump 时可能会遇到的问题：</p>\n<h4 id=\"toc_11\"><span style=\"color: #ff6600;\"><code>kexec -p kernel_image</code></span>  没有成功</h4>\n<ul>\n<li>检查是否分配了崩溃内存。</li>\n<li><span style=\"color: #ff6600;\"><code>cat /sys/kernel/kexec_crash_size</code></span> 不应该有零值。</li>\n<li><span style=\"color: #ff6600;\"><code>cat /proc/iomem | grep \"Crash kernel\"</code></span> 应该有一个分配的范围。</li>\n<li>如果未分配，则在命令行中传递正确的 <span style=\"color: #ff6600;\"><code>crashkernel=</code></span> 参数。</li>\n<li>如果没有显示，则在 <span style=\"color: #ff6600;\"><code>kexec</code></span> 命令中传递参数 <span style=\"color: #ff6600;\"><code>-d</code></span>，并将输出信息发送到 kexec-tools 邮件列表。</li>\n</ul>\n<h4 id=\"toc_12\">在“第一内核”的最后一个消息之后，在控制台上看不到任何东西（比如“bye”）</h4>\n<ul>\n<li>检查 <span style=\"color: #ff6600;\"><code>kexec -e</code></span> 之后的 <span style=\"color: #ff6600;\"><code>kexec -l kernel_image</code></span> 命令是否工作。</li>\n<li>可能缺少支持的体系结构或特定机器的选项。</li>\n<li>可能是 purgatory 的 SHA 验证失败。如果您的体系结构不支持 purgatory 中的控制台，则很难进行调试。</li>\n<li>可能是“第二内核”早已崩溃。</li>\n<li>将您的系统的 <span style=\"color: #ff6600;\"><code>earlycon</code></span> 或 <span style=\"color: #ff6600;\"><code>earlyprintk</code></span> 选项传递给“第二内核”的命令行。</li>\n<li>使用 kexec-tools 邮件列表共享第一个内核和捕获内核的 <span style=\"color: #ff6600;\"><code>dmesg</code></span> 日志。</li>\n</ul>\n<h3 id=\"toc_13\">资源</h3>\n<h4 id=\"toc_14\">fedora-kexec-tools</h4>\n<ul>\n<li>GitHub 仓库：<span style=\"color: #ff6600;\"><code>git://pkgs.fedoraproject.org/kexec-tools</code></span></li>\n<li>邮件列表：<a href=\"mailto:kexec@lists.fedoraproject.org\">kexec@lists.fedoraproject.org</a></li>\n<li>说明：Specs 文件和脚本提供了用户友好的命令和服务，以便 <span style=\"color: #ff6600;\"><code>kexec-tools</code></span> 可以在不同的用户场景下实现自动化。</li>\n</ul>\n<h4 id=\"toc_15\">kexec-tools</h4>\n<ul>\n<li>GitHub 仓库：git://git.kernel.org/pub/scm/utils/kernel/kexec/kexec-tools.git</li>\n<li>邮件列表：<a href=\"mailto:kexec@lists.infradead.org\">kexec@lists.infradead.org</a></li>\n<li>说明：使用内核系统调用并提供用户命令 <span style=\"color: #ff6600;\"><code>kexec</code></span>。</li>\n</ul>\n<h4 id=\"toc_16\">Linux kernel</h4>\n<ul>\n<li>GitHub 仓库： <span style=\"color: #ff6600;\"><code>git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</code></span></li>\n<li>邮件列表：<a href=\"mailto:kexec@lists.infradead.org\">kexec@lists.infradead.org</a></li>\n<li>说明：实现了 <span style=\"color: #ff6600;\"><code>kexec_load()</code></span>、<span style=\"color: #ff6600;\"><code>kexec_file_load()</code></span>、<span style=\"color: #ff6600;\"><code>reboot()</code></span> 系统调用和特定体系结构的代码，例如 <span style=\"color: #ff6600;\"><code>machine_kexec()</code></span> 和 <span style=\"color: #ff6600;\"><code>machine_crash_shutdown()</code></span>。</li>\n</ul>\n<h4 id=\"toc_17\">Makedumpfile</h4>\n<ul>\n<li>GitHub 仓库： <span style=\"color: #ff6600;\"><code>git://git.code.sf.net/p/makedumpfile/code</code></span></li>\n<li>邮件列表：<a href=\"mailto:kexec@lists.infradead.org\">kexec@lists.infradead.org</a></li>\n<li>说明：从转储文件中压缩和过滤不必要的组件。</li>\n</ul>\n<p>（题图：<a href=\"https://pixabay.com/en/penguins-emperor-antarctic-life-429136/\">Penguin</a>、 <a href=\"https://pixabay.com/en/shoe-boots-home-boots-house-1519804/\">Boot</a>，修改：Opensource.com. <a href=\"https://creativecommons.org/licenses/by-sa/4.0/\">CC BY-SA 4.0</a>）</p>\n<hr>\n<p>作者简介：</p>\n<p>Pratyush Anand – Pratyush 正在以以为 Linux 内核专家的身份与 Red Hat 合作。他主要负责 Red Hat 产品和上游所面临的几个 kexec/kdump 问题。他还处理 Red Hat 支持的 ARM64 平台周围的其他内核调试、跟踪和性能问题。除了 Linux 内核，他还在上游的 kexec-tools 和 makedumpfile 项目中做出了贡献。他是一名开源爱好者，并在教育机构举办志愿者讲座，促进了 FOSS。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112099\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112099votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112099\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,dump,Linux", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "c266f9bd7c12201bf651fad9a9794aaf", "title": "Linux 的 EXT4 文件系统的历史、特性以及最佳实践", "create_time": "2017/07/17", "url": "http://blog.jobbole.com/111885/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/5/introduction-ext4-filesystem\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8685-1.html\">Linux中国/chenxinlong</a>   </div><p>在之前关于 Linux 文件系统的文章里，我写过一篇 <a class=\"ext\" href=\"https://opensource.com/life/16/10/introduction-linux-filesystems\" target=\"_blank\" rel=\"external nofollow\">Linux 文件系统介绍</a> 和一些更高级的概念例如 <a class=\"ext\" href=\"https://opensource.com/life/15/9/everything-is-a-file\" target=\"_blank\" rel=\"external nofollow\">一切都是文件</a>。现在我想要更深入地了解 EXT 文件系统的特性的详细内容，但是首先让我们来回答一个问题，“什么样才算是一个文件系统 ？” 一个文件系统应该涵盖以下所有特点：</p>\n<ol>\n<li><strong>数据存储：</strong> 对于任何一个文件系统来说，一个最主要的功能就是能够被当作一个结构化的容器来存储和获取数据。</li>\n<li><strong>命名空间：</strong> 命名空间是一个提供了用于命名与组织数据的命名规则和数据结构的方法学。</li>\n<li><strong>安全模型：</strong> 一个用于定义访问权限的策略。</li>\n<li><strong>API：</strong> 操作这个系统的对象的系统功能调用，这些对象诸如目录和文件。</li>\n<li><strong>实现：</strong> 能够实现以上几点的软件。</li>\n</ol>\n<p>本文内容的讨论主要集中于上述几点中的第一项，并探索为一个 EXT 文件系统的数据存储提供逻辑框架的元数据结构。</p>\n<h3 id=\"toc_1\">EXT 文件系统历史</h3>\n<p>虽然 EXT 文件系统是为 Linux 编写的，但其真正起源于 Minix 操作系统和 Minix 文件系统，而 Minix 最早发布于 1987，早于 Linux 5 年。如果我们从 EXT 文件系统大家族的 Minix 起源来观察其历史与技术发展那么理解 EXT4 文件系统就会简单得多。</p>\n<h3 id=\"toc_2\">Minix</h3>\n<p>当 Linux Torvalds 在写最初的 Linux 内核的时候，他需要一个文件系统但是他又不想自己写一个。于是他简单地把 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/MINIX_file_system\" target=\"_blank\" rel=\"external nofollow\">Minix 文件系统</a> 加了进去，这个 Minix 文件系统是由 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Andrew_S._Tanenbaum\" target=\"_blank\" rel=\"external nofollow\">Andrew S. Tanenbaum</a> 写的，同时它也是 Tanenbaum 的 Minix 操作系统的一部分。<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/MINIX\" target=\"_blank\" rel=\"external nofollow\">Minix</a> 是一个类 Unix 风格的操作系统，最初编写它的原因是用于教育用途。Minix 的代码是自由可用的并有适当的许可协议，所以 Torvalds 可以把它用 Linux 的最初版本里。</p>\n<p>Minix 有以下这些结构，其中的大部分位于生成文件系统的分区中：</p>\n<ul>\n<li><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Boot_sector\" target=\"_blank\" rel=\"external nofollow\"><strong>引导扇区</strong></a> 是硬盘安装后的第一个扇区。这个引导块包含了一个非常小的引导记录和一个分区表。</li>\n<li>每一个分区的第一个块都是一个包含了元数据的超级块superblock ，这些元数据定义了其他的文件系统结构并将其定位于物理硬盘的具体分区上。</li>\n<li>一个 <strong>inode 位图块</strong> 决定了哪些 inode 是在使用中的，哪一些是未使用的。</li>\n<li><strong>inode</strong> 在硬盘上有它们自己的空间。每一个 inode 都包含了一个文件的信息，包括其所处的数据块的位置，也就是该文件所处的区域。</li>\n<li>一个 <strong>区位图</strong> 用于保持追踪数据区域的使用和未使用情况。</li>\n<li>一个 <strong>数据区</strong>, 这里是数据存储的地方。</li>\n</ul>\n<p>对上述了两种位图类型来说，一个位bit表示一个指定的数据区或者一个指定的 inode。 如果这个位是 0 则表示这个数据区或者这个 inode 是未使用的，如果是 1 则表示正在使用中。</p>\n<p>那么，<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Inode\" target=\"_blank\" rel=\"external nofollow\">inode</a> 又是什么呢 ? 就是 index-node（索引节点）的简写。 inode 是位于磁盘上的一个 256 字节的块，用于存储和该 inode 对应的文件的相关数据。这些数据包含了文件的大小、文件的所有者和所属组的用户 ID、文件模式（即访问权限）以及三个时间戳用于指定：该文件最后的访问时间、该文件的最后修改时间和该 inode 中的数据的最后修改时间。</p>\n<p>同时，这个 inode 还包含了位置数据，指向了其所对应的文件数据在硬盘中的位置。在 Minix 和 EXT 1-3 文件系统中，这是一个数据区和块的列表。Minix 文件系统的 inode 支持 9 个数据块，包括 7 个直接数据块和 2 个间接数据块。如果你想要更深入的了解，这里有一个优秀的 PDF 详细地描述了 <a class=\"ext\" href=\"http://ohm.hgesser.de/sp-ss2012/Intro-MinixFS.pdf\" target=\"_blank\" rel=\"external nofollow\">Minix 文件系统结构</a> 。同时你也可以在维基百科上对 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Inode_pointer_structure\" target=\"_blank\" rel=\"external nofollow\">inode 指针结构</a> 做一个快速了解。</p>\n<h3 id=\"toc_3\">EXT</h3>\n<p>原生的 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Extended_file_system\" target=\"_blank\" rel=\"external nofollow\">EXT 文件系统</a> (意即扩展的extended) 是由 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/R%C3%A9my_Card\" target=\"_blank\" rel=\"external nofollow\">Rémy Card</a> 编写并于 1992 年与 Linux 一同发行。主要是为了克服 Minix 文件系统中的一些文件大小限制的问题。其中，最主要的结构变化就是文件系统中的元数据。它基于 Unix 文件系统 （UFS），其也被称为伯克利快速文件系统（FFS）。我发现只有很少一部分关于 EXT 文件系统的发行信息是可以被确证的，显然这是因为其存在着严重的问题，并且它很快地被 EXT2 文件系统取代了。</p>\n<h3 id=\"toc_4\">EXT2</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext2\" target=\"_blank\" rel=\"external nofollow\">EXT2 文件系统</a> 就相当地成功，它在 Linux 发行版中存活了多年。它是我在 1997 年开始使用 Red Hat Linux 5.0 时接触的第一个文件系统。实际上，EXT2 文件系统有着和 EXT 文件系统基本相同的元数据结构。然而 EXT2 更高瞻远瞩，因为其元数据结构之间留有很多供将来使用的磁盘空间。</p>\n<p>和 Minix 类似，EXT2 也有一个<a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Boot_sector\" target=\"_blank\" rel=\"external nofollow\">引导扇区</a> ，它是硬盘安装后的第一个扇区。它包含了非常小的引导记录和一个分区表。接着引导扇区之后是一些保留的空间，它填充了引导记录和硬盘驱动器上的第一个分区（通常位于下一个柱面）之间的空间。<a class=\"ext\" href=\"https://opensource.com/article/17/2/linux-boot-and-startup\" target=\"_blank\" rel=\"external nofollow\">GRUB2</a> – 也可能是 GRUB1 – 将此空间用于其部分引导代码。</p>\n<p>每个 EXT2 分区中的空间被分为柱面组cylinder group，它允许更精细地管理数据空间。 根据我的经验，每一组大小通常约为 8MB。 下面的图 1 显示了一个柱面组的基本结构。 柱面中的数据分配单元是块，通常大小为 4K。</p>\n<p class=\"article_img\"><img class=\"aligncenter\" title=\"图 1： EXT 文件系统中的柱面组的结构\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201707/11/154011lxv9mpu50c5v0xa5.png\" alt=\"图 1： EXT 文件系统中的柱面组的结构\"></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>图 1： EXT 文件系统中的柱面组的结构</em></p>\n<p>柱面组中的第一个块是一个超级块superblock，它包含了元数据，定义了其它文件系统的结构并将其定位于物理硬盘的具体分区上。分区中有一些柱面组还会有备用超级块，但并不是所有的柱面组都有。我们可以使用例如 <code>dd</code> 等磁盘工具来拷贝备用超级块的内容到主超级块上，以达到修复损坏的超级块的目的。虽然这种情况不会经常发生，但是在几年前我的一个超级块损坏了，我就是用这种方法来修复的。幸好，我很有先见之明地使用了 <code>dumpe2fs</code> 命令来备份了我的系统上的分区描述符信息。</p>\n<p>以下是 <code>dumpe2fs</code> 命令的一部分输出。这部分输出主要是超级块上包含的一些元数据，同时也是文件系统上的前两个柱面组的数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adee2ba9d0d984519001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# dumpe2fs /dev/sda1\r\nFilesystem volume name:   boot \r\nLast mounted on:          /boot \r\nFilesystem UUID:          79fc5ed8-5bbc-4dfe-8359-b7b36be6eed3 \r\nFilesystem magic number:  0xEF53 \r\nFilesystem revision #:    1 (dynamic) \r\nFilesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir nlink extra_isize \r\nFilesystem flags:         signed_directory_hash \r\nDefault mount options:    user_xattr acl \r\nFilesystem state:         clean \r\nErrors behavior:          Continue \r\nFilesystem OS type:       Linux \r\nInode count:              122160 \r\nBlock count:              488192 \r\nReserved block count:     24409 \r\nFree blocks:              376512 \r\nFree inodes:              121690 \r\nFirst block:              0 \r\nBlock size:               4096 \r\nFragment size:            4096 \r\nGroup descriptor size:    64 \r\nReserved GDT blocks:      238 \r\nBlocks per group:         32768 \r\nFragments per group:      32768 \r\nInodes per group:         8144 \r\nInode blocks per group:   509 \r\nFlex block group size:    16 \r\nFilesystem created:       Tue Feb  7 09:33:34 2017 \r\nLast mount time:          Sat Apr 29 21:42:01 2017 \r\nLast write time:          Sat Apr 29 21:42:01 2017 \r\nMount count:              25 \r\nMaximum mount count:      -1 \r\nLast checked:             Tue Feb  7 09:33:34 2017 \r\nCheck interval:           0 (&lt;none&gt;) \r\nLifetime writes:          594 MB \r\nReserved blocks uid:      0 (user root) \r\nReserved blocks gid:      0 (group root) \r\nFirst inode:              11 \r\nInode size:               256 \r\nRequired extra isize:     32 \r\nDesired extra isize:      32 \r\nJournal inode:            8 \r\nDefault directory hash:   half_md4 \r\nDirectory Hash Seed:      c780bac9-d4bf-4f35-b695-0fe35e8d2d60 \r\nJournal backup:           inode blocks \r\nJournal features:         journal_64bit \r\nJournal size:             32M \r\nJournal length:           8192 \r\nJournal sequence:         0x00000213 \r\nJournal start:            0 \r\nGroup 0: (Blocks 0-32767) \r\n Primary superblock at 0, Group descriptors at 1-1 \r\n Reserved GDT blocks at 2-239 \r\n Block bitmap at 240 (+240) \r\n Inode bitmap at 255 (+255) \r\n Inode table at 270-778 (+270) \r\n 24839 free blocks, 7676 free inodes, 16 directories \r\n Free blocks: 7929-32767 \r\n Free inodes: 440, 470-8144 \r\nGroup 1: (Blocks 32768-65535) \r\n Backup superblock at 32768, Group descriptors at 32769-32769 \r\n Reserved GDT blocks at 32770-33007 \r\n Block bitmap at 241 (bg #0 + 241) \r\n Inode bitmap at 256 (bg #0 + 256)\r\n Inode table at 779-1287 (bg #0 + 779) \r\n 8668 free blocks, 8142 free inodes, 2 directories \r\n Free blocks: 33008-33283, 33332-33791, 33974-33975, 34023-34092, 34094-34104, 34526-34687, 34706-34723, 34817-35374, 35421-35844, 35935-36355, 36357-36863, 38912-39935, 39940-40570, 42620-42623, 42655, 42674-42687, 42721-42751, 42798-42815, 42847, 42875-42879, 42918-42943, 42975, 43000-43007, 43519, 43559-44031, 44042-44543, 44545-45055, 45116-45567, 45601-45631, 45658-45663, 45689-45695, 45736-45759, 45802-45823, 45857-45887, 45919, 45950-45951, 45972-45983, 46014-46015, 46057-46079, 46112-46591, 46921-47103, 49152-49395, 50027-50355, 52237-52255, 52285-52287, 52323-52351, 52383, 52450-52479, 52518-52543, 52584-52607, 52652-52671, 52734-52735, 52743-53247 \r\n Free inodes: 8147-16288 \r\nGroup 2: (Blocks 65536-98303) \r\n Block bitmap at 242 (bg #0 + 242) \r\n Inode bitmap at 257 (bg #0 + 257) \r\n Inode table at 1288-1796 (bg #0 + 1288) \r\n 6326 free blocks, 8144 free inodes, 0 directories \r\n Free blocks: 67042-67583, 72201-72994, 80185-80349, 81191-81919, 90112-94207 \r\n Free inodes: 16289-24432 \r\nGroup 3: (Blocks 98304-131071)\r\n&lt;截断&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adee2ba9d0d984519001-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d0d984519001-77\">77</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-1\"><span class=\"crayon-p\"># dumpe2fs /dev/sda1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-2\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">volume </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">boot </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-3\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">mounted </span><span class=\"crayon-v\">on</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">boot </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-4\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">79fc5ed8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5bbc</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4dfe</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8359</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">b7b36be6eed3 </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-5\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">magic </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0xEF53</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-6\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">revision</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#:    1 (dynamic) </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-7\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">features</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">has_journal </span><span class=\"crayon-e\">ext_attr </span><span class=\"crayon-e\">resize_inode </span><span class=\"crayon-e\">dir_index </span><span class=\"crayon-e\">filetype </span><span class=\"crayon-e\">needs_recovery </span><span class=\"crayon-i\">extent</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64bit</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flex_bg </span><span class=\"crayon-e\">sparse_super </span><span class=\"crayon-e\">large_file </span><span class=\"crayon-e\">huge_file </span><span class=\"crayon-e\">dir </span><span class=\"crayon-e\">nlink </span><span class=\"crayon-e\">extra_isize </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-8\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">flags</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">signed_directory_hash </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-9\"><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">user_xattr </span><span class=\"crayon-e\">acl </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-10\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">clean </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-11\"><span class=\"crayon-e\">Errors </span><span class=\"crayon-v\">behavior</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-st\">Continue</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-12\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-e\">OS </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-e\">Linux </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-13\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">122160</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-14\"><span class=\"crayon-e\">Block </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">488192</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-15\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">block </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">24409</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-16\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">376512</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-17\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">121690</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-18\"><span class=\"crayon-e\">First </span><span class=\"crayon-v\">block</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-19\"><span class=\"crayon-e\">Block </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-20\"><span class=\"crayon-e\">Fragment </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-21\"><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptor </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-22\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">238</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-23\"><span class=\"crayon-e\">Blocks </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-24\"><span class=\"crayon-e\">Fragments </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-25\"><span class=\"crayon-e\">Inodes </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-26\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-e\">per </span><span class=\"crayon-v\">group</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">509</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-27\"><span class=\"crayon-e\">Flex </span><span class=\"crayon-e\">block </span><span class=\"crayon-e\">group </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-28\"><span class=\"crayon-e\">Filesystem </span><span class=\"crayon-v\">created</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-29\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">Sat </span><span class=\"crayon-i\">Apr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-30\"><span class=\"crayon-e\">Last </span><span class=\"crayon-e\">write </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">Sat </span><span class=\"crayon-i\">Apr</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-31\"><span class=\"crayon-e\">Mount </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-32\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">mount </span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-33\"><span class=\"crayon-e\">Last </span><span class=\"crayon-v\">checked</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">             </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-34\"><span class=\"crayon-e\">Check </span><span class=\"crayon-v\">interval</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">none</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-35\"><span class=\"crayon-e\">Lifetime </span><span class=\"crayon-v\">writes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">594</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MB </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-36\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-v\">uid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-37\"><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-v\">gid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">group </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-38\"><span class=\"crayon-e\">First </span><span class=\"crayon-v\">inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-39\"><span class=\"crayon-e\">Inode </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-40\"><span class=\"crayon-e\">Required </span><span class=\"crayon-e\">extra </span><span class=\"crayon-v\">isize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-41\"><span class=\"crayon-e\">Desired </span><span class=\"crayon-e\">extra </span><span class=\"crayon-v\">isize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-42\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-43\"><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directory </span><span class=\"crayon-v\">hash</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">half_md4 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-44\"><span class=\"crayon-e\">Directory </span><span class=\"crayon-e\">Hash </span><span class=\"crayon-v\">Seed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">c780bac9</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d4bf</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4f35</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b695</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0fe35e8d2d60</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-45\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-e\">inode </span><span class=\"crayon-e\">blocks </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-46\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">features</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-e\">journal_64bit </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-47\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">32M</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-48\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-49\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">sequence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0x00000213</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-50\"><span class=\"crayon-e\">Journal </span><span class=\"crayon-v\">start</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-51\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32767</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-52\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Primary </span><span class=\"crayon-e\">superblock </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptors </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-53\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">239</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-54\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">240</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">240</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-55\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-56\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">270</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">778</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">270</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-57\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24839</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7676</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-58\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7929</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32767</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-59\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">440</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">470</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-60\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-61\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Backup </span><span class=\"crayon-e\">superblock </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32768</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Group </span><span class=\"crayon-e\">descriptors </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32769</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">32769</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-62\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reserved </span><span class=\"crayon-e\">GDT </span><span class=\"crayon-e\">blocks </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32770</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33007</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-63\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">241</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 241) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-64\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 256)</span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-65\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">779</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1287</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 779) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-66\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8668</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8142</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-67\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33008</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33283</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33332</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33791</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33974</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">33975</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34023</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34092</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34094</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34104</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34526</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34687</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34706</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">34723</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34817</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">35374</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35421</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">35844</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35935</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">36355</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">36357</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">36863</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">38912</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">39935</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">39940</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">40570</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42620</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42623</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42655</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42674</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42687</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42721</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42751</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42798</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42815</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42847</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42875</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42879</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42918</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">42943</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42975</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43000</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">43007</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43519</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43559</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">44031</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44042</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">44543</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44545</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45055</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45116</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45567</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45601</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45631</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45658</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45663</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45689</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45695</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45736</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45759</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45802</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45823</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45857</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45887</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45919</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45950</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45951</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45972</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">45983</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46015</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46057</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46079</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46112</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">46591</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46921</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">47103</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">49152</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">49395</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50027</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">50355</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52237</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52255</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52285</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52287</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52323</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52351</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52383</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52450</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52479</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52518</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52543</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52584</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52607</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52652</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52671</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52734</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">52735</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52743</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">53247</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-68\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8147</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16288</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-69\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">98303</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-70\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">242</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 242) </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-71\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">bitmap </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">257</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 257) </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-72\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Inode </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1288</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1796</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#0 + 1288) </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-73\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6326</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8144</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directories </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-74\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">67042</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">67583</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">72201</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">72994</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80185</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">80349</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">81191</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">81919</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90112</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">94207</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-75\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">inodes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16289</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">24432</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adee2ba9d0d984519001-76\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">98304</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">131071</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adee2ba9d0d984519001-77\"><span class=\"crayon-o\">&lt;</span>截断<span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0201 seconds] -->\r\n<p>每一个柱面组都有自己的 inode 位图，用于判定该柱面组中的哪些 inode 是使用中的而哪些又是未被使用的。每一个柱面组的 inode 都有它们自己的空间。每一个 inode 都包含了一个文件的相关信息，包括属于该文件的数据块的位置。而块位图纪录了文件系统中的使用中和非使用中的数据块。请注意，在上面的输出中有大量关于文件系统的数据。在非常大的文件系统上，柱面组的数据可以多达数百页的长度。柱面组的元数据包括组中所有空闲数据块的列表。</p>\n<p>EXT 文件系统实现了数据分配策略以确保产生最少的文件碎片。减少文件碎片可以提高文件系统的性能。这些策略会在下面的 EXT4 中描述到。</p>\n<p>我所遇见的关于 EXT2 文件系统最大的问题是 <code>fsck</code> (文件系统检查) 程序这一环节占用了很长一段时间来定位和校准文件系统中的所有的不一致性，从而导致在系统崩溃crash后其会花费了数个小时来修复。有一次我的其中一台电脑在崩溃后重新启动时共花费了 28 个小时恢复磁盘，而且并且是在磁盘被检测量只有几百兆字节大小的情况下。</p>\n<h3 id=\"toc_5\">EXT3</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext3\" target=\"_blank\" rel=\"external nofollow\">EXT3 文件系统</a>是应一个目标而生的，就是克服 <code>fsck</code> 程序需要完全恢复在文件更新操作期间发生的不正确关机而损坏的磁盘结构所需的大量时间。它对 EXT 文件系统的唯一新增功能就是 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Journaling_file_system\" target=\"_blank\" rel=\"external nofollow\">日志</a>，它将提前记录将对文件系统执行的更改。 EXT3 的磁盘结构的其余部分与 EXT2 中的相同。</p>\n<p>除了同先前的版本一样直接写入数据到磁盘的数据区域外，EXT3 上的日志会将文件数据随同元数据写入到磁盘上的一个指定数据区域。一旦这些（日志）数据安全地到达硬盘，它就可以几乎零丢失率地被合并或被追加到目标文件上。当这些数据被提交到磁盘上的数据区域上，这些日志就会随即更新，这样在日志中的所有数据提交之前，系统发生故障时文件系统将保持一致状态。在下次启动时，将检查文件系统的不一致性，然后将仍保留在日志中的数据提交到磁盘的数据区，以完成对目标文件的更新。</p>\n<p>日志功能确实降低了数据写入性能，但是有三个可用于日志的选项，允许用户在性能和数据完整性、安全性之间进行选择。 我的个人更偏向于选择安全性，因为我的环境不需要大量的磁盘写入活动。</p>\n<p>日志功能将失败后检查硬盘驱动器所需的时间从几小时（甚至几天）减少到了几分钟。 多年来，我遇到了很多导致我的系统崩溃的问题。要详细说的话恐怕还得再写一篇文章，但这里需要说明的是大多数是我自己造成的，就比如不小心踢掉电源插头。 幸运的是，EXT 日志文件系统将启动恢复时间缩短到两三分钟。此外，自从我开始使用带日志记录的 EXT3，我从来没有遇到丢失数据的问题。</p>\n<p>EXT3 的日志功能可以关闭，然后其功能就等同于 EXT2 文件系统了。 该日志本身仍然是存在的，只是状态为空且未使用。 只需在 <code>mount</code> 命令中使用文件系统类型参数来重新挂载即可指定为 EXT2。 你可以从命令行执行此操作，但是具体还是取决于你正在使用的文件系统，不过你也可以更改 <code>/etc/fstab</code> 文件中的类型说明符，然后重新启动。 我强烈建议不要将 EXT3 文件系统挂载为 EXT2 ，因为这会有丢失数据和增加恢复时间的潜在可能性。</p>\n<p>EXT2 文件系统可以使用如下命令来通过日志升级到 EXT3 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adee2ba9d1e335127316\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntune2fs -j /dev/sda1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d1e335127316-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adee2ba9d1e335127316-1\"><span class=\"crayon-v\">tune2fs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sda1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><code>/dev/sda1</code> 表示驱动器和分区的标识符。同时要注意修改 <code>/etc/fstab</code> 中的文件系统类型标识符并重新挂载分区，或者重启系统以确保修改生效。</p>\n<h3 id=\"toc_6\">EXT4</h3>\n<p><a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Ext4\" target=\"_blank\" rel=\"external nofollow\">EXT4 文件系统</a>主要提高了性能、可靠性和容量。为了提高可靠性，它新增了元数据和日志校验和。同时为了满足各种关键任务要求，文件系统新增了纳秒级别的时间戳，并在时间戳字段中添加了两个高位来延缓时间戳的 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Year_2038_problem\" target=\"_blank\" rel=\"external nofollow\">2038 年问题</a> ，这样 EXT4 文件系统至少可用到 2446 年。</p>\n<p>在 EXT4 中，数据分配从固定块改为扩展盘区extent方式，扩展盘区由硬盘驱动器上的开始和结束位置来描述。这使得可以在单个 inode 指针条目中描述非常长的物理上连续的文件，这可以显著减少描述大文件中所有数据的位置所需的指针数。其它在 EXT4 中已经实施的分配策略可以进一步减少碎片化。</p>\n<p>EXT4 通过将新创建的文件散布在磁盘上，使其不会像早期的 PC 文件系统一样全部聚集在磁盘起始位置，从而减少了碎片。文件分配算法尝试在柱面组中尽可能均匀地散布文件，并且当文件（由于太大）需要分段存储时，使不连续的文件扩展盘区尽可能靠近同一文件中的其他部分，以尽可能减少磁头寻道和电机旋转等待时间。当创建新文件或扩展现有文件时，使用其它策略来预先分配额外的磁盘空间。这有助于确保扩展文件时不会自动导致其分段。新文件不会紧挨这现有文件立即分配空间，这也可以防止现有文件的碎片化。</p>\n<p>除了磁盘上数据的实际位置外，EXT4 使用诸如延迟分配的功能策略，以允许文件系统在分配空间之前收集到所有正在写入磁盘的数据，这可以提高数据空间连续的可能性。</p>\n<p>较旧的 EXT 文件系统（如 EXT2 和 EXT3）可以作为 EXT4 进行 <code>mount</code> ，以使其性能获得较小的提升。但不幸的是，这需要关闭 EXT4 的一些重要的新功能，所以我建议不要这样做。</p>\n<p>自 Fedora 14 以来，EXT4 一直是 Fedora 的默认文件系统。我们可以使用 Fedora 文档中描述的 <a class=\"ext\" href=\"https://docs.fedoraproject.org/en-US/Fedora/14/html/Storage_Administration_Guide/ext4converting.html\" target=\"_blank\" rel=\"external nofollow\">流程</a> 将 EXT3 文件系统升级到 EXT4，但是由于仍然存留的之前的 EXT3 元数据结构，它的性能仍将受到影响。从 EXT3 升级到 EXT4 的最佳方法是备份目标文件系统分区上的所有数据，使用 <code>mkfs</code> 命令将空 EXT4 文件系统写入分区，然后从备份中恢复所有数据。</p>\n<h3 id=\"toc_7\">Inode</h3>\n<p>之前介绍过的 inode 是 EXT 文件系统中的元数据的关键组件。 图 2 显示了 inode 和存储在硬盘驱动器上的数据之间的关系。 该图是单个文件的目录和 inode，在这种情况下，可能会产生高度碎片化。 EXT 文件系统可以主动地减少碎片，所以不太可能会看到有这么多间接数据块或扩展盘区的文件。 实际上，你在下面将会看到，EXT 文件系统中的碎片非常低，所以大多数 inode 只使用一个或两个直接数据指针，而不使用间接指针。</p>\n<p class=\"article_img\"><img class=\"aligncenter\" title=\"图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201707/11/154012v1jru7qjxs47fc71.png\" alt=\"图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。\"></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>图 2 ：inode 存储有关每个文件的信息，并使 EXT 文件系统能够查找属于它的所有数据。</em></p>\n<p>inode 不包含文件的名称。通过目录项访问文件，目录项本身就是文件的名称，并包含指向 inode 的指针。该指针的值是 inode 号。文件系统中的每个 inode 都具有唯一的 ID 号，但同一台计算机上的其它文件系统（甚至是相同的硬盘驱动器）中的 inode 可以具有相同的 inode 号。这对 <a class=\"ext\" href=\"https://en.wikipedia.org/wiki/Hard_link\" target=\"_blank\" rel=\"external nofollow\">硬链接</a> 存在影响，但是这个讨论超出了本文的范围。</p>\n<p>inode 包含有关该文件的元数据，包括其类型和权限以及其大小。 inode 还包含 15 个指针的空位，用于描述柱面组数据部分中数据块或扩展盘区的位置和长度。12 个指针提供对数据扩展盘区的直接访问，应该足以满足大多数文件的需求。然而，对于具有明显分段的文件，需要以间接节点node的形式提供一些额外的容量——从技术上讲，这些不是真正的“inode”，所以为了方便起见我在这里使用这个术语“节点node”。</p>\n<p>间接节点是文件系统中的正常数据块，它仅用于描述数据而不用于存储元数据，因此可以支持超过 15 个条目。例如，4K 的块大小可以支持 512 个 4 字节的间接节点，允许单个文件有 <strong>12（直接）+ 512（间接）= 524</strong> 个扩展盘区。还支持双重和三重间接节点，但我们大多数人不太可能遇到需要那么多扩展盘区的文件。</p>\n<h3 id=\"toc_8\">数据碎片</h3>\n<p>对于许多较旧的 PC 文件系统，如 FAT（及其所有变体）和 NTFS，碎片一直是导致磁盘性能下降的重大问题。 碎片整理本身就成为一个行业，有各种品牌的整理软件，其效果范围从非常有效到仅仅是微乎其微。</p>\n<p>Linux 的扩展文件系统使用数据分配策略，有助于最小化硬盘驱动器上的文件碎片，并在发生碎片时减少碎片的影响。 你可以使用 EXT 文件系统上的 <code>fsck</code> 命令检查整个文件系统的碎片。 以下示例检查我的主工作站的家目录，只有 1.5％ 的碎片。 确保使用 <code>-n</code> 参数，因为它会防止 <code>fsck</code> 对扫描的文件系统采取任何操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adee2ba9d27659467042\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfsck -fn /dev/mapper/vg_01-home</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adee2ba9d27659467042-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adee2ba9d27659467042-1\"><span class=\"crayon-v\">fsck</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mapper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vg_01</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">home</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我曾经进行过一些理论计算，以确定磁盘碎片整理是否会产生任何明显的性能提升。 我做了一些假设条件，我使用的磁盘性能数据来自一个新的 300GB 的西部数字硬盘驱动器，具有 2.0ms 的轨到轨寻道时间。 此示例中的文件数是我在计算的当天的文件系统中存在的实际数。 我假设每天有相当大量的碎片化文件（约 20％）会被用到。</p>\n<table border=\"1\" cellpadding=\"4\">\n<thead>\n<tr>\n<th><strong>全部文件</strong></th>\n<th><strong>271,794</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>碎片率 %</td>\n<td>5.00%</td>\n</tr>\n<tr>\n<td>不连续数</td>\n<td>13,590</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>% 每天用到的碎片化文件</td>\n<td>20% （假设）</td>\n</tr>\n<tr>\n<td>额外寻道次数</td>\n<td>2,718</td>\n</tr>\n<tr>\n<td>平均寻道时间</td>\n<td>10.90 ms</td>\n</tr>\n<tr>\n<td>每天全部的额外寻道时间</td>\n<td>29.63 sec</td>\n</tr>\n<tr>\n<td></td>\n<td>0.49 min</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>轨到轨寻道时间</td>\n<td>2.00 ms</td>\n</tr>\n<tr>\n<td>每天全部的额外寻道时间</td>\n<td>5.44 sec</td>\n</tr>\n<tr>\n<td></td>\n<td>0.091 min</td>\n</tr>\n</tbody>\n</table>\n<p style=\"text-align: center\"><em>表 1: 碎片对磁盘性能的理论影响</em></p>\n<p>我对每天的全部的额外寻道时间进行了两次计算，一次是轨到轨寻道时间，这是由于 EXT 文件分配策略而导致大多数文件最可能的情况，一个是平均寻道时间，我假设这是一个合理的最坏情况。</p>\n<p>从表 1 可以看出，对绝大多数应用程序而言，碎片化甚至对性能适中的硬盘驱动器上的现代 EXT 文件系统的影响是微乎其微的。您可以将您的环境中的数字插入到您自己的类似电子表格中，以了解你对性能影响的期望。这种类型的计算不一定能够代表实际的性能，但它可以提供一些对碎片化及其对系统的理论影响的洞察。</p>\n<p>我的大部分分区的碎片率都在 1.5％ 左右或 1.6％，我有一个分区有 3.3％ 的碎片，但是这是一个大约 128GB 文件系统，具有不到 100 个非常大的 ISO 映像文件；多年来，我扩展过该分区几次，因为它已经太满了。</p>\n<p>这并不是说一些应用的环境并不需要更少的碎片的环境。 EXT 文件系统可以由有经验和知识的管理员小心调整，管理员可以针对特定的工作负载类型调整参数。这个工作可以在文件系统创建的时候或稍后使用 <code>tune2fs</code> 命令时完成。每一次调整变化的结果应进行测试，精心的记录和分析，以确保目标环境的最佳性能。在最坏的情况下，如果性能不能提高到期望的水平，则其他文件系统类型可能更适合特定的工作负载。并记住，在单个主机系统上混用文件系统类型以匹配每个文件系统上的不同负载是常见的。</p>\n<p>由于大多数 EXT 文件系统的碎片数量较少，因此无需进行碎片整理。目前，EXT 文件系统没有安全的碎片整理工具。有几个工具允许你检查单个文件的碎片程度或文件系统中剩余可用空间的碎片程度。有一个工具，<code>e4defrag</code>，它可以对允许使用的剩余可用空间、目录或文件系统进行碎片整理。顾名思义，它只适用于 EXT4 文件系统中的文件，并且它还有一其它的些限制。</p>\n<p>如果有必要在 EXT 文件系统上执行完整的碎片整理，则只有一种方法能够可靠地工作。你必须将文件系统中的所有要进行碎片整理的文件移动从而进行碎片整理，并在确保安全复制到其他位置后将其删除。如果可能，你可以增加文件系统的大小，以帮助减少将来的碎片。然后将文件复制回目标文件系统。但是其实即使这样也不能保证所有文件都被完全去碎片化。</p>\n<h3 id=\"toc_9\">总结</h3>\n<p>EXT 文件系统在一些 Linux 发行版本上作为默认文件系统已经超过二十多年了。它们用最少的维护代价提供了稳定性、高可用性、可靠性和性能。我尝试过一些其它的文件系统但最终都还是回归到 EXT。每一个我在工作中使用到 Linux 的地方都使用到了 EXT 文件系统，同时我发现了它们适用于任何主流负载。毫无疑问，EXT4 文件系统应该被用于大部分的 Linux 文件系统上，除非我们有明显需要使用其它文件系统的理由。</p>\n<hr>\n<p>作者简介：</p>\n<p>David Both – David Both 是一名 Linux 于开源的贡献者，目前居住在北卡罗莱纳州的罗利。他从事 IT 行业有 40 余年并在 IBM 中从事 OS/2 培训约 20 余年。在 IBM 就职期间，他在 1981 年为最早的 IBM PC 写了一个培训课程。他已经为红帽教授了 RHCE 课程，曾在 MCI Worldcom，思科和北卡罗来纳州工作。 他使用 Linux 和开源软件工作了近 20 年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111885\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111885votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111885\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux,文件系统", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "6d15dbaaf727b966d37bd068bb39aa2a", "title": "小团队管理与大团队管理", "create_time": "2017/07/17", "url": "http://blog.jobbole.com/111484/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/7062164f8b12cab9bb7cfd7920176dc7.jpg"], "praise_num": "2", "comment_num": 1, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/liulun/p/7159705.html\">liulun</a>   </div><p>我们公司和大部分传统软件公司一样，随着业务的发展和新领域的开拓，公司的管理风格越来越像华为，这是不是最佳的演进路线，我觉得值得探讨，以下是我的思考，希望跟大家讨论。</p>\n<h2>一个问题</h2>\n<p>前段时间跟一个创业的朋友聊天，说起他们最近在做的一个项目，这是一个教育行业的管理系统，业务非常复杂，牵涉到的决策人，需要对接的系统也非常多，最后问到他们做了多久完成这个项目，朋友告诉我2个多月，6个人，其中还括一个美工，一个项目经理；剩下的都是开发人员，没有测试，没有前端开发；朋友问我，如果这个项目给你们做，你们需要做多久；我想了想说，这个项目如果交给我们做，顺利的话，至少要半年。</p>\n<p><strong>为什么差异这么大呢？</strong></p>\n<p>我们一个一个环节来分析一下，朋友的团队跟客户沟通需求的时候，功能性需求只用一个原型草图，非功能性需求就一个excel表格；如果我们公司做的话，至少要做需求调研报告，需求规格说明书；这个阶段的负责人甚至不会画原型，要到设计阶段才有人能画原型；</p>\n<p>到设计阶段，朋友的团队几乎没有什么技术设计，业务按模块给开发人员分一下，各人设计好自己的数据库模型，汇总起来给项目经理看一下，没问题就进入开发阶段了，界面设计花的时间比较久，跟客户反复确认了两三次；如果我们公司做的话，至少要产出原型设计（低保真描述功能的设计稿，高保真描述界面的设计稿），概要设计，详细设计（技术设计、架构设计、网络设计）等等，而且几乎每个设计都要经历评审环节，组织评审就要协调人员，要等大家都有时间的时候再做评审，这都是损耗；</p>\n<p>到开发测试阶段，朋友的团队几个开发人员从前端到后端，从开发到测试，都是这几个人做；如果我们公司来做的话，后台开发人员不做前端（不做复杂的前端页面，普通的前端工作还是要做的），质量保证要测试人员保证，测试把BUG提交到BUG管理工具，开发再去BUG管理工具查阅属于自己的BUG，修改完成之后，再关闭BUG，测试再做回归测试；这些流程看起来琐碎，但却损耗了大量的资源；</p>\n<p>验收上线阶段，朋友的团队所有人都铺在项目现场，有问题，当场解决；我们公司要收集问题，让测试工程师验证问题，再由开发解决，解决之后再验证，再发布版本给现场的实施工程师，实施工程师再更新上线，给客户验证。</p>\n<p>这个问题很明显：规模大的团队和规模小的团队工作方式的差异非常大，组织资源的方式也有明显的区别；我们抽象一下，把这两种模式称为：大军团模式和小编队模式，再看这两种模式的具体区别：</p>\n<h2>大军团模式</h2>\n<p>之前有一种理论，要完成一项超大规模的工程，往往需要成百上千人，有组织有纪律的协作才能完成；</p>\n<p>这样就需要制定一系列的规章、制度、流程、KPI来约束这些人，</p>\n<p>把这些人变成一个庞大机器的零部件，保证结果的达成，避免产生差错；</p>\n<p>这是一种非常常见的大组织的运作模式，</p>\n<p>不但在软件行业普遍存在（华为、惠普、IBM），</p>\n<p>在造桥、修路、航天、汽车等工业领域也十分常见，</p>\n<p>这种模式非常“稳”，他能保证目标的稳定达成，并且能使目标达成的过程清晰、可控。</p>\n<h2>小编队模式</h2>\n<p>第三次工业革命（信息技术革命）以来，小编队的运作模式发展越来越好，我司IPCC产品的核心：开源语音通信软件FreeSwitch，核心开发者也不过6个人；（说这个开源软件养活了半个呼叫中心行业的开发者都不足为过）； 这种例子在软件行业不胜枚举，比如：git源码管理系统、linux操作系统、JavaScript语言等等。</p>\n<p>甚至有些产品是一个人在短时间内完成的，这就是英雄；</p>\n<p>有很多大规模的公司，比如谷歌、Facebook、国内的百度也在内部推行小编队的运作模式；</p>\n<p>这种模式非常“快”，他能保证目标的快速达成，并且能使目标达成的效率非常高；</p>\n<h2>大军团的不足</h2>\n<h3>效率低下</h3>\n<p>大军团强调集体的智慧，</p>\n<p>个体想推动一项事务向正确的方向推进十分困难，</p>\n<p>个体的决策往往会受到质疑或排斥</p>\n<p>诸如：流程、规范、计划、考核、文档、评审、调研等词</p>\n<p>都是为了保证目标的稳定达成所衍生出来的东西，</p>\n<p>它们都是团队快速前进的束缚和绊脚石！</p>\n<h3>阻碍创新</h3>\n<p>大军团鼓励墨守成规、照章办事的氛围，</p>\n<p>大军团强调分工，把员工看作螺丝钉，希望员工各司其职，不是职责范围内的事务尽量不要碰，因为你不专业，你可能会出错，大军团最害怕出错；</p>\n<p>只有这样才能使目标达成的过程清晰可控；</p>\n<p>然而创新却需要不拘一格的思想，需要独立自主的工作空间，需要组织具备容错性，这和大军团的工作方式是格格不入的；</p>\n<h3>资源浪费</h3>\n<p>为了使目标的达成过程清晰可控；</p>\n<p>大军团制定了很多流程和制度来约束个体的行为；</p>\n<p>他把每一项事务都拆分成很多环节；</p>\n<p>又给每个环节制定了很多关卡；</p>\n<p>而且每个环节都要留下数据，使过程有迹可寻；</p>\n<p>因为大军团要做到每项事务都可以复盘，产生问题之后要可以追溯问题根源；</p>\n<p>这样确实保证了目标达成过程的清晰可控，但却浪费了大量的资源；</p>\n<h2>小编队的优势</h2>\n<h3>小编队也适合做大项目</h3>\n<p>有很多很庞大复杂的软件系统，都是以小编队的方式完成的；</p>\n<p>比如操作系统linux，大数据分析系统hadoop，我们这个行业的freeSwitch等；</p>\n<p>如果一个项目大到一定的规模，需要不同角色的人参与，那么也应该是有更多的小编队来做这一块事情；甚至更极端的做法，就是一个项目在建设之初，就考虑到会有很多小编队或个人参与到项目建设过程中，预留了多人、多团队协作的支撑工具，比如说nodejs的NPM，go语言和rust语言也有相应的规划；</p>\n<h3>小编队有很强的执行力</h3>\n<p>小编队不会说这个事情需要做个评审；</p>\n<p>小编队不会说这个事情安排的资源不够，需要协调更多的资源；</p>\n<p>小编队会把这个事情当成自己的事情，不会像大军团一样，把这个事情当成大家的事情来对待；</p>\n<p>我们来看个图：</p>\n<p>（图片遗失，暂不补充）</p>\n<h3>小编队有很强的创新力</h3>\n<p>软件行业不像建筑行业，90%以上的优秀软件一开始都是个人或者小编队创造出来的；很少见一个优秀软件是一个大规模的组织创造出来的。</p>\n<h2>一个案例</h2>\n<p>张小龙曾经说过一段话：</p>\n<p>好的工具就不应该黏人，应该帮助用户非常高效率完成任务，而不是说用完了还要拿到手里玩一会儿、多用一会儿，那不是一个很高效的表现。但是对这样的一些想法的话，我特别希望它能够根植到大家意识里，时刻想一下什么是我们做的对用户有价值的事情；</p>\n<p>假设你是马化腾，你会怎么给张小龙定KPI呢？考核微信的日活吗？……</p>\n<p>无论你制定什么KPI，都会导致团队去围绕着那个KPI去完成任务；</p>\n<p>KPI考核准则里有一项原则就是“可度量”，当你提出一项纯数据目标的时候，团队就会围绕着那个数字去工作。而偏离了做好产品的初心。</p>\n<p>一个团队工作的目的不应该是完成KPI，工作的目的应该是做好产品，完成KPI只不过是做好产品这件事情的副产物，就像一个人好好工作的目的不应该是为了赚钱，他好好工作的副产物是赚了很多钱；</p>\n<p>所以你制定了一系列的kpi考核制度，只能导致员工工作的动机更不纯粹。</p>\n<h2>最后</h2>\n<p>一个组织只要发展良好，总是会吸引更多的资源，所以组织规模的扩大是无可避免的，但如果一个组织规模已经超过500人了，那么你应该把他看作是50~100个小团队来对待，而不是把他当作一个500人的大团队来对待；</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111484\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111484votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111484\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,团队,管理,职场", "front_image_path": "full/ff4572cdd38455986d3d6be616ebc49296dd76d8.jpg"}
{"url_object_id": "47b29ae058a42e8c7d20bb7935eb996f", "title": "写给自学者的入门指南", "create_time": "2017/08/02", "url": "http://blog.jobbole.com/112052/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-story-1024x595.jpg"], "praise_num": "6", "comment_num": 3, "fav_num": 35, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>在 IT 工程师和培训机构多如牛毛的时代，拜师学艺并不难。但自学编程对于毫无基础的同学来说却可能是个问题，相信有过类似经历的朋友都有一把辛酸泪和一肚不吐不快的体会。让我们从一个故事说起…</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-story-1024x595.jpg\" alt=\"\" width=\"700\" height=\"407\"></p>\n<h3>故事</h3>\n<p>某君在一个普通大学读着自己不喜欢的专业，以打游戏、刷段子和睡觉度日，突然有一天想学点什么。学编程好像挺酷，而且听说IT行业充满了机会，没准一不小心就和大佬一起“改变世界”了。</p>\n<p>那么第一个问题来了，他该选择什么语言？</p>\n<p>是世界上最好的语言 PHP？还是语言之母的 C？幸好还知道个编程语言排行榜，找到一看、几十种不带重样，这要逼死天秤座的小朋友。选 PHP 吧？上非诚勿扰都要被灭灯，而且就只能做个网页。万般纠结之后我们选 C 吧，听起来既高级又底层，说不准还能考个计算机二级。</p>\n<p>接下来得干正事儿了。在这个便捷的网络时代，自学可选择的方式非常丰富。除了在网络上收集资料、阅读干货外，某君还向一些前辈咨询了自学的方法。</p>\n<p>网络上流传的编程学习方式有：</p>\n<ul>\n<li>看书（这是最容易想到的方法）</li>\n<li>观看视频教程</li>\n<li>阅读官网文档</li>\n<li>读源码</li>\n<li>到大学蹭课或者报名培训（不知道还算不算自学，没交学费都算吧？）</li>\n</ul>\n<p>某君又得纠结一番了，大学蹭课和培训并不一定有合适条件，且不符合自学的气质；观看视频教程，前辈们觉得比较low；阅读官网文档和源码，这不适合初学者。总得来说看书算是比较中肯的方法，至于看什么书呢，前辈推荐了《C Primer Plus》，据说是学习C语言的经典之作。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-C-Primer-Plus-1-1024x572.jpg\" alt=\"\" width=\"700\" height=\"391\"></p>\n<p>好吧，不再纠结，直接啃这本大部头，虽然有人说看原版好一些，但是实在能力有限、还是看中文版吧。一口气花了一周时间读完这本书，果然是经典，变量、语句、条件判断甚至指针都知道怎么回事了。</p>\n<p>某君决定按照书中的说法实践一下了，于是打开了记事本，折腾很久装了GCC，把书上的第一个例子抄了下来，在控制台的小黑窗输出了“Hello World”，成就感满满。决定上手写点高级的的东西一试身手，合上书。咦，为什么会报错？哦，原来少个分号。不禁陷入思考：为什么学了两个月还是只能在这个黑窗口算算秋水仙数？网友还说要看官网文档、要读源码、要看英文原版，我一样都不能做到，我一定是能力不够，编程果然是天才做的事情……</p>\n<h3>正经话</h3>\n<p>上面的故事是我编的，但其中的纠结却是自学者或多或少都经历过的。实际上，IT从业者并不像传说中那样需要天才般的智商，要点在于能否找到合适的入门途径，再加上一点点坚持和思考。比较可惜的情况是一些人没能找到适合自己的学习方法，并在纠结和碰壁后失去信心，然后沮丧的认定自己并不适合干这行。学编程很多时候就是一个趟坑的过程，但不是每一个坑都有必要趟，写这篇文章的目的是希望能够帮助初学者尽量少趟一些坑。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-learning-method-1024x553.jpg\" alt=\"\" width=\"700\" height=\"378\"></p>\n<h3>IT世界的地图</h3>\n<p>初学者遇到的一个典型问题是对IT世界没有一个大的图景。比如大多数的Java书籍，教完你基础语法知识和秋水仙数的求法后就结束了，并没告诉你接下来能干什么。我曾经为此感到非常困惑，学完Java SE后做了一个非常简陋的GUI demo，就失去了后续的Java学习方向，带着对Java的偏见，这成为了我一段令人沮丧的学习经历。关于这个话题一本书可能都不够，简单来说，我尝试从计算机科学知识和技术实践两方面来聊聊成为一名IT工程师需要具备哪些东西。</p>\n<h3>计算机科学基础</h3>\n<p>首先初学者要具备一些非常基础的知识，这些知识在你踏上工作岗位后能被实际的用到，比如计算机运行原理、网络的传输、常用数据结构和算法等。这部分属于计算机科学，也是应该被计算机专业本科课程涵盖的，不要伤心错过了大学本科的相关课程，我会分享一些有用的资源。</p>\n<p>这里我罗列了一些计算机专业的学生一般需要学习的课程，当然每个学校专业设计都不一样，甚至采用的教材名字也不一样，仅供参考。大学计算机科学课程往往包括：《高等数学》、《离线数学》、《电子电路》、《数据结构》、《程序设计》、《计算机组成原理》、《编译原理》、《计算机网络》、《软件工程》、《数据库原理》等。有些学校会有一些额外的课程，例如《通信原理》、《汇编语言》、《线性代数》、《C语言》、《Java 语言》等。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/4-MOOC.png\" alt=\"\" width=\"761\" height=\"403\"></p>\n<p style=\"text-align: center;\">图片来源于网易计算机专业的课程体系</p>\n<p>尽管IT行业知识更迭非常快，但是基础知识并不容易过时，因此有大量的资料可以选择。可以选择从计算机经典丛书系列开始，比如佛罗赞和莫沙拉夫的《计算机科学导论》，甚至可以阅读一些计算机科普类读物例如《穿越计算机的迷雾》。另一种直观的方式是观看大学精品课和去跟慕课课程，比较推荐的有几个：</p>\n<ul>\n<li>中国大学精品开放课程，高等教育出版社的精品课程项目，有全国大量的名校授课视频和课件</li>\n<li>中国大学MOOC ，这个是中国大学MOOC和网易合作的，提供了上文附图中计算机课程体系中所有课程</li>\n<li>果壳网的MOOC学院，主打翻译全球名校的优秀课程，比如斯坦福的《编译原理》和MIT的《Python》</li>\n</ul>\n<h3>从知识到实践</h3>\n<p>除此之外，还需要了解实际应用于设计软件或者开发网站中的实践类知识，包括某个特定语言以及周边的库、框架和工具等。 我们可以把特定需求中用到的语言、库和框架以及其他的工具称为技术栈，在技术选型上通常也是被这样考虑的，HR常常会根据技术栈来寻找需要的工程师。比如需要学习SSH 三大框架和Java的Java技术栈；为服务器web开发而生的PHP技术栈；在移动开发领域流行的IOS、安卓技术栈等。当然这里面有一些重合和共用的技术也需要学习，比如版本管理器Git、SVN就是每个合格的工程师需要去学习的。</p>\n<p>换句话说，大学课程主要定位在上面说到的计算机科学基础知识，而市面上的培训机构主要是告诉你在怎么在实际工作中运用，所以大学和培训机构都有他们的价值。</p>\n<p>想要更加详细的了解这部分内容，这里有一些开源的技能图谱可以参考:</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/5-skill-map-1024x752.jpeg\" alt=\"\" width=\"700\" height=\"514\"></p>\n<p style=\"text-align: center;\">图片来自： http://skill-map.stuq.org/</p>\n<h3>如何挑选你的兵器？</h3>\n<p>在介绍完计算机领域的大致图景后，就需要选择一门合适的编程语言，一个较为形象的例子是把编程语言比喻成兵器，因为我们深知编程语言对于工程师而言是实实在在的工具，我们不是为了学它而学，学编程不仅仅是学语言特性，一般来说我们也不用知道赋值语句像“茴香豆蔻”的“茴”字有四种写法。</p>\n<p>当然语言之争从来没有停止过，如果把编程语言比喻江湖武器的话十分有趣。</p>\n<blockquote><p>C语言是M1式加兰德步枪，很老但可靠。</p>\n<p>C++是双截棍，挥舞起来很强悍，很吸引人，但需要多年的磨练来掌握，很多人希望改用别的武器。</p>\n<p>Perl语言是燃烧弹，曾经在战场上很有用，但现在很少人使用它。</p>\n<p>Java是M240通用弹夹式自动机枪，有时它的弹夹是圆的，但有时候不是，如果不是，当你开火时，会遇到NullPointerException问题，枪会爆炸，你就会被炸死。</p>\n<p>JavaScript是一把宝剑，但没有剑柄。</p>\n<p>— 来自网络</p></blockquote>\n<p>老实来讲IT行业的最终目的是交付可用的软件，编程语言也是适应市场的。这对于初学者或许有些残酷，在工作中我们发现最好的语言是用来处理工作任务或者构建合适的应用，并不是出于爱好或者某种Geek精神。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/6-Geek-1024x586.png\" alt=\"\" width=\"700\" height=\"401\"></p>\n<p>对于初学者而言，在选择合适的入门语言时至少需要考虑两点：</p>\n<ul>\n<li>是否能适用于构建你想要的应用。如果你的目标是创建一个运行在IPhone上的APP，那么最好选择 Object C 或者 Swift，学习web开发可以选择PHP 或者JAVA。实际上我们仍然可以用汇编做出网页，但是这样做成本高昂。</li>\n<li>是否容易学习，在满足第一点的条件下请尽量选择容易学习的语言。容易不仅仅指语法简单，包括环境搭建、部署等都需要考虑在内，以及能不能容易找到好的学习资料，因此尽可能的选择主流语言。</li>\n</ul>\n<p>别忘了非常重要的一点，学习编程语言还包括平台提供的API，比如Win 32 之于C++/C#/VB，以及周边的库和框架（这些库、框架和工具能在上面说的技术图谱中找到）。IT历史上甚至出现框架和库引领编程语言走向的情况：JQuery 和Angular 改变了前端开发的思想; Rails 抢走了Ruby的名气；而SSH三大框架一度代表了Java世界。</p>\n<p>最后我为初学者整理了一个流行编程语言和用途的表：</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/7-programming-language-1.png\" alt=\"\" width=\"606\" height=\"555\"></p>\n<p>另外还需要注意的是开发工具，可以选用IDE和有代码提示的编辑器，但尽量不要在这上喋喋不休，这就像用来盛放你锋利兵器的架子，用着顺手就行，也不推荐使用纯文本编辑器，这看起来像赤手空拳。 推荐一些编辑器和IDE</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/8-IDE-1.png\" alt=\"\" width=\"674\" height=\"323\"></p>\n<h3>挑选合适的资料和有效的阅读</h3>\n<p>对初学者而言，我仍然推荐好的视频教程，虽然我已经听到不下5个人声称是靠阅读官方文档或者看源码学会编程的，而且认为观看视频教程见效太慢。但这个思想对初学者很危险，不得不承认阅读文档和源码能更准确找到自己想要的信息，这对深入技术原理非常有用，但视频能比文字传达出更丰富的内容，有更直观的演示和细致的讲解，我想没有比这个更适合初学者了。</p>\n<p>除了上面提到的精品课程和慕课教程，国内有像网易云课堂，国外有lynda.com这种在线学习视频网站，甚至在优酷和土豆都能找到足够的教程资源。</p>\n<p>如果选择了阅读技术类书籍，我们来聊聊怎么有效的阅读一本技术书籍。</p>\n<p>读IT类书籍和读考试类书籍的方式不同，初学者需要选择更接地气、并且能告诉你最终能做出什么案例的书籍。你不需要通读整本书，而是需要搭建好和书中版本一致的环境，然后把书中的每行代码敲入电脑，观察这些代码怎样被运行，在遇到问题时去请教朋友或者到搜索引擎中寻找解决办法，直到示例程序能被正确运行。</p>\n<p>可能一个月才能读完一本书，但慢点并没什么坏处，敲过一遍的代码才能算是你的，否则永远存在于纸上的代码清单中。对于关键的概念和知识点，可以在阅读的同时做一些笔记，去尝试使用思维导图来做你的笔记吧，这让你的笔记跟上你的思考，并形成一个知识网络。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/9-spring.png\" alt=\"\" width=\"940\" height=\"356\"></p>\n<h3>自我激励</h3>\n<p>自学无疑是寂寞的。编程学习耗时较长，如何保证在这个阶段能坚持下去？</p>\n<p>我们知道很多人都能对游戏产生强烈的兴趣、愿意为之投入时间，这其中的秘密就是游戏的奖励规则。杀死一个怪物就能得到一些金币，通过完成任务获得满足感，通过关卡的设计产生持续吸引力，进而形成正向的反馈。</p>\n<p>其实学习编程也一样，实现一小段程序并运行，足以让人感到成就感和满足，借鉴这个简单的心理学技巧，定期给自己设定一些有实际意义但是不太难的目标和任务。太难会让人失去耐心，太简单又很无聊，最好设定一个跳起来刚好摸得着的任务。每完成一个目标就给予自己奖励，可以是完成任务的成就感，也可以是其他的物质奖励。</p>\n<p>这个时候一个代办记事的清单就可以帮上忙了，可以是一个to do list的软件，或者自己手写一张卡片贴到墙上，关键在于不要忘了在任务达成后给予自己适当的奖励。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/10-to-do-list.png\" alt=\"\" width=\"940\" height=\"560\"></p>\n<p style=\"text-align: center;\">图片来源：https://appadvice.com</p>\n<p>那如果真的遇到一些麻烦的任务呢，如何顺利解决而不至于丧失信心？笛卡尔在《方法论》一书中告诉了我们研究复杂问题的方法和步骤:</p>\n<ul>\n<li>尽量将其分解为多个比较简单的小问题，一个一个地分开解决</li>\n<li>将小问题从简单到复杂排列，先从容易解决的问题着手</li>\n<li>子问题被解决后，进行联调测试，看是否能协同运行</li>\n</ul>\n<p>在敏捷开发这种工程思想中我们正是这样做的，我们需要把业务需求进行拆分然后评估工作量，不仅可以直观的看到任务进展，手上的工作也不会看起来庞大得难以完成。</p>\n<h3>最后多说几句</h3>\n<p>非科班出身的工程师入门是有一定痛苦的，不像武侠世界里面的名门正派弟子，也没有机缘遇到骨骼精奇的世外高人，如何选择合适自己的学习方式并自我管理是很重要的一方面。没有任何Low的学习方式，只要直接而又高效，而且要能达到我们的目的就好。以我为例，从大专学校毕业并没有机会参加本科课程，曾经也在网上攫取各种视频教程，去别的学校蹭课，甚至带上礼物去一个老师那里登门拜访补课。</p>\n<p>另一方面是如何上桌，吃上编程这碗饭。学习的成果如果无处施展便成为屠龙之技，参加一些开源项目和一些公益活动，谁不喜欢一个热心的人呢。也可以尝试去实现自己的一些idea，当做一个小项目来开发，有了一些项目实践后去找一个公司实习会容易的多。</p>\n<p>我不知道算是有幸还是不幸经历了这一个过程，矫情一点来说是有一些曲折，但是我知道“聪明”从来不是这个行业的门槛。引用流行于知乎的一句老话“以大多人的努力程度，还轮不到拼天赋的程度”，在Thoughtworks有大量优秀的工程师，从他们身上我能看到聪明不是学习编程成功的关键，坚持和勤于思考才是。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112052\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112052votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112052\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 35 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "其他,程序员,编程,自学", "front_image_path": "full/d1090f61ad1b5ed427d81d03e12c8b76397dd93a.jpg"}
{"url_object_id": "99c1959be1169340bfefafd21c8b2fdd", "title": "DB 分库分表（4）：多数据源的事务处理", "create_time": "2017/07/18", "url": "http://blog.jobbole.com/111880/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7793172\">Laurence的技术博客</a>   </div><p>系统经sharding改造之后，原来单一的数据库会演变成多个数据库，如何确保多数据源同时操作的原子性和一致性是不得不考虑的一个问题。总体上看，目前对于一个分布式系统的事务处理有三种方式：分布式事务、基于Best Efforts 1PC模式的事务以及事务补偿机制。我们下面对这三种处理方式一一进行分析。</p>\n<p><strong>分布式事务</strong></p>\n<p>这是最为人们所熟知的多数据源事务处理机制。本文并不打算对分布式事务做过多介绍，读者可参考此文：<a href=\"http://blog.csdn.net/bluishglc/article/details/7612811\" target=\"_blank\">关于分布式事务、两阶段提交、一阶段提交、Best Efforts 1PC模式和事务补偿机制的研究 </a>。在这里只想对分布式事务的利弊作一下分析。</p>\n<p>优势：</p>\n<blockquote><p>1. 基于两阶段提交，最大限度地保证了跨数据库操作的“原子性”，是分布式系统下最严格的事务实现方式。<br>\n2. 实现简单，工作量小。由于多数应用服务器以及一些独立的分布式事务协调器做了大量的封装工作，使得项目中引入分布式事务的难度和工作量基本上可以忽略不计。</p></blockquote>\n<p>劣势：</p>\n<blockquote><p>系统“水平”伸缩的死敌。基于两阶段提交的分布式事务在提交事务时需要在多个节点之间进行协调,最大限度地推后了提交事务的时间点，客观上延长了事务的执行时间，这会导致事务在访问共享资源时发生冲突和死锁的概率增高，随着数据库节点的增多，这种趋势会越来越严重，从而成为系统在数据库层面上水平伸缩的”枷锁”， 这是很多Sharding系统不采用分布式事务的主要原因。</p></blockquote>\n<p><strong>基于Best Efforts 1PC模式的事务</strong></p>\n<p>与分布式事务采用的两阶段提交不同，Best Efforts 1PC模式采用的是一阶段端提交，牺牲了事务在某些特殊情况(当机、网络中断等)下的安全性，却获得了良好的性能，特别是消除了对水平伸缩的桎酷。<a href=\"http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html?page=5\" target=\"_blank\">Distributed transactions in Spring, with and without XA</a>一文对Best Efforts 1PC模式进行了详细的说明，该文提供的Demo代码更是直接给出了在Spring环境下实现一阶段提交的多数据源事务管理示例。不过需要注意的是，原示例是基于spring 3.0之前的版本，如果你使用spring 3.0+,会得到如下错误：<strong>java.lang.IllegalStateException: Cannot activate transaction synchronization – already active</strong>，如果使用spring 3.0+，你需要参考<a href=\"https://github.com/SpringSource/spring-data-graph/blob/master/spring-data-neo4j/src/main/java/org/springframework/data/neo4j/transaction/ChainedTransactionManager.java\" target=\"_blank\">spring-data-neo4j</a>的实现。鉴于Best Efforts 1PC模式的性能优势，以及相对简单的实现方式，它被大多数的sharding框架和项目采用。</p>\n<p><strong>事务补偿机制</strong></p>\n<p>对于那些对性能要求很高，但对一致性要求并不高的系统，往往并不苛求系统的实时一致性，只要在一个允许的时间周期内达到最终一致性即可，这使得事务补偿机制成为一种可行的方案。事务补偿机制最初被提出是在“长事务”的处理中，但是对于分布式系统确保一致性也有很好的参考意义。笼统地讲，与事务在执行中发生错误后立即回滚的方式不同，事务补偿是一种事后检查并补救的措施，它只期望在一个容许时间周期内得到最终一致的结果就可以了。事务补偿的实现与系统业务紧密相关，并没有一种标准的处理方式。一些常见的实现方式有：对数据进行对帐检查;基于日志进行比对;定期同标准数据来源进行同步，等等。</p>\n<p><strong>小结</strong></p>\n<p>分布式事务，最严格的事务实现，但性能是个大问题;Best Efforts 1PC模式，性能与事务可靠性的平衡，支持系统水平伸缩，大多数情况下是最合适的选择;事务补偿机制，只能适用于对事务性要求不高，允许数据“最终一致”即可的系统，牺牲实时一致性，获得最大的性能回报。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111880\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111880votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111880\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,分库分表,数据库", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "4e2323f618189ba713417f1ffdd20900", "title": "Nginx 配置文件 nginx.conf 详解", "create_time": "2017/07/18", "url": "http://blog.jobbole.com/111765/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "praise_num": "3", "comment_num": 0, "fav_num": 19, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/gide/p/6180251.html\">北京流浪儿</a>   </div><p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4b792c062008604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#定义Nginx运行的用户和用户组\r\nuser www www;\r\n\r\n#nginx进程数，建议设置为等于CPU总核心数。\r\nworker_processes 8;\r\n\r\n#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]\r\nerror_log /var/log/nginx/error.log info;\r\n\r\n#进程文件\r\npid /var/run/nginx.pid;\r\n\r\n#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。\r\nworker_rlimit_nofile 65535;\r\n\r\n#工作模式与连接数上限\r\nevents\r\n{\r\n#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。\r\nuse epoll;\r\n#单个进程最大连接数（最大连接数=连接数*进程数）\r\nworker_connections 65535;\r\n}\r\n\r\n#设定http服务器\r\nhttp\r\n{\r\ninclude mime.types; #文件扩展名与文件类型映射表\r\ndefault_type application/octet-stream; #默认文件类型\r\n#charset utf-8; #默认编码\r\nserver_names_hash_bucket_size 128; #服务器名字的hash表大小\r\nclient_header_buffer_size 32k; #上传文件大小限制\r\nlarge_client_header_buffers 4 64k; #设定请求缓\r\nclient_max_body_size 8m; #设定请求缓\r\nsendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。\r\nautoindex on; #开启目录列表访问，合适下载服务器，默认关闭。\r\ntcp_nopush on; #防止网络阻塞\r\ntcp_nodelay on; #防止网络阻塞\r\nkeepalive_timeout 120; #长连接超时时间，单位是秒\r\n\r\n#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。\r\nfastcgi_connect_timeout 300;\r\nfastcgi_send_timeout 300;\r\nfastcgi_read_timeout 300;\r\nfastcgi_buffer_size 64k;\r\nfastcgi_buffers 4 64k;\r\nfastcgi_busy_buffers_size 128k;\r\nfastcgi_temp_file_write_size 128k;\r\n\r\n#gzip模块设置\r\ngzip on; #开启gzip压缩输出\r\ngzip_min_length 1k; #最小压缩文件大小\r\ngzip_buffers 4 16k; #压缩缓冲区\r\ngzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）\r\ngzip_comp_level 2; #压缩等级\r\ngzip_types text/plain application/x-javascript text/css application/xml;\r\n#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。\r\ngzip_vary on;\r\n#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用\r\n\r\nupstream blog.ha97.com {\r\n#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。\r\nserver 192.168.80.121:80 weight=3;\r\nserver 192.168.80.122:80 weight=2;\r\nserver 192.168.80.123:80 weight=3;\r\n}\r\n\r\n#虚拟主机的配置\r\nserver\r\n{\r\n    #监听端口\r\n    listen 80;\r\n    #域名可以有多个，用空格隔开\r\n    server_name www.ha97.com ha97.com;\r\n    index index.html index.htm index.php;\r\n    root /data/www/ha97;\r\n    location ~ .*\\.(php|php5)?$\r\n    {\r\n    fastcgi_pass 127.0.0.1:9000;\r\n    fastcgi_index index.php;\r\n    include fastcgi.conf;\r\n    }\r\n    #图片缓存时间设置\r\n    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$\r\n    {\r\n    expires 10d;\r\n    }\r\n    #JS和CSS缓存时间设置\r\n    location ~ .*\\.(js|css)?$\r\n    {\r\n    expires 1h;\r\n    }\r\n    #日志格式设定\r\n    log_format access '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n    '$status $body_bytes_sent \"$http_referer\" '\r\n    '\"$http_user_agent\" $http_x_forwarded_for';\r\n    #定义本虚拟主机的访问日志\r\n    access_log /var/log/nginx/ha97access.log access;\r\n\r\n    #对 \"/\" 启用反向代理\r\n    location / {\r\n    proxy_pass http://127.0.0.1:88;\r\n    proxy_redirect off;\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    #以下是一些反向代理的配置，可选。\r\n    proxy_set_header Host $host;\r\n    client_max_body_size 10m; #允许客户端请求的最大单文件字节数\r\n    client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，\r\n    proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)\r\n    proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)\r\n    proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)\r\n    proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小\r\n    proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置\r\n    proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）\r\n    proxy_temp_file_write_size 64k;\r\n    #设定缓存文件夹大小，大于这个值，将从upstream服务器传\r\n    }\r\n\r\n    #设定查看Nginx状态的地址\r\n    location /NginxStatus {\r\n    stub_status on;\r\n    access_log on;\r\n    auth_basic \"NginxStatus\";\r\n    auth_basic_user_file conf/htpasswd;\r\n    #htpasswd文件的内容可以用apache提供的htpasswd工具来产生。\r\n    }\r\n\r\n    #本地动静分离反向代理配置\r\n    #所有jsp的页面均交由tomcat或resin处理\r\n    location ~ .(jsp|jspx|do)?$ {\r\n    proxy_set_header Host $host;\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    proxy_pass http://127.0.0.1:8080;\r\n    }\r\n    #所有静态文件由nginx直接读取不经过tomcat或resin\r\n    location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$\r\n    { expires 15d; }\r\n    location ~ .*.(js|css)?$\r\n    { expires 1h; }\r\n}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4b792c062008604-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4b792c062008604-144\">144</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-1\"><span class=\"crayon-p\">#定义Nginx运行的用户和用户组</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-2\"><span class=\"crayon-e\">user </span><span class=\"crayon-e\">www </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-4\"><span class=\"crayon-p\">#nginx进程数，建议设置为等于CPU总核心数。</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-5\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-7\"><span class=\"crayon-p\">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-8\"><span class=\"crayon-v\">error_log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">info</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-10\"><span class=\"crayon-p\">#进程文件</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-11\"><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-13\"><span class=\"crayon-p\">#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-14\"><span class=\"crayon-v\">worker_rlimit</span><span class=\"crayon-sy\">_</span>nofile<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-16\"><span class=\"crayon-p\">#工作模式与连接数上限</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-17\"><span class=\"crayon-e\">events</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-19\"><span class=\"crayon-p\">#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-20\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epoll</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-21\"><span class=\"crayon-p\">#单个进程最大连接数（最大连接数=连接数*进程数）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-22\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65535</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-23\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-24\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-25\"><span class=\"crayon-p\">#设定http服务器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-26\"><span class=\"crayon-e\">http</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-27\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-28\"><span class=\"crayon-e\">include </span><span class=\"crayon-v\">mime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#文件扩展名与文件类型映射表</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-29\"><span class=\"crayon-e\">default_type </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">octet</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#默认文件类型</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-30\"><span class=\"crayon-p\">#charset utf-8; #默认编码</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-31\"><span class=\"crayon-v\">server_names_hash_bucket</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#服务器名字的hash表大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-32\"><span class=\"crayon-v\">client_header_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#上传文件大小限制</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-33\"><span class=\"crayon-v\">large_client_header</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设定请求缓</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-34\"><span class=\"crayon-v\">client_max_body</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8m</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设定请求缓</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-35\"><span class=\"crayon-e\">sendfile </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-36\"><span class=\"crayon-e\">autoindex </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启目录列表访问，合适下载服务器，默认关闭。</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-37\"><span class=\"crayon-e\">tcp_nopush </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#防止网络阻塞</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-38\"><span class=\"crayon-e\">tcp_nodelay </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#防止网络阻塞</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-39\"><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#长连接超时时间，单位是秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-40\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-41\"><span class=\"crayon-p\">#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-42\"><span class=\"crayon-v\">fastcgi_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-43\"><span class=\"crayon-v\">fastcgi_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-44\"><span class=\"crayon-v\">fastcgi_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-45\"><span class=\"crayon-v\">fastcgi_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-46\"><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-47\"><span class=\"crayon-v\">fastcgi_busy_buffers</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-48\"><span class=\"crayon-v\">fastcgi_temp_file_write</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-50\"><span class=\"crayon-p\">#gzip模块设置</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-51\"><span class=\"crayon-e\">gzip </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#开启gzip压缩输出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-52\"><span class=\"crayon-v\">gzip_min</span><span class=\"crayon-sy\">_</span>length<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#最小压缩文件大小</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-53\"><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩缓冲区</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-54\"><span class=\"crayon-v\">gzip_http</span><span class=\"crayon-sy\">_</span>version<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-55\"><span class=\"crayon-v\">gzip_comp</span><span class=\"crayon-sy\">_</span>level<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#压缩等级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-56\"><span class=\"crayon-e\">gzip_types </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">plain </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">javascript </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">css </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">xml</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-57\"><span class=\"crayon-p\">#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-58\"><span class=\"crayon-e\">gzip_vary </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-59\"><span class=\"crayon-p\">#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-60\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-61\"><span class=\"crayon-e\">upstream </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-62\"><span class=\"crayon-p\">#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-63\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.121</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-64\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.122</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-65\"><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.80.123</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-66\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-68\"><span class=\"crayon-p\">#虚拟主机的配置</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-69\"><span class=\"crayon-e\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-70\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#监听端口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">listen</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#域名可以有多个，用空格隔开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">server_name </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">index </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">html </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">htm </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ha97</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">php5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">_</span>pass<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">9000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fastcgi_index </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">include </span><span class=\"crayon-v\">fastcgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#图片缓存时间设置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">bmp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">swf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-85\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-86\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10d</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#JS和CSS缓存时间设置</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">js</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1h</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#日志格式设定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">log_format </span><span class=\"crayon-i\">access</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'$remote_addr - $remote_user [$time_local] \"$request\" '</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'$status $body_bytes_sent \"$http_referer\" '</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"$http_user_agent\" $http_x_forwarded_for'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-97\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#定义本虚拟主机的访问日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">access_log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ha97access</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">access</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#对 \"/\" 启用反向代理</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-102\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//127.0.0.1:88;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_redirect </span><span class=\"crayon-v\">off</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-104\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Real</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">IP</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote_addr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-105\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Forwarded</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">proxy_add_x_forwarded_for</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#以下是一些反向代理的配置，可选。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_set_header </span><span class=\"crayon-i\">Host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client_max_body</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10m</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#允许客户端请求的最大单文件字节数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client_body_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#缓冲区代理缓冲用户端请求的最大字节数，</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#nginx跟后端服务器连接超时时间(代理连接超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-112\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#后端服务器数据回传时间(代理发送超时)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#连接成功后，后端服务器响应时间(代理接收超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_buffer</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy</span><span class=\"crayon-sy\">_</span>buffers<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#proxy_buffers缓冲区，网页平均在32k以下的设置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_busy_buffers</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#高负荷下缓冲大小（proxy_buffers*2）</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_temp_file_write</span><span class=\"crayon-sy\">_</span>size<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-119\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-120\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#设定查看Nginx状态的地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-122\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">NginxStatus</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">stub_status </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">access_log </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-125\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">auth</span><span class=\"crayon-sy\">_</span>basic<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NginxStatus\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-126\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">auth_basic_user_file </span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">htpasswd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-127\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#htpasswd文件的内容可以用apache提供的htpasswd工具来产生。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-128\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-129\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#本地动静分离反向代理配置</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#所有jsp的页面均交由tomcat或resin处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jsp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jspx</span><span class=\"crayon-o\">|</span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-133\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_set_header </span><span class=\"crayon-i\">Host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-134\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Real</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">IP</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote_addr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proxy_set</span><span class=\"crayon-sy\">_</span>header<span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Forwarded</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">proxy_add_x_forwarded_for</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-136\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//127.0.0.1:8080;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-137\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#所有静态文件由nginx直接读取不经过tomcat或resin</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">htm</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">gif</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpeg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">bmp</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">swf</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ioc</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">rar</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">flv</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">mid</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">doc</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">ppt</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">pdf</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">xls</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">mp3</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">wma</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15d</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-141\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">js</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1h</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4b792c062008604-143\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4b792c062008604-144\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0173 seconds] -->\r\n<p></p>\n<div></div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111765\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111765votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111765\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 19 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Nginx", "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg"}
{"url_object_id": "9ce14fbc71c2b3562272365d741946ba", "title": "数据库压缩技术探索", "create_time": "2017/07/19", "url": "http://blog.jobbole.com/111930/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6e6cabd45d6fb2d059e608a9ff5b97e4.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.iteye.com/news/32473\">首发《程序员》杂志</a>   </div><div>\n<blockquote>作者：雷鹏，Terark核心技术发明人。曾就职奇虎360，负责搜索引擎核心研发；曾就职Yahoo！北研所负责搜索广告、广告交易（AdExchange）等项目。在数据库、高性能计算、分布式、系统架构上都深有造诣。</blockquote>\n</div>\n<p>作为数据库，在系统资源（CPU、内存、SSD、磁盘等）一定的前提下，我们希望：</p>\n<ul>\n<li><strong>存储的数据更多：</strong>采用压缩，这个世界上有各种各样的压缩算法；</li>\n<li><strong>访问的速度更快：</strong>更快的压缩（写）/解压（读）算法、更大的缓存。</li>\n</ul>\n<p>几乎所有压缩算法都严重依赖上下文：</p>\n<ul>\n<li>位置相邻的数据，一般情况下相关性更高，内在冗余度更大；</li>\n<li>上下文越大，压缩率的上限越大（有极限值）。</li>\n</ul>\n<p><strong>块压缩</strong></p>\n<p><strong>传统数据库中的块压缩技术</strong></p>\n<p>对于普通的以数据块/文件为单位的压缩，传统的（流式）数据压缩算法工作得不错，时间长了，大家也都习惯了这种数据压缩的模式。基于这种模式的数据压缩算法层出不穷，不断有新的算法实现。包括使用最广泛的gzip、bzip2、Google的Snappy、新秀Zstd等。</p>\n<ul>\n<li>gzip几乎在在所有平台上都有支持，并且也已经成为一个行业标准，压缩率、压缩速度、解压速度都比较均衡；</li>\n<li>bzip2是基于BWT变换的一种压缩，本质是上对输入分块，每个块单独压缩，优点是压缩率很高，但压缩和解压速度都比较慢；</li>\n<li>Snappy是Google出品，优点是压缩和解压都很快，缺点是压缩率比较低，适用于对压缩率要求不高的实时压缩场景；</li>\n<li>LZ4是Snappy一个强有力的竞争对手，速度比Snappy更快，特别是解压速度；</li>\n<li>Zstd是一个压缩新秀，压缩率比LZ4和Snappy都高不少，压缩和解压速度略低；相比gzip，压缩率不相上下，但压缩/解压速度要高很多。</li>\n</ul>\n<p>对于数据库，在计算机世界的太古代，为I/O优化的Btree一直是不可撼动的，为磁盘优化的Btree block/page size比较大，正好让传统数据压缩算法能得到较大的上下文，于是，基于block/page的压缩也就自然而然地应用到了各种数据库中。在这个蛮荒时代，内存的性能、容量与磁盘的性能、容量泾渭分明，各种应用对性能的需求也比较小，大家都相安无事。</p>\n<p>现在，我们有了SSD、PCIe SSD、3D XPoint等，内存也越来越大，块压缩的缺点也日益突出：</p>\n<ul>\n<li>块选小了，压缩率不够；块选大了，性能没法忍；</li>\n<li>更致命的是，块压缩节省的只是更大更便宜的磁盘、SSD；</li>\n<li>更贵更小的内存不但没有节省，反而更浪费了（双缓存问题）。</li>\n</ul>\n<p>于是，对于很多实时性要求较高的应用，只能关闭压缩。</p>\n<p><strong>块压缩的原理</strong></p>\n<p>使用通用压缩技术（Snappy、LZ4、zip、bzip2、Zstd等），按块/页（block/page）进行压缩（块尺寸通常是4KB~32KB，以压缩率著称的TokuDB块尺寸是2MB~4MB），这个块是逻辑块，而不是内存分页、块设备概念中的那种物理块。</p>\n<p>启用压缩时，随之而来的是访问速度下降，这是因为：</p>\n<ul>\n<li>写入时，很多条记录被打包在一起压缩成一个个的块，增大块尺寸，压缩算法可以获得更大的上下文，从而提高压缩率；相反地，减小块尺寸，会降低压缩率。</li>\n<li>读取时，即便是读取很短的数据，也需要先把整个块解压，再去读取解压后的数据。这样，块尺寸越大，同一个块内包含的记录数目越多。为读取一条数据，所做的不必要解压就也就越多，性能也就越差。相反地，块尺寸越小，性能也就越好。</li>\n</ul>\n<p>一旦启用压缩，为了缓解以上问题，传统数据库一般都需要比较大的专用缓存，用来缓存解压后的数据，这样可以大幅提高热数据的访问性能，但又引起了双缓存的空间占用问题：一是操作系统缓存中的压缩数据；二是专用缓存（例如RocksDB中的DBCache）中解压后的数据。还有一个同样很严重的问题：专用缓存终归是缓存，当缓存未命中时，仍需要解压整个块，这就是慢Query问题的一个主要来源（慢Query的另一个主要来源是在操作系统缓存未命中时）。</p>\n<p>这些都导致现有传统数据库在访问速度和空间占用上是一个此消彼长、无法彻底解决的问题，只能采取一些折衷。</p>\n<p><strong>RocksDB 的块压缩</strong></p>\n<p>以RocksDB为例，RocksDB中的BlockBasedTable就是一个块压缩的SSTable，使用块压缩，索引只定位到块，块的尺寸在dboption里设定，一个块中包含多条（key，value）数据，例如M条，这样索引的尺寸就减小到了1/M：</p>\n<ul>\n<li>M越大，索引的尺寸越小；</li>\n<li>M越大，Block的尺寸越大，压缩算法（gzip、Snappy等）可以获得的上下文也越大，压缩率也就越高。</li>\n</ul>\n<p>创建BlockBasedTable时，Key Value被逐条填入buffer，当buffer尺寸达到预定大小（块尺寸，当然，一般buffer尺寸不会精确地刚好等于预设的块尺寸），就将buffer压缩并写入BlockBasedTable文件，并记录文件偏移和buffer中的第一个Key（创建index要用），如果单条数据太大，比预设的块尺寸还大，这条数据就单独占一个块（单条数据不管多大也不会分割成多个块）。所有Key Value写完以后，根据之前记录的每个块的起始Key和文件偏移，创建一个索引。所以在BlockBasedTable文件中，数据在前，索引在后，文件末尾包含元信息（作用相当于常用的FileHeader，只是位置在文件末尾，所以叫footer）。</p>\n<p>搜索时，先使用searchkey找到searchkey所在的block，然后到DB Cache中搜索这个块，找到后就进一步在块中搜索searchkey，如果找不到，就从磁盘/SSD读取这个块，解压后放入DB Cache。RocksDB中的DB Cache有多种实现，常用的包括LRU Cache，另外还有Clock Cache、Counting Cache（用来统计Cache命中率等），还有其他一些特殊的Cache。</p>\n<p>一般情况下，操作系统会有文件缓存，所以同一份数据可能既在DB Cache中（解压后的数据），又在操作系统Cache中（压缩的数据）。这样会造成内存浪费，所以RocksDB提供了一个折衷：在dboption中设置DIRECT_IO选项，绕过操作系统Cache，这样就只有DB Cache，可以节省一部分内存，但在一定程度上会降低性能。</p>\n<p><strong>传统非主流压缩：FM-Index</strong></p>\n<p>FM-Index的全名是Full Text Matching Index，属于Succinct Data Structure家族，对数据有一定的压缩能力，并且可以直接在压缩的数据上执行搜索和访问。</p>\n<p>FM-Index的功能非常丰富，历史也已经相当悠久，不算是一种新技术，在一些特殊场景下也已经得到了广泛应用，但是因为各种原因，一直不温不火。最近几年，FM-Index开始有些活跃，首先是GitHub上有个大牛实现了全套Succinct算法，其中包括FM-Index，其次Berkeley的Succinct项目也使用了FM-Index。</p>\n<p>FM-Index属于Offline算法（一次性压缩所有数据，压缩好之后不可修改），一般基于BWT变换（BWT变换基于后缀数组），压缩好的FM-Index支持以下两个最主要的操作：</p>\n<ul>\n<li>data = extract(offset, length)</li>\n<li>{offset} = search(string) ，返回多个匹配string的位置/偏移（offset）</li>\n</ul>\n<p>FM-Index还支持更多其他操作，感兴趣的朋友可以进一步调研。</p>\n<p>但是，在笔者看来，FM-Index有几个致命的缺点：</p>\n<ul>\n<li>实现太复杂（这一点可以被少数大牛们克服，不提也罢）；</li>\n<li>压缩率不高（比流式压缩例如gzip差太多）；</li>\n<li>搜索（search）和访问（extract）速度都很慢（在2016年最快的CPU i7-6700K上，单线程吞吐率不超过7MB/sec）；</li>\n<li>压缩过程又慢又耗内存（Berkeley的Succinct压缩过程内存消耗是源数据的50倍以上）；</li>\n<li>数据模型是Flat Text，不是数据库的KeyValue模型。</li>\n</ul>\n<p>可以用一种简单的方式把Flat Model转化成KeyValue Model：挑选一个在Key和Value中都不会出现的字符“#”（如果无法找出这样的字符，需要进行转义编码），每个Key前后都插入该字符，Key之后紧邻的就是Value。如此，search(#key#)返回了#key#出现的位置，我们就能很容易地拿到Value了。</p>\n<p>Berkeley的Succinc项目在FM-Index的Flat Text模型上实现了更丰富的行列（Row-Column）模型，付出了巨大的努力，达到了一定的效果，但离实用还相差太远。</p>\n<p>感兴趣的朋友可以仔细调研下FM-Index，以验证笔者的总结与判断。</p>\n<p><strong>Terark的可检索压缩（Searchable Compression）</strong></p>\n<p>Terark公司提出了“可检索压缩（Searchable Compression）”的概念，其核心也是直接在压缩的数据上执行搜索（search）和访问（extract），但数据模型本身就是KeyValue模型，根据其测试报告，速度要比FM-Index快得多（两个数量级），具体阐述：</p>\n<ul>\n<li>摒弃传统数据库的块压缩技术，采用全局压缩；</li>\n<li>对Key和Value使用不同的全局压缩技术；</li>\n<li>对Key使用有搜索功能的全局压缩技术COIndex（对应FM-Index的search）；</li>\n<li>对Value使用可定点访问的全局压缩技术PA-Zip（对应FM-Index的extract）。</li>\n</ul>\n<p><strong>对Key的压缩：CO-Index</strong></p>\n<p>我们需要对Key进行索引，才能有效地进行搜索，并访问需要的数据。</p>\n<p>普通的索引技术，索引的尺寸相对于索引中原始Key的尺寸要大很多，有些索引使用前缀压缩，能在一定程度上缓解索引的膨胀，但仍然无法解决索引占用内存过大的问题。</p>\n<p>我们提出了CO-Index（Compressed Ordered Index）的概念，并且通过一种叫做Nested Succinct Trie的数据结构实践了这一概念。</p>\n<p>较之传统实现索引的数据结构，Nested Succinct Trie的空间占用小十几倍甚至几十倍。而在保持该压缩率的同时，还支持丰富的搜索功能：</p>\n<ul>\n<li>精确搜索；</li>\n<li>范围搜索；</li>\n<li>顺序遍历；</li>\n<li>前缀搜索；</li>\n<li>正则表达式搜索（不是逐条遍历）。</li>\n</ul>\n<p>与FM-Index相比，CO-Index也有其优势（假定FM-Index中所有的数据都是Key）。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0457b02458b4a0ba39b8c6364b7c78d4.png\"></div>\n<div style=\"text-align: center\">表1 FM-Index对比CO-Index</div>\n<p><strong>CO-Index的原理</strong></p>\n<p>实际上我们实现了很多种CO-Index，其中Nested Succinct Trie是适用性最广的一种，在这里对其原理做一个简单介绍：</p>\n<p><strong>Succinct Data Structure介绍</strong></p>\n<p>Succinct Data Structure是一种能够在接近于信息论下限的空间内来表达对象的技术，通常使用位图来表示，用位图上的rank和select来定位。</p>\n<p>虽然能够极大降低内存占用量，但实现起来较为复杂，并且性能低很多（时间复杂度的常数项很大）。目前开源的有SDSL-Lite，我们则使用自己实现的Rank-Select，性能也高于开源实现。</p>\n<p><strong>以二叉树为例</strong></p>\n<p>传统的表现形式是一个结点中包含两个指针：struct Node { Node *left, *right; };</p>\n<p>每个结点占用 2ptr，如果我们对传统方法进行优化，结点指针用最小的bits数来表达，N个结点就需要2*[log2(N)]个bits。</p>\n<ul>\n<li>对比传统基本版和传统优化版，假设共有216个结点（包括null结点），传统优化版需要2 bytes，传统基本版需要4/8 bytes。</li>\n<li>对比传统优化版和Succinct，假设共有10亿(~230)个结点。</li>\n<li>传统优化版每个指针占用[log2(230)]=30bits，总内存占用：($frac{2*30}{8}$)*230≈ 7.5GB。</li>\n<li>使用Succinct，占用：($frac{2.5}{8}$)*230≈ 312.5MB(每个结点2.5 bits，其中0.5bits是 rank-select 索引占用的空间）。</li>\n</ul>\n<p><strong>Succinct Tree</strong></p>\n<p>Succinct Tree有很多种表达方式，这里列出常见的两种：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/42bb4fdda5077930596850352a5d5ab8.png\"></div>\n<div style=\"text-align: center\">图1 Succinct Tree表达方式示例</div>\n<p><strong>Succinct Trie = Succinct Tree + Trie Label</strong></p>\n<p>Trie可以用来实现Index，图2这个Succinct Trie用的是LOUDS表达方式，其中保存了hat、is、it、a、四个Key。</p>\n<p><strong>Patricia Trie加嵌套</strong></p>\n<p>仅使用Succinct技术，压缩率远远不够，所以又应用了路径压缩和嵌套。这样一来，压缩率就上了一个新台阶。</p>\n<p>把上面这些技术综合到一起，就是我们的Nest Succinct Trie。</p>\n<p><strong>对Value的压缩: PA-Zip</strong></p>\n<p>我们研发了一种叫做PA-Zip (Point Accessible Zip)的压缩技术：每条数据关联一个ID，数据压缩好之后，就可以用相应的ID访问那条数据。这里，ID就是那个Point，所以叫做Point Accessible Zip。</p>\n<p>PA-Zip对整个数据库中的所有Value（KeyValue数据库中所有Value的集合）进行全局压缩，而不是按block/page进行压缩。这是针对数据库的需求（KeyValue 模型），专门设计的一个压缩算法，用来解决传统数据库压缩的问题：</p>\n<ul>\n<li>压缩率更高，没有双缓存的问题，只要把压缩后的数据装进内存，不需要专用缓存，可以按ID直接读取单条数据，如果把这种读取单条数据看作是一种解压，那么：</li>\n<li>按ID顺序解压时，解压速度（Throughput）一般在500MB每秒（单线程），最高达到约7GB/s，适合离线分析性需求，传统数据库压缩也能做到这一点；</li>\n<li>按ID随机解压时，解压速度一般在300MB每秒（单线程），最高达到约3GB/s，适合在线服务需求，这一点完胜传统数据库压缩：按随机解压300MB/s算，如果每条记录平均长度1K，相当于QPS = 30万；如果每条记录平均长度300个字节，相当于QPS = 100万；</li>\n<li>预热（warmup），在某些特殊场景下，数据库可能需要预热。因为去掉了专用缓存，TerarkDB的预热相对简单高效，只要把mmap的内存预热一下（避免Page Fault即可），数据库加载成功后就是预热好的，这个预热的Throughput就是SSD连续读的IO性能（较新的SSD读性能超过3GB/s）。</li>\n</ul>\n<p>与FM-Index相比，PA-Zip解决的是FM-Index的extract操作，但性能和压缩率都要好得多：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/899986dec4eb1f141407f572b05c511f.png\"></div>\n<div style=\"text-align: center\">表2 FM-Index对比PA-Zip</div>\n<p><strong>结合Key与Value</strong></p>\n<p>Key以全局压缩的形式保存在CO-Index中，Value以全局压缩的形式保存在 PA-Zip中。搜索一个Key，会得到一个内部ID，根据这个ID，去PA-Zip中定点访问该ID对应的Value，整个过程中只触碰需要的数据，不需要触碰其他数据。</p>\n<p>如此无需专用缓存（例如RocksDB中的DBCache），仅使用mmap，完美配合文件系统缓存，整个DB只有mmap的文件系统缓存这一层缓存，再加上超高的压缩率，大幅降低了内存用量，并且极大简化了系统的复杂性，最终完成数据库性能的大幅提升，从而同时实现了超高的压缩率和超高的随机读性能。</p>\n<p>从更高的哲学层面看，我们的存储引擎很像是用构造法推导出来的，因为CO-Index和PA-Zip紧密配合，完美匹配KeyValue模型，功能上“刚好够用”，性能上压榨硬件极限，压缩率逼近信息论的下限。相比其他方案：</p>\n<ul>\n<ul>\n<li>传统块压缩是从通用的流式压缩衍生而来，流式压缩的功能非常有限，只有压缩和解压两个操作，对太小的数据块没有压缩效果，也无法压缩数据块之间的冗余。把它用到数据库上，需要大量的工程努力，就像给汽车装上飞机机翼，然后要让它飞起来。</li>\n<li>相比FM-Index，情况则相反，FM-Index的功能非常丰富，它就必然要为此付出一些代价——压缩率和性能。而在KeyValue模型中，我们只需要它那些丰富功能的一个非常小的子集（还要经过适配和转化），其他更多的功能毫无用武之地，却仍然要付出那些代价，就像我们花了很高的代价造了一架飞机，却把它按在地上，只用轮子跑，当汽车用。</li>\n</ul>\n</ul>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fadbdd0670c36a88f53a624790ad3bb.png\"></div>\n<div style=\"text-align: center\">图2 用LOUDS方式表达的Succinct Tree</div>\n<p> </p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7be742bb10ad455007a1e6e8ca885fe4.png\"></div>\n<div style=\"text-align: center\">图3 路径压缩与嵌套</div>\n<p><strong>附录</strong></p>\n<p><strong>压缩率&amp;性能测试比较</strong></p>\n<p><strong>数据集：Amazon movie data</strong></p>\n<p>Amazon movie data (~8 million reviews)，数据集的总大小约为9GB, 记录数大约为800万条，平均每条数据长度大约1K。</p>\n<p>Benchmark代码开源：参见<a href=\"https://github.com/Terark/terarkdb-benchmark/tree/master/doc/movies\" target=\"_blank\">Github仓库</a>。<br>\n压缩率（见图4）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02b6b59e468b97bc09a4d6ce30dd5eb2.png\"></div>\n<div style=\"text-align: center\">图4 压缩率对比</div>\n<p>随机读（见图5）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/33436d4c3c3bdef34dcbd58741d80380.png\"></div>\n<div style=\"text-align: center\">图5 随机读性能对比</div>\n<p>这是在内存足够的情况下，各个存储引擎的性能。<br>\n延迟曲线（见图6）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/75f6ac41648016d57f8c64747e19c235.png\"></div>\n<div style=\"text-align: center\">图6 延迟曲线对比</div>\n<p><strong>数据集：Wikipedia英文版</strong></p>\n<p>Wikipedia英文版的所有文本数据，109G，压缩到23G。</p>\n<p><strong>数据集：TPC-H</strong></p>\n<p>在TPC-H的lineitem数据上，使用TerarkDB和原版RocksDB（BlockBasedTable）进行对比测试：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ea750214ac1a02595cc67c794e35b20.png\"></div>\n<div style=\"text-align: center\">表3 TerarkDB与原版RocksDB对比测试</div>\n<p><strong>API 接口</strong></p>\n<p><strong>TerarkDB = Terark SSTable + RocksDB</strong></p>\n<p>RocksDB最初是Facebook对Google的LevelDB的一个fork，编程接口上兼容LevelDB，并增加了很多改进。</p>\n<p>RocksDB对我们有用的地方在于其SSTable可以plugin，所以我们实现了一个RocksDB的SSTable，将我们的技术优势通过RocksDB发挥出来。</p>\n<p>虽然RocksDB提供了一个相对完整的KeyValueDB框架，但要完全适配我们特有的技术，仍有一些欠缺，所以需要对RocksDB本身也做一些修改。将来可能有一天我们会将自己的修改提交到RocksDB官方版。</p>\n<p>Github链接：<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">TerarkDB</a>（<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">https://github.com/Terark/terarkdb</a>），TerarkDB包括两部分：</p>\n<ul>\n<li>terark-zip-rocksdb（<a href=\"https://github.com/terark/terark-zip-rocksdb\" target=\"_blank\">https://github.com/terark/terark-zip-rocksdb</a>），（Terark SSTable forrocksdb）</li>\n<li>Terark fork rocksdb（<a href=\"https://github.com/Terark/rocksdb\" target=\"_blank\">https://github.com/Terark/rocksdb</a>），（必须使用这个修改版的rocksdb）</li>\n</ul>\n<p>为了更好的兼容性，TerarkDB对RocksDB的API没有做任何修改，为了进一步方便用户使用TerarkDB，我们甚至提供了一种方式：程序无需重新编译，只需要替换 librocksdb.so并设置几个环境变量，就能体验TerarkDB。</p>\n<p>如果用户需要更精细的控制，可以使用C++ API详细配置TerarkDB的各种选项。</p>\n<p>目前大家可以免费试用，可以做性能评测，但是不能用于production，因为试用版会随机删掉0.1%的数据。</p>\n<p><strong>Terark命令行工具集</strong></p>\n<p>我们提供了一组命令行工具，这些工具可以将输入数据压缩成不同的形式，压缩后的文件可以使用Terark API或（该工具集中的）其他命令行工具解压或定点访问。</p>\n<p>详情参见<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">Terark wiki中文版</a>（<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">https://github.com/Terark/terark-wiki-zh_cn</a>）。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111930\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111930votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111930\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,数据库", "front_image_path": "full/ff17de8672c48c6a8dd39a73a0753c9ad77c1693.jpg"}
{"url_object_id": "cca88c074547b53fcc59c01e5736f847", "title": "DB 分库分表（5）：一种支持自由规划无须数据迁移和修改路由代码的 Sharding 扩容方案", "create_time": "2017/07/19", "url": "http://blog.jobbole.com/111927/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7970268\">Laurence的技术博客，首发《程序员》杂志</a>   </div><p>作为一种数据存储层面上的水平伸缩解决方案，数据库Sharding技术由来已久，很多海量数据系统在其发展演进的历程中都曾经历过分库分表的Sharding改造阶段。简单地说，Sharding就是将原来单一数据库按照一定的规则进行切分，把数据分散到多台物理机（我们称之为Shard)上存储，从而突破单机限制，使系统能以Scale-Out的方式应对不断上涨的海量数据，但是这种切分对上层应用来说是透明的，多个物理上分布的数据库在逻辑上依然是一个库。实现Sharding需要解决一系列关键的技术问题，这些问题主要包括：切分策略、节点路由、全局主键生成、跨节点排序/分组/表关联、多数据源事务处理和数据库扩容等。本文将重点围绕“数据库扩容”进行深入讨论，并提出一种允许自由规划并能避免数据迁移和修改路由代码的Sharding扩容方案。</p>\n<h3><strong>Sharding扩容——系统维护不能承受之重</strong></h3>\n<p>任何Sharding系统，在上线运行一段时间后，数据就会积累到当前节点规模所能承载的上限，此时就需要对数据库进行扩容了，也就是增加新的物理结点来分摊数据。如果系统使用的是基于ID进行散列的路由方式，那么团队需要根据新的节点规模重新计算所有数据应处的目标Shard，并将其迁移过去，这对团队来说无疑是一个巨大的维护负担；而如果系统是按增量区间进行路由(如每1千万条数据或是每一个月的数据存放在一个节点上 )，虽然可以避免数据的迁移，却有可能带来“热点”问题，也就是近期系统的读写都集中在最新创建的节点上(很多系统都有此类特点：新生数据的读写频率明显高于旧有数据)，从而影响了系统性能。面对这种两难的处境，Sharding扩容显得异常困难。</p>\n<p>一般来说，“理想”的扩容方案应该努力满足以下几个要求：</p>\n<ol>\n<li> 最好不迁移数据 （无论如何，数据迁移都是一个让团队压力山大的问题）</li>\n<li>允许根据硬件资源自由规划扩容规模和节点存储负载</li>\n<li>能均匀的分布数据读写，避免“热点”问题</li>\n<li>保证对已经达到存储上限的节点不再写入数据</li>\n</ol>\n<p>目前，能够避免数据迁移的优秀方案并不多，相对可行的有两种，一种是维护一张记录数据ID和目标Shard对应关系的映射表，写入时，数据都写入新扩容的Shard，同时将ID和目标节点写入映射表，读取时，先查映射表，找到目标Shard后再执行查询。该方案简单有效，但是读写数据都需要访问两次数据库，且映射表本身也极易成为性能瓶颈。为此系统不得不引入分布式缓存来缓存映射表数据，但是这样也无法避免在写入时访问两次数据库，同时大量映射数据对缓存资源的消耗以及专门为此而引入分布式缓存的代价都是需要权衡的问题。另一种方案来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。</p>\n<h3><strong>取长补短，兼容并包——一种理想的Sharding扩容方案</strong></h3>\n<p>如前文所述，Sharding扩容与系统采用的路由规则密切相关：基于散列的路由能均匀地分布数据，但却需要数据迁移，同时也无法避免对达到上限的节点不再写入新数据；基于增量区间的路由天然不存在数据迁移和向某一节点无上限写入数据的问题，但却存在“热点”困扰。我们设计方案的初衷就是希望能结合两种路由规则的优势，摒弃各自的劣势，创造出一种接近“理想”状态的扩容方式，而这种方式简单概括起来就是：全局按增量区间分布数据，使用增量扩容，无数据迁移，局部使用散列方式分散数据读写，解决“热点”问题，同时对Sharding拓扑结构进行建模，使用一致的路由算法，扩容时只需追加节点数据，不再修改散列逻辑代码。</p>\n<h3><strong>原理</strong></h3>\n<p>首先，作为方案的基石，为了能使系统感知到Shard并基于Shard的分布进行路由计算，我们需要建立一个可以描述Sharding拓扑结构的编程模型。按照一般的切分原则，一个单一的数据库会首先进行垂直切分，垂直切分只是将关系密切的表划分在一起，我们把这样分出的一组表称为一个Partition。 接下来，如果Partition里的表数据量很大且增速迅猛，就再进行水平切分，水平切分会将一张表的数据按增量区间或散列方式分散到多个Shard上存储。在我们的方案里，我们使用增量区间与散列相结合的方式，全局上，数据按增量区间分布，但是每个增量区间并不是按照某个Shard的存储规模划分的，而是根据一组Shard的存储总量来确定的，我们把这样的一组Shard称为一个ShardGroup，局部上，也就是一个ShardGroup内，记录会再按散列方式均匀分布到组内各Shard上。这样，一条数据的路由会先根据其ID所处的区间确定ShardGroup，然后再通过散列命中ShardGroup内的某个目标Shard。在每次扩容时，我们会引入一组新的Shard，组成一个新的ShardGroup，为其分配增量区间并标记为“可写入”，同时将原有ShardGroup标记为“不可写入”，于是新生数据就会写入新的ShardGroup，旧有数据不需要迁移。同时，在ShardGroup内部各Shard之间使用散列方式分布数据读写，进而又避免了“热点”问题。最后，在Shard内部，当单表数据达到一定上限时，表的读写性能就开始大幅下滑，但是整个数据库并没有达到存储和负载的上限，为了充分发挥服务器的性能，我们通常会新建多张结构一样的表，并在新表上继续写入数据，我们把这样的表称为“分段表”（Fragment Table）。不过，引入分段表后所有的SQL在执行前都需要根据ID将其中的表名替换成真正的分段表名，这无疑增加了实现Sharding的难度，如果系统再使用了某种ORM框架，那么替换起来可能会更加困难。目前很多数据库提供一种与分段表类似的“分区”机制，但没有分段表的副作用，团队可以根据系统的实现情况在分段表和分区机制中灵活选择。总之，基于上述切分原理，我们将得到如下Sharding拓扑结构的领域模型：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b6a6923203f3865db3481b3ac4c3103a.jpg\" alt=\"\" width=\"591\" height=\"483\"></p>\n<p style=\"text-align: center\">图1. Sharding拓扑结构领域模型</p>\n<p>在这个模型中，有几个细节需要注意：ShardGroup的writable属性用于标识该ShardGroup是否可以写入数据，一个Partition在任何时候只能有一个ShardGroup是可写的，这个ShardGroup往往是最近一次扩容引入的；startId和endId属性用于标识该ShardGroup的ID增量区间；Shard的hashValue属性用于标识该Shard节点接受哪些散列值的数据；FragmentTable的startId和endId是用于标识该分段表储存数据的ID区间。</p>\n<p>确立上述模型后，我们需要通过配置文件或是在数据库中建立与之对应的表来存储节点元数据，这样，整个存储系统的拓扑结构就可以被持久化起来，系统启动时就能从配置文件或数据库中加载出当前的Sharding拓扑结构进行路由计算了（如果结点规模并不大可以使用配置文件，如果节点规模非常大，需要建立相关表结构存储这些结点元数据。从最新的Oracle发布的《面向大规模可伸缩网站基础设施的MySQL参考架构》白皮书一文的“超大型系统架构参考”章节给出的架构图中我们可以看到一种名为：Shard Catalog的专用服务器，这个其实是保存结点配置信息的数据库），扩容时只需要向对应的文件或表中加入相关的节点信息重启系统即可，不需要修改任何路由逻辑代码。</p>\n<h3><strong>示例</strong></h3>\n<p>让我们通过示例来了解这套方案是如何工作的。</p>\n<p><strong>阶段一：初始上线</strong></p>\n<p>假设某系统初始上线，规划为某表提供4000W条记录的存储能力，若单表存储上限为1000W条，单库存储上限为2000W条，共需2个Shard，每个Shard包含两个分段表，ShardGroup增量区间为0-4000W，按2取余分散到2个Shard上，具体规划方案如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a4da76f81d438d240c54afe5124d2ab.jpg\" alt=\"\" width=\"591\" height=\"310\"></p>\n<p style=\"text-align: center\">图2. 初始4000W存储规模的规划方案</p>\n<p>与之相适应，Sharding拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/09fcb6013304ed5a0bd37962856c02c7.jpg\" alt=\"\" width=\"467\" height=\"388\"></p>\n<p style=\"text-align: center\">图3. 对应Sharding元数据</p>\n<p><strong>阶段二：系统扩容</strong></p>\n<p>经过一段时间的运行，当原表总数据逼近4000W条上限时，系统就需要扩容了。为了演示方案的灵活性，我们假设现在有三台服务器Shard2、Shard3、Shard4，其性能和存储能力表现依次为Shard2&lt;Shard3&lt;Shard4，我们安排Shard2储存1000W条记录，Shard3储存2000W条记录，Shard4储存3000W条记录，这样，该表的总存储能力将由扩容前的4000W条提升到10000W条，以下是详细的规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2375c89746d023b9ddcbb20f653c3b3b.jpg\" alt=\"\" width=\"802\" height=\"278\"></p>\n<p style=\"text-align: center\">图4. 二次扩容6000W存储规模的规划方案</p>\n<p>相应拓扑结构表数据下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfae7a7e6e53f086c125982d8bbc8132.jpg\" alt=\"\" width=\"474\" height=\"471\"></p>\n<p style=\"text-align: center\">图5. 对应Sharding元数据</p>\n<p>从这个扩容案例中我们可以看出该方案允许根据硬件情况进行灵活规划，对扩容规模和节点数量没有硬性规定，是一种非常自由的扩容方案。</p>\n<h3><strong>增强</strong></h3>\n<p>接下来让我们讨论一个高级话题：对“再生”存储空间的利用。对于大多数系统来说，历史数据较为稳定，被更新或是删除的概率并不高，反映到数据库上就是历史Shard的数据量基本保持恒定，但也不排除某些系统其数据有同等的删除概率，甚至是越老的数据被删除的可能性越大，这样反映到数据库上就是历史Shard随着时间的推移，数据量会持续下降，在经历了一段时间后，节点就会腾出很大一部分存储空间，我们把这样的存储空间叫“再生”存储空间，如何有效利用再生存储空间是这些系统在设计扩容方案时需要特别考虑的。回到我们的方案，实际上我们只需要在现有基础上进行一个简单的升级就可以实现对再生存储空间的利用，升级的关键就是将过去ShardGroup和FragmentTable的单一的ID区间提升为多重ID区间。为此我们把ShardGroup和FragmentTable的ID区间属性抽离出来，分别用ShardGroupInterval和FragmentTableIdInterval表示，并和它们保持一对多关系。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb93f0a9d14f8dd2f21535aaa611eb66.jpg\" alt=\"\" width=\"550\" height=\"629\"></p>\n<p style=\"text-align: center\">图6. 增强后的Sharding拓扑结构领域模型</p>\n<p>让我们还是通过一个示例来了解升级后的方案是如何工作的。</p>\n<p><strong>阶段三：不扩容，重复利用再生存储空间</strong></p>\n<p>假设系统又经过一段时间的运行之后，二次扩容的6000W条存储空间即将耗尽，但是由于系统自身的特点，早期的很多数据被删除，Shard0和Shard1又各自腾出了一半的存储空间，于是ShardGroup0总计有2000W条的存储空间可以重新利用。为此，我们重新将ShardGroup0标记为writable=true，并给它追加一段ID区间：10000W-12000W，进而得到如下规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9aefceaacb575a4a218b4444b710525c.jpg\" alt=\"\" width=\"518\" height=\"312\"></p>\n<p style=\"text-align: center\">图7. 重复利用2000W再生存储空间的规划方案</p>\n<p>相应拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7174be65f86f3158fbeae47d88984408.jpg\" alt=\"\" width=\"713\" height=\"382\"></p>\n<p style=\"text-align: center\">图8. 对应Sharding元数据</p>\n<h3><strong>小结</strong></h3>\n<p>这套方案综合利用了增量区间和散列两种路由方式的优势，避免了数据迁移和“热点”问题，同时，它对Sharding拓扑结构建模，使用了一致的路由算法，从而避免了扩容时修改路由代码，是一种理想的Sharding扩容方案。</p>\n<p><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></p>\n<h1><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></h1>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111927\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111927votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111927\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,分库分表,数据库", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "1a6ec2a64adc4d7e67f112d418752843", "title": "Nginx 缓存引发的跨域惨案", "create_time": "2017/08/21", "url": "http://blog.jobbole.com/112224/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 4, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://tech.lede.com/2017/07/21/rd/server/crossdomain/\">网易乐得 - 张捷</a>   </div><h3 id=\"1-前言\">1. 前言</h3>\n<p>贵金属wap版直播间上线后，偶尔有用户反馈，在进入wap直播间的时候，出现空白页面，但是重新刷新又可以正常显示了。我们曾一度认为是网络请求异常或兼容问题，直到开发PC版直播间，在进行调试中，同样遇到了“白屏”问题，才引起了足够重视，并进行了问题跟踪与分析。现在跟大家分享一下，这种偶然现象出现的原因。</p>\n<p>我们的直播间落地页在fa.163.com 系统，而直播间内容，是通过 向直播间系统 qz.fa.163.com 发起Ajax请求获取的。在出现“白屏”的时候，可以通过浏览器的调试窗口，可以看到出现下面的报错</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\"><img class=\"alignnone size-full wp-image-112226\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\" alt=\"p1\"></a></p>\n<h3 id=\"2-问题分析\">2. 问题分析</h3>\n<p>从上述错误提示文案中可以看到，问题首先和 <strong>跨域</strong> 有关。</p>\n<blockquote><p><strong>何为跨域</strong></p>\n<p>从字面上理解为“跨域名”，<br>\n浏览器不能执行其他网站的脚本，然而，跨域不仅仅局限于域名这一项。只要协议、域名、端口有任何一个不同，都被当作是不同的域。 这是由于&gt;同源策略的限制，从一个域上加载的脚本不允许访问另外一个域的文档属性。虽然在浏览器中，&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;等标签都&gt;可&gt;以加载跨域资源，而不受同源限制，但浏览器会限制脚本中发起的跨域请求。比如，使用 XMLHttpRequest 对象和Fetch发起 HTTP 请求就必须遵守同源策略。</p>\n<p><strong>同源策略/SOP（Same origin policy）</strong>是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。SOP要求两个通讯地址的协议、域名、端口号必须相同，否则两个地址的通讯将被浏览器视为不安全的，并被block下来。</p>\n<p style=\"text-align: center\">举个例子：从贵金属主站 <a href=\"http://fa.163.com\" target=\"_blank\" rel=\"external\">http://fa.163.com</a> 发起请求访问以下url：<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\"><img class=\"alignnone size-full wp-image-112227\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\" alt=\"p6\"></a></p>\n<p><strong>解决跨域</strong></p>\n<p>在实际应用中有多种方式来解决跨域问题，相信在实践中都会用到其中的某些方案：</p>\n<p>1.JSONP （无状态连接，不能获悉连接状态和错误事件，而且只能走GET的形式）</p>\n<p>2.iframe形式</p>\n<p>3.服务器代理</p>\n<p>页面直接向同域的服务端发请求，服务端进行跨域处理或爬虫后，再把数据返回给客户端页。</p>\n<p>4.CORS</p>\n<p>CORS(Cross-Origin Resource Sharing)跨域资源共享，定义了必须在访问跨域资源时，浏览器与服务器应该如何沟通。CORS背后的基本思想就&gt;是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是失败。目前，所有浏览器都支持该功能，IE浏览器不能低&gt;于IE10。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏&gt;览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p>\n<p>CORS方式实现：</p>\n<p>浏览器在发出CORS请求时会在头信息之中增加一个Origin字段；</p>\n<p>后端返回代码中增加三个字段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef52af016750750928\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheader(“Access-Control-Allow-Origin”:“”);           // 必选 允许所有来源访问\r\nheader(“Access-Control-Allow-Credentials”:“true”);  //可选 是否允许发送cookie\r\nheader(“Access-Control-Allow-Method”:“POST,GET”);   //可选 允许访问的方式</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef52af016750750928-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af016750750928-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af016750750928-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef52af016750750928-1\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Origin</span>”<span class=\"crayon-o\">:</span>“”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 必选 允许所有来源访问</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af016750750928-2\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Credentials</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-t\">true</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//可选 是否允许发送cookie</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af016750750928-3\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Method</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">GET</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//可选 允许访问的方式</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>nginx是一个高性能的web服务器，常用作反向代理服务器。nginx作为反向代理服务器，就是把http请求转发到另一个或者一些服务器上。通过把本地一个url前缀映射到要跨域访问的web服务器上，就可以。</p></blockquote>\n<p>为了解决跨域问题，我们选择方案d ， 在直播间的过滤器中，统一添加了如下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef52af020264670132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n   &lt;a href=\"http://www.jobbole.com/members/wx610506454\"&gt;@Override&lt;/a&gt;\r\n   public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\r\n    // 加入响应头\r\n    String origin = request.getHeader(\"Origin\");\r\n    if(\"http://fa.163.com\".equals(origin) || \"https://fa.163.com\".equals(origin) ) {\r\n        response.addHeader(\"Access-Control-Allow-Origin\", origin);\r\n        response.addHeader(\"Access-Control-Allow-Credentials\", \"true\");\r\n    }\r\n    return true;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef52af020264670132-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af020264670132-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af020264670132-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af020264670132-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af020264670132-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af020264670132-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af020264670132-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af020264670132-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af020264670132-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af020264670132-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef52af020264670132-1\"><span class=\"crayon-h\">   </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx610506454\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af020264670132-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af020264670132-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 加入响应头</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af020264670132-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Origin\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af020264670132-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af020264670132-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Origin\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af020264670132-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Credentials\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"true\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af020264670132-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af020264670132-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af020264670132-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>从错误提示文案中，我们还可以看到错误提示的关键点 “<a href=\"http://fa.163.com%E2%80%9D\" target=\"_blank\" rel=\"external\">http://fa.163.com”</a> that is not equal to the supplied origin. Origin ‘<a href=\"https://fa.163.com\" target=\"_blank\" rel=\"external\">https://fa.163.com</a>‘ is therefore not allowed access.<br>\n目前我们的系统同时支持http访问和https访问，但是为什么使用 http访问 ，返回的header中却是 https 协议呢？<br>\n通过多次模拟，确认出现问题的请求中，Request URL使用的协议和 response返回的headers中的 Access-Control-Allow-Origin 中的 协议确实不一致，且还有一个特性，X-Cached 为 HIT，如下图：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\"><img class=\"alignnone size-full wp-image-112228\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\" alt=\"p2\"></a></p>\n<p>命中了缓存的请求，出现了协议不一致？</p>\n<p>突然想到，这个接口，我们配置了nginx 缓存，那必然和nginx缓存有关了。</p>\n<blockquote><p><strong>Nginx 缓存</strong></p>\n<p>Nginx (engine x) 是一个高性能的HTTP和反向代理服务器。<br>\n首先从源服务器（内部网络上的web服务器）上获取内容，然后把内容返回给用户，同时，也会把内容保存到代理服务器上一份，这样日后再接收同样的信息请求时，他会把本地缓存里的内容直接发给用户，以此减少后端web服务器的压力，提高响应速度。这其实就是缓存服务器所实现的功能。如下图所示。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\"><img class=\"alignnone size-full wp-image-112229\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\" alt=\"p3\"></a></p></blockquote>\n<p>进入直播间后，首先需要查询直播内容是否有更新，而这个接口客户端会以5s间隔轮询，为了减少tomcat的压力，我们配置了nginx缓存。配置如下</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\"><img class=\"alignnone size-full wp-image-112231\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\" alt=\"p4\"></a></p>\n<p>其中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adef52af025946813791\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nproxy_cache_methods： 用来设置HTTP哪些方法会被缓存，直播间接口配置了GET、HEAD、POST；\r\nproxy_cache_valid:    用来设置对不同HTTP状态码的不同缓存时间。直播间接口配置了对于 返回值为200的状态码，缓存5秒；\r\nproxy_cache_min_uses: 用来设置多少次访问后，应答值会被缓存，配置为3次；\r\nproxy_cache_key:      设置Web缓存的key\r\nproxy_cache:          用来设置哪个缓存区将被使用，并定义缓存区的名称\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adef52af025946813791-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af025946813791-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af025946813791-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af025946813791-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adef52af025946813791-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adef52af025946813791-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adef52af025946813791-1\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-sy\">_</span>methods：<span class=\"crayon-h\"> </span>用来设置<span class=\"crayon-i\">HTTP</span>哪些方法会被缓存，直播间接口配置了<span class=\"crayon-i\">GET</span>、<span class=\"crayon-i\">HEAD</span>、<span class=\"crayon-i\">POST</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af025946813791-2\"><span class=\"crayon-v\">proxy_cache_valid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span>用来设置对不同<span class=\"crayon-i\">HTTP</span>状态码的不同缓存时间。直播间接口配置了对于<span class=\"crayon-h\"> </span>返回值为<span class=\"crayon-cn\">200</span>的状态码，缓存<span class=\"crayon-cn\">5</span>秒；</div><div class=\"crayon-line\" id=\"crayon-59adef52af025946813791-3\"><span class=\"crayon-v\">proxy_cache_min_uses</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>用来设置多少次访问后，应答值会被缓存，配置为<span class=\"crayon-cn\">3</span>次；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af025946813791-4\"><span class=\"crayon-v\">proxy_cache_key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span>设置<span class=\"crayon-i\">Web</span>缓存的<span class=\"crayon-e\">key</span></div><div class=\"crayon-line\" id=\"crayon-59adef52af025946813791-5\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span>用来设置哪个缓存区将被使用，并定义缓存区的名称</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adef52af025946813791-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>通过上述配置，我们可以看到 proxy_cache_key 配置中，只配置了host + uri + 参数，但没有配置协议，所以无论用http访问，还是https访问，只要被缓存后，返回的内容都是一样的，而不会区分http或https。从而引起了跨域问题。<br>\n至此，问题分析完毕。</p>\n<h3 id=\"3-问题解决\">3. 问题解决</h3>\n<p>跟运维同学沟通后，通过修改nginx配置，将协议类型scheme加入到缓存查找的判断参数中，配置如下。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\"><img class=\"alignnone size-full wp-image-112230\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\" alt=\"p5\"></a></p>\n<p>问题得到了解决。</p>\n<h1 id=\"4-总结\">4. 总结</h1>\n<p>上述“惨案” ，是 跨域、nginx缓存、http/https协议 这三种条件同时出现引发的。<br>\n如果不涉及跨域，混用 http/https协议 + nginx缓存，其实也是没有问题的。但是一旦出现了跨域使用，必须 在nginx 缓存配置中，配置 scheme + host + uri +　参数。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112224\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112224votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112224\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Nginx,数据库", "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg"}
{"url_object_id": "69121d473d20cb45ed412306e1883d3f", "title": "10小时到10分钟，一步步优化巨量关键词的匹配", "create_time": "2017/07/19", "url": "http://blog.jobbole.com/111934/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/zhenbianshu/p/7197349.html\">枕边书</a>   </div><div>\n<h2 id=\"toc_0\">问题由来</h2>\n<p>前些天工作中遇到一个问题：</p>\n<blockquote><p>有 60万 条短消息记录日志，每条约 50 字，5万 关键词，长度 2-8 字，绝大部分为中文。要求将这 60万 条记录中包含的关键词全部提取出来并统计各关键词的命中次数。</p></blockquote>\n<p>本文完整介绍了我的实现方式，看我如何将需要运行十小时的任务优化到十分钟以内。虽然实现语言是 PHP，但本文介绍的更多的思想，应该能给大家一些帮助。</p>\n<h2 id=\"toc_1\">原始 – grep</h2>\n<h3 id=\"toc_2\">设计</h3>\n<p>一开始接到任务的时候，我的小心思立刻转了起来，<strong>日志 + 关键词 + 统计</strong>，我没有想到自己写代码实现，而是首先想到了 linux 下常用的日志统计命令 <span style=\"color: #ff0000;\"><code>grep</code></span>。</p>\n<p><span style=\"color: #ff0000;\"><code>grep</code></span>命令的用法不再多提，使用 <span style=\"color: #ff0000;\"><code>grep 'keyword' | wc -l</code></span> 可以很方便地进行统计关键词命中的信息条数，而php的 <span style=\"color: #ff0000;\"><code>exec()</code></span> 函数允许我们直接调用 linux 的 shell 命令，虽然这样执行危险命令时会有安全隐患。</p>\n<h3 id=\"toc_3\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf01493206537899573\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nforeach ($word_list as $keyword) {\r\n    $count = intval(exec(\"grep '{$keyword}' file.log | wc -l\"));\r\n    record($keyword, $count);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf01493206537899573-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493206537899573-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493206537899573-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493206537899573-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf01493206537899573-1\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">word_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493206537899573-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"grep '{$keyword}' file.log | wc -l\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493206537899573-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493206537899573-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在一台老机器上跑的，话说老机器效率真的差，跑了6小时。估计最新机器2-3小时吧，后面的优化都使用的新机器，而且需求又有变动，正文才刚刚开始。</p>\n<p><em>原始，原始在想法和方法</em>。</p>\n<h2 id=\"toc_4\">进化 – 正则</h2>\n<h3 id=\"toc_5\">设计</h3>\n<p>交了差之后，第二天产品又提出了新的想法，说以后想把某数据源接入进来，消息以数据流的形式传递，而不再是文件了。而且还要求了消息统计的实时性，一下把我想把数据写到文件再统计的想法也推翻了，为了方案的可扩展性，现在的统计对象不再是一个整体，而是要考虑拿n个单条的消息来匹配了。</p>\n<p>这时，略懵的我只好祭出了最传统的工具- 正则。正则的实现也不难，各个语言也都封装好了正则匹配函数，重点是模式(pattern)的构建。</p>\n<p>当然这里的模式构建也不难，<span style=\"color: #ff0000;\"><code>/keyword1|keword2|.../</code></span>，用<span style=\"color: #ff0000;\"><code>|</code></span>将关键词连接起来即可。</p>\n<h3 id=\"toc_6\">正则小坑</h3>\n<p>这里介绍两个使用中遇到的小坑：</p>\n<ul>\n<li>正则模式长度太长导致匹配失败：PHP 的正则有回溯限制，以防止消耗掉所有的进程可用堆栈, 最终导致 php 崩溃。太长的模式会导致 PHP 检测到回溯过多，中断匹配，经测试默认设置时最大模式长度为 32000 字节 左右。php.ini 内 <span style=\"color: #ff0000;\"><code>pcre.backtrack_limit</code></span> 参数为最大回溯次数限制，默认值为 1000000，修改或 <span style=\"color: #ff0000;\"><code>php.ini</code></span> 或在脚本开始时使用 <span style=\"color: #ff0000;\"><code>ini_set(‘pcre.backtrack_limit’, n);</code></span> 将其设置为一个较大的数可以提高单次匹配最大模式长度。当然也可以将关键词分批统计（我用了这个=_=）。</li>\n<li>模式中含有特殊字符导致大量warning：匹配过程中发现 PHP 报出大量 warning：<span style=\"color: #ff0000;\"><code>unknown modifier <strong>乱码</strong></code></span>，仔细检查发现关键词中有<span style=\"color: #ff0000;\"><code>/</code></span>字符，可以使用<span style=\"color: #ff0000;\"><code>preg_quote()</code></span>函数过滤一遍关键词即可。</li>\n</ul>\n<h3 id=\"toc_7\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf01493216054185710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$end = 0;\r\n$step = 1500;\r\n$pattern = array();\r\n// 先将pattern 拆成多个小块\r\nwhile ($end &lt; count($word_list)) {\r\n    $tmp_arr = array_slice($word_list, $end, $step);\r\n    $end += $step;\r\n    $item = implode('|', $tmp_arr);\r\n    $pattern[] = preg_quote($item);\r\n}\r\n\r\n$content = file_get_contents($log_file);\r\n$lines = explode(\"\\n\", $content);\r\nforeach ($lines as $line) {\r\n    // 使用各小块pattern分别匹配\r\n    for ($i = 0; $i &lt; count($pattern); $i++) {\r\n        preg_match_all(\"/{$pattern[$i]}/\", $line, $match);\r\n    }\r\n    $match = array_unique(array_filter($match));\r\n    dealResult($match);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493216054185710-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493216054185710-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-4\"><span class=\"crayon-c\">// 先将pattern 拆成多个小块</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'|'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_quote</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">log_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-14\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">lines </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 使用各小块pattern分别匹配</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">preg_match_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{$pattern[$i]}/\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_unique</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493216054185710-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dealResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493216054185710-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>为了完成任务，硬着头皮进程跑了一夜。当第二天我发现跑了近十个小时的时候内心是崩溃的。。。太慢了，完全达不到使用要求，这时，我已经开始考虑改换方法了。</p>\n<p>当产品又改换了关键词策略，替换了一些关键词，要求重新运行一遍，并表示还会继续优化关键词时，我完全否定了现有方案。绝对不能用关键词去匹配信息，这样一条一条用全部关键词去匹配，效率实在是不可忍受。</p>\n<p><em>进化，需求和实现的进化</em></p>\n<h2 id=\"toc_8\">觉醒 – 拆词</h2>\n<h3 id=\"toc_9\">设计</h3>\n<p>我终于开始意识到要拿信息去关键词里对比。如果我用关键词为键建立一个 hash 表，用信息里的词去 hash 表里查找，如果查到就认为匹配命中，这样不是能达到 O(1) 的效率了么？</p>\n<p>可是一条短消息，我如何把它拆分为刚好的词去匹配呢，分词？分词也是需要时间的，而且我的关键词都是些无语义的词，构建词库、使用分词工具又是很大的问题，最终我想到 <span style=\"color: #ff0000;\"><code>拆词</code></span>。</p>\n<p>为什么叫拆词呢，我考虑以蛮力将一句话拆分为<span style=\"color: #ff0000;\"><code><strong>所有可能</strong>的</code></span>词。如（<strong><span style=\"color: #ff0000;\"><code>我是好人）</code></span></strong>就可以拆成（<strong><span style=\"color: #ff0000;\"><code>我是、是好、好人、我是好、是好人、我是好人）</code></span></strong>等词，我的关键词长度为 2-8，所以可拆词个数会随着句子长度迅速增加。不过，可以用标点符号、空格、语气词（如<span style=\"color: #ff0000;\"><code>的、是</code></span>等）作为分隔将句子拆成小短语再进行拆词，会大大减少拆出的词量。</p>\n<p>其实分词并没有完整实现就被后一个方法替代了，只是一个极具实现可能的构想，写这篇文章时用伪代码实现了一下，供大家参考，即使不用在匹配关键词，用在其他地方也是有可能的。</p>\n<h3>代码</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf01493221098119161\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$str_list = getStrList($msg);\r\nforeach ($str_list as $str) {\r\n    $keywords = getKeywords($str);\r\n    foreach ($keywords as $keyword) {\r\n        // 直接通过PHP数组的哈希实现来进行快速查找\r\n        if (isset($word_list[$keyword])) {\r\n            record($keyword);\r\n        }\r\n    }\r\n}\r\n/**\r\n * 从消息中拆出短句子\r\n */\r\nfunction getStrList($msg) {\r\n    $str_list = array();\r\n    $seperators = array('，', '。', '的', ...);\r\n\r\n    $words = preg_split('/(?&lt;!^)(?!$)/u', $msg);\r\n    $str = array();\r\n    foreach ($words as $word) {\r\n        if (in_array($word, $seperators)) {\r\n            $str_list[] = $str;\r\n            $str = array();\r\n        } else {\r\n            $str[] = $word;\r\n        }\r\n    }\r\n\r\n    return array_filter($str_list);\r\n}\r\n\r\n/**\r\n * 从短句中取出各个词\r\n */\r\nfunction getKeywords($str) {\r\n    if (count($str) &lt; 2) {\r\n        return array();\r\n    }\r\n\r\n    $keywords = array();\r\n    for ($i = 0; $i &lt; count($str); $i++) {\r\n        for ($j = 2; $j &lt; 9; $j++) {\r\n            $keywords[] = array_slice($str, $i, $j); // todo 限制一下不要超过数组最大长度\r\n        }\r\n    }\r\n\r\n    return $keywords;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493221098119161-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493221098119161-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-2\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">str_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">keywords </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 直接通过PHP数组的哈希实现来进行快速查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-11\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-12\"><span class=\"crayon-c\"> * 从消息中拆出短句子</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-13\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-14\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'，'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'。'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'的'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/(?&lt;!^)(?!$)/u'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-28\"> </div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-32\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-33\"><span class=\"crayon-c\"> * 从短句中取出各个词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-34\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-35\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// todo 限制一下不要超过数组最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-46\"> </div><div class=\"crayon-line\" id=\"crayon-59adf01493221098119161-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493221098119161-48\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0068 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">结果</h3>\n<p>我们知道一个 <span style=\"color: #ff0000;\"><code>utf-8</code></span> 的中文字符要占用三个字节，为了拆分出包含中英文的每一个字符，使用简单的 <span style=\"color: #ff0000;\"><code>split()</code></span> 函数是做不到的。</p>\n<p>这里使用了 <span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>preg_split('/(?&lt;!^)(?!$)/u', $msg)</code></span></span> 是通过正则匹配到两个字符之间的<span style=\"color: #ff0000;\"><code>''</code></span>来将两个字符拆散，而两个括号里的 <span style=\"color: #ff0000;\"><code>(?&lt;!^)(?!$)</code></span> 是分别用来限定捕获组不是第一个，也不是最后一个（不使用这两个捕获组限定符也是可以的，直接使用<span style=\"color: #ff0000;\"><code>//</code></span>作为模式会导致拆分结果在前后各多出一个空字符串项）。  捕获组的概念和用法可见我之前的博客 <a href=\"http://www.cnblogs.com/zhenbianshu/p/4941964.html\">PHP正则中的捕获组与非捕获组</a></p>\n<p>由于没有真正实现，也不知道效率如何。估算每个短句长度约为 10 字左右时，每条短消息约50字左右，会拆出 200 个词。虽然它会拆出很多无意义的词，但我相信效率绝不会低，由于其 hash 的高效率，甚至我觉得会可能比终极方法效率要高。</p>\n<p>最终没有使用此方案是因为它对句子要求较高，拆词时的分隔符也不好确定，最重要的是它不够优雅。。。这个方法我不太想去实现，统计标识和语气词等活显得略为笨重，而且感觉拆出很多无意义的词感觉效率浪费得厉害。</p>\n<p><em>觉醒，意识和思路的觉醒</em></p>\n<h2 id=\"toc_12\">终级 – Trie树</h2>\n<h3 id=\"toc_13\">trie树</h3>\n<p>于是我又来找谷哥帮忙了，搜索大量数据匹配，有人提出了 使用 trie 树的方式，没想到刚学习的 trie 树的就派上了用场。我上上篇文章刚介绍了 trie 树，在<a href=\"http://www.cnblogs.com/zhenbianshu/p/7061550.html\">空间索引 – 四叉树</a> 里<span style=\"color: #ff0000;\"><code>字典树</code></span>这一小节，大家可以查看一下。</p>\n<p>当然也为懒人复制了一遍我当时的解释(看过的可以跳过这一小节了)。</p>\n<blockquote><p>字典树，又称前缀树或 trie 树，是一种有序树，用于保存关联数组，其中的键通常是字符串。与二叉查找树不同，键不是直接保存在节点中，而是由节点在树中的位置决定。一个节点的所有子孙都有相同的前缀，也就是这个节点对应的字符串，而根节点对应空字符串。</p></blockquote>\n<p>我们可以类比字典的特性：我们在字典里通过拼音查找晃(<span style=\"color: #ff0000;\"><code>huang</code></span>)这个字的时候，我们会发现它的附近都是读音为<span style=\"color: #ff0000;\"><code>huang</code></span>的，可能是声调有区别，再往前翻，我们会看到读音前缀为<span style=\"color: #ff0000;\"><code>huan</code></span>的字，再往前，是读音前缀为<span style=\"color: #ff0000;\"><code>hua</code></span>的字… 取它们的读音前缀分别为 <span style=\"color: #ff0000;\"><code>h qu hua huan huang</code></span>。我们在查找时，根据 <span style=\"color: #ff0000;\"><code>abc...xyz</code></span> 的顺序找到<span style=\"color: #ff0000;\"><code>h</code></span>前缀的部分，再根据 <span style=\"color: #ff0000;\"><code>ha he hu</code></span>找到 <span style=\"color: #ff0000;\"><code>hu</code></span> 前缀的部分…最后找到 <span style=\"color: #ff0000;\"><code>huang</code></span>，我们会发现，越往后其读音前缀越长，查找也越精确，这种类似于字典的树结构就是字典树，也是前缀树。</p>\n<h2 id=\"toc_14\">设计</h2>\n<p>那么 trie 树怎么实现关键字的匹配呢? 这里以一幅图来讲解 trie 树匹配的过程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\"><img class=\"aligncenter wp-image-111935 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\" alt=\"1\" width=\"396\" height=\"493\"></a></p>\n<p>其中要点：</p>\n<h4 id=\"toc_15\">构造trie树</h4>\n<ol>\n<li>将关键词用上面介绍的<span style=\"color: #ff0000;\"><code>preg_split()</code></span>函数拆分为单个字符。如<span style=\"color: #ff0000;\"><code>科学家</code></span>就拆分为<span style=\"color: #ff0000;\"><code>科、学、家</code></span>三个字符。</li>\n<li>在最后一个字符后添加一个特殊字符<span style=\"color: #ff0000;\"><code>`</code></span>，此字符作为一个关键词的结尾（图中的粉红三角），以此字符来标识查到了一个关键词（不然，我们不知道匹配到<span style=\"color: #ff0000;\"><code>科、学</code></span>两个字符时算不算匹配成功）。</li>\n<li>检查根部是否有第一个字符(<span style=\"font-family: Monaco, Consolas, 'Andale Mono', 'DejaVu Sans Mono', monospace;\">科</span>)节点，如果有了此节点，到<code style=\"font-weight: bold;\">步骤4</code>。 如果还没有，在根部添加值为<code style=\"font-weight: bold;\">科</code>的节点。</li>\n<li>依次检查并添加<span style=\"color: #ff0000;\"><code>学、家</code></span> 两个节点。</li>\n<li>在结尾添加 <span style=\"color: #ff0000;\"><code>`</code></span> 节点，并继续下一个关键词的插入。</li>\n</ol>\n<h4 id=\"toc_16\">匹配</h4>\n<p>然后我们以 <span style=\"color: #ff0000;\"><code><strong>这位科学家很了不起</strong>！</code></span>为例来发起匹配。</p>\n<ul>\n<li>首先我们将句子拆分为单个字符 <strong><span style=\"color: #ff0000;\"><code>这、位</code></span><span style=\"color: #ff0000;\"><code>、...</code></span>；</strong></li>\n<li>从根查询第一个字符<span style=\"color: #ff0000;\"><code>这</code></span>，并没有以这个字符开头的关键词，将字符“指针”向后移，直到找到根下有的字符节点<strong><span style=\"color: #ff0000;\"><code>科</code></span></strong>;</li>\n<li>接着在节点<span style=\"color: #ff0000;\"><code>科</code></span>下寻找值为 <strong><span style=\"color: #ff0000;\"><code>学</code></span></strong>节点，找到时，结果子树的深度已经到了2，关键词的最短长度是2，此时需要在<span style=\"color: #ff0000;\"><code>学</code></span>结点下查找是否有<span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>`</code></span></span>，找到意味着匹配成功，返回关键词，并将字符“指针”后移，如果找不到则继续在此结点下寻找下一个字符。</li>\n<li>如此遍历，直到最后，返回所有匹配结果。</li>\n</ul>\n<h3 id=\"toc_17\">代码</h3>\n<p>完整代码我已经放到了GitHub上：<a href=\"https://github.com/zhenbianshu/DataStructureAndAlgorithm/blob/master/keyword_match_trie.php\">Trie-GitHub-zhenbianshu</a>，这里放上核心。</p>\n<p>首先是数据结构树结点的设计，当然它也是重中之重：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0149322f294702486\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$node = array(\r\n    'depth' =&gt; $depth, // 深度，用以判断已命中的字数\r\n    'next' =&gt; array(\r\n        $val =&gt; $node, // 这里借用php数组的哈希底层实现，加速子结点的查找\r\n        ...\r\n    ),\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0149322f294702486-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149322f294702486-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149322f294702486-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149322f294702486-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149322f294702486-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149322f294702486-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149322f294702486-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0149322f294702486-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149322f294702486-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 深度，用以判断已命中的字数</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149322f294702486-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149322f294702486-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 这里借用php数组的哈希底层实现，加速子结点的查找</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149322f294702486-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149322f294702486-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149322f294702486-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>然后是树构建时子结点的插入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf01493236697219605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里要往节点内插入子节点，所以将它以引用方式传入\r\nprivate function insert(&amp;$node, $words) {\r\n         if (empty($words)) {\r\n            return;\r\n        }\r\n        $word = array_shift($words);\r\n        // 如果子结点已存在，向子结点内继续插入\r\n        if (isset($node['next'][$word])) {\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        } else {\r\n            // 子结点不存在时，构造子结点插入结果\r\n            $tmp_node = array(\r\n                'depth' =&gt; $node['depth'] + 1,\r\n                'next' =&gt; array(),\r\n            );\r\n            $node['next'][$word] = $tmp_node;\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf01493236697219605-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf01493236697219605-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-1\"><span class=\"crayon-c\">// 这里要往节点内插入子节点，所以将它以引用方式传入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果子结点已存在，向子结点内继续插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 子结点不存在时，构造子结点插入结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf01493236697219605-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf01493236697219605-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>最后是查询时的操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0149323e809327591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched\r\nprivate function query($node, $words, &amp;$matched) {\r\n        $word = array_shift($words);\r\n        if (isset($node['next'][$word])) {\r\n            // 如果存在对应子结点，将它放到结果集里\r\n            array_push($matched, $word);\r\n            // 深度到达最短关键词时，即可判断是否到词尾了\r\n            if ($node['next'] &gt; 1 &amp;&amp; isset($node['next'][$word]['next']['`'])) {\r\n                return true;\r\n            }\r\n            return $this-&gt;query($node['next'][$word], $words, $matched);\r\n        } else {\r\n            $matched = array();\r\n            return false;\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf0149323e809327591-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0149323e809327591-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-1\"><span class=\"crayon-c\">// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果存在对应子结点，将它放到结果集里</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">array_push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 深度到达最短关键词时，即可判断是否到词尾了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'`'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0149323e809327591-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0149323e809327591-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<h3 id=\"toc_18\">结果</h3>\n<p>结果当然是喜人的，如此匹配，处理一千条数据只需要3秒左右。找了 Java 的同事试了下，Java 处理一千条数据只需要1秒。</p>\n<p>这里来分析一下为什么这种方法这么快：</p>\n<ul>\n<li>正则匹配：要用所有的关键词去信息里匹配匹配次数是 <span style=\"color: #ff0000;\"><code>key_len * msg_len</code></span>，当然正则会进行优化，但基础这样，再优化效率可想而知。</li>\n<li>而 trie 树效率最差的时候是<strong> <span style=\"color: #ff0000;\"><code>msg_len * 9(最长关键词长度 + 1个特殊字符)</code></span>次 hash</strong> 查找，即最长关键词类似 <span style=\"color: #ff0000;\"><code>AAA</code></span>，信息内容为 <span style=\"color: #ff0000;\"><code>AAA...</code></span>时，而这种情况的概率可想而知。</li>\n</ul>\n<p>至此方法的优化到此结束，从每秒钟匹配 10 个，到 300 个，30 倍的性能提升还是巨大的。</p>\n<p><em>终级，却不一定是终极</em></p>\n<h2 id=\"toc_19\">他径 – 多进程</h2>\n<h3 id=\"toc_20\">设计</h3>\n<p>匹配方法的优化结束了，开头说的优化到十分钟以内的目标还没有实现，这时候就要考虑一些其他方法了。</p>\n<p>我们一提到高效，必然想到的是 <span style=\"color: #ff0000;\"><code>并发</code></span>，那么接下来的优化就要从并发说起。PHP 是单线程的（虽然也有不好用的多线程扩展），这没啥好的解决办法，并发方向只好从多进程进行了。</p>\n<p>那么一个日志文件，用多个进程怎么读呢？这里当然也提供几个方案：</p>\n<ul>\n<li>进程内添加日志行数计数器，各个进程支持传入参数 n，进程只处理第 行数<span style=\"color: #ff0000;\"><code> % n = n</code></span> 的日志，这种 hack 的反向分布式我已经用得很熟练了，哈哈。这种方法需要进程传参数，还需要每个进程都分配读取整个日志的的内存，而且也不够优雅。</li>\n<li>使用 linux 的 <span style=\"color: #ff0000;\"><code>split -l n file.log output_pre</code></span> 命令，将文件分割为每份为 n 行的文件，然后用多个进程去读取多个文件。此方法的缺点就是不灵活，想换一下进程数时需要重新切分文件。</li>\n<li>使用 Redis 的 list 队列临时存储日志，开启多个进程消费队列。此方法需要另外向 Redis 内写入数据，多了一个步骤，但它扩展灵活，而且代码简单优雅。</li>\n</ul>\n<p>最终使用了第三种方式来进行。</p>\n<h3 id=\"toc_21\">结果</h3>\n<p>这种方式虽然也会有瓶颈，最后应该会落在 Redis 的网络 IO 上。我也没有闲心开 n 个进程去挑战公司 Redis 的性能，运行 10 个进程三四分钟就完成了统计。即使再加上 Redis 写入的耗时，10分钟以内也妥妥的。</p>\n<p>一开始产品对匹配速度已经有了小时级的定位了，当我 10 分钟就拿出了新的日志匹配结果，看到产品惊讶的表情，心里也是略爽的，哈哈~</p>\n<p><em>他径，也能帮你走得更远</em></p>\n<h2 id=\"toc_22\">总结</h2>\n<p>解决问题的方法有很多种，我认为在解决各种问题之前，要了解很多种知识，即使只知道它的作用。就像一个工具架，你要先把工具尽量摆得多，才能在遇到问题时选取一个最合适的。接着当然要把这些工具用是纯熟了，这样才能使用它们去解决一些怪异问题。</p>\n<p>工欲善其事，必先利其器，要想解决性能问题，掌握系统级的方法还略显不够，有时候换一种数据结构或算法，效果可能会更好。感觉自己在这方面还略显薄弱，慢慢加强吧，各位也共勉。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111934\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111934votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111934\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,php,正则表达式", "front_image_path": "full/d91c8c6ea6d894ebf725cdccfda0bccf6f675e36.jpg"}
{"url_object_id": "a91e0b50334a75b7a782e2c16dff83d3", "title": "代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？", "create_time": "2017/07/18", "url": "http://blog.jobbole.com/111892/", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg"], "praise_num": "2", "comment_num": 5, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>问：代码写的好，出过畅销书，并且还拿过赛车冠军，这是一种什么体验？</p>\n<p>答：这事得问 DHH。什么？你不知道 DHH 是哪个程序员，那你更得看看这篇文章了。😀</p>\n<p>（ps：以前伯乐在线扩散《<a href=\"http://blog.jobbole.com/110811/\" target=\"_blank\">我是小有成就，但我过不了白板面试</a>》这篇文章时，曾有读者问 DHH 是何许人也。）</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhnu0fdsm9j20dw09bgos.jpg\"></p>\n<p>DHH 是一个丹麦程序员，全名是 David Heinemeier Hansson，DHH 是他的全名首字母缩写，也是他常用的网名。1979 年 10 月 15 日出生在哥本哈根。</p>\n<h3>Ruby On Rails 的诞生</h3>\n<p>1999 年，20 岁的 DHH 成立了一个丹麦语的游戏资讯和社区网站 Daily Rush，一直运营到 2001 年。</p>\n<p>后来因其 PHP 编程能力，吸引到 37signals 联合创始人 Jason Fried 的注意，后被 Jason 招入37signals 开发一个在线版的项目管理工具。该工具也就是后来 37signals 的 SasS 产品 Basecamp。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fhnuqwp1i0j21kw0w0ajk.jpg\" width=\"601\" height=\"338\"></p>\n<p style=\"text-align: center;\">（图：37signals 联合创始人 Jason Fried）</p>\n<p>为了加速 Basecamp 开发，DHH 用 Ruby 开发了一个框架，即 Ruby On Rails。2004 年 7 月，DHH 把 Rails 从 Basecamp 中剥离出来，并且开源。Rails 初期并没有开放 commit 权限，2005 年 2 月才向外开放。</p>\n<p>因其 Rails 的贡献，DHH 获得 Google 和 O’Reilly 联合颁发的「2005 年度最佳 Hacker」奖。</p>\n<p>2006 年 8 月，Rails 迎来一个重要里程碑，苹果公司宣布 Mac OS X v10.5 Leopard 预装 Rails 框架。</p>\n<p>2007 年，DHH 注册了 3 个商标：RUBY ON RAILS 短语、RAILS 以及 Rails 官方标志。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fhnw217rahj20go0gogm2.jpg\" width=\"300\" height=\"300\"></p>\n<p>Rails 的（企业）用户很多，包括 GitHub、Shopify、 Airbnb 和 Square 等。</p>\n<h3>移居美国</h3>\n<p>2005 年，DHH 从哥本哈根商学院毕业，拿到计算机科学和企业管理双学位。同年 11 月，从丹麦移居到美国芝加哥。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhns0wk3zrj20jb0avt9s.jpg\" width=\"601\" height=\"338\"></p>\n<p>DHH 后来成为了 37signals 的联合创始人兼 CTO。</p>\n<p>37signals 公司在 2014 年更名为 Basecamp。</p>\n<h3>写书</h3>\n<p>DHH 和 Jason 合著了 3 本畅销书：</p>\n<p>2006 年的《<a href=\"http://gettingreal.37signals.com/\" target=\"_blank\">Getting Real</a>》，2010 年的《Rework》，和 2013 年的《Remote》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho1d0td36j20im0cewg8.jpg\" width=\"601\" height=\"400\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho1d0b23lj20ic0cqt9o.jpg\" width=\"601\" height=\"417\"></p>\n<h3>赛车</h3>\n<p>DHH 有两大业余爱好：赛车和摄影。</p>\n<p>从 2013 年到 2017 年，连续 5 年参加国际汽联世界耐力锦标赛（FIA WEC）。2014 年，在「勒芒 24 小时耐力赛」个人排名 82 位。他所在车队赢得 GTE-AM 组的冠军。</p>\n<p>补充介绍：</p>\n<blockquote><p>勒芒 24 小时耐力赛：3 位车手为一个车组，驾驶一台赛车，完成连续 24 个小时的竞赛。它和世界一级方程式锦标赛(F1)、世界汽车拉力锦标赛(WRC)，并称为世界最著名和最艰苦的三大汽车赛事。</p>\n<p>勒芒耐力赛分 4 个组别：LMP1、LMP2、GTE-PRO，GTE-AM。</p>\n<p>GTE-AM：允许封闭座舱以及开放式座舱，2车门，2或2+2坐席，所使用的赛车为市面上可以够买到的量产车改装而成，但赛车车龄必须大于 12 个月，每辆车内必须包含有业余车手。</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg\" width=\"600\" height=\"390\"></p>\n<blockquote><p>注意 DHH 的赛车服，前胸的 Basecamp.com、脖颈的 Basecamp.com 和 logo，还有左臂的 37signals logo，开车还不忘给自家公司做宣传。´</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p>五年来，DHH 参加 FIA WEC 36 场比赛，16 次上领奖台，赢过 6 次分站冠军，2 次锦标赛亚军，1 次锦标赛冠军。</p>\n<p>5 次参加勒芒耐力赛（无退赛），3 次上领奖台，获得 1 次冠军。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho726yopzj21kw1kwqow.jpg\" width=\"640\" height=\"640\"></p>\n<p style=\"text-align: center;\">（DHH 参加比赛的车）</p>\n<h3>摄影</h3>\n<p>除了赛车，DHH 还有一大爱好 —— 摄影。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3eotjxrj20hs0bvadi.jpg\" width=\"640\" height=\"427\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3es3f93j20hs0bwjv1.jpg\" width=\"640\" height=\"428\"></p>\n<p>DHH 已婚，妻子 Jamie。他们有 2 个儿子：Colt 和 Dash。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fho7266uh9j20m80m81i9.jpg\" width=\"690\" height=\"690\"></p>\n<p>DHH 一家四口的时间，主要在芝加哥、加州的马里布，西班牙的马贝拉之间切换度过。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111892\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111892votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111892\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 249</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "职场,DHH", "front_image_path": "full/0f76dcd24f8a5d0095b676d974e274b9e9914d81.jpg"}
{"url_object_id": "b727b9066b0e290ea3a28731fb346c13", "title": "走近比特币：一个故事看懂“区块链”", "create_time": "2017/07/10", "url": "http://blog.jobbole.com/111768/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png"], "praise_num": "4", "comment_num": 1, "fav_num": 14, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://thenextweb.com/contributors/2017/07/04/ultimate-3500-word-plain-english-guide-blockchain/#.tnw_M8YLXnfv\">Mohit Mamoria</a>   译文出处：<a target=\"_blank\" href=\"http://www.4hou.com/info/news/6152.html\">赛博朔方</a>   </div><p>区块链是比特币的底层技术和基础架构，本质上是一个去中心化的数据库。区块链是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一次比特币网络交易的信息，用于验证其信息的有效性（防伪）并生成下一个区块。</p>\n<p>狭义来讲，区块链是一种按照时间顺序将数据区块以顺序相连的方式组合成的一 种链式数据结构， 并以密码学方式保证的不可篡改和不可伪造的分布式账本。</p>\n<p>以上定义摘自百度百科。很多菜鸟朋友看完这段解释依然满脸懵逼，到底什么是“区块链”？</p>\n<p><strong>起因</strong></p>\n<p>除非你完全没有接触过信息安全，否则一定听说过比特币和区块链。毕竟这两个名词也是近两年来各大国内外媒体争相报道的热词。尤其是继今年5月爆发的WannaCry病毒爆发以后，很多从未接触过的人都开始加入讨论大军。</p>\n<p>我的很多朋友都不懂技术。最近几周他们一个个都变身好奇宝宝，围着我问比特币和区块链。我想这两个名词的热度一定还会持续攀高，对他们不够了解的人也还有很多很多。何不采用通俗的语言对“区块链”做一个解释，把这个概念传播开来？</p>\n<p>和网上一般的名词解释不同（不管三七二十一，下个定义再说，其实并没有什么卵用），我们以它的作用为切入点来理解区块链的工作机制。</p>\n<p><strong>故事的开端</strong></p>\n<p>Joe是你最好的朋友。他出国旅游后的第五天给你打了个电话：“兄弟，我需要点钱，出国之后把身上的钱都花完了。”</p>\n<p>你回复：“我马上打过来”，然后挂了电话。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\"><img class=\"aligncenter wp-image-111770 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>接着你又打电话给你的银行客户经理：“麻烦你马上从我的账户转1000美元给Joe。”</p>\n<p>客户经理：“好的，明白。”</p>\n<p>客户经理随后确认了你的账户是否有足够的余额。因为你是百万富翁，所以客户经理进行了如下的操作：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\"><img class=\"aligncenter wp-image-111771 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>交易账单</p>\n<p>你打电话给Joe说你已经把1000美元转过去了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\"><img class=\"aligncenter wp-image-111772 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>回头我们再来看看刚刚到底发生了什么。你和Joe都信任那家银行来管理你们各自的财产。整个过程中实际并没有真实货币的物理流动。整个过程只涉及录入系统的两个账户即可。更准确地说，全程只需主动权属于该银行的两个账户就可以完成。</p>\n<p>在这样传统的货币体系中，我的问题就来了。</p>\n<p>交易双方的信任机制建立需要借助第三方。这种“中间人”的方式由来已久。那么你可能又要问了：“这种信任机制有什么问题吗？”问题在于除交易双方以外的“监督者”只是单个个体。这种情况可能存在以下风险：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d562ce9319914359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。\r\n如果记录了某个交易的注册表遭遇火灾怎么办？\r\n万一你的客户经理不小心划了1500美元到你朋友的账户怎么办？\r\n如果他是故意这么做的呢？</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d562ce9319914359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d562ce9319914359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d562ce9319914359-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d562ce9319914359-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d562ce9319914359-1\">如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d562ce9319914359-2\">如果记录了某个交易的注册表遭遇火灾怎么办？</div><div class=\"crayon-line\" id=\"crayon-59adf6d562ce9319914359-3\">万一你的客户经理不小心划了<span class=\"crayon-cn\">1500</span>美元到你朋友的账户怎么办？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d562ce9319914359-4\">如果他是故意这么做的呢？</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>世界上有没有无需借助银行就能帮助我们完成安全转账的系统？</p>\n<p>要想解决这个问题，我们首先应该静下心来好好思考，问自己一个更深层次的问题：我们能不能自己掌握账户和历史交易的信息呢？</p>\n<p>这的确是一个值得探讨的问题。答案当然你一定也已经猜到了——那就是“区块链”。现在我们就开始学习这个分布式账本是如何运作的。</p>\n<p><strong>故事的发展</strong></p>\n<p>该方法得以实行的必要条件是必须有足够多的人愿意在交易时不依赖于第三方。只有这样，这一部分的人才能够自己掌控账本资料。</p>\n<p>那么人数要达到多少才足够呢？在下面的例子中，我们假设有10个人愿意放弃银行或其它任何第三方机构。在双方达成协议的前提下，他们互相之间能够在不知道对方身份的情况下时刻掌握对方账户的一切信息和动态。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\"><img class=\"aligncenter wp-image-111773 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>1. 一个空文件夹</p>\n<p>一开始每个人都会获得一个空文件夹。随着时间推进，这十个人都会在他们现在空的文件夹里不断添加记录交易信息的纸张。</p>\n<p>2. 交易发生时</p>\n<p>接下来，这个交易网络中的每个人都带着纸和笔坐下来，准备记录下在这个系统中发生的每一笔交易。</p>\n<p>假设，2号想给9号10美元。</p>\n<p>为了完成这笔交易，2号大声地告诉每个人：“我要转10美元给9号。请大家都在自己的纸上记下来。”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\"><img class=\"aligncenter wp-image-111774 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>然后每个人都检查确认2号是不是有10美元及以上的余额能够转给9。如2号余额足够，那么大家都在空白纸上记录下这笔交易。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\"><img class=\"aligncenter wp-image-111775 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>纸上的第一笔交易</p>\n<p>这笔交易这样就算完成了。</p>\n<p>3. 持续发生的交易</p>\n<p>随着时间的流逝，这个交易网络中出现交易需求的人越来越多。无论何时他们产生交易需求，都会通知网络中的每个人。只要有人听到了这个通知，他/她就会在他们各自的纸上记录下来。</p>\n<p>这个过程会持续进行，直到这张纸上的空间不足。假设每张纸只能记录10次交易，那么只要第10次交易完成，每个人纸上的空间也就随之耗尽。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\"><img class=\"aligncenter wp-image-111776 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>当白纸被填满</p>\n<p>这时候我们就需要把这张纸放进文件夹并拿出另一张新的白纸，重复上面步骤2的过程。</p>\n<p>4. 把纸张放进文件夹的注意点</p>\n<p>在把纸张放进文件夹之前，我们需要对这张纸用网络中每个人都认可的专有密钥进行密封。但是密封后我们要确保的是，这张纸就只能尘封在文件夹里，无论是谁无论何时都不能对其作任何修改。并且如果每个人都相信这个“封印”，那么也就意味着每个人都绝对信任这张纸上的内容。这种密封方式也是区块链的关键所在。</p>\n<p>以前第三方或中间人都会说服我们相信无论他们在注册表中记录了什么，里面的内容都不会发生改变。但在现在这个分布式的、去中心化的系统中，这个印章（密钥）就为我们建立了这种信任机制。</p>\n<p><strong>故事的高潮 （一）</strong></p>\n<p>新的问题又来了。我们应该如何密封这张纸？</p>\n<p>在学习如何密封之前，我们先来了解印章的工作原理。</p>\n<p>假设我们现在有一个机器，如果你把一个里面装着东西的盒子从左边放进去，这个魔法机器会从右边吐出一个装着其它东西的盒子。</p>\n<p>【术语解析】这个机器实际叫作“哈希函数”，但是今天我们不讨论技术。所以我们暂且称它为“魔法机器”。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\"><img class=\"aligncenter wp-image-111777 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>魔法机器（即哈希函数）</p>\n<p>如果我们把装有数字4的盒子从左边放进去，它会从右边给出下列字符：dcbea。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\"><img class=\"aligncenter wp-image-111778 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>如果已知条件是输出结果为“dcbea”，要想知道从左边输入的是什么非常困难。但是每次如果你把4放进去，最终的输出结果“dcbea”是肯定的。</p>\n<p>我们来试试发送其它数字。如果放入26会得到什么呢？</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\"><img class=\"aligncenter wp-image-111779 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>哈希（26）=94c8e</p>\n<p>这次我们得到的是“94c8e”。从26的输出结果来看，结果也可以包含数字。</p>\n<p>了解到这儿，我们可以开始思考下一个更加深入的问题了：</p>\n<p>“如果我想从右边得到一个以3个零为开头的结果（如000ab、00098、000fa等），那么我应该从机器的左边放入什么内容？”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\"><img class=\"aligncenter wp-image-111780 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>预测输入的内容</p>\n<p>这个机器有一个单向性的属性：给出右边的预期结果后，我们无法计算出左边放入的内容。那是不是意味着这个问题无解？倒也未必。</p>\n<p>我能想到一种方法——把每个数字都输入一遍，直到机器输出以3个零为开头的结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\"><img class=\"aligncenter wp-image-111781 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>把每个数字都尝试一遍</p>\n<p>有耐心的人试上几千次可能也就找到了这个符合我们输出要求的数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\"><img class=\"aligncenter wp-image-111782 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过输出结果来获得输入数字这种逆向计算的确非常困难。但是如果我们得到了预测的输入内容，验证该输入是否能得出我们想要的结果就非常非常容易了。记住，这个机器最大的特点就是每个结果只对应一个数字，绝无例外的“一夫一妻制”。</p>\n<p>如果我给你72533这个数字，然后问你：“这个数字输入魔法机器后会不会输出以3个零为开头的结果？”这个问题就简单到简直在侮辱我们的智商了。</p>\n<p>因此这个机器最最最重要的属性是——知道结果，要想算出输出非常困难，但是如果我们知道输入的数字和输出结果，验证两者是否匹配很简单。</p>\n<p><strong>如何利用这个机器密封纸张？</strong></p>\n<p>怎样利用魔法机器生成每张纸独有的封印？还是老办法，采用情境模拟的方法展开解释。</p>\n<p>假设我给了你两个盒子。第一个盒子里面有数字20893，你能不能想出一个数字，这个数字与第一个盒子里的数字相加后的结果放入魔法机器后，我们能够得到一个以3个零为开头的字符结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\"><img class=\"aligncenter wp-image-111783 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>这个情景和之前的难题几乎相同。唯一的办法就是把每个数字都放入机器尝试一遍。</p>\n<p>经过几千次的尝试，我们会在21191这个数字这里停下，21191+20893=42084，把42084放入这个机器后所得到的结果正是我们想要的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\"><img class=\"aligncenter wp-image-111784 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>在这个案例中，21191这个数字就是20893这个数字的“封印”。假设有张纸上写着20893这个数字。为了密封这张纸（即没有人能够再对其内容作改动），我们把带有21191标签的徽章贴在纸上，密封完成。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\"><img class=\"aligncenter wp-image-111785 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>被密封的数字</p>\n<p>【术语解析】用来密封的数字实际被称为“工作证明（Proof Of Work）”，因为这个数字是通过努力计算得来的。本文为了简单易懂，我们称它为“密封数字”。</p>\n<p>无论谁想验证这个页面是否被改动过，只要把页面上的内容与密封号码叠加后放入魔法机器。如果机器输出的内容是以3个零为开头的，那么该页面内容是没有被“污染”过的。但如果结果不满足这个特点，我们就应果断丢弃这个页面，因为上面的内容已经被改动、已经失效。</p>\n<p><strong>密封过程总结</strong></p>\n<p>要想密封记录整个交易网络中交易流水的页面，我们需要找到那个加入交易内容并输入机器后会得到以3个零为开头的字符的关键数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\"><img class=\"aligncenter wp-image-111786 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>注意：“以3个零为开头的字符”只是一个举例，简单地反应哈希函数的工作原理。实际问题处理起来会复杂得多。</p>\n<p>只要花费一定的时间，交易网络中的参与者就能够计算出这个数字，该页面也就随之密封。一旦有人更改了页面上的内容，任何人都能够通过这个密封号码来验证这个页面的完整性。</p>\n<p><strong>故事的高潮（二）</strong></p>\n<p>了解如何密封页面后，我们再把思绪拉回10个人用完了一张纸上所有空间的时候。</p>\n<p>当这个页面上记不下更多的交易记录时，交易网络中的每个人都会停下来计算该页面的密封数字，然后将其放入文件夹。如果第一个人算好了密封数字，他就会向所有人公布。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\"><img class=\"aligncenter wp-image-111787 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>听到密封号码后，大家都去验证这个数字是否能满足输出需求。如是，则在他们的页面上贴上这个标签，再把这个页面放进文件夹。</p>\n<p>但是如果7号算出了密封号码并“昭告了天下”，但结果大家发现这个数字并不满足他们的输出需求怎么办？这样的情况也很常见。原因可能有以下几点：</p>\n<p>1. 公布交易信息时听错了；</p>\n<p>2. 记录交易信息时出现笔误；</p>\n<p>3. 为了一己之利，记录交易时故意犯错。</p>\n<p>不管出于什么原因，7号只有一种选择——丢弃自己这张纸，然后从别人那里复制一份副本放进他自己的文件夹。如果不把这个页面放进文件夹，他就不能继续记录接下来的交易记录，这也就相当于把他从这个交易网络中踢掉了。</p>\n<p>说到这里，我相信有的人脑海里又出现了一个疑惑：既然有人计算好密封号码后会公布，为什么我们每个人还要花费那么多时间都去计算一遍？其他人为什么不歇着、坐等公布？</p>\n<p>Good question!区块链包含特殊的奖励机制，网络中每个人都有资格获得奖励。第一个计算出密封号码的人能够获得一定奖励。</p>\n<p>我们再来简单地假设一下，如果5号第一个算出了页面的密封号码，并获得了1美元的金额奖励，那么这1美元就是凭空出现的。换句话说，假如他账户里本来余额5美元，现在增加了1元，但是这1元没有从其它任何人的账户里扣除，即没有减少任何人的账户余额。</p>\n<p>这就是比特币的起源。它是在区块链（分布式账目）上发生交易的第一种货币。如果在这个交易网络上持续努力，你同样也能获得回报，这个过程就是我们所说的“挖矿”。</p>\n<p>拥有比特币的人越来越多，这些人一刻不闲着地开始炒这种虚拟货币，不断扩大市场对比特币的需求，再进一步提高比特币的价值。就这样周而复始地把比特币的价格炒得很高。</p>\n<p>这种奖励机制让交易网络中的每个人都勤勤恳恳地劳作。</p>\n<p>他们把纸张放进文件夹后，拿出一张新的空白纸张，然后再次重复前面的过程——循环往复、永无止境。</p>\n<p>假设文件夹中已经有5个被密封的页面。如果我为了谋取私利修改了第二个页面的其中一笔交易会发生什么？前面已经提到过，所有人都可以通过密封号码查出交易内容已经发生改变。但是如果我根据修改的内容重新计算密封号码，然后把新号码贴在纸上，出现这样的情况怎么办？</p>\n<p>为了防止有人同时修改页面和密封号码，计算密封号码时有一个小技巧。</p>\n<p><strong>如何防止密封号码被重新计算、更改？</strong></p>\n<p>还记得之前我假设你有两个盒子，一个包含20893这个数字，一个是用于计算的空盒子吗？在区块链中计算密封号码，实际上存在三个盒子，而不是两个，其中两个是有内容的，一个是待计算填充的。</p>\n<p>当三个盒子的内容都填好放入机器后，机器右边输出的结果能够满足我们的需求。</p>\n<p>一个盒子里是交易记录、一个盒子是密封号码，第三个盒子是通过哈希函数计算出来的前一页的输出结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\"><img class=\"aligncenter wp-image-111788 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过这个小技巧，我们能够确保每一页的密封号码都与前一页的内容相关联。因此如果有人修改了历史页面的内容，他需要改动接下来每一页的密封号码，从而保证整个链路的一致性。</p>\n<p>我们假设十个人中有一个人想要恶意修改区块链中的内容（包含记录了交易历史页面的文件夹），那么他需要调整很多页面，计算改动页面之后所有页面的密封号码。我们都知道计算密封号码的工作非常困难。因此，整个交易网络中的一个叛徒最终还是会输个剩下的9个好人。</p>\n<p>从这个叛徒想要更改内容的页面开始，他就需要在整个网络中创建另一个区块链，但是这个区块链几乎不可能赶上好人们创建的链路——一个人的力量赶不上剩下9个人的共同努力。因此，有一点非常明确，区块链规模越大，安全性和可信度越高。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\"><img class=\"aligncenter wp-image-111789 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\" alt=\"1\" width=\"1000\" height=\"637\"></a></p>\n<p>但是如果10个人中有6个人都叛变了怎么办？</p>\n<p>如果出现这样的情况，这个协议就有点打脸了。这种情况被称为“51%攻击”。如果整个网络中的大多数人都决定叛变，欺骗剩下不到半数的人，那么整个协议就自然而然地走向了灭亡。</p>\n<p>这是区块链最大的弱点。尽管这样的情况不可能出现，但我们还是要谨记这个系统的弱点。整个体系都是基于一个假设：整个交易网络中的大多数人都不会叛变。</p>\n<p><strong>结 局</strong></p>\n<p>解释到这里也就差不多了。还请亲爱的们再回头看看百度百科给出的定义，现在是不是理解起来容易很多了？</p>\n<p>如果还有人问起到底什么是区块链，比特币的运作机制是怎样的，我相信本文的读者都能够解释给更多的小白们听啦。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111768\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111768votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111768\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 14 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,区块链,比特币", "front_image_path": "full/63f2aa24b2b070edaefbb38b67ace3ebd11241ce.jpg"}
{"url_object_id": "fd842a72622552f4dffcc903ae3af9b5", "title": "漫画算法：什么是 B 树？", "create_time": "2017/07/09", "url": "http://blog.jobbole.com/111757/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg"], "praise_num": "2", "comment_num": 2, "fav_num": 13, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<blockquote><p>伯乐在线补充：本文提到的「B-树」，就是「B树」，都是 B-tree 的翻译，里面不是减号-，是连接符-。因为有人把 B-tree 翻成 「B-树」，让人以为「B树」和「B-树」是两种树，实际上两者就是同一种树。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fc713400ca8ce73e4d4f7b656974a270.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/98d1b3066e41fa6e28ad131e4f04f2d5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4cb37c6fcae8dbb405cb4b8ed10112aa.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70f82597c6205ae0b915cf9446605986.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fbb934ec8ef90054d26303d34bb27a24.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/616f5e86b4cf206dcfee036fd55e9602.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce70b97a696efa28520a19e5adea080c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/54f122a98313bd4f61c2e95d9858eaf6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/06556ae2f9f1dbf3bc798b350a97290a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b159585a12d50e1fbfffa2d892fde68f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/40fb54cfbec0e48c40e3f01d79f2cc3e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/89cca300c77afb89a592d252de98f012.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f2ab28eb6aa7b3efce6c000aed8ccba2.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29249cf3f3edddb4eb738a4b05eff361.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0264f0d13bce4acf176e0e67412e02d8.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/093de5649072fa0e9118d6b47ea4c39f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0aa46ad4cff77069122a89d83238dd02.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1516c8202da7f5df1ba479edeff75d9e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70d834f21e6e7a482270817f1ef9b66a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a5c3760c3b6375ab7f3db270c833205.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/423081a186bb730f6246d4fc88fe8397.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/35e21257dd7649cbf648f8a12c9526bf.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/be4e8c9eea941021983b3a0ec2e30fe7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c8115df892823961e16b58e50f2745f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3fc378e0a26f0a455b5de0c2b9085d0e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2540a2a93236be26570e7cfed001dd0c.jpg\" alt=\"\"></p>\n<p><strong>二叉查找树的结构：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a48d291a87e8f7451d7096f06c28a266.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c3afbbed4dc8d9ab0eb28f36c525eb64.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eaaadd8563fe9c2ce028b356b4b1b972.jpg\" alt=\"\"></p>\n<p><strong>第3次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29510bc7455978e0a4b76538c481d211.jpg\" alt=\"\"></p>\n<p><strong>第4次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e776aad15f9db6791ed4ece4cebf179b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/519a5ecae2049027e151f56404221cd6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/57a3d2232bdc3602101d26de6af70629.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfe811439d5a4b83908d1aece65b2858.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a551a5af0899d0f4487d5174c879fbee.jpg\" alt=\"\"></p>\n<p><strong>下面来具体介绍一下B-树（Balance Tree），一个m阶的B树具有如下几个特征：</strong></p>\n<p>1.根结点至少有两个子女。</p>\n<p>2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 &lt;= k &lt;= m</p>\n<p>3.每一个叶子节点都包含k-1个元素，其中 m/2 &lt;= k &lt;= m</p>\n<p>4.所有的叶子结点都位于同一层。</p>\n<p>5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3bdde769e986c29df17ee5a05e2283f5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1053258e35bc3a11daa6a35c0a4876a5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7b6f7416cab11f23fa141cbcbe5ae97b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e4bab35b22e04f408f20d9d78dd1ada7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1da23fc560320dd7fc33c4250f7bc62f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a18c14c033cc7773cbc5417b47c8433e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e00c03897682ce16665f1fc6a103fae5.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a9bff5a34ad1b721c406d49aa5f71c7f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和9比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e7aad0107f143df4d294f6d4ddc2efca.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/55f9ffb7ec69c5624d3d38c3e487619f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和2，6比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7181bf7db0d93d67a6d19e98bdec086a.jpg\" alt=\"\"></p>\n<p>第3次磁盘IO：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c7d939ddbd73ea5a28ab7c895e996d1e.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和3，5比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e00c658824f6979d5c2a6526adcdd07.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a8d6dd48be32ff61f0a20955c3f1231.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e067432832fd13a46e588a4165f6f2e9.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/150acc7b44a31e028d53b97e44e6a7f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/301f7f8c3add3183aa7fcc85a6ac584c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/07469afd080afb68036063ba808965f1.jpg\" alt=\"\"></p>\n<p>自顶向下查找4的节点位置，发现4应当插入到节点元素3，5之间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b19105d47fd35c8b0d1e7ed2248bdaa0.jpg\" alt=\"\"></p>\n<p>节点3，5已经是两元素节点，无法再增加。父亲节点 2， 6 也是两元素节点，也无法再增加。根节点9是单元素节点，可以升级为两元素节点。于是<strong>拆分</strong>节点3，5与节点2，6，让根节点9升级为两元素节点4，9。节点6独立为根节点的第二个孩子。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1a708a324257d422e594224c6f7afad4.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/60daf22a13c44bec7cd0384a04fe9e12.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ebf569b446c84c77405395ea1503477c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ed7fea3cc0eeab4fac24420dfa6a57c0.jpg\" alt=\"\"></p>\n<p>自顶向下查找元素11的节点位置。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ca7856622c48d55fbf9502f4ef8219b7.jpg\" alt=\"\"></p>\n<p>删除11后，节点12只有一个孩子，不符合B树规范。因此找出12,13,15三个节点的中位数13，取代节点12，而节点12自身下移成为第一个孩子。（这个过程称为<strong>左旋</strong>）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f5f4b28523d3d381b63c11b7ab3ac7d3.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8d567b18da9582a3dbed613232117001.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7041d2780cb7fa9bf64af19b6476dc2f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/04191ffe9d9fa92c54b4375b8b3da210.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fd1168e35ccc3953584f971f38c75b5.jpg\" alt=\"\"></p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111757\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111757votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111757\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 13 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 96</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,趣文小说,算法", "front_image_path": "full/3f0be7614d3c4b769873121d69a7e1ad5ae8b755.jpg"}
{"url_object_id": "cc276802ec74b5c8ad50fe746800ea7f", "title": "人人都能读懂的设计模式（3）：行为型模式", "create_time": "2017/07/17", "url": "http://blog.jobbole.com/111797/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/ef9bd8829d4a02c071feb1af9522d6ab.png"], "praise_num": "1", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/justin_ygg\">Justin(李加庆)</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://github.com/kamranahmedse/design-patterns-for-humans/blob/master/README.md#behavioral-design-patterns\">kamranahmedse</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>用最简单的语言，解释设计模式。</p>\n<p>虽然示例代码是用 PHP7 实现的，但因为概念是一样的，所以语言并不会阻碍大家理解设计模式。</p>\n<ul>\n<li>《<a href=\"http://blog.jobbole.com/111799/\" target=\"_blank\">人人都能读懂的设计模式（1）：创建型模式</a>》</li>\n<li>《<a href=\"http://blog.jobbole.com/111798/\" target=\"_blank\">人人都能读懂的设计模式（2）：结构型模式</a>》</li>\n</ul>\n<h3>概述</h3>\n<p>行为型设计模式关心对象之间的责任分配。与结构型设计模式不同的是，行为型设计模式不仅仅指定结构，而且还概述了它们之间的消息传递/通信的模式。或者换句话说，行为型模式帮助回答了“软件组件是如何运行的？”</p>\n<h3>维基百科</h3>\n<p>在软件工程中，行为型设计模式为设计模式的一种类型，用来识别对象之间的常用交流模式并加以实现。如此，可以在交流时增强灵活性。</p>\n<p><strong>分类</strong></p>\n<ul>\n<li>责任链模式</li>\n<li>命令模式</li>\n<li>迭代器模式</li>\n<li>中介者模式</li>\n<li>备忘录模式</li>\n<li>观察者模式</li>\n<li>访问者模式</li>\n<li>策略模式</li>\n<li>状态模式</li>\n<li>模板方法模式</li>\n</ul>\n<h3>🔗 责任链模式</h3>\n<h4>现实生活示例</h4>\n<p>例如，你的帐户中有三种付款方式（A，B 和 C）; 每种方式付款额不同。 A 可支付 100 美元，B 可支付 300 美元，C 可支付 1000 美元，支付的优先级为 A-&gt;B-&gt;C。现在想要购买价值 210 美元的东西。使用责任链模式，首先将检查帐户 A 是否可以进行购买，如果可以购买，链条将被破坏。如果不能购买，将继续检查账号 B 是否可以购买，如果可以购买，链条将被破坏，否则请求将继续转发，直到找到合适的处理程序。这里的 A、B 和 C 就是责任链的链条，整个现象就是责任链模式。</p>\n<h4>概述</h4>\n<p>责任链模式有助于建立一个对象链。请求从一端进入，在对象之间转发，直到找到合适的处理程序。</p>\n<h4>维基百科</h4>\n<p>责任链模式是面向对象程序设计的一种软件设计模式，它包含了一些命令对象和一系列的处理对象。每一个处理对象决定它能处理哪些命令对象，不能处理的命令对象传递给该链中的下一个处理对象。</p>\n<p><strong>程序示例</strong></p>\n<p>以上面的支付账号为例，首先给出账户基类，包含链接账号的逻辑以及一些不同类型的账户</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469038703440737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Account\r\n{\r\n    protected $successor;\r\n    protected $balance;\r\n\r\n    public function setNext(Account $account)\r\n    {\r\n        $this-&gt;successor = $account;\r\n    }\r\n\r\n    public function pay(float $amountToPay)\r\n    {\r\n        if ($this-&gt;canPay($amountToPay)) {\r\n            echo sprintf('Paid %s using %s' . PHP_EOL, $amountToPay, get_called_class());\r\n        } elseif ($this-&gt;successor) {\r\n            echo sprintf('Cannot pay using %s. Proceeding ..' . PHP_EOL, get_called_class());\r\n            $this-&gt;successor-&gt;pay($amountToPay);\r\n        } else {\r\n            throw new Exception('None of the accounts have enough balance');\r\n        }\r\n    }\r\n\r\n    public function canPay($amount): bool\r\n    {\r\n        return $this-&gt;balance &gt;= $amount;\r\n    }\r\n}\r\n\r\nclass Bank extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Paypal extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Bitcoin extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469038703440737-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469038703440737-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Account</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-10\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Paid %s using %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Cannot pay using %s. Proceeding ..'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'None of the accounts have enough balance'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-22\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-28\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-29\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-30\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-32\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-37\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-38\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-39\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-40\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-42\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-47\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-48\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-49\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-50\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-52\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469038703440737-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469038703440737-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>然后通过上面定义的链接（即 Bank, Paypal, Bitcoin）形成责任链</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46904d787337407\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Let's prepare a chain like below\r\n//      $bank-&gt;$paypal-&gt;$bitcoin\r\n//\r\n// First priority bank\r\n//      If bank can't pay then paypal\r\n//      If paypal can't pay then bit coin\r\n\r\n$bank = new Bank(100);          // Bank with balance 100\r\n$paypal = new Paypal(200);      // Paypal with balance 200\r\n$bitcoin = new Bitcoin(300);    // Bitcoin with balance 300\r\n\r\n$bank-&gt;setNext($paypal);\r\n$paypal-&gt;setNext($bitcoin);\r\n\r\n// Let's try to pay using the first priority i.e. bank\r\n$bank-&gt;pay(259);\r\n\r\n// Output will be\r\n// ==============\r\n// Cannot pay using bank. Proceeding ..\r\n// Cannot pay using paypal. Proceeding ..:\r\n// Paid 259 using Bitcoin!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46904d787337407-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46904d787337407-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-1\"><span class=\"crayon-c\">// Let's prepare a chain like below</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-2\"><span class=\"crayon-c\">//      $bank-&gt;$paypal-&gt;$bitcoin</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-3\"><span class=\"crayon-c\">//</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-4\"><span class=\"crayon-c\">// First priority bank</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-5\"><span class=\"crayon-c\">//      If bank can't pay then paypal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-6\"><span class=\"crayon-c\">//      If paypal can't pay then bit coin</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">          </span><span class=\"crayon-c\">// Bank with balance 100</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Paypal with balance 200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Bitcoin with balance 300</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-14\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-15\"><span class=\"crayon-c\">// Let's try to pay using the first priority i.e. bank</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-16\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">259</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-18\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-19\"><span class=\"crayon-c\">// ==============</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-20\"><span class=\"crayon-c\">// Cannot pay using bank. Proceeding ..</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46904d787337407-21\"><span class=\"crayon-c\">// Cannot pay using paypal. Proceeding ..:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46904d787337407-22\"><span class=\"crayon-c\">// Paid 259 using Bitcoin!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h3>👮 命令模式</h3>\n<h4>现实生活示例</h4>\n<p>一个典型的例子是你在餐厅点菜，你（即客户）向服务员（即 Invoker）点餐（即命令），服务员只需将需求转达给会烹饪的厨师。 另外一个例子是你（即客户端）使用遥控器（Invoker）打开（即命令）电视机（即接收器）。</p>\n<h4>概述</h4>\n<p>命令模式允许将操作封装在对象中，其背后的关键思想是提供客户端与接收器分离的方法。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计的范畴中，命令模式是一种行为型设计模式。将所有需要的信息封装到对象中，用于之后的动作（action）或者事件触发。被封装的信息包括方法名以及拥有方法及参数的对象。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出一个接收器，实现了可能会执行的动作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469052130158304\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Receiver\r\nclass Bulb\r\n{\r\n    public function turnOn()\r\n    {\r\n        echo \"Bulb has been lit\";\r\n    }\r\n\r\n    public function turnOff()\r\n    {\r\n        echo \"Darkness!\";\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469052130158304-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469052130158304-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-1\"><span class=\"crayon-c\">// Receiver</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Bulb has been lit\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Darkness!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469052130158304-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469052130158304-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>然后给出一个接口，（Bulb）中的每个命令都要实现这个接口，得到一组命令集：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469055310509219\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Command\r\n{\r\n    public function execute();\r\n    public function undo();\r\n    public function redo();\r\n}\r\n\r\n// Command\r\nclass TurnOn implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}\r\n\r\nclass TurnOff implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469055310509219-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469055310509219-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-8\"><span class=\"crayon-c\">// Command</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-22\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-34\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-35\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-42\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-52\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469055310509219-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469055310509219-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>然后是Invoker，客户端将与之交互以处理各种命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469059686507721\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Invoker\r\nclass RemoteControl\r\n{\r\n    public function submit(Command $command)\r\n    {\r\n        $command-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469059686507721-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469059686507721-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469059686507721-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469059686507721-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469059686507721-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469059686507721-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469059686507721-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469059686507721-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469059686507721-1\"><span class=\"crayon-c\">// Invoker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469059686507721-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469059686507721-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469059686507721-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469059686507721-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469059686507721-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469059686507721-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469059686507721-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>最后来看一下如何在客户端中使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46905c403514311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$bulb = new Bulb();\r\n\r\n$turnOn = new TurnOn($bulb);\r\n$turnOff = new TurnOff($bulb);\r\n\r\n$remote = new RemoteControl();\r\n$remote-&gt;submit($turnOn); // Bulb has been lit!\r\n$remote-&gt;submit($turnOff); // Darkness!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46905c403514311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46905c403514311-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46905c403514311-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46905c403514311-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46905c403514311-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46905c403514311-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46905c403514311-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46905c403514311-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46905c403514311-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46905c403514311-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46905c403514311-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46905c403514311-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46905c403514311-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46905c403514311-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46905c403514311-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Bulb has been lit!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46905c403514311-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Darkness!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>命令模式也可用于实现基于事务的系统。在执行命令时，需要持续保存命令的历史，如果最后一条命令成功执行，皆大欢喜，否则遍历历史记录，并对所有执行过的命执行<code>撤销</code>。</p>\n<h3>➿ 迭代器模式</h3>\n<h4>现实生活示例</h4>\n<p>老式的无线电设备将是一个很好的迭代器示例，用户可以在某个频道上启动，然后使用下一个或上一个按钮来切换频道。或者以 MP3 播放器或电视机为例，你可以按下一个按钮和上一个按钮进行连续的频道切换。换句话说，它们都提供了一个界面来遍历相应的频道，歌曲或广播电台。</p>\n<h4>概述</h4>\n<p>迭代器模式提供了一种方法，可以访问对象的元素而不暴露底层实现。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计中，迭代器模式是一种设计模式，其中迭代器用于遍历容器并访问容器的元素。迭代器模式将算法与容器解耦; 在某些情况下，算法是特定容器必需的，因此不能解耦。</p>\n<p><strong>程序示例</strong></p>\n<p>通过PHP，使用 SPL（PHP标准库）可以轻松实现迭代器模式，以上述收音机为例，首先给出 <code>RadioStation</code> 类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469060337484093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RadioStation\r\n{\r\n    protected $frequency;\r\n\r\n    public function __construct(float $frequency)\r\n    {\r\n        $this-&gt;frequency = $frequency;\r\n    }\r\n\r\n    public function getFrequency(): float\r\n    {\r\n        return $this-&gt;frequency;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469060337484093-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469060337484093-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469060337484093-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469060337484093-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后是 迭代器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469063004047209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuse Countable;\r\nuse Iterator;\r\n\r\nclass StationList implements Countable, Iterator\r\n{\r\n    /** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */\r\n    protected $stations = [];\r\n\r\n    /** [@var](http://www.jobbole.com/members/variable) int $counter */\r\n    protected $counter;\r\n\r\n    public function addStation(RadioStation $station)\r\n    {\r\n        $this-&gt;stations[] = $station;\r\n    }\r\n\r\n    public function removeStation(RadioStation $toRemove)\r\n    {\r\n        $toRemoveFrequency = $toRemove-&gt;getFrequency();\r\n        $this-&gt;stations = array_filter($this-&gt;stations, function (RadioStation $station) use ($toRemoveFrequency) {\r\n            return $station-&gt;getFrequency() !== $toRemoveFrequency;\r\n        });\r\n    }\r\n\r\n    public function count(): int\r\n    {\r\n        return count($this-&gt;stations);\r\n    }\r\n\r\n    public function current(): RadioStation\r\n    {\r\n        return $this-&gt;stations[$this-&gt;counter];\r\n    }\r\n\r\n    public function key()\r\n    {\r\n        return $this-&gt;counter;\r\n    }\r\n\r\n    public function next()\r\n    {\r\n        $this-&gt;counter++;\r\n    }\r\n\r\n    public function rewind()\r\n    {\r\n        $this-&gt;counter = 0;\r\n    }\r\n\r\n    public function valid(): bool\r\n    {\r\n        return isset($this-&gt;stations[$this-&gt;counter]);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469063004047209-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469063004047209-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-1\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-2\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Iterator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Iterator</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-5\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) int $counter */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-16\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-24\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">current</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-34\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-44\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rewind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469063004047209-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469063004047209-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469068147008647\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$stationList = new StationList();\r\n\r\n$stationList-&gt;addStation(new RadioStation(89));\r\n$stationList-&gt;addStation(new RadioStation(101));\r\n$stationList-&gt;addStation(new RadioStation(102));\r\n$stationList-&gt;addStation(new RadioStation(103.2));\r\n\r\nforeach($stationList as $station) {\r\n    echo $station-&gt;getFrequency() . PHP_EOL;\r\n}\r\n\r\n$stationList-&gt;removeStation(new RadioStation(89)); // Will remove station 89</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469068147008647-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469068147008647-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">101</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">102</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">103.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-8\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">stationList </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469068147008647-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469068147008647-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Will remove station 89</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h3>👽 中介者模式</h3>\n<h4>现实生活示例</h4>\n<p>典型的例子是你通过手机与他人通话，你与通话者之间有一个网络供应商，对话将通过供应商传递而非直接传递。这种情况下网络供应商就是中介者。</p>\n<h4>概述</h4>\n<p>中介者模式添加了第三方对象（称为中介者）来控制两个对象（称为 colleague）之间的交互。中介者模式有助于减少通信类之间的耦合，因为类之间无需知道对方的实现。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，中介者模式包装了一系列对象相互作用的方式。这种模式被认为是一种行为模式，因为它可以改变程序的运行时行为。</p>\n<p><strong>程序示例</strong></p>\n<p>下面是一个最简单的用户（即 colleague）在聊天室（中介者）中互相发送消息的示例</p>\n<p>首先给出中介者及聊天室</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46906c312857500\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface ChatRoomMediator \r\n{\r\n    public function showMessage(User $user, string $message);\r\n}\r\n\r\n// Mediator\r\nclass ChatRoom implements ChatRoomMediator\r\n{\r\n    public function showMessage(User $user, string $message)\r\n    {\r\n        $time = date('M d, y H:i');\r\n        $sender = $user-&gt;getName();\r\n\r\n        echo $time . '[' . $sender . ']:' . $message;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906c312857500-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906c312857500-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-6\"><span class=\"crayon-c\">// Mediator</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'M d, y H:i'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'['</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">']:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906c312857500-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906c312857500-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>然后是用户即 colleague</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46906f950768344\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass User {\r\n    protected $name;\r\n    protected $chatMediator;\r\n\r\n    public function __construct(string $name, ChatRoomMediator $chatMediator) {\r\n        $this-&gt;name = $name;\r\n        $this-&gt;chatMediator = $chatMediator;\r\n    }\r\n\r\n    public function getName() {\r\n        return $this-&gt;name;\r\n    }\r\n\r\n    public function send($message) {\r\n        $this-&gt;chatMediator-&gt;showMessage($this, $message);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46906f950768344-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46906f950768344-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ChatRoomMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46906f950768344-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46906f950768344-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469072896762911\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$mediator = new ChatRoom();\r\n\r\n$john = new User('John Doe', $mediator);\r\n$jane = new User('Jane Doe', $mediator);\r\n\r\n$john-&gt;send('Hi there!');\r\n$jane-&gt;send('Hey!');\r\n\r\n// Output will be\r\n// Feb 14, 10:58 [John]: Hi there!\r\n// Feb 14, 10:58 [Jane]: Hey!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469072896762911-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469072896762911-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469072896762911-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469072896762911-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469072896762911-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469072896762911-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469072896762911-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469072896762911-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469072896762911-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hi there!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hey!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469072896762911-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-9\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469072896762911-10\"><span class=\"crayon-c\">// Feb 14, 10:58 [John]: Hi there!</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469072896762911-11\"><span class=\"crayon-c\">// Feb 14, 10:58 [Jane]: Hey!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>💾 备忘录模式</h3>\n<h4>现实生活示例</h4>\n<p>以计算器（即发起者）为例，每当执行一些计算时，最后一次计算结果将保存在内存中（即备忘录），以便数据可以恢复，也可以使用某些操作按钮（即临时代理）来恢复数据。</p>\n<h4>概述</h4>\n<p>备忘录模式以一种稍后可平滑恢复的方式捕捉并存储对象的当前状态。</p>\n<h4>维基百科</h4>\n<p>备忘录模式是一种软件设计模式，可以将对象恢复到之前的状态（通过回滚来撤销）</p>\n<p>需要提供撤销操作时，备忘录模式通常很有用。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出可以存储编辑器状态的备忘录对象</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469076186627970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass EditorMemento\r\n{\r\n    protected $content;\r\n\r\n    public function __construct(string $content)\r\n    {\r\n        $this-&gt;content = $content;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469076186627970-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469076186627970-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469076186627970-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469076186627970-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>然后是使用备忘录对象的编辑器及发起者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46907a829842368\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Editor\r\n{\r\n    protected $content = '';\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;content = $this-&gt;content . ' ' . $words;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n\r\n    public function save()\r\n    {\r\n        return new EditorMemento($this-&gt;content);\r\n    }\r\n\r\n    public function restore(EditorMemento $memento)\r\n    {\r\n        $this-&gt;content = $memento-&gt;getContent();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907a829842368-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907a829842368-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-14\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EditorMemento</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907a829842368-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907a829842368-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46907d991072605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new Editor();\r\n\r\n// Type some stuff\r\n$editor-&gt;type('This is the first sentence.');\r\n$editor-&gt;type('This is second.');\r\n\r\n// Save the state to restore to : This is the first sentence. This is second.\r\n$saved = $editor-&gt;save();\r\n\r\n// Type some more\r\n$editor-&gt;type('And this is third.');\r\n\r\n// Output: Content before Saving\r\necho $editor-&gt;getContent(); // This is the first sentence. This is second. And this is third.\r\n\r\n// Restoring to last saved state\r\n$editor-&gt;restore($saved);\r\n\r\n$editor-&gt;getContent(); // This is the first sentence. This is second.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46907d991072605-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46907d991072605-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-3\"><span class=\"crayon-c\">// Type some stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is the first sentence.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is second.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-7\"><span class=\"crayon-c\">// Save the state to restore to : This is the first sentence. This is second.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-10\"><span class=\"crayon-c\">// Type some more</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'And this is third.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-13\"><span class=\"crayon-c\">// Output: Content before Saving</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second. And this is third.</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-16\"><span class=\"crayon-c\">// Restoring to last saved state</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-17\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46907d991072605-18\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46907d991072605-19\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>😎 观察者模式</h3>\n<h4>现实生活示例</h4>\n<p>一个很好的例子是，求职者订阅了一些招聘网站，每当有匹配的工作机会时，求职者就会收到通知。</p>\n<h4>概述</h4>\n<p>定义了对象之间的依赖，一旦其中一个对象的状态发生改变，依赖它的对象都会收到通知。</p>\n<h4>维基百科</h4>\n<p>观察者模式是软件设计模式的一种。在此种模式中，一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。通常通过调用目标对象所提供的方法来实现。</p>\n<p><strong>程序示例</strong></p>\n<p>以上述求职订阅为例，首先给出求职者，有职位发布时会收到通知</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469081285130249\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPost\r\n{\r\n    protected $title;\r\n\r\n    public function __construct(string $title)\r\n    {\r\n        $this-&gt;title = $title;\r\n    }\r\n\r\n    public function getTitle()\r\n    {\r\n        return $this-&gt;title;\r\n    }\r\n}\r\n\r\nclass JobSeeker implements Observer\r\n{\r\n    protected $name;\r\n\r\n    public function __construct(string $name)\r\n    {\r\n        $this-&gt;name = $name;\r\n    }\r\n\r\n    public function onJobPosted(JobPost $job)\r\n    {\r\n        // Do something with the job posting\r\n        echo 'Hi ' . $this-&gt;name . '! New job posted: '. $job-&gt;getTitle();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469081285130249-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469081285130249-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-16\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observer</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-17\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-24\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do something with the job posting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hi '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'! New job posted: '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469081285130249-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469081285130249-30\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>然后是求职者订阅的职位发布类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469085946988517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPostings implements Observable\r\n{\r\n    protected $observers = [];\r\n\r\n    protected function notify(JobPost $jobPosting)\r\n    {\r\n        foreach ($this-&gt;observers as $observer) {\r\n            $observer-&gt;onJobPosted($jobPosting);\r\n        }\r\n    }\r\n\r\n    public function attach(Observer $observer)\r\n    {\r\n        $this-&gt;observers[] = $observer;\r\n    }\r\n\r\n    public function addJob(JobPost $jobPosting)\r\n    {\r\n        $this-&gt;notify($jobPosting);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469085946988517-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469085946988517-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">observers </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Observer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">observers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-16\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469085946988517-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469085946988517-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469089267093248\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Create subscribers\r\n$johnDoe = new JobSeeker('John Doe');\r\n$janeDoe = new JobSeeker('Jane Doe');\r\n\r\n// Create publisher and attach subscribers\r\n$jobPostings = new JobPostings();\r\n$jobPostings-&gt;attach($johnDoe);\r\n$jobPostings-&gt;attach($janeDoe);\r\n\r\n// Add a new job and see if subscribers get notified\r\n$jobPostings-&gt;addJob(new JobPost('Software Engineer'));\r\n\r\n// Output\r\n// Hi John Doe! New job posted: Software Engineer\r\n// Hi Jane Doe! New job posted: Software Engineer</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469089267093248-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469089267093248-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-1\"><span class=\"crayon-c\">// Create subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-5\"><span class=\"crayon-c\">// Create publisher and attach subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-10\"><span class=\"crayon-c\">// Add a new job and see if subscribers get notified</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Software Engineer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-13\"><span class=\"crayon-c\">// Output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469089267093248-14\"><span class=\"crayon-c\">// Hi John Doe! New job posted: Software Engineer</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469089267093248-15\"><span class=\"crayon-c\">// Hi Jane Doe! New job posted: Software Engineer</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3>🏃 访问者模式</h3>\n<h4>现实生活示例</h4>\n<p>假如有人前往迪拜，他们需要有证件（比如签证）就可进入迪拜。到达后，无需获得许可或做一些跑腿工作，他们便可以自由前往迪拜的任何地方; 只要是知道的地方，就能游览。访问者模式可以做到这一点，它可以帮助你添加访问地点，以便在无需跑腿的情况下，可以尽可能多地访问。</p>\n<h4>概述</h4>\n<p>访问者模式可以在无需修改对象的情况下增加一些额外操作。</p>\n<h4>维基百科</h4>\n<p>在面向对象编程和软件工程中，访问者设计模式是一种从对象结构中分离算法的方式。这种分离的实际结果是能够向现有的对象结构添加新的操作，而无需修改这些结构。这是遵循开放/封闭原则的一种方式。</p>\n<p><strong>编程示例</strong></p>\n<p>以模拟动物园为例，动物园里有几种不同种类的动物，我们需要让它们发出叫声，下面使用访问者模式实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46908d570997665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Visitee\r\ninterface Animal\r\n{\r\n    public function accept(AnimalOperation $operation);\r\n}\r\n\r\n// Visitor\r\ninterface AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey);\r\n    public function visitLion(Lion $lion);\r\n    public function visitDolphin(Dolphin $dolphin);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46908d570997665-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46908d570997665-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-1\"><span class=\"crayon-c\">// Visitee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-7\"><span class=\"crayon-c\">// Visitor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-8\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-9\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46908d570997665-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46908d570997665-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>然后实现各种动物</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469090892488033\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Monkey implements Animal\r\n{\r\n    public function shout()\r\n    {\r\n        echo 'Ooh oo aa aa!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitMonkey($this);\r\n    }\r\n}\r\n\r\nclass Lion implements Animal\r\n{\r\n    public function roar()\r\n    {\r\n        echo 'Roaaar!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitLion($this);\r\n    }\r\n}\r\n\r\nclass Dolphin implements Animal\r\n{\r\n    public function speak()\r\n    {\r\n        echo 'Tuut tuttu tuutt!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitDolphin($this);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469090892488033-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469090892488033-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Ooh oo aa aa!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Roaaar!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-20\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-25\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-26\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-27\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-28\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Tuut tuttu tuutt!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469090892488033-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469090892488033-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>接下来实现访问者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469095329357281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Speak implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        $monkey-&gt;shout();\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        $lion-&gt;roar();\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        $dolphin-&gt;speak();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469095329357281-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469095329357281-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469095329357281-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469095329357281-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d469098850428772\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$monkey = new Monkey();\r\n$lion = new Lion();\r\n$dolphin = new Dolphin();\r\n\r\n$speak = new Speak();\r\n\r\n$monkey-&gt;accept($speak);    // Ooh oo aa aa!    \r\n$lion-&gt;accept($speak);      // Roaaar!\r\n$dolphin-&gt;accept($speak);   // Tuut tutt tuutt!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d469098850428772-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469098850428772-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469098850428772-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469098850428772-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469098850428772-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469098850428772-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469098850428772-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d469098850428772-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d469098850428772-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d469098850428772-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469098850428772-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469098850428772-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469098850428772-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469098850428772-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469098850428772-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d469098850428772-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Ooh oo aa aa!    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d469098850428772-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d469098850428772-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>当需要为动物添加新动作时，我们本可以通过动物支持继承来实现，但是需要修改动物类。但现在就不必修改动物类了。例如，假设需要向动物添加跳跃行为，我们可以通过创建一个新的访问者来简单地添加此行为，即：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46909b583423256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Jump implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        echo 'Jumped 20 feet high! on to the tree!';\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        echo 'Jumped 7 feet! Back on the ground!';\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        echo 'Walked on water a little and disappeared';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909b583423256-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909b583423256-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 20 feet high! on to the tree!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 7 feet! Back on the ground!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Walked on water a little and disappeared'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909b583423256-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909b583423256-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d46909e905711169\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$jump = new Jump();\r\n\r\n$monkey-&gt;accept($speak);   // Ooh oo aa aa!\r\n$monkey-&gt;accept($jump);    // Jumped 20 feet high! on to the tree!\r\n\r\n$lion-&gt;accept($speak);     // Roaaar!\r\n$lion-&gt;accept($jump);      // Jumped 7 feet! Back on the ground!\r\n\r\n$dolphin-&gt;accept($speak);  // Tuut tutt tuutt!\r\n$dolphin-&gt;accept($jump);   // Walked on water a little and disappeared</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909e905711169-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909e905711169-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909e905711169-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909e905711169-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909e905711169-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909e905711169-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909e905711169-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909e905711169-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d46909e905711169-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d46909e905711169-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d46909e905711169-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909e905711169-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46909e905711169-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Ooh oo aa aa!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909e905711169-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Jumped 20 feet high! on to the tree!</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909e905711169-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909e905711169-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d46909e905711169-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Jumped 7 feet! Back on the ground!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909e905711169-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d46909e905711169-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d46909e905711169-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Walked on water a little and disappeared</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3>💡 策略模式</h3>\n<h4>现实生活示例</h4>\n<p>考虑排序的例子，我们实现了冒泡排序，但数据开始增长，冒泡排序开始变得非常慢。为了解决这个问题，我们实现了快速排序。尽管快速排序算法对于大型数据集来说效果很好，但对于较小的数据集却非常慢。为了解决这个问题，我们实施了一个策略，小数据集使用冒泡排序，大数据集使用快速排序。</p>\n<h4>概述</h4>\n<p>策略模式允许你基于场景转换算法或策略。</p>\n<h4>维基百科</h4>\n<p>在计算机编程中，策略模式是一种行为设计模式，可以在运行时选择算法的行为。</p>\n<p><strong>编程示例</strong></p>\n<p>以上述排序为例，首先给出策略接口及不同的策略实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690a2345839900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface SortStrategy\r\n{\r\n    public function sort(array $dataset): array;\r\n}\r\n\r\nclass BubbleSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using bubble sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}\r\n\r\nclass QuickSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using quick sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a2345839900-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a2345839900-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using bubble sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-16\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using quick sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-22\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a2345839900-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a2345839900-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>客户端可以使用任意策略</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690a5897979877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Sorter\r\n{\r\n    protected $sorter;\r\n\r\n    public function __construct(SortStrategy $sorter)\r\n    {\r\n        $this-&gt;sorter = $sorter;\r\n    }\r\n\r\n    public function sort(array $dataset): array\r\n    {\r\n        return $this-&gt;sorter-&gt;sort($dataset);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a5897979877-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a5897979877-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">SortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a5897979877-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a5897979877-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690a9012278937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$dataset = [1, 5, 4, 3, 2, 8];\r\n\r\n$sorter = new Sorter(new BubbleSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using bubble sort\r\n\r\n$sorter = new Sorter(new QuickSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using quick sort</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a9012278937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a9012278937-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a9012278937-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a9012278937-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a9012278937-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690a9012278937-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690a9012278937-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690a9012278937-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a9012278937-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a9012278937-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a9012278937-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using bubble sort</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a9012278937-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690a9012278937-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690a9012278937-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using quick sort</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3>💢 状态模式</h3>\n<h4>现实生活示例</h4>\n<p>想象一下，你正在使用一些绘图应用程序，你可以选择笔刷来绘画，刷子根据所选颜色改变其行为，即如果选择红色，它将绘制为红色，如果选择蓝色，那么它将绘制蓝色等。</p>\n<h4>概述</h4>\n<p>当状态改变时，类的行为也发生改变。</p>\n<h4>维基百科</h4>\n<p>状态模式是以面向对象的方式实现状态机的行为设计模式。对于状态模式，通过将每个单独状态实现为派生类的状态模式接口, 来实现一个状态机，并通过调用模式超类的方法来实现状态转换。状态模式可以被解释为一种策略模式，它能够通过调用模式接口定义的方法来切换当前策略。</p>\n<p><strong>程序示例</strong></p>\n<p>以文本编辑器为例，编辑器可以改变文本的状态如选中粗体，就会以粗体输入文本，选中斜体便以斜体输入。</p>\n<p>首先是状态接口和一些状态实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690ad269891939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface WritingState\r\n{\r\n    public function write(string $words);\r\n}\r\n\r\nclass UpperCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtoupper($words);\r\n    }\r\n}\r\n\r\nclass LowerCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtolower($words);\r\n    }\r\n}\r\n\r\nclass Default implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo $words;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ad269891939-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ad269891939-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtoupper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtolower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-22\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-23\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ad269891939-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ad269891939-28\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>然后是文本编辑器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690b0748881170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass TextEditor\r\n{\r\n    protected $state;\r\n\r\n    public function __construct(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function setState(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;state-&gt;write($words);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b0748881170-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b0748881170-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-14\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b0748881170-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b0748881170-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690b3521909432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new TextEditor(new Default());\r\n\r\n$editor-&gt;type('First line');\r\n\r\n$editor-&gt;setState(new UpperCase());\r\n\r\n$editor-&gt;type('Second line');\r\n$editor-&gt;type('Third line');\r\n\r\n$editor-&gt;setState(new LowerCase());\r\n\r\n$editor-&gt;type('Fourth line');\r\n$editor-&gt;type('Fifth line');\r\n\r\n// Output:\r\n// First line\r\n// SECOND LINE\r\n// THIRD LINE\r\n// fourth line\r\n// fifth line</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b3521909432-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b3521909432-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'First line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-4\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Second line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Third line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fourth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fifth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-14\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-15\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-16\"><span class=\"crayon-c\">// First line</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-17\"><span class=\"crayon-c\">// SECOND LINE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-18\"><span class=\"crayon-c\">// THIRD LINE</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b3521909432-19\"><span class=\"crayon-c\">// fourth line</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b3521909432-20\"><span class=\"crayon-c\">// fifth line</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h3>📒 模板方法模式</h3>\n<h4>现实生活示例</h4>\n<p>假设我们要造一座房子，建造的大体步骤如下：</p>\n<ul>\n<li>打地基</li>\n<li>垒墙</li>\n<li>封顶</li>\n<li>铺地板</li>\n</ul>\n<p>这些步骤的顺序不能被打乱，比如说，你不能在垒墙之前先封顶。但是其中的每一步可以定制，比如墙的材料可以使用木头、聚酯纤维或者石头。</p>\n<h4>概述</h4>\n<p>模板方法模式定义了如何执行某种算法的框架，但是将这些步骤的实现推迟到子类中。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，模板方法模式是一种行为设计模式，用于定义操作中算法的程序框架，将一些步骤推迟到子类实现。它允许在不改变算法结构的情况下重新定义算法的某些步骤。</p>\n<p><strong>程序示例</strong></p>\n<p>假如我们有一个构建工具，可以帮助我们测试，构建并生成构建报告（即代码覆盖报告，linting报告等），并将应用程序部署到测试服务器上。</p>\n<p>首先是用于确定构建算法框架的基类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690b7937737778\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Builder\r\n{\r\n\r\n    // Template method\r\n    final public function build()\r\n    {\r\n        $this-&gt;test();\r\n        $this-&gt;lint();\r\n        $this-&gt;assemble();\r\n        $this-&gt;deploy();\r\n    }\r\n\r\n    abstract public function test();\r\n    abstract public function lint();\r\n    abstract public function assemble();\r\n    abstract public function deploy();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690b7937737778-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690b7937737778-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Template method</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690b7937737778-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690b7937737778-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>然后提供一些基类的实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690ba546742157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass AndroidBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running android tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the android code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the android build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying android build to server';\r\n    }\r\n}\r\n\r\nclass IosBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running ios tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the ios code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the ios build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying ios build to server';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690ba546742157-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690ba546742157-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running android tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the android code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the android build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying android build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-24\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running ios tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-30\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the ios code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the ios build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-40\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying ios build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690ba546742157-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690ba546742157-45\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf6d4690be444753408\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$androidBuilder = new AndroidBuilder();\r\n$androidBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running android tests\r\n// Linting the android code\r\n// Assembling the android build\r\n// Deploying android build to server\r\n\r\n$iosBuilder = new IosBuilder();\r\n$iosBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running ios tests\r\n// Linting the ios code\r\n// Assembling the ios build\r\n// Deploying ios build to server</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf6d4690be444753408-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf6d4690be444753408-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-4\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-5\"><span class=\"crayon-c\">// Running android tests</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-6\"><span class=\"crayon-c\">// Linting the android code</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-7\"><span class=\"crayon-c\">// Assembling the android build</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-8\"><span class=\"crayon-c\">// Deploying android build to server</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-12\"> </div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-13\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-14\"><span class=\"crayon-c\">// Running ios tests</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-15\"><span class=\"crayon-c\">// Linting the ios code</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf6d4690be444753408-16\"><span class=\"crayon-c\">// Assembling the ios build</span></div><div class=\"crayon-line\" id=\"crayon-59adf6d4690be444753408-17\"><span class=\"crayon-c\">// Deploying ios build to server</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/a9e67955472c1afcad111aa202984192.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111797\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111797votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111797\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">Justin(李加庆)</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/4302cabf679254e36d325f1d9185b6c72.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python工程师一枚，对go、docker感兴趣，还在成长ing~~        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/justin_ygg\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/justin_ygg/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,设计模式", "front_image_path": "full/ae5704bda1df1c07deb1efa5f979b89054301d53.jpg"}
{"url_object_id": "206d408271cde72276773274eb31dfde", "title": "如何最有效的编写SQL", "create_time": "2017/07/12", "url": "http://blog.jobbole.com/111807/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/01/970c5be7812066919173f6ec5ab052ce.png"], "praise_num": "2", "comment_num": 0, "fav_num": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/the-most-effective-way-to-write-effective-sql-chan\">Emrah Mete</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32540\">ITeye-黑色巧克力</a>   </div><p><em>译者注：解决数据库级（SQL）工作上的问题，应该采用的是SET方法（整体的）而不是过程式的方法。下面来看看作者为什么这么说。</em></p>\n<p>编写有效的SQL查询是企业软件世界中最大的难题之一。</p>\n<p>每个公司在数据库开发项目中所面临的最根本的问题，在于开发环境中实现的性能不能在生产环境中实现。一般来说，存在性能损失是因为生产环境中的数据量要大得多。</p>\n<p>这些问题（运行缓慢的数据库操作）可能有各种各样的原因。本文将解释如何在编写查询时进行思考，如何思考是最基本的问题，也是解决此类问题的起点。</p>\n<p>观察发现SQL开发人员常使用过程方法编写查询。事实上，这是很自然的，因为用程序方法解决问题是最方便的人类逻辑解决方案。另一个方面，几乎所有的SQL开发人员都在同时编写Java、c#或其他编程语言的代码。Java、C#等可以用来训练开发人员以一种程序化的方式来培养他们的思维方式，因为当使用这些语言开发应用程序时，会使用很多类似的东西，比如IF .. THEN .. ELSE，FOR .. LOOP，WHILE .. DO， CASE .. WHEN。当然，在这种情况下，当将业务规则应用到一组数据时，意味着每个记录都是单独处理的(逐行处理)。这个过程方法在Java、c#等语言中使用。虽然使用语言开发软件是一种正确的方法，但在编写数据库级(SQL)的查询时，却不会产生同样的效果。</p>\n<p>下面用两种不同的方法来解决同一个示例问题，并将结果进行比较。看看CUSTOMERS表中对应的每个客户在SALES表中有多少条记录。</p>\n<p>过程式方法如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0418d5af549042652\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n      c.cust_id,\r\n       (SELECT COUNT (*)\r\n          FROM sh.sales s\r\n         WHERE s.cust_id = c.cust_id)\r\n          sa_count\r\n  FROM SH.CUSTOMERS c;\r\nPlan hash value: 881374884\r\nStatistics\r\n----------------------------------------------------------\r\n          0  recursive calls\r\n          0  db block gets\r\n    2454756  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5af549042652-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5af549042652-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-4\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">sa_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-8\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-9\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">881374884</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-10\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-11\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2454756</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-15\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5af549042652-21\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5af549042652-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c59d421762074b3cc17f430ca7ce714.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0418d5bb879073577\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n        c.cust_id, COUNT (s.cust_id) jh_count\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nPlan hash value: 716053480\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n        742  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bb879073577-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bb879073577-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jh_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-6\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-7\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">716053480</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-8\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-10\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">742</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-14\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bb879073577-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bb879073577-20\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c68cc95938e0f52a457d15867b33b3fc.png\"></div>\n<p>可以看到在两个查询的consistent gets数量之间的差异（当检查缓冲区缓存读到的块数据时）是巨大的。使用两种不同方法编写的查询在运行时导致不同时间。这种差别可以用性能来解释。</p>\n<p>在另一个例子中，常见的习惯是在SQL语句中调用PL/SQL函数。作为过程式工作的例子，也是一种解决问题的方法。还有其他一些影响在SQL内调用PL/SQL代码性能的不利因素，但在本文中，不会提到性能问题。</p>\n<p>下面编写查找客户表中每个客户的购买金额的代码。</p>\n<p>过程方法:</p>\n<p>在第一步中，创建一个PL/SQL函数来计算每个客户的总数，然后在代码和输出中调用这个函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0418d5bf572768973\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE OR REPLACE FUNCTION get_grand_total (\r\n   p_cust_id_in IN SH.CUSTOMERS.CUST_ID%TYPE)\r\n   RETURN NUMBER\r\nIS\r\n   r_grand_total   NUMBER;\r\nBEGIN\r\n   SELECT SUM (amount_sold)\r\n     INTO r_grand_total\r\n     FROM sh.sales\r\n    WHERE cust_id = p_cust_id_in;\r\n   RETURN r_grand_total;\r\nEND;\r\nSET AUTOTRACE ON\r\nSELECT cust_id, \r\n            get_grand_total (cust_id) grand_total \r\nFROM sh.customers;\r\nStatistics\r\n----------------------------------------------------------\r\n      55503  recursive calls\r\n          0  db block gets\r\n    3066293  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890447  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5bf572768973-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5bf572768973-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REPLACE </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">p_cust_id_in </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUSTOMERS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUST_ID</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">TYPE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NUMBER</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-4\"><span class=\"crayon-st\">IS</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">r_grand_total   </span><span class=\"crayon-v\">NUMBER</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-6\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-7\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">r_grand_total</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-9\"><span class=\"crayon-e\">     </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sales</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p_cust_id_in</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r_grand_total</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-12\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-13\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-14\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grand_total </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-16\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">customers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-17\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-18\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55503</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3066293</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-22\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-23\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-24\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890447</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-26\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-27\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5bf572768973-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5bf572768973-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b2618277a22d514ec13ef9a857ab3ec9.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf0418d5c3862538127\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\n  SELECT c.cust_id, SUM (amount_sold)\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n       1841  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890452  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf0418d5c3862538127-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf0418d5c3862538127-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-5\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-6\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-7\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-8\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-10\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">1841</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890452</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-15\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf0418d5c3862538127-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf0418d5c3862538127-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c419b66138cea074ab015cdd55726c10.png\"></div>\n<p>在本例中，通过查看consistent GETS和递归调用输出，我们可以看到相同的情况。</p>\n<p>我们的查询也是生成更高效的数据库操作的第一步，它考虑的是批处理，而不是逐行思考。在进行数据库操作时，批处理的方法会让你在一天结束时消耗更少的资源，从而提高工作效率。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111807\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111807votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111807\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,SQL,数据库", "front_image_path": "full/0e89c4879b2842f9c58098e98ad64d0a9d218103.jpg"}
{"url_object_id": "28306cda6bcd694e383903e031f1cdfe", "title": "C++17 相比于 C++14 的所有重大变化", "create_time": "2017/07/11", "url": "http://blog.jobbole.com/111801/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/05/2b6a906c5f04bf387ccf049e4a20b855.png"], "praise_num": "1", "comment_num": 0, "fav_num": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0636r1.html\">open-std</a>   译文出处：<a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/27551890\">d41d8c</a>   </div><h2>摘要</h2>\n<p>本文档列举了自C++14发布以来，到C++17 DIS（N4660）发布为止，应用于C++工作草案（working draft）的所有重大变化。重大变化（major changes）是以专门的文件（paper）的形式加入的。不是每个文件都单独在此提及，没有单独提及的文件在下面简要列出。CWG或LWG问题清单（issue list）中的问题解决方案（issue resolution）通常不包括在重大变化之内，但是包含问题解决方案的文件也会简要列出。</p>\n<h2>目录</h2>\n<ol>\n<li>删除或弃用的特性</li>\n<li>具有全局影响的新的核心语言特性</li>\n<li>具有局部影响的新的核心语言特性</li>\n<li>新的库特性</li>\n<li>对现有特性的修改</li>\n<li>杂项</li>\n<li>未列入的文件</li>\n<li>展示C++17的代码片段合集</li>\n</ol>\n<h2>删除或弃用的特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4086\" target=\"_blank\" rel=\"nofollow noreferrer\">N4086<i class=\"icon-external\"></i></a><br>\n概要：删除trigraph<br>\n注释：字符序列 ??! 不再表示 | 。实现（implementation）可以把类似trigraph的功能作为输入编码的一环。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0001r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0001R1<i class=\"icon-external\"></i></a><br>\n概要：删除register<br>\n注释：register仍然是保留字，但是不再具有任何语义。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0002r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0002R1<i class=\"icon-external\"></i></a><br>\n概要：删除bool类型的++运算<br>\n注释：前自增和后自增运算符不再接受bool类型的操作数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0003r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0003R5<i class=\"icon-external\"></i></a><br>\n概要：删除throw(A, B, C)<br>\n注释：形如throw(A, B, C)的动态异常规范（dynamic exception specification）不再是合法的。throw()保留，成为noexcept(true)的同义词。注意throw()的语义变化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a><br>\n概要：弃用static constexpr成员的重复声明<br>\n注释： 对于struct X { static constexpr int n = 10; };，int X::n;不再是定义，而是多余的重复声明，这种重复声明已被弃用。成员X::n是隐含的inline变量（见下文）。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4190\" target=\"_blank\" rel=\"nofollow noreferrer\">N4190<i class=\"icon-external\"></i></a><br>\n概要：删除auto_ptr、random_shuffle、&lt;functional&gt;中的过时部分<br>\n注释：在C++11已经被弃用并被更好的组件取代的功能将不再包含于C++17中。它们的名字仍然是保留的，实现可以选择继续提供。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0004r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0004R1<i class=\"icon-external\"></i></a><br>\n概要：删除被弃用的iostream成员<br>\n注释：同上</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0302r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0302R1<i class=\"icon-external\"></i></a><br>\n概要：删除std::function的内存分配器（allocator）支持<br>\n注释：多态函数包装器function不再具有接受内存分配器的构造函数。内存分配器支持对具有类型擦除（type-erase）功能的可复制类型来说很困难，可能无法有效实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a>（见下文）<br>\n概要：弃用一些C库（C library）头文件（header）<br>\n注释：“C库”（C library，这个术语指的是C++标准库的一部分， 而不是C标准库的一部分）中的以下头文件被弃用：&lt;ccomplex&gt;、&lt;cstdalign&gt;、&lt;cstdbool&gt;、&lt;ctgmath&gt;。注意&lt;ciso646&gt;头文件没有被弃用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0174r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0174R2<i class=\"icon-external\"></i></a><br>\n概要：弃用标准库中的陈旧部分<br>\n注释：以下组件被弃用：allocator&lt;void&gt;、raw_storage_iterator、get_temporary_buffer、is_literal_type、std::iterator。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0618r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0618R0<i class=\"icon-external\"></i></a><br>\n概要：弃用&lt;codecvt&gt;<br>\n注释：整个&lt;codecvt&gt;头文件（注意codecvt类并不在这个头文件中）被弃用。wstring_convert和wbuffer_convert也被弃用。这些功能难以正确使用，甚至有怀疑它们的规范是否正确。用户应该使用专用的文本处理库。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0371r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0371R1<i class=\"icon-external\"></i></a><br>\n概要：暂时弃用memory_order_consume<br>\n注释： 当前的“consume”内存序的语义被发现是不够的，需要重新定义。这项工作希望能在C++的下一版中完成。在进行这项工作的时间里，建议用户不要使用“consume”内存序，而是使用“acquire”内存序，以免将来遇到问题。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0521r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0521R0<i class=\"icon-external\"></i></a><br>\n概要：弃用shared_ptr::unique<br>\n注释：该成员函数暗示了没有实际提供的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：弃用result_of<br>\n注释：请改用新的trait：invoke_result。</p>\n<h2>具有全局影响的新的核心语言特性</h2>\n<p>这些是在不需要你知情或同意的情况下，你可能遇到的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0012r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0012R1<i class=\"icon-external\"></i></a><br>\n概要：异常规范（exception specification）作为类型系统的一部分<br>\n注释：函数的异常规范现在是函数类型的一部分：void f() noexcept(true); 和 void f() noexcept(false); 是具有不同类型的函数。函数指针可以按符合常理的方式转换。（但是这两个函数 f 不能构成重载。）这个变化加强了类型系统。例如，API可以通过类型系统要求回调函数不抛出异常。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0135r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0135R1<i class=\"icon-external\"></i></a><br>\n概要：保证的复制消除（guaranteed copy elision）<br>\n注释：prvalue和glvalue的含义已被修改，prvalue不再代表对象（object），而仅仅代表“初始化”（“initialization”）。返回prvalue的函数不再会复制对象（强制复制消除“mandatory copy elision”），并且有了新的从prvalue到glvalue的转换，叫做<i>temporary materialization conversion</i>。这个变化意味着复制消除是保证了的，而且甚至可以应用于不可移动或复制的类型。这允许你定义返回这种（不可移动或复制的）类型的函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0035r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0035R4<i class=\"icon-external\"></i></a><br>\n概要：过度对齐类型（over-aligned types——即alignment超过std::max_align_t的类型）的动态内存分配<br>\n注释：动态内存分配（operator new）现在可以支持过度对齐的类型，这个运算符的一个新的重载接受对齐要求（alignment）参数。仍然是由实现决定支持哪些对齐。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0145r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0145R3<i class=\"icon-external\"></i></a><br>\n概要：更严格的表达式求值顺序<br>\n注释：对某些子表达式的求值顺序的规定更多了。这个变化的一个重要方面是函数的各个实参现在以不确定（indeterminate）的顺序的求值（也就是说没有交错 interleaving），而以前只是未指定的（unspecified）。注意重载运算符的求值顺序和调用方式有关：如果按照运算符的形式调用，就和相应的内置运算符的顺序相同；如果按照函数调用的形式调用，就和一般的函数调用相同（也就是不确定的 indeterminate）。</p>\n<h2>具有局部影响的新的核心语言特性</h2>\n<p>这些是如果你要使用，你就需要知道的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4267\" target=\"_blank\" rel=\"nofollow noreferrer\">N4267<i class=\"icon-external\"></i></a><br>\n概要：u8字符字面量<br>\n注释：具有u8前缀的字符字面量产生一个在UTF-8中占有一个编码单元（code unit）的合法Unicode代码点（code point）对应的字符，换句话说，就是产生一个ASCII值。例如：u8’x’。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0245r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0245R1<i class=\"icon-external\"></i></a><br>\n概要：十六进制浮点数字面量<br>\n注释：具有十六进制底数和十进制指数的浮点数字面量： 0xC.68p+2, 0x1.P-126。C语言自从C99开始就支持这种语法， printf的%a可以输出这种形式的浮点数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4295\" target=\"_blank\" rel=\"nofollow noreferrer\">N4295<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0036r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0036R0<i class=\"icon-external\"></i></a><br>\n概要：fold表达式<br>\n注释：用于迭代地将二元运算符应用于参数包（parameter pack）的元素的便利语法：template &lt;typename …Args&gt; auto f(Args …args) { return <b>(0 + … + args)</b>; }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0127r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0127R2<i class=\"icon-external\"></i></a><br>\n概要：template &lt;auto&gt;<br>\n注释：模板的非类型形参可以用占位符类型auto声明。例如：<br>\n• template &lt;<b>auto</b> X&gt; struct constant { static constexpr auto value = X; };<br>\n• Delegate&lt;&amp;MyClass::some_function&gt;<br>\n（←_←第二个例子的完整版本见下文）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0091r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0091R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0512r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0512R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0433r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0433R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0620r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0620R0<i class=\"icon-external\"></i></a><br>\n概要：类模板参数推导<br>\n注释：类模板的模板参数现在可以从构造函数推导。例如 pair p(1, ‘x’); 定义 p 为 pair&lt;int, char&gt; 类型的变量（这不是HTML错误，模板实参是故意省略的）。显式的推导指引（deduction guide）是隐式推导的补充，显式的推导指引允许作者定制推导如何发生，或者禁止推导。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0292r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0292R2<i class=\"icon-external\"></i></a><br>\n概要：Constexpr if<br>\n注释：新的 if <b>constexpr</b> (<i>condition</i>) 语句根据常量表达式（constant expression）的值选择执行哪个分支。在模板的实例中，只有在条件（condition）具有合适的值的时候，对应的分支才会实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0305r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0305R1<i class=\"icon-external\"></i></a><br>\n概要：带初始化的选择语句<br>\n注释：选择语句 if 和 switch 有了一个新的、可选的初始化部分：if (auto it = m.find(key); it != m.end()) return it-&gt;second;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0170r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0170R1<i class=\"icon-external\"></i></a><br>\n概要：Constexpr lambda<br>\n注释：lambda表达式现在可以是常量表达式了：auto add = [](int a, int b) <b>constexpr</b> { return a + b; }; int arr[add(1, 2)];</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0018r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0018R3<i class=\"icon-external\"></i></a><br>\n概要：lambda捕获*this<br>\n注释：以前：[self = *this]{ self.f(); } 现在：[<b>*this</b>]{ f(); }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0607r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0607R0<i class=\"icon-external\"></i></a><br>\n概要：inline变量<br>\n注释：在头文件中：<b>inline</b> int n = 10; 所有定义都指代同一个实体。static constexpr 成员变量隐含地成为 inline 变量。（标准库中的常量，不论是已有的还是新增的，都已使用inline。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0217r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0217R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0615r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0615R0<i class=\"icon-external\"></i></a><br>\n概要：结构化绑定<br>\n注释：<b>auto [it, ins]</b> = m.try_emplace(key, a1, a2, a3);<br>\n可以分解数组、所有成员都是public的类、像pair、tuple和array一样遵循get&lt;N&gt;协议的自定义类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0061r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0061R1<i class=\"icon-external\"></i></a><br>\n概要：__has_include<br>\n注释：检查能否包含特定头文件的预处理运算符。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0188r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0188R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0189r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0189R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0212r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0212R1<i class=\"icon-external\"></i></a><br>\n概要：属性（attribute）[[fallthrough]]、[[nodiscard]]、[[maybe_unused]]（分别对应三个文件）<br>\n注释：一套新的标准化属性。属性没有必要的语义，但是鼓励实现发出或抑制适当的诊断（警告）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0137r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0137R1<i class=\"icon-external\"></i></a><br>\n概要：launder<br>\n注释：语言支持工具（“优化屏障optimisation barrier”），允许库重新使用存储（storage），并通过旧指针访问该存储（以前是不允许的）。（这是实现者的专家工具，预期不会在“正常”代码中出现）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0298r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0298R3<i class=\"icon-external\"></i></a><br>\n概要：字节类型<br>\n注释：新的类型byte在&lt;cstddef&gt;中定义（不在&lt;stddef.h&gt;，并且只定义在命名空间std中），它和unsigned char具有相同的布局，和现有的字符类型一样允许别名（aliasing），并且定义了按位操作。</p>\n<h2>新的库特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0226r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0226R1<i class=\"icon-external\"></i></a><br>\n概要：数学特殊函数（mathematical special functions）<br>\n注释：前国际标准ISO/IEC 29124:2010（数学特殊函数）的内容现在是C++的一部分。 这些函数只添加到&lt;cmath&gt; ，而没有添加到&lt;math.h&gt; ，并且只定义在命名空间std中。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0218r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0218R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0219r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0219R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0317r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0317R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0392r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0392R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0430r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0430R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0492r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0492R2<i class=\"icon-external\"></i></a><br>\n概要：文件系统<br>\n注释：文件系统技术规范（Filesystems Technical Specification）的内容现在是C++的一部分。 文件系统库允许以可移植的方式与目录和类似目录的结构进行交互（列出文件目录的内容，移动文件等）。 它主要以POSIX为模型，但它足够灵活，可以在各种系统上实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0336r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0336R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0394r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0394R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0452r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0452R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0467r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0467R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0502r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0502R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0518r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0518R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0523r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0523R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0574r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0574R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0623r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0623R0<i class=\"icon-external\"></i></a><br>\n概要：并行<br>\n注释：并行技术规范（Parallelism Technical Specification）的内容现在是C++的一部分。它为很多算法（algorithm）增加了重载，这些新的重载额外接受一个<i>执行策略</i>（<i>execution policy</i>）参数。它也加入了新的算法（见下文）。 支持三种执行策略，分别提供顺序（sequential），并行（ parallel）和向量化（vectorized）的执行。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a><br>\n概要：新算法<br>\n注释：并行技术规范为标准库添加了几种新算法。加入它们的动机是它们可以有效地并行执行，但也提供了通常的（不接受execution policy参数的）简单形式：for_each_n、reduce、transform_reduce、exclusive_scan、inclusive_scan、transform_exclusive_scan、transform_inclusive_scan。请注意， reduce看起来与现有的accumulate相似，但reduce不保证任何特定的操作顺序。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0254r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0254R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0403r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0403R1<i class=\"icon-external\"></i></a><br>\n概要：新类型：string_view（以及basic_string_view）<br>\n注释：新的string_view类是API接口的推荐类型，如果API需要读取字符串的内容，但是不需要取得字符串的所有权或者修改字符串。它可以从char指针构造，但是其他的字符串类型应该自己提供到string_view的隐式转换。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新类型：any<br>\n注释：类型any对可复制（copyable）的对象进行类型擦除（type-erase）。基本上可以用any做以下三件事：1. 把T类型的值放入其中。2. 复制它。 3. 检查它是否包含一个U类型的值，并且取出这个值，取出操作只有在U就是T的时候才会成功。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0088r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0088R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0393r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0393R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0510r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0510R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：variant<br>\n注释：variant是一个可辨识联合（disjoint union / discriminated union）。variant&lt;A, B, C&gt; 类型的值在任何时间都包含一个类型为A、B或C之一的值。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0307r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0307R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：optional<br>\n注释：一个可选的值。一个optional&lt;T&gt;表示一个T值，或者表示没有值（由类型nullopt_t标记）。在某些方面，可以认为它等同于variant&lt;nullopt_t, T&gt;，但是它具有专门的接口。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：新算法：sample<br>\n注释：从一个范围（range）里均匀选取最多n个元素作为样本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4169\" target=\"_blank\" rel=\"nofollow noreferrer\">N4169<i class=\"icon-external\"></i></a><br>\n概要：invoke<br>\n注释：以统一形式调用Callable实体（包括函数、函数对象和成员指针）的工具。这允许用户编写的库可以使用与标准的魔法（magic）<i>INVOKE</i>规则相同的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0077r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0077R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：is_invocable, is_invocable_r, invoke_result<br>\n注释：用于推断可调用性和调用结果的trait。（←_←看名字就知道应该和std::invoke配合使用。C++11的result_of也应该和invoke配合使用来着，如果只支持函数和函数对象应该直接用decltype，可惜名字取得不好，造成不少误用）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0067r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0067R5<i class=\"icon-external\"></i></a><br>\n概要：基本字符串转换<br>\n注释：函数to_chars和from_chars分别生成和解析数字的字符串表示。这些旨在形成用于替换printf和iostream格式化操作的高效、低级（low-level）的基础。它们遵循惯用的C++算法风格。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3911\" target=\"_blank\" rel=\"nofollow noreferrer\">N3911<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板void_t<br>\n注释：template &lt;class…&gt; using void_t = void; 在元编程中惊人地有用，简化了SFINAE的使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4389\" target=\"_blank\" rel=\"nofollow noreferrer\">N4389<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板bool_constant<br>\n注释：template &lt;bool B&gt; using bool_constant = integral_constant&lt;bool, B&gt;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0013r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0013R1<i class=\"icon-external\"></i></a><br>\n概要：逻辑操作元函数<br>\n注释：用于元编程的变长元函数conjunction、disjunction和negation。这些trait在元编程的意义上是短路（short-circuit）的：不影响结果的模板不会被实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0185r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0185R1<i class=\"icon-external\"></i></a><br>\n概要：用于SFINAE友好（SFINAE-friendly）swap的traits<br>\n注释：新的trait is_swappable、is_nothrow_swappable、is_swappable_with、is_nothrow_swappable_with。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/lwg2911\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG 2911<i class=\"icon-external\"></i></a><br>\n概要：Trait is_aggregate<br>\n注释：检查类型是否是聚合类（aggregate）。例如，可以用于判断泛型类型（←_←就是作为模板参数的类型）是应该用列表初始化（list-initialization）还是应该用非列表初始化（non-list-initialization）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0258r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0258r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0258R2<i class=\"icon-external\"></i></a><br>\n概要：Trait has_unique_object_representations<br>\n注释：这个trait可以用来判断特定的基于值的操作（例如比较和求hash值）是否可以用基于对象表示（object representation）的操作（例如memcmp）代替。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0007r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0007r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0007R1<i class=\"icon-external\"></i></a><br>\n概要：as_const<br>\n注释：给定lvalue x，std::as_const(x)返回相应的带const限定符的lvalue。std::as_const不能接受rvalue。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4280%2520%253Cview-source%3Ahttp%3A//wg21.link/n4280%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4280<i class=\"icon-external\"></i></a><br>\n概要：非成员函数size、data、empty<br>\n注释：新增的函数补充了现有的非成员函数begin、end等等。通过这些函数，可以用统一的方式访问标准容器和C风格数组。注意，和begin/end不同，这些新的函数不是定制点（customisation point），仅为方便起见提供。（←_←不知道原文作者为什么强调 the new functions are <i>not</i> customisation points，记得customization point是Ranges里的术语，而且在Ranges里这些非成员函数确实是customization point object）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0025r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0025r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0025R0<i class=\"icon-external\"></i></a><br>\n概要：clamp<br>\n注释：clamp(x, low, high)在x处于区间[low, high]内时返回x，否则返回最接近的边界（小于low就返回low，大于high就返回high）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0295r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0295r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0295R0<i class=\"icon-external\"></i></a><br>\n概要：gcd和lcm<br>\n注释：数论中的函数，计算两个整数的最大公约数和最小公倍数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4508%2520%253Cview-source%3Ahttp%3A//wg21.link/n4508%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4508<i class=\"icon-external\"></i></a><br>\n概要：shared_mutex类<br>\n注释：读-写互斥体，能够以共享或独占模式锁定。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0154r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0154r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0154R1<i class=\"icon-external\"></i></a><br>\n概要：干扰尺寸（interference sizes）<br>\n注释：两个新的实现定义常量hardware_constructive_interference_size、hardware_destructive_interference_size允许平台记录其高速缓存行大小（cache line size），以便用户避免虚假共享（破坏性干扰）并提高局部性（建设性干扰）。定义了两个单独的常量，以支持异构体系结构（heterogeneous architecture）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：元组（tuple）apply<br>\n注释：调用一个callable，参数从给定的元组中提取。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0209r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0209r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0209R2<i class=\"icon-external\"></i></a><br>\n概要：从元组构造<br>\n注释：新的函数模板make_from_tuple，功能是用给定元组的成员初始化T类型的值。它有点像刚提到的apply，但是它用于构造函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0005r4%2520%253Cview-source%3Ahttp%3A//wg21.link/p0005r4%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0005R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0358r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0358r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0358R1<i class=\"icon-external\"></i></a><br>\n概要：通用否定函数对象not_fn<br>\n注释：一个调用包装器（call wrapper），对它包装的callable取否定。它适用于具有任意数量参数的callable。它取代了旧的not1和not2包装器。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：memory resource<br>\n注释：一套新的组件，包括用于动态选择内存提供者的<i>memory resource</i>基类，以及三个具体实现（synchronized_pool_resource、unsynchronized_pool_resource、monotonic_buffer_resource）。有关用例参见下一条。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0337r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0337r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0337R0<i class=\"icon-external\"></i></a><br>\n概要：多态的内存分配器<br>\n注释：使用memory resource的内存分配器，memory resource可以在运行时改变，不是分配器类型的一部分。为方便使用，还提供了类型别名，如std::pmr::vector&lt;T&gt; = std::vector&lt;T, polymorphic_allocator&lt;T&gt;&gt;。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0253r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0253r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0253R1<i class=\"icon-external\"></i></a><br>\n概要：搜索器函数对象<br>\n注释：使用Boyer-Moore和Boyer-Moore-Horspool算法、用于搜索子字符串的函数对象，和一个使用这些函数对象的algorithm。</p>\n<h2>对现有特性的修改</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3928\" target=\"_blank\" rel=\"nofollow noreferrer\">N3928<i class=\"icon-external\"></i></a><br>\n概要：只接受一个参数的static_assert<br>\n注释：static_assert声明不再需要第二个参数：static_assert(N &gt; 0);</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4230\" target=\"_blank\" rel=\"nofollow noreferrer\">N4230<i class=\"icon-external\"></i></a><br>\n概要：嵌套命名空间声明<br>\n注释：namespace <b>foo::bar</b> { /* … */ }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4051\" target=\"_blank\" rel=\"nofollow noreferrer\">N4051<i class=\"icon-external\"></i></a><br>\n概要：允许用typename声明模板的模板参数（template template parameters）<br>\n注释：template &lt;template &lt;typename&gt; <b>typename</b> Tmpl&gt; struct X; 以前，模板的模板参数的声明只能用关键字class。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0184r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0184R0<i class=\"icon-external\"></i></a><br>\n概要：基于范围的for循环（range-based for）接受不同的begin/end类型<br>\n注释：for (<i>decl</i> : <i>expr</i>) 的规则受到重写，从以前的auto __begin = <i>begin-expr</i>, __end = <i>end-expr</i>;改成现在使用的 auto __begin = <i>begin-expr</i>; auto __end = <i>end-expr</i>;。这使得基于范围的for循环为新的Ranges（工作正在进行中）做好准备。</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0195r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0195R2<i class=\"icon-external\"></i></a><br>\n概要：<i>using-declaration</i> 中的包扩展（pack expansion）<br>\n注释：template &lt;typename …Args&gt; struct X : Args… { <b>using Args::f…;</b> };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0138r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0138R2<i class=\"icon-external\"></i></a><br>\n概要：固定枚举（fixed enum）值的构造<br>\n注释：类型为固定枚举 E 的变量可以用 E e { 5 }; 的形式定义，不再需要更啰嗦的 E e { E(5) };。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3922\" target=\"_blank\" rel=\"nofollow noreferrer\">N3922<i class=\"icon-external\"></i></a><br>\n概要：从花括号列表中推导auto的新规则<br>\n注释：以前，auto a{1, 2, 3}, b{1}; 是允许的，两个变量的类型都是 initializer_list&lt;int&gt;。现在 auto a{1, 2, 3}; 是错误的（ill-formed）， auto b{1}; 声明一个 int。注意，auto a = {1, 2, 3}, b = {1}; 保持不变，推导出 initializer_list&lt;int&gt; 。此改变预期作为缺陷解决方案（defect resolution）（在C++11和C++14模式下也会使用新规则）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4259\" target=\"_blank\" rel=\"nofollow noreferrer\">N4259<i class=\"icon-external\"></i></a><br>\n概要：uncaught_exceptions()<br>\n注释：函数uncaught_exception被弃用，新函数uncaught_exceptions返回计数而不是布尔值。以前的功能实际上是不能用的，<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4152\" target=\"_blank\" rel=\"nofollow noreferrer\">N4152<i class=\"icon-external\"></i></a>解释了细节。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4266\" target=\"_blank\" rel=\"nofollow noreferrer\">N4266<i class=\"icon-external\"></i></a><br>\n概要：命名空间（namespace）和枚举成员（enumerators）的属性（attributes）<br>\n注释：命名空间和枚举成员现在可以用属性标记。例如，这允许标记命名空间和枚举成员为弃用的（deprecated）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0028r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0028R4<i class=\"icon-external\"></i></a><br>\n概要：属性命名空间（attribute namespace）不需要重复指定<br>\n注释：当重复使用某一个属性命名空间时，这简化了命名空间限定。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4279\" target=\"_blank\" rel=\"nofollow noreferrer\">N4279<i class=\"icon-external\"></i></a><br>\n概要：改进了std::map和std::unordered_map的插入<br>\n注释：m.try_emplace(key, arg1, arg2, arg3) 在m中已经含有key的时候没有任何效果，否则插入一个从参数构造的新元素。这个接口（interface）保证即使实参绑定到右值引用（rvalue reference），如果没有发生插入，实参将不会被移动（not moved from）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0084r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0084R2<i class=\"icon-external\"></i></a><br>\n概要：emplace的返回类型<br>\n注释：顺序容器（sequence container）的过去返回void的emplace、emplace_front、emplace_back成员函数模板，现在返回刚刚插入的元素的引用。（关联容器不受影响，因为它们的插入函数一直都返回相关元素的迭代器。）</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0083r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0083R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0508r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0508R0<i class=\"icon-external\"></i></a><br>\n概要：set和map的拼接（splice）<br>\n注释：一个叫做<i>节点句柄</i>（<i>node handle</i>）的新机制加入了标准容器库。这个新机制允许在不同的map/set对象之间移植元素，而不会触及容器中的对象。此外，这个机制使得对提取（extract）出的键值进行可变访问成为可能。（←_←可以不使用mutable就修改set的元素和map的key了，当然在修改之前必须先提取出来，修改之后再插入回去，以保证set和map的内部结构不受破坏）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0272r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0272R1<i class=\"icon-external\"></i></a><br>\n概要：非const的string::data<br>\n注释：现在有了一个非const的basic_string::data重载，返回一个可变的（mutable）指针。此外，C++17允许向空终止符（null terminator）写入，只要写入的值是零。这使得字符串类更便于和C风格接口一起使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R2<i class=\"icon-external\"></i></a><br>\n概要：变长（variadic）版的lock_guard，名叫scoped_lock<br>\n注释：增加了变长的类模板scoped_lock&lt;Args…&gt;。它可以同时给多个可锁的对象（lockable object）加锁（使用和std::lock相同的算法），并且在析构函数中释放锁。一开始建议直接修改lock_guard，使它成为变长模板，但是发现这会造成ABI不兼容，所以现在我们有了新的类模板scoped_lock，它严格优于旧的lock_guard，所以不要使用lock_guard了。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0006r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0006R0<i class=\"icon-external\"></i></a><br>\n概要：变量模板trait<br>\n注释：对于每一个只包含一个静态成员常量的trait foo ，有了一个对应的变量模板foo_v&lt;Args…&gt;。foo_v&lt;Args…&gt;等价于foo&lt;Args…&gt;::value。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0152r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0152R1<i class=\"icon-external\"></i></a><br>\n概要：atomic::is_always_lock_free<br>\n注释：一个新的静态成员常量is_always_lock_free记录了给定原子类型（atomic type）的操作是否总是无锁（lock-free）的。现有的非静态成员函数可能对同一原子类型的不同值给出不同的答案。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0414r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0414R2<i class=\"icon-external\"></i></a><br>\n概要：数组的shared_ptr<br>\n注释：类模板shared_ptr现在可以支持C风格数组，只需传入T[]或T[N]作为模板参数。接受原始指针（raw pointer）的构造函数将会设置（install）合适的数组内存释放器（array deleter）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0163r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0163R0<i class=\"icon-external\"></i></a><br>\n概要：shared_ptr::weak_type<br>\n注释：shared_ptr&lt;T&gt;现在有了一个成员类型weak_type，它是weak_ptr&lt;T&gt;的别名。这使得泛型代码不需要解构shard_ptr的类型就可以知道对应的weak_ptr类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0030r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0030R1<i class=\"icon-external\"></i></a><br>\n概要：三维的斜边长（hypotenuse）<br>\n注释：三维斜边长hypot(x, y, z) （可以用来计算三维空间中两个点的距离）作为额外的重载加入 &lt;cmath&gt; （但没有加入&lt;math.h&gt;，并且只定义在命名空间std中）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0040r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0040R3<i class=\"icon-external\"></i></a><br>\n概要：更多用于未初始化内存的算法<br>\n注释：增加在未初始化的内存中构造对象和销毁对象的算法。包括分别进行默认初始化（default-initialization）和值初始化（value-initialization）的版本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4510\" target=\"_blank\" rel=\"nofollow noreferrer\">N4510<i class=\"icon-external\"></i></a><br>\n概要：内存分配器对不完整类型（incomplete type）的支持<br>\n注释：这项改变放宽了内存分配器对它的值类型（value type）的要求，使得值类型可以是不完整类型。例如，这允许递归的结构，如：struct X { std::vector&lt;X&gt; data; };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0092r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0092R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0505r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0505R0<i class=\"icon-external\"></i></a><br>\n概要：对&lt;chrono&gt;的改变<br>\n注释：为时间点（time point）增加了向上取整（floor）、向下取整（ceiling）、除法（division）和四舍六入五成双取整（rounding）。（←_←我们中出了一个除法。根据P0092R1来看，原文似有问题，增加的应该是绝对值abs而不是除法。）大多数成员函数成为constexpr函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0426r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0426R1<i class=\"icon-external\"></i></a><br>\n概要：char_traits的constexpr支持<br>\n注释：对于标准要求的所有的char_traits特化（也就是std::char_traits&lt;char&gt;、std::char_traits&lt;wchar_t&gt;、std::char_traits&lt;char16_t&gt;、std::char_traits&lt;char32_t&gt;这四个类），成员函数length、compare、find和assign现在都是constexpr成员函数了。这使得string view可以在常量表达式中更广泛地使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4387\" target=\"_blank\" rel=\"nofollow noreferrer\">N4387<i class=\"icon-external\"></i></a><br>\n概要：改善pair和tuple<br>\n注释：这个变化使得pair和tuple的构造函数变为“带条件的explicit”构造函数。只有在有某个元素的对应构造函数是explicit的时候，pair和tuple的构造函数才是explicit的。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0435r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0435R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0548r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0548R1<i class=\"icon-external\"></i></a><br>\n概要：对common_type的改变<br>\n注释：因为如果不改一下common_type，就不能称为新标准了……</p>\n<h2>杂项</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a><br>\n概要：C++引用C11<br>\n注释：C++标准现在正式地（normatively）引用C11 (ISO/IEC 9899:2011) 为“C标准”（“The C Standard”）了。这不仅是应对ISO的要求（ISO要求对其他国际标准的引用必须引用最新发布的版本，而不是某个历史版本），也使得我们可以使用aligned_alloc，它对于改进动态内存管理（dynamic memory management）非常有用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0180r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0180R2<i class=\"icon-external\"></i></a><br>\n概要：保留的（reserved）命名空间<br>\n注释：所有形如 std<i>N</i> （其中 <i>N</i> 是一串数字）的命名空间现在被保留了。（用户不能使用了。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0175r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0175R1<i class=\"icon-external\"></i></a><br>\n概要：C库总览（synopsis）<br>\n注释：一个纯粹非技术性（editorial）的变化：标准库的“C库”部分的所有头文件的内容现在在C++标准文档中以完整的总览（synopsis）的形式展现（也就是完整列出每个标准头文件包含的完整声明），而不再是像以前一样只列出名字。这使得与C语言中的语义不同的地方（例如增加的重载，针对language linkage的重载）更容易理解。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4262\" target=\"_blank\" rel=\"nofollow noreferrer\">N4262 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0134r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0134R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0391r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0391R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4284\" target=\"_blank\" rel=\"nofollow noreferrer\">N4284<i class=\"icon-external\"></i></a><br>\n概要：术语“forwarding reference”、“default member initializer”、“templated entity”、“contiguous iterator”（分别对应四个文件）<br>\n注释：这些变化没有正式的（normative）影响，但是它们为迄今为止只从语言规则中<i>出现</i>的概念建立了官方术语。精确和众所周知的术语简化了关于C++的讨论，也简化了规范。</p>\n<h2>未列入的文件</h2>\n<p>以下文件在委员会会议（committee meeting）上被接受，但是它们的内容过于专门，不能称为单独的特性：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4258\" target=\"_blank\" rel=\"nofollow noreferrer\">N4258<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4268\" target=\"_blank\" rel=\"nofollow noreferrer\">N4268<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4277\" target=\"_blank\" rel=\"nofollow noreferrer\">N4277<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4285\" target=\"_blank\" rel=\"nofollow noreferrer\">N4285<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0017r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0017R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0031r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0031R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0074r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0074R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0270r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0270R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0283r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0283R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0296r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0296R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0503r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0503R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0509r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0509R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0516r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0516R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0517r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0517R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0558r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0558R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0599r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0599R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0612r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0612R0<i class=\"icon-external\"></i></a>。</p>\n<p>以下文件包含被接受为缺陷报告（defect report）的问题（issue）。处理CWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4192\" target=\"_blank\" rel=\"nofollow noreferrer\">N4192<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4457\" target=\"_blank\" rel=\"nofollow noreferrer\">N4457<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0164r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0164R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0167r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0167R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0263r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0263R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0384r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0384R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0398r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0398R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0490r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0490R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0507r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0507R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0519r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0519R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0520r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0520R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0522r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0522R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0575r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0575R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0576r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0576R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0613r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0613R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0622r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0622R0<i class=\"icon-external\"></i></a>。处理LWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4245\" target=\"_blank\" rel=\"nofollow noreferrer\">N4245<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4366\" target=\"_blank\" rel=\"nofollow noreferrer\">N4366<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4383\" target=\"_blank\" rel=\"nofollow noreferrer\">N4383<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4525\" target=\"_blank\" rel=\"nofollow noreferrer\">N4525<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0304r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0304R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0397r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0397R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0610r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0610R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0625r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0625R0<i class=\"icon-external\"></i></a>。每份文件中只有部分问题被选出，具体细节见会议记录（meeting minutes）。以下单独的文件解决特定的问题：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4089\" target=\"_blank\" rel=\"nofollow noreferrer\">N4089<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4261\" target=\"_blank\" rel=\"nofollow noreferrer\">N4261<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0033r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0033R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0136r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0136R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0250r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0250R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0418r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0418R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0513r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0513R0<i class=\"icon-external\"></i></a>。历年来解决的问题（accepted issue）的完整列表公布在<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">CWG issues list<i class=\"icon-external\"></i></a>和<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG issues list<i class=\"icon-external\"></i></a>，二者会经常更新。</p>\n<h2>展示C++17的代码片段合集</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf03ec4cab427175266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstd::unordered_map&lt;std::string, std::unique_ptr&lt;Foo&gt;&gt; items;\r\nstd::vector&lt;std::unique_ptr&lt;Foo&gt;&gt; standby;\r\n\r\n// 如果没有'id'元素，则把'foo'作为'id'元素插入。\r\n// 否则把'foo'保存起来以备之后使用，将其放入standby中。\r\n\r\n// C++17以前\r\n\r\nvoid f(std::string id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  auto it = items.find(id);\r\n  if (it == items.end()) {\r\n    auto p = items.emplace(std::move(id), std::move(foo));\r\n    p.first-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.push_back(std::move(foo));\r\n    standby.back()-&gt;wait_for_notification();\r\n  }\r\n\r\n  // 注意：\r\n  // * 变量'id'不能再次使用（moved-from）；或者……\r\n  // * ……需要使用'const string&amp; id'作为参数，并强制复制。\r\n  // * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。\r\n  // * （不能无条件调用emplace，因为它可能导致*foo被析构。）\r\n}\r\n\r\n// 使用C++17\r\n\r\nvoid f(std::string_view id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  if (auto [pos, inserted] = items.try_emplace(id, std::move(foo)); inserted) {\r\n    pos-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.emplace_back(std::move(foo))-&gt;wait_for_notification();\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cab427175266-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cab427175266-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-1\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unordered_map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-4\"><span class=\"crayon-c\">// 如果没有'id'元素，则把'foo'作为'id'元素插入。</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-5\"><span class=\"crayon-c\">// 否则把'foo'保存起来以备之后使用，将其放入standby中。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-7\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-8\"> </div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-9\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">auto </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">first</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-18\"> </div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 注意：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 变量'id'不能再次使用（moved-from）；或者……</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * ……需要使用'const string&amp; id'作为参数，并强制复制。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * （不能无条件调用emplace，因为它可能导致*foo被析构。）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-26\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-28\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">string_view </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-29\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">try_emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-31\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cab427175266-33\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cab427175266-34\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>下面的代码片段展示了template &lt;auto&gt;的用法，例子中的类模板将一个非成员函数转发给绑定了类实例的成员函数，并且成员函数是这个类模板的<i>类型</i>的一部分。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf03ec4cc3199300418\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\n\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt; // 两个参数：一个类型参数，一个非类型参数\r\nstruct Delegate { /* ... */ };\r\n\r\nint n = Delegate&lt;MyComplexClass, &amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);\r\n\r\n// 使用C++17\r\n\r\ntemplate &lt;auto&gt; struct Delegate;                  // 一个（非类型）参数\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt;\r\nstruct Delegate&lt;MF&gt;  { /* ... */ };              // 实现方法和以前相同，但现在使用偏特化（partial specialization）\r\n\r\nint n = Delegate&lt;&amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cc3199300418-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cc3199300418-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-2\"> </div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-3\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 两个参数：一个类型参数，一个非类型参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-4\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-8\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-10\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">auto</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                  </span><span class=\"crayon-c\">// 一个（非类型）参数</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-11\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-12\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">MF</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 实现方法和以前相同，但现在使用偏特化（partial specialization）</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cc3199300418-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cc3199300418-14\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>下面的代码片段展示fold表达式在泛型代码中的用法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf03ec4ccc618236135\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 对于参数包f中的所有元素，调用f(n)。\r\ntemplate &lt;typename ...F&gt;\r\nvoid ApplyAll(int n, const F&amp;... f) {\r\n   (f(n), ...); // 一元fold (over the comma operator)\r\n}\r\n\r\n// 对于参数包f中的所有元素，计算f(a, b)，返回和。\r\ntemplate &lt;typename ...F&gt;\r\nint ApplyAndSum(int a, int b, const F&amp;... f) {\r\n   return (f(a, b) + ... + 0); // 二元fold\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4ccc618236135-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4ccc618236135-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4ccc618236135-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4ccc618236135-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4ccc618236135-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4ccc618236135-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-1\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，调用f(n)。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4ccc618236135-2\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-3\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4ccc618236135-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 一元fold (over the comma operator)</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4ccc618236135-6\"> </div><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-7\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，计算f(a, b)，返回和。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4ccc618236135-8\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-9\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAndSum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4ccc618236135-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 二元fold</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4ccc618236135-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>下面的代码片段展示shared_ptr对数组的支持。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf03ec4cd2209255462\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\nstd::shared_ptr&lt;char&gt; p(new char[N], std::default_delete&lt;char[]&gt;()); // 如果不提供删除器（deleter）就错了\r\n\r\n// 使用C++17\r\nstd::shared_ptr&lt;char[]&gt; p(new char[N]); // 删除器自动使用“delete[]”</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cd2209255462-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cd2209255462-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cd2209255462-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf03ec4cd2209255462-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf03ec4cd2209255462-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf03ec4cd2209255462-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cd2209255462-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">default_delete</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 如果不提供删除器（deleter）就错了</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cd2209255462-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf03ec4cd2209255462-4\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59adf03ec4cd2209255462-5\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 删除器自动使用“delete[]”</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111801\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111801votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111801\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "开发,C++", "front_image_path": "full/b7ccda3a3b2f793882325f528f2211d69c7b4f95.jpg"}
{"url_object_id": "22720e0ebb8efa08e36bb42b57357be2", "title": "累到想删库，程序员职业倦怠的真实现状", "create_time": "2017/07/10", "url": "http://blog.jobbole.com/111762/", "front_image_url": ["https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w"], "praise_num": "5", "comment_num": 1, "fav_num": 7, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.kennethreitz.org/essays/the-reality-of-developer-burnout\">kennethreitz</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：Kenneth Reitz 是一个知名的程序员，特别是在 Python 圈，他编写了 Requests / Records / Maya 等著名 Python 库，出过书《The Hitchhiker’s Guide to Python》。他在从 2001 年起就职于 Heroku，同时还是 Python 软件基金会董事会成员。对了，他以前还是个大胖子，2016 年后来减肥成功。他喜欢街拍，并且还是一个电子音乐制作人。</p>\n<p><img class=\"aligncenter\" src=\"https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w\" width=\"500\" height=\"333\"></p>\n<p>很不幸，倦怠在软件开发中是一个非常真实的现象，尤其是创立并维护一个具有大量用户的开源项目。就这个话题，我深有体会。所以我来分析我的个人经验。</p>\n<p>即使软件编程是你在这世上最喜欢的活动之一，每个整天写代码的人都会经历这样的事情，突然感觉“我想做别的事情，而不是坐在这写代码”。</p>\n<blockquote><p>你突然意识到，你已把冰激凌当成三餐，持续吃了好几年。你已厌倦了冰淇淋，不想再看到它。但偶尔吃冰淇淋的人不明白这一点，他们会想：你怎么会不想要冰淇淋了呢？—— Gary Bernhardt</p></blockquote>\n<p>我对软件开发的倦怠情况有一些个人经验，还有几个如何正视、防范和简单应对的小窍门。</p>\n<h3>目标的必然衰败</h3>\n<p>在 2011 年，我为自己设定了一些开源社区的目标后，我很努力地为此工作，有着好运相伴，我取得了成功（特别是 Requests 项目）。随着项目的人气不断攀升，我对继续创建新项目的动力下降了。同时，为了满足成功项目带来的大量用户群所提出的要求，我的负担越来越重，而维护项目的压力也在不断增加。</p>\n<p>这是我想要的，是吗？</p>\n<blockquote><p>倦怠十分狡猾，它悄然而至。它慢慢地折磨你，直到你认为这种感觉已经成为了新常态，这时你再也无法轻易跳出自己挖的坑了。—— Zach Holman</p></blockquote>\n<h3>410 GONE 网络失踪</h3>\n<p>我记得曾经有一次，我躺在沙发上，也就是我现在坐的地方，一边解决新出现的慢性偏头痛 (NDPH)，一边回顾我的生活。就像看推文一样，我不断地刷新并思考过当时软件世界中的一些政治问题，我发现自己对这些事情非常紧张，这本身就是一个问题。不仅如此，而且我过于在意我在推特上关注的人提出的公开观点，</p>\n<p>一旦我认识到这一点，我立刻意识到这是一个很严重的问题，必须立即停止它。我的第一个想法是提出所谓的“410 错误”情况。当然，我没有这样做，但是我很重视这个问题。</p>\n<blockquote><p>410 GONE 是 Mark Pilgrim 的一个沸沸扬扬的举动，他作为 Python 的开发者以及一个普通人，因为一些未知的原因，选择将自己从开发者社区隔离。我认为这可能是因为他感受到了来自开源“领导者”地位的压力，想要保持自己的身份认同。他突然从互联网上删除了所有的公共代码，这样所有的用户只能重新定向，访问其他非官方镜像。</p>\n<p>伯乐在线补注：Mark Pilgrim 是《Dive into Python | 深入 Python》的作者。他不仅删代码，并且他的社交账号 GitHub、Google+、Reddit、Twitter，也全部清空了。</p></blockquote>\n<p>在我看来，这是倦怠周期的缩影以及最坏的情况。我差一点就从 GitHub 上删除所有的项目，从 SpeakerDeck 上删除所有演讲的幻灯片，搞掉我自己的网站，然后在平静的生活中继续前进。</p>\n<p>但最后我没有这样做，为什么？因为这些是世界上对我最重要的事情。为什么我要破坏那些我努力创造、引以为傲的东西？</p>\n<h3>“只发布”模式</h3>\n<p>所以，我决定找到问题的根源，并解决它们。我意识到，我的世界已经挤入太多人，没有委派足够的人手，并且需要他人的帮助来维持我的项目。我不想失去我在社区中珍视的位置，它能够影响这个我极其重视的世界。</p>\n<p>所以，我选择取消关注推特上的所有人。我停止关注科技趋势，也不再阅读 Hacker News。我进入了“只发布”模式。</p>\n<p>这是一个重大的举措，就和我见过的很多其他开发者一样（一般比较隐晦，并不明确），这是一个从开源软件开发中，缓解压力的好方法。远离喧嚣，善待自己。</p>\n<p>今天，我在社交媒体上关注了一些人，人数不多，但足以让我处于一个相对较忙的状态，而过去很长一段时间我都过于忙碌了。这一切很容易就能实现。</p>\n<h3>委派</h3>\n<p>当成千上万的活跃用户使用你的软件，或即使只有你的同事时，你很容易感到懈怠，因为你是项目的唯一联系人。所以，我已经学会以新的方式委托并加强合作。</p>\n<p>针对 Requests 项目，我有两个合作维护者，他们帮忙处理收到的问题（issues），并解决诸如安全更新的事情。这大大降低了项目施加在我身上的压力，也帮助他们成为了 Python 社区的活跃分子。</p>\n<h3>我今天的平衡生活</h3>\n<p>所有的这些都是许多年前的事了，如今我的生活已经取得了一个良好的平衡。我在个人的兴趣爱好，如音乐制作、摄影上花费了大量的空闲时间（我甚至今年要出一张专辑）。我今年出版了一本书，另一个人花了大量的时间与精力参与其中，这本书的出版离不开他/她的鼎力相助。</p>\n<p><span style=\"color: #ff0000;\">有着写代码以外的爱好，实在是太重要了。</span></p>\n<p>我没有和往常那样，将编程作为一项娱乐消遣的工作，但我将再一次重新出发。我不觉得现在缺少了什么，但我的夜生活已经不同往昔，不再 100% 被代码完全占据了。</p>\n<p>开源的本质就是合作/协作。如果你发现自己倦怠了，累了，也许你需要找到一种与他人协作的新方式，来帮助你做最好的事情。你会发现，其他人可以通过做他们擅长的事，来帮助你做自己擅长的事。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111762\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111762votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111762\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 30</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "职场,程序员,职场", "front_image_path": "full/5e8775a4506c4ad37e2e965d436efb7888507510.jpg"}
{"url_object_id": "2b13e3e5df22fd0e812a87b4e135b363", "title": "如何做到“恰好一次”地传递数十亿条消息", "create_time": "2017/07/12", "url": "http://blog.jobbole.com/111809/", "front_image_url": ["http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png"], "praise_num": "1", "comment_num": 0, "fav_num": 6, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://segment.com/blog/exactly-once-delivery/\">Amir Abu Shareb</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32533\">ITeye-雁惊寒</a>   </div><p><em>译者注：在分布式领域中存在着三种类型的消息投递语义，分别是：最多一次（at-most-once）、至少一次（at-least-once）和恰好一次（exactly-once）。本文作者介绍了一个利用Kafka和RocksDB来构建的“恰好一次”消息去重系统的实现原理。以下是译文。</em></p>\n<p>对任何一个数据流水线的唯一要求就是不能丢失数据。数据通常可以被延迟或重新排序，但不能丢失。</p>\n<p>为了满足这一要求，大多数的分布式系统都能够保证“<a href=\"http://www.cloudcomputingpatterns.org/at_least_once_delivery/\" target=\"_blank\">至少一次</a>”的投递消息技术。实现“至少一次”的投递技术通常就是：“重试、重试、再重试”。在你收到消费者的确认消息之前，你永远不要认为消息已经投递过去。</p>\n<p>但“至少一次”的投递并不是用户想要的。用户希望消息被投递一次，并且仅有一次。</p>\n<p>然而，<a href=\"http://bravenewgeek.com/you-cannot-have-exactly-once-delivery/\" target=\"_blank\">实现“恰好一次”的投递需要完美的设计</a>。每种投递失败的情况都必须认真考虑，并设计到架构中去，因此它不能在事后“挂到”现有的实现上去。即使这样，“只有一次”的投递消息几乎是不可能的。</p>\n<p>在过去的三个月里，我们构建了一个全新的去重系统，以便在面对各种故障时能让系统尽可能实现“恰好一次”的投递。</p>\n<p>新系统能够跟踪旧系统100倍的消息数量，并且可靠性也得到了提高，而付出的代价却只有一点点。下面我们就开始介绍这个新系统。</p>\n<p><strong>问题所在</strong></p>\n<p>Segment内部的大部分系统都是通过重试、消息重新投递、锁定和<a href=\"https://en.wikipedia.org/wiki/Two-phase_commit_protocol\" target=\"_blank\">两阶段提交</a>来优雅地处理故障。但是，有一个特例，那就是将数据直接发送到公共API的客户端程序。</p>\n<p>客户端（特别是移动客户端）经常会发生网络问题，有时候发送了数据，却没有收到API的响应。</p>\n<p>想象一下，某天你乘坐公共汽车，在iPhone上使用HotelTonight软件预订房间。该应用程序将数据上传到了Segment的服务器上，但汽车突然进入了隧道并失去了网络连接。你发送的某些数据在服务器上已经被处理，但客户端却无法收到服务器的响应消息。</p>\n<p>在这种情况下，即使服务器在技术上已经收到了这些确切的消息，但客户端也会进行重试并将相同的消息重新发送给Segment的API。</p>\n<p>从我们服务器的统计数据来看，在四个星期的窗口时间内，大约有0.6％的消息似乎是我们已经收到过的重复消息。</p>\n<p>这个错误率听起来可能并不是很高。但是，对于一个能创造数十亿美元效益的电子商务应用程序来说，0.6％的出入可能意味着盈利和数百万美元损失之间的差别。</p>\n<p><strong>对消息进行去重</strong></p>\n<p>现在，我们认识到问题的症结了，我们必须删除发送到API的重复消息。但是，该怎么做呢？</p>\n<p>最简单的思路就是使用针对任何类型的去重系统的高级API。在Python中，我们可以将其表示为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adda55b558d322541031\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef dedupe(stream):  \r\n  for message in stream:  \r\n    if has_seen(message.id):   \r\n      discard(message)  \r\n    else:  \r\n      publish_and_commit(message)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adda55b558d322541031-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b558d322541031-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b558d322541031-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b558d322541031-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b558d322541031-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b558d322541031-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adda55b558d322541031-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">dedupe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b558d322541031-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b558d322541031-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has_seen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b558d322541031-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">discard</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b558d322541031-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b558d322541031-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">publish_and_commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>对于数据流中的每个消息，首先要把他的id（假设是唯一的）作为主键，检查是否曾经见过这个特定的消息。如果以前见过这个消息，则丢弃它。如果没有，则是新的，我们应重新发布这个消息并以原子的方式提交消息。</p>\n<p>为了避免存储所有的消息，我们会设置“去重窗口”这个参数，这个参数定义了在消息过期之前key存储的时长。只要消息落在窗口时间之外，我们就认为它已过期失效。我们要保证在窗口时间内某个给定ID的消息只发送一次。</p>\n<p>这个行为很容易描述，但有两个方面需要特别注意：读/写性能和正确性。</p>\n<p>我们希望系统能够低延迟和低成本的对通过流水线的数十亿个事件进行去重。更重要的是，我们要确保所有的事件都能够被持久化，以便可以从崩溃中恢复出来，并且不会输出重复的消息。</p>\n<p><strong>架构</strong></p>\n<p>为了实现这一点，我们创建了一个“两阶段”架构，它读入Kafka的数据，并且在四个星期的时间窗口内对接收到的所有事件进行去重。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png\" width=\"649\" height=\"363\"></div>\n<div style=\"text-align: center\">去重系统的高级架构图</div>\n<div style=\"text-align: center\"></div>\n<p><strong>Kafka的拓扑结构</strong></p>\n<p>要了解其工作原理，首先看一下<a href=\"https://kafka.apache.org/\" target=\"_blank\">Kafka</a>的流拓扑结构。所有传入消息的API调用都将作为单独的消息进行分离，并读入到Kafka输入主题（input topic）中。</p>\n<p>首先，每个传入的消息都有一个由客户端生成的具有唯一性的messageId标记。在大多数情况下，这是一个UUIDv4（我们考虑切换到<a href=\"https://segment.com/blog/a-brief-history-of-the-uuid/\" target=\"_blank\">ksuids</a>）。 如果客户端不提供messageId，我们会在API层自动分配一个。</p>\n<p>我们不使用矢量时钟或序列号，因为我们希望能降低客户端的复杂性。使用UUID可以让任何人轻松地将数据发送到我们的API上来，因为几乎所有的主要语言都支持它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adda55b55ad299209444\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{  \r\n  \"messageId\": \"ajs-65707fcf61352427e8f1666f0e7f6090\",  \r\n  \"anonymousId\": \"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\",  \r\n  \"timestamp\": \"2017-06-26T14:38:23.264Z\",  \r\n  \"type\": \"page\"  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adda55b55ad299209444-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55ad299209444-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55ad299209444-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55ad299209444-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55ad299209444-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55ad299209444-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adda55b55ad299209444-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55ad299209444-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"messageId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ajs-65707fcf61352427e8f1666f0e7f6090\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55ad299209444-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"anonymousId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55ad299209444-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2017-06-26T14:38:23.264Z\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55ad299209444-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"page\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55ad299209444-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>为了能够将消息持久化，并能够重新发送，一个个的消息被保存到Kafka中。消息以messageId进行分区，这样就可以保证具有相同messageId的消息能够始终由同一个消费者处理。</p>\n<p>这对于数据处理来说是一件很重要的事情。我们可以通过路由到正确的分区来查找键值，而不是在整个中央数据库的数百亿条消息中查找，这种方法极大地缩小了查找范围。</p>\n<p>去重“worker”（worker：工人。译者注，这里表示的是某个进程。为防止引起歧义，下文将直接使用worker）是一个Go程序，它的功能是从Kafka输入分区中读入数据，检查消息是否有重复，如果是新的消息，则发送到Kafka输出主题中。</p>\n<p>根据我们的经验，worker和Kafka拓扑结构都非常容易掌握。我们无需使用一组遇到故障时需要切换到副本的庞大的<a href=\"https://memcached.org/\" target=\"_blank\">Memcached</a>实例。相反，我们只需使用零协同的嵌入式<a href=\"http://rocksdb.org/\" target=\"_blank\">RocksDB</a>数据库，并以非常低的成本来获得持久化存储。</p>\n<p><strong>RocksDB的worker进程</strong></p>\n<p>每一个worker都会在本地EBS硬盘上存放了一个RocksDB数据库。 RocksDB是由<a href=\"https://www.facebook.com/notes/facebook-engineering/under-the-hood-building-and-open-sourcing-rocksdb/10151822347683920/\" target=\"_blank\">Facebook开发的嵌入式键值存储系统</a>，它的性能非常高。</p>\n<p>每当从输入主题中过来的消息被消费时，消费者通过查询RocksDB来确定我们之前是否见过该事件的messageId。</p>\n<p>如果RocksDB中不存在该消息，我们就将其添加到RocksDB中，然后将消息发布到Kafka输出主题。</p>\n<p>如果消息已存在于RocksDB，则worker不会将其发布到输出主题，而是更新输入分区的偏移，确认已处理过该消息。</p>\n<p><strong>性能</strong></p>\n<p>为了让我们的数据库获得高性能，我们必须对过来的每个事件满足三种查询模式：</p>\n<ul>\n<li>检测随机key的存在性，这可能不存在于我们的数据库中，但会在key空间中的任何地方找到。</li>\n<li>高速写入新的key</li>\n<li>老化那些超出了“去重窗口”的旧的key</li>\n</ul>\n<p>实际上，我们必须不断地检索整个数据库，追加新的key，老化旧的key。在理想情况下，这些发生在同一数据模型中。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9376/72903fab-cccf-3cad-865c-1ff55f16cc47.png\" width=\"650\" height=\"346\"></div>\n<div style=\"text-align: center\">我们的数据库必须满足三种独立的查询模式</div>\n<div style=\"text-align: center\"></div>\n<p>一般来说，这些性能大部分取决于我们数据库的性能，所以应该了解一下RocksDB的内部机制来提高它的性能。</p>\n<p>RocksDB是一个<a href=\"https://en.wikipedia.org/wiki/Log-structured_merge-tree\" target=\"_blank\">日志结构合并树（log-structured-merge-tree， 简称LSM）</a>数据库，这意味着它会不断地将新的key附加到磁盘上的预写日志（write-ahead-log）中，并把排序过的key存放在内存中作为memtable的一部分。</p>\n<div style=\"text-align: center\"><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9378/c8ba4f20-2a19-3d7d-9757-35a21939ad9b.png\" width=\"650\" height=\"316\"><br>\nkey存放在内存中作为memtable的一部分</div>\n<div></div>\n<div>写入key是一个非常快速的过程。新的消息以追加的方式直接保存到磁盘上，并且数据条目在内存中进行排序，以提供快速的搜索和批量写入。</div>\n<div>每当写入到memtable的条目达到一定数量时，这些条目就会被作为SSTable（排序的字符串表）持久化到磁盘上。由于字符串已经在内存中排过序了，所以可以将它们直接写入磁盘。</div>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9380/51764a44-a86b-3b2b-a51f-e3d76fb99e0d.png\" width=\"650\" height=\"442\"></div>\n<div style=\"text-align: center\">当前的memtable零级写入磁盘</div>\n<div style=\"text-align: center\"></div>\n<p>以下是在我们的生产日志中写入的示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adda55b55b4077459034\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[JOB 40] Syncing log #655020  \r\n[default] [JOB 40] Flushing memtable with next log file: 655022  \r\n[default] [JOB 40] Level-0 flush table #655023: started  \r\n[default] [JOB 40] Level-0 flush table #655023: 15153564 bytes OK  \r\n[JOB 40] Try to delete WAL files size 12238598, prev total WAL file size 24346413, number of live WAL files 3.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adda55b55b4077459034-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55b4077459034-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55b4077459034-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55b4077459034-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55b4077459034-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adda55b55b4077459034-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Syncing </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655020  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55b4077459034-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flushing </span><span class=\"crayon-e\">memtable </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">next </span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">655022</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55b4077459034-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: started  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55b4077459034-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: 15153564 bytes OK  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55b4077459034-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Try</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">files </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12238598</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prev </span><span class=\"crayon-e\">total </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24346413</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-i\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>每个SSTable是不可变的，一旦创建，永远不会改变。这是什么写入新的键这么快的原因。无需更新文件，无需写入扩展。相反，在带外压缩阶段，同一级别的多个SSTable可以合并成一个新的文件。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9382/50bf7dc4-1153-30fb-b263-d3d887451cec.png\" width=\"650\" height=\"422\"></div>\n<p> </p>\n<p>当在同一级别的SSTables压缩时，它们的key会合并在一起，然后将新的文件升级到下一个更高的级别。</p>\n<p>看一下我们生产的日志，可以看到这些压缩作业的示例。在这种情况下，作业41正在压缩4个0级文件，并将它们合并为单个较大的1级文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adda55b55bc641337241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/data/dedupe.db$ head -1000 LOG | grep \"JOB 41\"  \r\n[JOB 41] Compacting 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1, score 1.00  \r\n[default] [JOB 41] Generated table #655024: 1550991 keys, 69310820 bytes  \r\n[default] [JOB 41] Generated table #655025: 1556181 keys, 69315779 bytes  \r\n[default] [JOB 41] Generated table #655026: 797409 keys, 35651472 bytes  \r\n[default] [JOB 41] Generated table #655027: 1612608 keys, 69391908 bytes  \r\n[default] [JOB 41] Generated table #655028: 462217 keys, 19957191 bytes  \r\n[default] [JOB 41] Compacted 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1 =&gt; 263627170 bytes</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adda55b55bc641337241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55bc641337241-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55bc641337241-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55bc641337241-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55bc641337241-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55bc641337241-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55bc641337241-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55bc641337241-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adda55b55bc641337241-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dedupe</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"JOB 41\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55bc641337241-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.00</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55bc641337241-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655024: 1550991 keys, 69310820 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55bc641337241-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655025: 1556181 keys, 69315779 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55bc641337241-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655026: 797409 keys, 35651472 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55bc641337241-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655027: 1612608 keys, 69391908 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55bc641337241-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655028: 462217 keys, 19957191 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55bc641337241-8\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacted</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">263627170</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>压缩完成后，新合并的SSTables将成为最终的数据库记录集，旧的SSTables将被取消链接。</p>\n<p>如果我们登录到生产实例，我们可以看到正在更新的预写日志以及正在写入、读取和合并的单个SSTable。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9384/58c26daf-e386-397d-a70d-e0b929f02bb5.jpg\" width=\"650\" height=\"425\"></div>\n<div style=\"text-align: center\">日志和最近占用I/O的SSTable</div>\n<div style=\"text-align: center\"></div>\n<p>下面生产的SSTable统计数据中，可以看到一共有四个“级别”的文件，并且一个级别比一个级别的文件大。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9386/be0b7a4d-2501-3a32-8767-29ebfffb90ae.png\" width=\"650\" height=\"243\"></div>\n<p>RocksDB保存了索引和存储在SSTable的特定SSTables的<a href=\"https://en.wikipedia.org/wiki/Bloom_filter\" target=\"_blank\">布隆过滤器</a>，并将这些加载到内存中。通过查询这些过滤器和索引可以找到特定的key，然后将完整的SSTable作为LRU基础的一部分加载到内存中。</p>\n<p>在绝大多数情况下，我们就可以看到新的消息了，这使得我们的去重系统成为教科书中的布隆过滤器案例。</p>\n<p>布隆过滤器会告诉我们某个键“可能在集合中”，或者“绝对在集合中”。要做到这一点，布隆过滤器保存了已经见过的任何元素的多种哈希函数的设置位。如果设置了散列函数的所有位，则过滤器将返回消息“可能在集合中”。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9388/865a6b99-4181-3dc8-8400-5c9afab2d7b5.png\" width=\"650\" height=\"225\"></div>\n<p> </p>\n<p>我们的集合包含{x，y，z}，在布隆过滤器中查询w，则布隆过滤器会返回“不在集合中”，因为其中有一位没有设置。</p>\n<p>如果返回“可能在集合中”，则RocksDB可以从SSTables中查询到原始数据，以确定该项是否在该集合中实际存在。但在大多数情况下，我们不需查询任何SSTables，因为过滤器将返回“绝对不在集合”的响应。</p>\n<p>在我们查询RocksDB时，我们会为所有要查询的相关的messageId发出一个MultiGet。基于性能考虑，我们会批量地发布出去，以避免太多的并发锁定操作。它还允许我们批量处理来自Kafka的数据，这是为了实现顺序写入，而不是随机写入。</p>\n<p>以上回答了为什么读/写工作负载性能这么好的问题，但仍然存在如何老化数据这个问题。</p>\n<p><strong>删除：按大小来限制，而不是按时间来限制</strong></p>\n<p>在我们的去重过程中，我们必须要确定是否要将我们的系统限制在严格的“去重窗口”内，或者是通过磁盘上的总数据库大小来限制。</p>\n<p>为了避免系统突然崩溃导致去重系统接收到所有客户端的消息，我们决定按照大小来限制接收到消息数量，而不是按照设定的时间窗口来限制。这允许我们为每个RocksDB实例设置最大的大小，以能够处理突然的负载增加。但是其副作用是可能会将去重窗口降低到24小时以下。</p>\n<p>我们会定期在RocksDB中老化旧的key，使其不会增长到无限大小。为此，我们根据序列号保留key的第二个索引，以便我们可以先删除最早接收到的key。</p>\n<p>我们使用每个插入的key的序列号来删除对象，而不是使用RocksDB TTL（这需要在打开数据库的时候设置一个固定的TTL值）来删除。</p>\n<p>因为序列号是第二索引，所以我们可以快速地查询，并将其标记为已删除。下面是根据序列号进行删除的示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adda55b55c6086716563\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunc (d *DB) delete(n int) error {  \r\n        // open a connection to RocksDB  \r\n        ro := rocksdb.NewDefaultReadOptions()  \r\n        defer ro.Destroy()  \r\n  \r\n        // find our offset to seek through for writing deletes  \r\n        hint, err := d.GetBytes(ro, []byte(\"seek_hint\"))  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        it := d.NewIteratorCF(ro, d.seq)  \r\n        defer it.Close()  \r\n  \r\n        // seek to the first key, this is a small  \r\n        // optimization to ensure we don't use `.SeekToFirst()`  \r\n        // since it has to skip through a lot of tombstones.  \r\n        if len(hint) &gt; 0 {  \r\n                it.Seek(hint)  \r\n        } else {  \r\n                it.SeekToFirst()  \r\n        }  \r\n  \r\n        seqs := make([][]byte, 0, n)  \r\n        keys := make([][]byte, 0, n)  \r\n  \r\n        // look through our sequence numbers, counting up  \r\n        // append any data keys that we find to our set to be  \r\n        // deleted  \r\n        for it.Valid() &amp;&amp; len(seqs) &lt; n {  \r\n                k, v := it.Key(), it.Value()  \r\n                key := make([]byte, len(k.Data()))  \r\n                val := make([]byte, len(v.Data()))  \r\n  \r\n                copy(key, k.Data())  \r\n                copy(val, v.Data())  \r\n                seqs = append(seqs, key)  \r\n                keys = append(keys, val)  \r\n  \r\n                it.Next()  \r\n                k.Free()  \r\n                v.Free()  \r\n        }  \r\n  \r\n        wb := rocksdb.NewWriteBatch()  \r\n        wo := rocksdb.NewDefaultWriteOptions()  \r\n        defer wb.Destroy()  \r\n        defer wo.Destroy()  \r\n  \r\n        // preserve next sequence to be deleted.  \r\n        // this is an optimization so we can use `.Seek()`  \r\n        // instead of letting `.SeekToFirst()` skip through lots of tombstones.  \r\n        if len(seqs) &gt; 0 {  \r\n                hint, err := strconv.ParseUint(string(seqs[len(seqs)-1]), 10, 64)  \r\n                if err != nil {  \r\n                        return err  \r\n                }  \r\n  \r\n                buf := []byte(strconv.FormatUint(hint+1, 10))  \r\n                wb.Put([]byte(\"seek_hint\"), buf)  \r\n        }  \r\n  \r\n        // we not only purge the keys, but the sequence numbers as well  \r\n        for i := range seqs {  \r\n                wb.DeleteCF(d.seq, seqs[i])  \r\n                wb.Delete(keys[i])  \r\n        }  \r\n  \r\n        // finally, we persist the deletions to our database  \r\n        err = d.Write(wo, wb)  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        return it.Err()  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59adda55b55c6086716563-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adda55b55c6086716563-76\">76</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-1\"><span class=\"crayon-e\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">d *</span><span class=\"crayon-v\">DB</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// open a connection to RocksDB  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultReadOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-5\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// find our offset to seek through for writing deletes  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GetBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewIteratorCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-14\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// seek to the first key, this is a small  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// optimization to ensure we don't use `.SeekToFirst()`  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// since it has to skip through a lot of tombstones.  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SeekToFirst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-23\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-26\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// look through our sequence numbers, counting up  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// append any data keys that we find to our set to be  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// deleted  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-34\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-39\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-42\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-44\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWriteBatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultWriteOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-49\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// preserve next sequence to be deleted.  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// this is an optimization so we can use `.Seek()`  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// instead of letting `.SeekToFirst()` skip through lots of tombstones.  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-54\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-56\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-57\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-58\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-59\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormatUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-60\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-62\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// we not only purge the keys, but the sequence numbers as well  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DeleteCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-66\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-68\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// finally, we persist the deletions to our database  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-72\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-74\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59adda55b55c6086716563-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adda55b55c6086716563-76\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0126 seconds] -->\r\n<p>为了保证写入速度，RocksDB不会立即返回并删除一个键（记住，这些SSTable是不可变的！）。相反，RocksDB将添加一个“墓碑”，等到压缩时再进行删除。因此，我们可以通过顺序写入来快速地老化，避免因为删除旧项而破坏内存数据。</p>\n<p><strong>确保正确性</strong></p>\n<p>我们已经讨论了如何确保数十亿条消息投递的速度、规模和低成本的搜索。最后一个部分将讲述各种故障情况下我们如何确保数据的正确性。</p>\n<p><strong>EBS快照和附件</strong></p>\n<p>为了确保RocksDB实例不会因为错误的代码推送或潜在的EBS停机而损坏，我们会定期保存每个硬盘驱动器的快照。虽然EBS已经在底层进行了复制，但是这一步可以防止数据库受到某些底层机制的破坏。</p>\n<p>如果我们想要启用一个新实例，则可以先暂停消费者，将相关联的EBS驱动器分开，然后重新附加到新的实例上去。只要我们保证分区ID相同，重新分配磁盘是一个轻松的过程，而且也能保证数据的正确性。</p>\n<p>如果worker发生崩溃，我们依靠RocksDB内置的预写日志来确保不会丢失消息。消息不会从输入主题提交，除非RocksDB已经将消息持久化在日志中。</p>\n<p><strong>读取输出主题</strong></p>\n<p>你可能会注意到，本文直到这里都没有提到“原子”步骤，以使我们能够确保只投递一次消息。我们的worker有可能在任何时候崩溃，不如：写入RocksDB时、发布到输出主题时，或确认输入消息时。</p>\n<p>我们需要一个原子的“提交”点，并覆盖所有这些独立系统的事务。对于输入的数据，需要某个“事实来源”：输出主题。</p>\n<p>如果去重worker因为某些原因发生崩溃，或者遇到Kafka的某个错误，则系统在重新启动时，会首先查阅这个“事实来源”，输出主题，来判断事件是否已经发布出去。</p>\n<p>如果在输出主题中找到消息，而不是RocksDB（反之亦然），则去重worker将进行必要的修复工作以保持数据库和RocksDB之间的同步。实际上，我们使用输出主题作为我们的预写入日志和最终的事实来源，让RocksDB进行检查和校验。</p>\n<p><strong>在生产环境中</strong></p>\n<p>我们的去重系统已经在生产运行了3个月，对其运行的结果我们感到非常满意。我们有以下这些数据：</p>\n<ul>\n<li>在RocksDB中，有1.5TB的key存储在磁盘上</li>\n<li>在老化旧的key之前，有一个四个星期的去重窗口</li>\n<li>RocksDB实例中存储了大约600亿个key</li>\n<li>通过去重系统的消息达到2000亿条</li>\n</ul>\n<p>该系统快速、高效、容错性强，也非常容易理解。</p>\n<p>特别是我们的v2版本系统相比旧的去重系统有很多优点。</p>\n<p>以前我们将所有的key存储在Memcached中，并使用Memcached的原子CAS（check-and-set）操作来设置key。 Memcached起到了提交点和“原子”地发布key的作用。</p>\n<p>虽然这个功能很好，但它需要有大量的内存来支撑所有的key。此外，我们必须能够接受偶尔的Memcached故障，或者将用于高速内存故障切换的支出加倍。</p>\n<p>Kafka/RocksDB的组合相比旧系统有如下几个优势：</p>\n<p><strong>数据存储在磁盘上</strong>：在内存中保存所有的key或完整的索引，其代价是非常昂贵的。通过将更多的数据转移到磁盘，并利用多种不同级别的文件和索引，能够大幅削减成本。对于故障切换，我们能够使用冷备（EBS），而不用运行其他的热备实例。</p>\n<p><strong>分区</strong>：为了缩小key的搜索范围，避免在内存中加载太多的索引，我们需要保证某个消息能够路由到正确的worker。在Kafka中对上游进行分区可以对这些消息进行路由，从而更有效地缓存和查询。</p>\n<p><strong>显式地进行老化处理</strong>：在使用Memcached的时候，我们在每个key上设置一个TTL来标记是否超时，然后依靠Memcached进程来对超时的key进行处理。这使得我们在面对大量数据时，可能会耗尽内存，并且在丢弃大量超时消息时，Memcached的CPU使用率会飙升。而通过让客户端来处理key的删除，使得我们可以通过缩短去重窗口来优雅地处理。</p>\n<p><strong>将Kafka作为事实来源</strong>：为了真正地避免对多个提交点进行消息去重，我们必须使用所有下游消费者都常见的事实来源。使用Kafka作为“事实来源”是最合适的。在大多数失败的情况下（除了Kafka失败之外），消息要么会被写入Kafka，要么不会。使用Kafka可以确保按顺序投递消息，并在多台计算机之间进行磁盘复制，而不需要在内存中保留大量的数据。</p>\n<p><strong>批量读写</strong>：通过Kafka和RocksDB的批量I/O调用，我们可以通过利用顺序读写来获得更好的性能。与之前在Memcached中使用的随机访问不同，我们能够依靠磁盘的性能来达到更高的吞吐量，并只在内存中保留索引。</p>\n<p>总的来说，我们对自己构建的去重系统非常满意。使用Kafka和RocksDB作为流媒体应用的原语开始变得越来越普遍。我们很高兴能继续在这些原语之上构建新的分布式应用程序。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111809\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111809votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111809\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "其他,kafka,分布式", "front_image_path": "full/857f271a3adaff2d5c4056118f165d5851466b8a.jpg"}
{"url_object_id": "ba6118e0816d19137e375492919002d7", "title": "无我编程的 10 条戒律", "create_time": "2017/07/12", "url": "http://blog.jobbole.com/111796/", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg"], "praise_num": "1", "comment_num": 0, "fav_num": 6, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/tecla\">tecla</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.codinghorror.com/the-ten-commandments-of-egoless-programming/\">Jeff Atwood</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：无我编程（Egoless Programming）是一种编程风格，不是代码规范，旨在把代码评审中的人为因素最小化，应当在一个友好、合议方式进行，个人感情放一边，从而提高代码质量。</p>\n<p>在《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》书中，温伯格首次提出了无我编程十诫。本文则是 Stack Overflow 联合创始人 Jeff Atwood 对这十诫的注解。程序员普遍很自我（ego），都应该看看本文，时刻提醒自己。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg\"></p>\n<h3>1. 理解并接受这个事实：人都会犯错</h3>\n<p>关键是在错误引入到产品前，尽早发现。幸运的是，在我们的行业中，除了那些在喷气推进实验室（JPL）开发火箭导航软件的人来说，大多数错误并不要命，所以我们可以并且应该从错误中学习，一笑了之然后向前看。</p>\n<h3>2. 你和你的代码是两回事</h3>\n<p>切记，审查代码是为了找出问题，问题当然会被发现。当发现问题时，别有情绪，别往心里去。</p>\n<h3>3. 天外有天，人外有人</h3>\n<p>三人行必有我师焉。寻求并且接受其他人的意见，特别是当你认为不必要的时候。</p>\n<h3>4. 不要盲目地重写代码</h3>\n<p>修改代码和重写代码，两者有明确的界限。搞清楚区别，通过代码审查，改变代码风格，而不是做一个孤独的执行者。</p>\n<h3>5. 以尊重、敬意、耐心对待非技术人员</h3>\n<p>经常和程序员打交道的非技术人员普遍认为程序员充其量不过是一群自负的人，还是爱哭的娇气包。不要用生气和不耐烦强化这种偏见。</p>\n<h3>6. 惟有改变方永恒</h3>\n<p>以开放的态度对待改变并用微笑接受改变。将每一次需求、平台、工具的改变看作一个新挑战，而不是一些要反对的麻烦。</p>\n<h3>7. 真正且唯一的权威来自知识，不是地位</h3>\n<p>知识带来权威，权威带来尊敬。所以如果想在无我的环境里获得尊敬，那么请增长知识。</p>\n<h3>8. 为信仰战斗，但也要优雅地接受失败</h3>\n<p>要清楚，有时候你的想法会被否定。即使结果证明你是对的，不要报复，或者最多说几次‘我早就告诉过你’，不要让你过去的想法成为殉道者或者战斗口号。</p>\n<h3>9. 不要做个死宅</h3>\n<p>不要成为一直在小黑屋里编程，只在买可乐时出现的人。这样的人不与人接触，不被重视，不受控制并且不能融入开放合作的环境。</p>\n<h3>10. 对事不对人</h3>\n<p>要批评的是代码，不是写代码的人。尽可能让评论正面，并且只关注于提升代码。评论只涉及内部标准、编程规范、提升性能等等方面。</p>\n<p> </p>\n<p>软件的人性标准是永不过时的，《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》英文版早在 1971 年出版了，正好是我出生后第二年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111796\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111796votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111796\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">tecla</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/e7e39d569b983a82c96dbebcc426da0f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢逻辑，虽然不是很精通，喜欢英语，虽然不是都能完全理解。不是聪明人，但是希望能成为快乐的奋斗人。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/tecla\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/tecla/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/tecla/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"QQ：1942295950\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：ting-lyu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/xiangshang\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "职场,Code Review,程序员", "front_image_path": "full/a01ba8722479a3c05e927ef40ac381fcf60c6f35.jpg"}
{"url_object_id": "0652cdaecb237b8b1ccdb84d87bdf60c", "title": "Linux 内核驱动中对文件的读写", "create_time": "2017/07/13", "url": "http://blog.jobbole.com/111837/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_num": "1", "comment_num": 0, "fav_num": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.chinaunix.net/uid-13059007-id-5766941.html\">niuyimail</a>   </div><p>有时候需要在<a class=\"keyword_link\" href=\"http://www.chinabyte.com/keyword/Linux/\" target=\"_blank\">Linux</a> kernel–大多是在需要调试的驱动程序–中读写文件数据。在kernel中操作文件没有标准库可用，需要利用kernel的一些函数，这些函数主 要有： filp_open() filp_close(), vfs_read() vfs_write()，set_fs()，get_fs()等，这些函数在linux/fs.h和asm/uaccess.h头文件中声明。下面介绍主要步骤</p>\n<h3>1. 打开文件</h3>\n<p>filp_open()在kernel中可以打开文件，其原形如下：</p>\n<p>strcut file* filp_open(const char* filename, int open_mode, int mode);</p>\n<p>该函数返回strcut file*结构指针，供后继函数操作使用，该返回值用IS_ERR()来检验其有效性。</p>\n<h4>参数说明</h4>\n<p>filename： 表明要打开或创建文件的名称(包括路径部分)。在内核中打开的文件时需要注意打开的时机，很容易出现需要打开文件的驱动很早就加载并打开文件，但需要打开的文件所在设备还不有挂载到文件系统中，而导致打开失败。</p>\n<p>open_mode： 文件的打开方式，其取值与标准库中的open相应参数类似，可以取O_CREAT,O_RDWR,O_RDONLY等。</p>\n<p>mode： 创建文件时使用，设置创建文件的读写权限，其它情况可以匆略设为0</p>\n<h3>2. 读写文件</h3>\n<p>kernel中文件的读写操作可以使用vfs_read()和vfs_write，在使用这两个函数前需要说明一下get_fs()和 set_fs()这两个函数。</p>\n<p>vfs_read() vfs_write()两函数的原形如下：</p>\n<p>ssize_t vfs_read(struct file* filp, char __user* buffer, size_t len, loff_t* pos);</p>\n<p>ssize_t vfs_write(struct file* filp, const char __user* buffer, size_t len, loff_t* pos);</p>\n<p>注意这两个函数的第二个参数buffer，前面都有__user修饰符，这就要求这两个buffer指针都应该指向用户空间的内存，如果对该参数传 递kernel空间的指针，这两个函数都会返回失败-EFAULT。但在Kernel中，我们一般不容易生成用户空间的指针，或者不方便独立使用用户空间 内存。要使这两个读写函数使用kernel空间的buffer指针也能正确工作，需要使用set_fs()函数或宏(set_fs()可能是宏定义)，如 果为函数，其原形如下：</p>\n<p>void set_fs(mm_segment_t fs);</p>\n<p>该函数的作用是改变kernel对内存地址检查的处理方式，其实该函数的参数fs只有两个取值：USER_DS，KERNEL_DS，分别代表 用户空间和内核空间，默认情况下，kernel取值为USER_DS，即对用户空间地址检查并做变换。那么要在这种对内存地址做检查变换的函数中使用内核 空间地址，就需要使用set_fs(KERNEL_DS)进行设置。get_fs()一般也可能是宏定义，它的作用是取得当前的设置，这两个函数的一般用 法为：</p>\n<p>mm_segment_t old_fs;</p>\n<p>old_fs = get_fs();</p>\n<p>set_fs(KERNEL_DS);</p>\n<p>…… //与内存有关的操作</p>\n<p>set_fs(old_fs);</p>\n<p>还有一些其它的内核函数也有用__user修饰的参数，在kernel中需要用kernel空间的内存代替时，都可以使用类似办法。</p>\n<p>使用vfs_read()和vfs_write()最后需要注意的一点是最后的参数loff_t * pos，pos所指向的值要初始化，表明从文件的什么地方开始读写。</p>\n<h3>3. 关闭读写文件</h3>\n<p>int filp_close(struct file*filp, fl_owner_t id);</p>\n<p>该函数的使用很简单，第二个参数一般传递NULL值，也有用current-&gt;files作为实参的。</p>\n<p>使用以上函数的其它注意点：</p>\n<p>1. 其实Linux Kernel组成员不赞成在kernel中独立的读写文件(这样做可能会影响到策略和安全问题)，对内核需要的文件内容，最好由应用层配合完成。</p>\n<p>2. 在可加载的kernel module中使用这种方式读写文件可能使<a class=\"keyword_link\" href=\"http://www.chinabyte.com/keyword/%E6%A8%A1%E5%9D%97/\" target=\"_blank\">模块</a>加载失败，原因是内核可能没有EXPORT你所需要的所有这些函数。</p>\n<p>3. 分析以上某些函数的参数可以看出，这些函数的正确运行需要依赖于进程环境，因此，有些函数不能在中断的handle或Kernel中不属于任可进程的代码 中执行，否则可能出现崩溃，要避免这种情况发生，可以在kernel中创建内核线程，将这些函数放在线程环境下执行(创建内核线程的方式请参数 kernel_thread()函数)。</p>\n<p>在VFS的支持下，用户态进程读写 任何类型的文件系统都可以使用read和write着两个系统调用，但是在linux内核中没有这样的系统调用我们如何操作文件呢？我们知道read和 write在进入内核态之后，实际执行的是sys_read和sys_write，但是查看内核源代码，发现这些操作文件的函数都没有导出(使用 EXPORT_SYMBOL导出)，也就是说在内核模块中是不能使用的，那如何是好？</p>\n<p>通过查看sys_open的源码我 们发现，其主要使用了do_filp_open()函数，该函数在fs/namei.c中，而在改文件中，filp_open函数也是调用了 do_filp_open函数，并且接口和sys_open函数极为相似，调用参数也和sys_open一样，并且使用EXPORT_SYMBOL导出 了，所以我们猜想该函数可以打开文件，功能和open一样。使用同样的查找方法，我们找出了一组在内核中操作文件的函数，如下：</p>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">\n<tbody>\n<tr>\n<td align=\"center\">功能</td>\n<td align=\"center\">函数原型</td>\n</tr>\n<tr>\n<td>打开文件</td>\n<td><strong>struct</strong> file *filp_open(<strong>const</strong> <strong>char</strong> *filename, <strong>int</strong> flags, <strong>int</strong> mode)</td>\n</tr>\n<tr>\n<td>读取文件</td>\n<td><strong>ssize_t</strong> vfs_read(<strong>struct</strong> file *file, <strong>char</strong> __user *buf, <strong>size_t</strong> count, loff_t *pos)</td>\n</tr>\n<tr>\n<td>写文件</td>\n<td><strong>ssize_t</strong> vfs_write(<strong>struct</strong> file *file, <strong>const</strong> <strong>char</strong> __user *buf, <strong>size_t</strong> count, loff_t *pos)</td>\n</tr>\n<tr>\n<td>关闭文件</td>\n<td><strong>int</strong> filp_close(<strong>struct</strong> file *filp, fl_owner_t id)</td>\n</tr>\n</tbody>\n</table>\n<p>我们注意到在vfs_read和vfs_write函数中，其参数buf指向的用户空间的内存地址，如果我们直接使用内核空间的指针，则会返回-EFALUT。所以我们需要使用</p>\n<p>set_fs()和get_fs()宏来改变内核对内存地址检查的处理方式，所以在内核空间对文件的读写流程为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf05534bcf595780084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmm_segment_t fs = get_fs();\r\nset_fs(KERNEL_FS);\r\n//vfs_write();\r\nvfs_read();\r\nset_fs(fs);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf05534bcf595780084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bcf595780084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bcf595780084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bcf595780084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bcf595780084-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf05534bcf595780084-1\"><span class=\"crayon-e\">mm_segment_t </span><span class=\"crayon-v\">fs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bcf595780084-2\"><span class=\"crayon-e\">set_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">KERNEL_FS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bcf595780084-3\"><span class=\"crayon-c\">//vfs_write();</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bcf595780084-4\"><span class=\"crayon-e\">vfs_read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bcf595780084-5\"><span class=\"crayon-e\">set_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>下面为一个在内核中对文件操作的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59adf05534bdb672348011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;linux/module.h&gt;\r\n#include &lt;linux/init.h&gt;\r\n#include &lt;linux/fs.h&gt;\r\n#include &lt;linux/uaccess.h&gt;\r\nstatic char buf[] = \"你好\";\r\nstatic char buf1[10];\r\n \r\nint __init hello_init(void)\r\n{\r\n    struct file *fp;\r\n    mm_segment_t fs;\r\n    loff_t pos;\r\n    printk(\"hello enter\\n\");\r\n    fp = filp_open(\"/home/niutao/kernel_file\", O_RDWR | O_CREAT, 0644);\r\n    if (IS_ERR(fp)) {\r\n        printk(\"create file error\\n\");\r\n        return -1;\r\n    }\r\n    fs = get_fs();\r\n    set_fs(KERNEL_DS);\r\n    pos = 0;\r\n    vfs_write(fp, buf, sizeof(buf), &amp;pos);\r\n    pos = 0;\r\n    vfs_read(fp, buf1, sizeof(buf), &amp;pos);\r\n    printk(\"read: %s\\n\", buf1);\r\n    filp_close(fp, NULL);\r\n    set_fs(fs);\r\n    return 0;\r\n}\r\nvoid __exit hello_exit(void)\r\n{\r\n    printk(\"hello exit\\n\");\r\n}\r\n \r\nmodule_init(hello_init);\r\nmodule_exit(hello_exit);\r\n \r\nMODULE_LICENSE(\"GPL\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59adf05534bdb672348011-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59adf05534bdb672348011-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-1\"><span class=\"crayon-p\">#include &lt;linux/module.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-2\"><span class=\"crayon-p\">#include &lt;linux/init.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-3\"><span class=\"crayon-p\">#include &lt;linux/fs.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-4\"><span class=\"crayon-p\">#include &lt;linux/uaccess.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-5\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"你好\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-6\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf1</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init </span><span class=\"crayon-e\">hello_init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-9\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">file *</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">mm_segment_t </span><span class=\"crayon-v\">fs</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">loff_t </span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printk</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"hello enter\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filp_open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/home/niutao/kernel_file\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_RDWR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_CREAT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0644</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">IS_ERR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printk</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"create file error\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">set_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">KERNEL_DS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">vfs_write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">vfs_read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printk</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"read: %s\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">filp_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">set_fs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-29\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-30\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__exit </span><span class=\"crayon-e\">hello_exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-31\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printk</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"hello exit\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-34\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-35\"><span class=\"crayon-e\">module_init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hello_init</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-36\"><span class=\"crayon-e\">module_exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hello_exit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59adf05534bdb672348011-37\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59adf05534bdb672348011-38\"><span class=\"crayon-e\">MODULE_LICENSE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"GPL\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111837\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111837votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111837\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Linux,内核", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
